Python Script: extract_cs_files.py
Date: 2025-12-05 12:11:28
Source Paths File: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\ESTRATTORE DI CODICE IN UNICO TXT\extract_cs_files\paths.txt
Processed Roots (Directories from paths.txt or Parent Directories of files from paths.txt):
- C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard
- C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine
- C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend
========================================


--- Files from Project Root: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard ---

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\eslint.config.js
// ==================================================

import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\index.html
// ==================================================

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>zen-youtube-coach-dashboard</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\package-lock.json
// ==================================================

{
  "name": "zen-youtube-coach-dashboard",
  "version": "0.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "zen-youtube-coach-dashboard",
      "version": "0.0.0",
      "dependencies": {
        "react": "^19.2.0",
        "react-dom": "^19.2.0",
        "react-draggable": "^4.5.0",
        "react-grid-layout": "^1.5.2",
        "react-icons": "^5.5.0",
        "react-resizable": "^3.0.5",
        "react-router-dom": "^7.9.6"
      },
      "devDependencies": {
        "@eslint/js": "^9.39.1",
        "@types/react": "^19.2.5",
        "@types/react-dom": "^19.2.3",
        "@vitejs/plugin-react": "^5.1.1",
        "eslint": "^9.39.1",
        "eslint-plugin-react-hooks": "^7.0.1",
        "eslint-plugin-react-refresh": "^0.4.24",
        "globals": "^16.5.0",
        "vite": "^7.2.4"
      }
    },
    "node_modules/@babel/code-frame": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.27.1.tgz",
      "integrity": "sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-validator-identifier": "^7.27.1",
        "js-tokens": "^4.0.0",
        "picocolors": "^1.1.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/compat-data": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/compat-data/-/compat-data-7.28.5.tgz",
      "integrity": "sha512-6uFXyCayocRbqhZOB+6XcuZbkMNimwfVGFji8CTZnCzOHVGvDqzvitu1re2AU5LROliz7eQPhB8CpAMvnx9EjA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/core": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/core/-/core-7.28.5.tgz",
      "integrity": "sha512-e7jT4DxYvIDLk1ZHmU/m/mB19rex9sv0c2ftBtjSBv+kVM/902eh0fINUzD7UwLLNR+jU585GxUJ8/EBfAM5fw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.5",
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-module-transforms": "^7.28.3",
        "@babel/helpers": "^7.28.4",
        "@babel/parser": "^7.28.5",
        "@babel/template": "^7.27.2",
        "@babel/traverse": "^7.28.5",
        "@babel/types": "^7.28.5",
        "@jridgewell/remapping": "^2.3.5",
        "convert-source-map": "^2.0.0",
        "debug": "^4.1.0",
        "gensync": "^1.0.0-beta.2",
        "json5": "^2.2.3",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/babel"
      }
    },
    "node_modules/@babel/generator": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/generator/-/generator-7.28.5.tgz",
      "integrity": "sha512-3EwLFhZ38J4VyIP6WNtt2kUdW9dokXA9Cr4IVIFHuCpZ3H8/YFOl5JjZHisrn1fATPBmKKqXzDFvh9fUwHz6CQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.28.5",
        "@babel/types": "^7.28.5",
        "@jridgewell/gen-mapping": "^0.3.12",
        "@jridgewell/trace-mapping": "^0.3.28",
        "jsesc": "^3.0.2"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-compilation-targets": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/helper-compilation-targets/-/helper-compilation-targets-7.27.2.tgz",
      "integrity": "sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/compat-data": "^7.27.2",
        "@babel/helper-validator-option": "^7.27.1",
        "browserslist": "^4.24.0",
        "lru-cache": "^5.1.1",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-globals": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/helper-globals/-/helper-globals-7.28.0.tgz",
      "integrity": "sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-imports": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-imports/-/helper-module-imports-7.27.1.tgz",
      "integrity": "sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/traverse": "^7.27.1",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-transforms": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-transforms/-/helper-module-transforms-7.28.3.tgz",
      "integrity": "sha512-gytXUbs8k2sXS9PnQptz5o0QnpLL51SwASIORY6XaBKF88nsOT0Zw9szLqlSGQDP/4TljBAD5y98p2U1fqkdsw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-imports": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.27.1",
        "@babel/traverse": "^7.28.3"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-plugin-utils": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-plugin-utils/-/helper-plugin-utils-7.27.1.tgz",
      "integrity": "sha512-1gn1Up5YXka3YYAHGKpbideQ5Yjf1tDa9qYcgysz+cNCXukyLl6DjPXhD3VRwSb8c0J9tA4b2+rHEZtc6R0tlw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-string-parser": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",
      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-identifier": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.28.5.tgz",
      "integrity": "sha512-qSs4ifwzKJSV39ucNjsvc6WVHs6b7S03sOh2OcHF9UHfVPqWWALUsNUVzhSBiItjRZoLHx7nIarVjqKVusUZ1Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-option": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-option/-/helper-validator-option-7.27.1.tgz",
      "integrity": "sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helpers": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/helpers/-/helpers-7.28.4.tgz",
      "integrity": "sha512-HFN59MmQXGHVyYadKLVumYsA9dBFun/ldYxipEjzA4196jpLZd8UjEEBLkbEkvfYreDqJhZxYAWFPtrfhNpj4w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.4"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/parser": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.28.5.tgz",
      "integrity": "sha512-KKBU1VGYR7ORr3At5HAtUQ+TV3SzRCXmA/8OdDZiLDBIZxVyzXuztPjfLd3BV1PRAQGCMWWSHYhL0F8d5uHBDQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.5"
      },
      "bin": {
        "parser": "bin/babel-parser.js"
      },
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@babel/plugin-transform-react-jsx-self": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-self/-/plugin-transform-react-jsx-self-7.27.1.tgz",
      "integrity": "sha512-6UzkCs+ejGdZ5mFFC/OCUrv028ab2fp1znZmCZjAOBKiBK2jXD1O+BPSfX8X2qjJ75fZBMSnQn3Rq2mrBJK2mw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-react-jsx-source": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-source/-/plugin-transform-react-jsx-source-7.27.1.tgz",
      "integrity": "sha512-zbwoTsBruTeKB9hSq73ha66iFeJHuaFkUbwvqElnygoNbj/jHRsSeokowZFN3CZ64IvEqcmmkVe89OPXc7ldAw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/template": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/template/-/template-7.27.2.tgz",
      "integrity": "sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/parser": "^7.27.2",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/traverse": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/traverse/-/traverse-7.28.5.tgz",
      "integrity": "sha512-TCCj4t55U90khlYkVV/0TfkJkAkUg3jZFA3Neb7unZT8CPok7iiRfaX0F+WnqWqt7OxhOn0uBKXCw4lbL8W0aQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.5",
        "@babel/helper-globals": "^7.28.0",
        "@babel/parser": "^7.28.5",
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.5",
        "debug": "^4.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/types": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.28.5.tgz",
      "integrity": "sha512-qQ5m48eI/MFLQ5PxQj4PFaprjyCTLI37ElWMmNs0K8Lk3dVeOdNpB3ks8jc7yM5CDmVC73eMVk/trk3fgmrUpA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-string-parser": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.28.5"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@esbuild/aix-ppc64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.25.12.tgz",
      "integrity": "sha512-Hhmwd6CInZ3dwpuGTF8fJG6yoWmsToE+vYgD4nytZVxcu1ulHpUQRAB1UJ8+N1Am3Mz4+xOByoQoSZf4D+CpkA==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "aix"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-arm": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.25.12.tgz",
      "integrity": "sha512-VJ+sKvNA/GE7Ccacc9Cha7bpS8nyzVv0jdVgwNDaR4gDMC/2TTRc33Ip8qrNYUcpkOHUT5OZ0bUcNNVZQ9RLlg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.25.12.tgz",
      "integrity": "sha512-6AAmLG7zwD1Z159jCKPvAxZd4y/VTO0VkprYy+3N2FtJ8+BQWFXU+OxARIwA46c5tdD9SsKGZ/1ocqBS/gAKHg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.25.12.tgz",
      "integrity": "sha512-5jbb+2hhDHx5phYR2By8GTWEzn6I9UqR11Kwf22iKbNpYrsmRB18aX/9ivc5cabcUiAT/wM+YIZ6SG9QO6a8kg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/darwin-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.25.12.tgz",
      "integrity": "sha512-N3zl+lxHCifgIlcMUP5016ESkeQjLj/959RxxNYIthIg+CQHInujFuXeWbWMgnTo4cp5XVHqFPmpyu9J65C1Yg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/darwin-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.25.12.tgz",
      "integrity": "sha512-HQ9ka4Kx21qHXwtlTUVbKJOAnmG1ipXhdWTmNXiPzPfWKpXqASVcWdnf2bnL73wgjNrFXAa3yYvBSd9pzfEIpA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/freebsd-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.25.12.tgz",
      "integrity": "sha512-gA0Bx759+7Jve03K1S0vkOu5Lg/85dou3EseOGUes8flVOGxbhDDh/iZaoek11Y8mtyKPGF3vP8XhnkDEAmzeg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/freebsd-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.25.12.tgz",
      "integrity": "sha512-TGbO26Yw2xsHzxtbVFGEXBFH0FRAP7gtcPE7P5yP7wGy7cXK2oO7RyOhL5NLiqTlBh47XhmIUXuGciXEqYFfBQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-arm": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.25.12.tgz",
      "integrity": "sha512-lPDGyC1JPDou8kGcywY0YILzWlhhnRjdof3UlcoqYmS9El818LLfJJc3PXXgZHrHCAKs/Z2SeZtDJr5MrkxtOw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.25.12.tgz",
      "integrity": "sha512-8bwX7a8FghIgrupcxb4aUmYDLp8pX06rGh5HqDT7bB+8Rdells6mHvrFHHW2JAOPZUbnjUpKTLg6ECyzvas2AQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-ia32": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.25.12.tgz",
      "integrity": "sha512-0y9KrdVnbMM2/vG8KfU0byhUN+EFCny9+8g202gYqSSVMonbsCfLjUO+rCci7pM0WBEtz+oK/PIwHkzxkyharA==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-loong64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.25.12.tgz",
      "integrity": "sha512-h///Lr5a9rib/v1GGqXVGzjL4TMvVTv+s1DPoxQdz7l/AYv6LDSxdIwzxkrPW438oUXiDtwM10o9PmwS/6Z0Ng==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-mips64el": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.25.12.tgz",
      "integrity": "sha512-iyRrM1Pzy9GFMDLsXn1iHUm18nhKnNMWscjmp4+hpafcZjrr2WbT//d20xaGljXDBYHqRcl8HnxbX6uaA/eGVw==",
      "cpu": [
        "mips64el"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-ppc64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.25.12.tgz",
      "integrity": "sha512-9meM/lRXxMi5PSUqEXRCtVjEZBGwB7P/D4yT8UG/mwIdze2aV4Vo6U5gD3+RsoHXKkHCfSxZKzmDssVlRj1QQA==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-riscv64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.25.12.tgz",
      "integrity": "sha512-Zr7KR4hgKUpWAwb1f3o5ygT04MzqVrGEGXGLnj15YQDJErYu/BGg+wmFlIDOdJp0PmB0lLvxFIOXZgFRrdjR0w==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-s390x": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.25.12.tgz",
      "integrity": "sha512-MsKncOcgTNvdtiISc/jZs/Zf8d0cl/t3gYWX8J9ubBnVOwlk65UIEEvgBORTiljloIWnBzLs4qhzPkJcitIzIg==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.25.12.tgz",
      "integrity": "sha512-uqZMTLr/zR/ed4jIGnwSLkaHmPjOjJvnm6TVVitAa08SLS9Z0VM8wIRx7gWbJB5/J54YuIMInDquWyYvQLZkgw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/netbsd-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-arm64/-/netbsd-arm64-0.25.12.tgz",
      "integrity": "sha512-xXwcTq4GhRM7J9A8Gv5boanHhRa/Q9KLVmcyXHCTaM4wKfIpWkdXiMog/KsnxzJ0A1+nD+zoecuzqPmCRyBGjg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/netbsd-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.25.12.tgz",
      "integrity": "sha512-Ld5pTlzPy3YwGec4OuHh1aCVCRvOXdH8DgRjfDy/oumVovmuSzWfnSJg+VtakB9Cm0gxNO9BzWkj6mtO1FMXkQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openbsd-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-arm64/-/openbsd-arm64-0.25.12.tgz",
      "integrity": "sha512-fF96T6KsBo/pkQI950FARU9apGNTSlZGsv1jZBAlcLL1MLjLNIWPBkj5NlSz8aAzYKg+eNqknrUJ24QBybeR5A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openbsd-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.25.12.tgz",
      "integrity": "sha512-MZyXUkZHjQxUvzK7rN8DJ3SRmrVrke8ZyRusHlP+kuwqTcfWLyqMOE3sScPPyeIXN/mDJIfGXvcMqCgYKekoQw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openharmony-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/openharmony-arm64/-/openharmony-arm64-0.25.12.tgz",
      "integrity": "sha512-rm0YWsqUSRrjncSXGA7Zv78Nbnw4XL6/dzr20cyrQf7ZmRcsovpcRBdhD43Nuk3y7XIoW2OxMVvwuRvk9XdASg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openharmony"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/sunos-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.25.12.tgz",
      "integrity": "sha512-3wGSCDyuTHQUzt0nV7bocDy72r2lI33QL3gkDNGkod22EsYl04sMf0qLb8luNKTOmgF/eDEDP5BFNwoBKH441w==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "sunos"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.25.12.tgz",
      "integrity": "sha512-rMmLrur64A7+DKlnSuwqUdRKyd3UE7oPJZmnljqEptesKM8wx9J8gx5u0+9Pq0fQQW8vqeKebwNXdfOyP+8Bsg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-ia32": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.25.12.tgz",
      "integrity": "sha512-HkqnmmBoCbCwxUKKNPBixiWDGCpQGVsrQfJoVGYLPT41XWF8lHuE5N6WhVia2n4o5QK5M4tYr21827fNhi4byQ==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.25.12.tgz",
      "integrity": "sha512-alJC0uCZpTFrSL0CCDjcgleBXPnCrEAhTBILpeAp7M/OFgoqtAetfBzX0xM00MUsVVPpVjlPuMbREqnZCXaTnA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@eslint-community/eslint-utils": {
      "version": "4.9.0",
      "resolved": "https://registry.npmjs.org/@eslint-community/eslint-utils/-/eslint-utils-4.9.0.tgz",
      "integrity": "sha512-ayVFHdtZ+hsq1t2Dy24wCmGXGe4q9Gu3smhLYALJrr473ZH27MsnSL+LKUlimp4BWJqMDMLmPpx/Q9R3OAlL4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "eslint-visitor-keys": "^3.4.3"
      },
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      },
      "peerDependencies": {
        "eslint": "^6.0.0 || ^7.0.0 || >=8.0.0"
      }
    },
    "node_modules/@eslint-community/eslint-utils/node_modules/eslint-visitor-keys": {
      "version": "3.4.3",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz",
      "integrity": "sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint-community/regexpp": {
      "version": "4.12.2",
      "resolved": "https://registry.npmjs.org/@eslint-community/regexpp/-/regexpp-4.12.2.tgz",
      "integrity": "sha512-EriSTlt5OC9/7SXkRSCAhfSxxoSUgBm33OH+IkwbdpgoqsSsUg7y3uh+IICI/Qg4BBWr3U2i39RpmycbxMq4ew==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^12.0.0 || ^14.0.0 || >=16.0.0"
      }
    },
    "node_modules/@eslint/config-array": {
      "version": "0.21.1",
      "resolved": "https://registry.npmjs.org/@eslint/config-array/-/config-array-0.21.1.tgz",
      "integrity": "sha512-aw1gNayWpdI/jSYVgzN5pL0cfzU02GT3NBpeT/DXbx1/1x7ZKxFPd9bwrzygx/qiwIQiJ1sw/zD8qY/kRvlGHA==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/object-schema": "^2.1.7",
        "debug": "^4.3.1",
        "minimatch": "^3.1.2"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/config-helpers": {
      "version": "0.4.2",
      "resolved": "https://registry.npmjs.org/@eslint/config-helpers/-/config-helpers-0.4.2.tgz",
      "integrity": "sha512-gBrxN88gOIf3R7ja5K9slwNayVcZgK6SOUORm2uBzTeIEfeVaIhOpCtTox3P6R7o2jLFwLFTLnC7kU/RGcYEgw==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/core": "^0.17.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/core": {
      "version": "0.17.0",
      "resolved": "https://registry.npmjs.org/@eslint/core/-/core-0.17.0.tgz",
      "integrity": "sha512-yL/sLrpmtDaFEiUj1osRP4TI2MDz1AddJL+jZ7KSqvBuliN4xqYY54IfdN8qD8Toa6g1iloph1fxQNkjOxrrpQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@types/json-schema": "^7.0.15"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/eslintrc": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-3.3.1.tgz",
      "integrity": "sha512-gtF186CXhIl1p4pJNGZw8Yc6RlshoePRvE0X91oPGb3vZ8pM3qOS9W9NGPat9LziaBV7XrJWGylNQXkGcnM3IQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ajv": "^6.12.4",
        "debug": "^4.3.2",
        "espree": "^10.0.1",
        "globals": "^14.0.0",
        "ignore": "^5.2.0",
        "import-fresh": "^3.2.1",
        "js-yaml": "^4.1.0",
        "minimatch": "^3.1.2",
        "strip-json-comments": "^3.1.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint/eslintrc/node_modules/globals": {
      "version": "14.0.0",
      "resolved": "https://registry.npmjs.org/globals/-/globals-14.0.0.tgz",
      "integrity": "sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/@eslint/js": {
      "version": "9.39.1",
      "resolved": "https://registry.npmjs.org/@eslint/js/-/js-9.39.1.tgz",
      "integrity": "sha512-S26Stp4zCy88tH94QbBv3XCuzRQiZ9yXofEILmglYTh/Ug/a9/umqvgFtYBAo3Lp0nsI/5/qH1CCrbdK3AP1Tw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      }
    },
    "node_modules/@eslint/object-schema": {
      "version": "2.1.7",
      "resolved": "https://registry.npmjs.org/@eslint/object-schema/-/object-schema-2.1.7.tgz",
      "integrity": "sha512-VtAOaymWVfZcmZbp6E2mympDIHvyjXs/12LqWYjVw6qjrfF+VK+fyG33kChz3nnK+SU5/NeHOqrTEHS8sXO3OA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/plugin-kit": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/@eslint/plugin-kit/-/plugin-kit-0.4.1.tgz",
      "integrity": "sha512-43/qtrDUokr7LJqoF2c3+RInu/t4zfrpYdoSDfYyhg52rwLV6TnOvdG4fXm7IkSB3wErkcmJS9iEhjVtOSEjjA==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/core": "^0.17.0",
        "levn": "^0.4.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@humanfs/core": {
      "version": "0.19.1",
      "resolved": "https://registry.npmjs.org/@humanfs/core/-/core-0.19.1.tgz",
      "integrity": "sha512-5DyQ4+1JEUzejeK1JGICcideyfUbGixgS9jNgex5nqkW+cY7WZhxBigmieN5Qnw9ZosSNVC9KQKyb+GUaGyKUA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanfs/node": {
      "version": "0.16.7",
      "resolved": "https://registry.npmjs.org/@humanfs/node/-/node-0.16.7.tgz",
      "integrity": "sha512-/zUx+yOsIrG4Y43Eh2peDeKCxlRt/gET6aHfaKpuq267qXdYDFViVHfMaLyygZOnl0kGWxFIgsBy8QFuTLUXEQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@humanfs/core": "^0.19.1",
        "@humanwhocodes/retry": "^0.4.0"
      },
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanwhocodes/module-importer": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz",
      "integrity": "sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=12.22"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@humanwhocodes/retry": {
      "version": "0.4.3",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/retry/-/retry-0.4.3.tgz",
      "integrity": "sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@jridgewell/gen-mapping": {
      "version": "0.3.13",
      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",
      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.0",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/remapping": {
      "version": "2.3.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/remapping/-/remapping-2.3.5.tgz",
      "integrity": "sha512-LI9u/+laYG4Ds1TDKSJW2YPrIlcVYOwi2fUC6xB43lueCjgxV4lffOCZCtYFiH6TNOX+tQKXx97T4IKHbhyHEQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/gen-mapping": "^0.3.5",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/resolve-uri": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
      "integrity": "sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.31",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.31.tgz",
      "integrity": "sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.1.0",
        "@jridgewell/sourcemap-codec": "^1.4.14"
      }
    },
    "node_modules/@rolldown/pluginutils": {
      "version": "1.0.0-beta.47",
      "resolved": "https://registry.npmjs.org/@rolldown/pluginutils/-/pluginutils-1.0.0-beta.47.tgz",
      "integrity": "sha512-8QagwMH3kNCuzD8EWL8R2YPW5e4OrHNSAHRFDdmFqEwEaD/KcNKjVoumo+gP2vW5eKB2UPbM6vTYiGZX0ixLnw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@rollup/rollup-android-arm-eabi": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.53.3.tgz",
      "integrity": "sha512-mRSi+4cBjrRLoaal2PnqH82Wqyb+d3HsPUN/W+WslCXsZsyHa9ZeQQX/pQsZaVIWDkPcpV6jJ+3KLbTbgnwv8w==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-android-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm64/-/rollup-android-arm64-4.53.3.tgz",
      "integrity": "sha512-CbDGaMpdE9sh7sCmTrTUyllhrg65t6SwhjlMJsLr+J8YjFuPmCEjbBSx4Z/e4SmDyH3aB5hGaJUP2ltV/vcs4w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-darwin-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-arm64/-/rollup-darwin-arm64-4.53.3.tgz",
      "integrity": "sha512-Nr7SlQeqIBpOV6BHHGZgYBuSdanCXuw09hon14MGOLGmXAFYjx1wNvquVPmpZnl0tLjg25dEdr4IQ6GgyToCUA==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-darwin-x64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-x64/-/rollup-darwin-x64-4.53.3.tgz",
      "integrity": "sha512-DZ8N4CSNfl965CmPktJ8oBnfYr3F8dTTNBQkRlffnUarJ2ohudQD17sZBa097J8xhQ26AwhHJ5mvUyQW8ddTsQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-arm64/-/rollup-freebsd-arm64-4.53.3.tgz",
      "integrity": "sha512-yMTrCrK92aGyi7GuDNtGn2sNW+Gdb4vErx4t3Gv/Tr+1zRb8ax4z8GWVRfr3Jw8zJWvpGHNpss3vVlbF58DZ4w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-x64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-x64/-/rollup-freebsd-x64-4.53.3.tgz",
      "integrity": "sha512-lMfF8X7QhdQzseM6XaX0vbno2m3hlyZFhwcndRMw8fbAGUGL3WFMBdK0hbUBIUYcEcMhVLr1SIamDeuLBnXS+Q==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-gnueabihf": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-gnueabihf/-/rollup-linux-arm-gnueabihf-4.53.3.tgz",
      "integrity": "sha512-k9oD15soC/Ln6d2Wv/JOFPzZXIAIFLp6B+i14KhxAfnq76ajt0EhYc5YPeX6W1xJkAdItcVT+JhKl1QZh44/qw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-musleabihf": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-musleabihf/-/rollup-linux-arm-musleabihf-4.53.3.tgz",
      "integrity": "sha512-vTNlKq+N6CK/8UktsrFuc+/7NlEYVxgaEgRXVUVK258Z5ymho29skzW1sutgYjqNnquGwVUObAaxae8rZ6YMhg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-gnu/-/rollup-linux-arm64-gnu-4.53.3.tgz",
      "integrity": "sha512-RGrFLWgMhSxRs/EWJMIFM1O5Mzuz3Xy3/mnxJp/5cVhZ2XoCAxJnmNsEyeMJtpK+wu0FJFWz+QF4mjCA7AUQ3w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-musl": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-musl/-/rollup-linux-arm64-musl-4.53.3.tgz",
      "integrity": "sha512-kASyvfBEWYPEwe0Qv4nfu6pNkITLTb32p4yTgzFCocHnJLAHs+9LjUu9ONIhvfT/5lv4YS5muBHyuV84epBo/A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-loong64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-loong64-gnu/-/rollup-linux-loong64-gnu-4.53.3.tgz",
      "integrity": "sha512-JiuKcp2teLJwQ7vkJ95EwESWkNRFJD7TQgYmCnrPtlu50b4XvT5MOmurWNrCj3IFdyjBQ5p9vnrX4JM6I8OE7g==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-ppc64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-ppc64-gnu/-/rollup-linux-ppc64-gnu-4.53.3.tgz",
      "integrity": "sha512-EoGSa8nd6d3T7zLuqdojxC20oBfNT8nexBbB/rkxgKj5T5vhpAQKKnD+h3UkoMuTyXkP5jTjK/ccNRmQrPNDuw==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-gnu/-/rollup-linux-riscv64-gnu-4.53.3.tgz",
      "integrity": "sha512-4s+Wped2IHXHPnAEbIB0YWBv7SDohqxobiiPA1FIWZpX+w9o2i4LezzH/NkFUl8LRci/8udci6cLq+jJQlh+0g==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-musl": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-musl/-/rollup-linux-riscv64-musl-4.53.3.tgz",
      "integrity": "sha512-68k2g7+0vs2u9CxDt5ktXTngsxOQkSEV/xBbwlqYcUrAVh6P9EgMZvFsnHy4SEiUl46Xf0IObWVbMvPrr2gw8A==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-s390x-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-s390x-gnu/-/rollup-linux-s390x-gnu-4.53.3.tgz",
      "integrity": "sha512-VYsFMpULAz87ZW6BVYw3I6sWesGpsP9OPcyKe8ofdg9LHxSbRMd7zrVrr5xi/3kMZtpWL/wC+UIJWJYVX5uTKg==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-gnu/-/rollup-linux-x64-gnu-4.53.3.tgz",
      "integrity": "sha512-3EhFi1FU6YL8HTUJZ51imGJWEX//ajQPfqWLI3BQq4TlvHy4X0MOr5q3D2Zof/ka0d5FNdPwZXm3Yyib/UEd+w==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-musl": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-musl/-/rollup-linux-x64-musl-4.53.3.tgz",
      "integrity": "sha512-eoROhjcc6HbZCJr+tvVT8X4fW3/5g/WkGvvmwz/88sDtSJzO7r/blvoBDgISDiCjDRZmHpwud7h+6Q9JxFwq1Q==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-openharmony-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-openharmony-arm64/-/rollup-openharmony-arm64-4.53.3.tgz",
      "integrity": "sha512-OueLAWgrNSPGAdUdIjSWXw+u/02BRTcnfw9PN41D2vq/JSEPnJnVuBgw18VkN8wcd4fjUs+jFHVM4t9+kBSNLw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openharmony"
      ]
    },
    "node_modules/@rollup/rollup-win32-arm64-msvc": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-arm64-msvc/-/rollup-win32-arm64-msvc-4.53.3.tgz",
      "integrity": "sha512-GOFuKpsxR/whszbF/bzydebLiXIHSgsEUp6M0JI8dWvi+fFa1TD6YQa4aSZHtpmh2/uAlj/Dy+nmby3TJ3pkTw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-ia32-msvc": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-ia32-msvc/-/rollup-win32-ia32-msvc-4.53.3.tgz",
      "integrity": "sha512-iah+THLcBJdpfZ1TstDFbKNznlzoxa8fmnFYK4V67HvmuNYkVdAywJSoteUszvBQ9/HqN2+9AZghbajMsFT+oA==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-x64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-x64-gnu/-/rollup-win32-x64-gnu-4.53.3.tgz",
      "integrity": "sha512-J9QDiOIZlZLdcot5NXEepDkstocktoVjkaKUtqzgzpt2yWjGlbYiKyp05rWwk4nypbYUNoFAztEgixoLaSETkg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-x64-msvc": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-x64-msvc/-/rollup-win32-x64-msvc-4.53.3.tgz",
      "integrity": "sha512-UhTd8u31dXadv0MopwGgNOBpUVROFKWVQgAg5N1ESyCz8AuBcMqm4AuTjrwgQKGDfoFuz02EuMRHQIw/frmYKQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@types/babel__core": {
      "version": "7.20.5",
      "resolved": "https://registry.npmjs.org/@types/babel__core/-/babel__core-7.20.5.tgz",
      "integrity": "sha512-qoQprZvz5wQFJwMDqeseRXWv3rqMvhgpbXFfVyWhbx9X47POIA6i/+dXefEmZKoAgOaTdaIgNSMqMIU61yRyzA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.20.7",
        "@babel/types": "^7.20.7",
        "@types/babel__generator": "*",
        "@types/babel__template": "*",
        "@types/babel__traverse": "*"
      }
    },
    "node_modules/@types/babel__generator": {
      "version": "7.27.0",
      "resolved": "https://registry.npmjs.org/@types/babel__generator/-/babel__generator-7.27.0.tgz",
      "integrity": "sha512-ufFd2Xi92OAVPYsy+P4n7/U7e68fex0+Ee8gSG9KX7eo084CWiQ4sdxktvdl0bOPupXtVJPY19zk6EwWqUQ8lg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.0.0"
      }
    },
    "node_modules/@types/babel__template": {
      "version": "7.4.4",
      "resolved": "https://registry.npmjs.org/@types/babel__template/-/babel__template-7.4.4.tgz",
      "integrity": "sha512-h/NUaSyG5EyxBIp8YRxo4RMe2/qQgvyowRwVMzhYhBCONbW8PUsg4lkFMrhgZhUe5z3L3MiLDuvyJ/CaPa2A8A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.1.0",
        "@babel/types": "^7.0.0"
      }
    },
    "node_modules/@types/babel__traverse": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@types/babel__traverse/-/babel__traverse-7.28.0.tgz",
      "integrity": "sha512-8PvcXf70gTDZBgt9ptxJ8elBeBjcLOAcOtoO/mPJjtji1+CdGbHgm77om1GrsPxsiE+uXIpNSK64UYaIwQXd4Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.2"
      }
    },
    "node_modules/@types/estree": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",
      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/json-schema": {
      "version": "7.0.15",
      "resolved": "https://registry.npmjs.org/@types/json-schema/-/json-schema-7.0.15.tgz",
      "integrity": "sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/react": {
      "version": "19.2.7",
      "resolved": "https://registry.npmjs.org/@types/react/-/react-19.2.7.tgz",
      "integrity": "sha512-MWtvHrGZLFttgeEj28VXHxpmwYbor/ATPYbBfSFZEIRK0ecCFLl2Qo55z52Hss+UV9CRN7trSeq1zbgx7YDWWg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "csstype": "^3.2.2"
      }
    },
    "node_modules/@types/react-dom": {
      "version": "19.2.3",
      "resolved": "https://registry.npmjs.org/@types/react-dom/-/react-dom-19.2.3.tgz",
      "integrity": "sha512-jp2L/eY6fn+KgVVQAOqYItbF0VY/YApe5Mz2F0aykSO8gx31bYCZyvSeYxCHKvzHG5eZjc+zyaS5BrBWya2+kQ==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "^19.2.0"
      }
    },
    "node_modules/@vitejs/plugin-react": {
      "version": "5.1.1",
      "resolved": "https://registry.npmjs.org/@vitejs/plugin-react/-/plugin-react-5.1.1.tgz",
      "integrity": "sha512-WQfkSw0QbQ5aJ2CHYw23ZGkqnRwqKHD/KYsMeTkZzPT4Jcf0DcBxBtwMJxnu6E7oxw5+JC6ZAiePgh28uJ1HBA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/core": "^7.28.5",
        "@babel/plugin-transform-react-jsx-self": "^7.27.1",
        "@babel/plugin-transform-react-jsx-source": "^7.27.1",
        "@rolldown/pluginutils": "1.0.0-beta.47",
        "@types/babel__core": "^7.20.5",
        "react-refresh": "^0.18.0"
      },
      "engines": {
        "node": "^20.19.0 || >=22.12.0"
      },
      "peerDependencies": {
        "vite": "^4.2.0 || ^5.0.0 || ^6.0.0 || ^7.0.0"
      }
    },
    "node_modules/acorn": {
      "version": "8.15.0",
      "resolved": "https://registry.npmjs.org/acorn/-/acorn-8.15.0.tgz",
      "integrity": "sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "acorn": "bin/acorn"
      },
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/acorn-jsx": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/acorn-jsx/-/acorn-jsx-5.3.2.tgz",
      "integrity": "sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "acorn": "^6.0.0 || ^7.0.0 || ^8.0.0"
      }
    },
    "node_modules/ajv": {
      "version": "6.12.6",
      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",
      "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fast-deep-equal": "^3.1.1",
        "fast-json-stable-stringify": "^2.0.0",
        "json-schema-traverse": "^0.4.1",
        "uri-js": "^4.2.2"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/epoberezkin"
      }
    },
    "node_modules/ansi-styles": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
      "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "color-convert": "^2.0.1"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
      }
    },
    "node_modules/argparse": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/argparse/-/argparse-2.0.1.tgz",
      "integrity": "sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==",
      "dev": true,
      "license": "Python-2.0"
    },
    "node_modules/balanced-match": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/balanced-match/-/balanced-match-1.0.2.tgz",
      "integrity": "sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/baseline-browser-mapping": {
      "version": "2.8.31",
      "resolved": "https://registry.npmjs.org/baseline-browser-mapping/-/baseline-browser-mapping-2.8.31.tgz",
      "integrity": "sha512-a28v2eWrrRWPpJSzxc+mKwm0ZtVx/G8SepdQZDArnXYU/XS+IF6mp8aB/4E+hH1tyGCoDo3KlUCdlSxGDsRkAw==",
      "dev": true,
      "license": "Apache-2.0",
      "bin": {
        "baseline-browser-mapping": "dist/cli.js"
      }
    },
    "node_modules/brace-expansion": {
      "version": "1.1.12",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",
      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "balanced-match": "^1.0.0",
        "concat-map": "0.0.1"
      }
    },
    "node_modules/browserslist": {
      "version": "4.28.0",
      "resolved": "https://registry.npmjs.org/browserslist/-/browserslist-4.28.0.tgz",
      "integrity": "sha512-tbydkR/CxfMwelN0vwdP/pLkDwyAASZ+VfWm4EOwlB6SWhx1sYnWLqo8N5j0rAzPfzfRaxt0mM/4wPU/Su84RQ==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/browserslist"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "baseline-browser-mapping": "^2.8.25",
        "caniuse-lite": "^1.0.30001754",
        "electron-to-chromium": "^1.5.249",
        "node-releases": "^2.0.27",
        "update-browserslist-db": "^1.1.4"
      },
      "bin": {
        "browserslist": "cli.js"
      },
      "engines": {
        "node": "^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7"
      }
    },
    "node_modules/callsites": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/callsites/-/callsites-3.1.0.tgz",
      "integrity": "sha512-P8BjAsXvZS+VIDUI11hHCQEv74YT67YUi5JJFNWIqL235sBmjX4+qx9Muvls5ivyNENctx46xQLQ3aTuE7ssaQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/caniuse-lite": {
      "version": "1.0.30001757",
      "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001757.tgz",
      "integrity": "sha512-r0nnL/I28Zi/yjk1el6ilj27tKcdjLsNqAOZr0yVjWPrSQyHgKI2INaEWw21bAQSv2LXRt1XuCS/GomNpWOxsQ==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/caniuse-lite"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "CC-BY-4.0"
    },
    "node_modules/chalk": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/chalk/-/chalk-4.1.2.tgz",
      "integrity": "sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ansi-styles": "^4.1.0",
        "supports-color": "^7.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/chalk?sponsor=1"
      }
    },
    "node_modules/clsx": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/clsx/-/clsx-2.1.1.tgz",
      "integrity": "sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/color-convert": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
      "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "color-name": "~1.1.4"
      },
      "engines": {
        "node": ">=7.0.0"
      }
    },
    "node_modules/color-name": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
      "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/concat-map": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/concat-map/-/concat-map-0.0.1.tgz",
      "integrity": "sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/convert-source-map": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/convert-source-map/-/convert-source-map-2.0.0.tgz",
      "integrity": "sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/cookie": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-1.0.2.tgz",
      "integrity": "sha512-9Kr/j4O16ISv8zBBhJoi4bXOYNTkFLOqSL3UDB0njXxCXNezjeyVrJyGOWtgfs/q2km1gwBcfH8q1yEGoMYunA==",
      "license": "MIT",
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/cross-spawn": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.6.tgz",
      "integrity": "sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "path-key": "^3.1.0",
        "shebang-command": "^2.0.0",
        "which": "^2.0.1"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/csstype": {
      "version": "3.2.3",
      "resolved": "https://registry.npmjs.org/csstype/-/csstype-3.2.3.tgz",
      "integrity": "sha512-z1HGKcYy2xA8AGQfwrn0PAy+PB7X/GSj3UVJW9qKyn43xWa+gl5nXmU4qqLMRzWVLFC8KusUX8T/0kCiOYpAIQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/debug": {
      "version": "4.4.3",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",
      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/deep-is": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/deep-is/-/deep-is-0.1.4.tgz",
      "integrity": "sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/electron-to-chromium": {
      "version": "1.5.259",
      "resolved": "https://registry.npmjs.org/electron-to-chromium/-/electron-to-chromium-1.5.259.tgz",
      "integrity": "sha512-I+oLXgpEJzD6Cwuwt1gYjxsDmu/S/Kd41mmLA3O+/uH2pFRO/DvOjUyGozL8j3KeLV6WyZ7ssPwELMsXCcsJAQ==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/esbuild": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/esbuild/-/esbuild-0.25.12.tgz",
      "integrity": "sha512-bbPBYYrtZbkt6Os6FiTLCTFxvq4tt3JKall1vRwshA3fdVztsLAatFaZobhkBC8/BrPetoa0oksYoKXoG4ryJg==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "bin": {
        "esbuild": "bin/esbuild"
      },
      "engines": {
        "node": ">=18"
      },
      "optionalDependencies": {
        "@esbuild/aix-ppc64": "0.25.12",
        "@esbuild/android-arm": "0.25.12",
        "@esbuild/android-arm64": "0.25.12",
        "@esbuild/android-x64": "0.25.12",
        "@esbuild/darwin-arm64": "0.25.12",
        "@esbuild/darwin-x64": "0.25.12",
        "@esbuild/freebsd-arm64": "0.25.12",
        "@esbuild/freebsd-x64": "0.25.12",
        "@esbuild/linux-arm": "0.25.12",
        "@esbuild/linux-arm64": "0.25.12",
        "@esbuild/linux-ia32": "0.25.12",
        "@esbuild/linux-loong64": "0.25.12",
        "@esbuild/linux-mips64el": "0.25.12",
        "@esbuild/linux-ppc64": "0.25.12",
        "@esbuild/linux-riscv64": "0.25.12",
        "@esbuild/linux-s390x": "0.25.12",
        "@esbuild/linux-x64": "0.25.12",
        "@esbuild/netbsd-arm64": "0.25.12",
        "@esbuild/netbsd-x64": "0.25.12",
        "@esbuild/openbsd-arm64": "0.25.12",
        "@esbuild/openbsd-x64": "0.25.12",
        "@esbuild/openharmony-arm64": "0.25.12",
        "@esbuild/sunos-x64": "0.25.12",
        "@esbuild/win32-arm64": "0.25.12",
        "@esbuild/win32-ia32": "0.25.12",
        "@esbuild/win32-x64": "0.25.12"
      }
    },
    "node_modules/escalade": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/escalade/-/escalade-3.2.0.tgz",
      "integrity": "sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/escape-string-regexp": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz",
      "integrity": "sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/eslint": {
      "version": "9.39.1",
      "resolved": "https://registry.npmjs.org/eslint/-/eslint-9.39.1.tgz",
      "integrity": "sha512-BhHmn2yNOFA9H9JmmIVKJmd288g9hrVRDkdoIgRCRuSySRUHH7r/DI6aAXW9T1WwUuY3DFgrcaqB+deURBLR5g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@eslint-community/eslint-utils": "^4.8.0",
        "@eslint-community/regexpp": "^4.12.1",
        "@eslint/config-array": "^0.21.1",
        "@eslint/config-helpers": "^0.4.2",
        "@eslint/core": "^0.17.0",
        "@eslint/eslintrc": "^3.3.1",
        "@eslint/js": "9.39.1",
        "@eslint/plugin-kit": "^0.4.1",
        "@humanfs/node": "^0.16.6",
        "@humanwhocodes/module-importer": "^1.0.1",
        "@humanwhocodes/retry": "^0.4.2",
        "@types/estree": "^1.0.6",
        "ajv": "^6.12.4",
        "chalk": "^4.0.0",
        "cross-spawn": "^7.0.6",
        "debug": "^4.3.2",
        "escape-string-regexp": "^4.0.0",
        "eslint-scope": "^8.4.0",
        "eslint-visitor-keys": "^4.2.1",
        "espree": "^10.4.0",
        "esquery": "^1.5.0",
        "esutils": "^2.0.2",
        "fast-deep-equal": "^3.1.3",
        "file-entry-cache": "^8.0.0",
        "find-up": "^5.0.0",
        "glob-parent": "^6.0.2",
        "ignore": "^5.2.0",
        "imurmurhash": "^0.1.4",
        "is-glob": "^4.0.0",
        "json-stable-stringify-without-jsonify": "^1.0.1",
        "lodash.merge": "^4.6.2",
        "minimatch": "^3.1.2",
        "natural-compare": "^1.4.0",
        "optionator": "^0.9.3"
      },
      "bin": {
        "eslint": "bin/eslint.js"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      },
      "peerDependencies": {
        "jiti": "*"
      },
      "peerDependenciesMeta": {
        "jiti": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-plugin-react-hooks": {
      "version": "7.0.1",
      "resolved": "https://registry.npmjs.org/eslint-plugin-react-hooks/-/eslint-plugin-react-hooks-7.0.1.tgz",
      "integrity": "sha512-O0d0m04evaNzEPoSW+59Mezf8Qt0InfgGIBJnpC0h3NH/WjUAR7BIKUfysC6todmtiZ/A0oUVS8Gce0WhBrHsA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/core": "^7.24.4",
        "@babel/parser": "^7.24.4",
        "hermes-parser": "^0.25.1",
        "zod": "^3.25.0 || ^4.0.0",
        "zod-validation-error": "^3.5.0 || ^4.0.0"
      },
      "engines": {
        "node": ">=18"
      },
      "peerDependencies": {
        "eslint": "^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0"
      }
    },
    "node_modules/eslint-plugin-react-refresh": {
      "version": "0.4.24",
      "resolved": "https://registry.npmjs.org/eslint-plugin-react-refresh/-/eslint-plugin-react-refresh-0.4.24.tgz",
      "integrity": "sha512-nLHIW7TEq3aLrEYWpVaJ1dRgFR+wLDPN8e8FpYAql/bMV2oBEfC37K0gLEGgv9fy66juNShSMV8OkTqzltcG/w==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "eslint": ">=8.40"
      }
    },
    "node_modules/eslint-scope": {
      "version": "8.4.0",
      "resolved": "https://registry.npmjs.org/eslint-scope/-/eslint-scope-8.4.0.tgz",
      "integrity": "sha512-sNXOfKCn74rt8RICKMvJS7XKV/Xk9kA7DyJr8mJik3S7Cwgy3qlkkmyS2uQB3jiJg6VNdZd/pDBJu0nvG2NlTg==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "esrecurse": "^4.3.0",
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/eslint-visitor-keys": {
      "version": "4.2.1",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-4.2.1.tgz",
      "integrity": "sha512-Uhdk5sfqcee/9H/rCOJikYz67o0a2Tw2hGRPOG2Y1R2dg7brRe1uG0yaNQDHu+TO/uQPF/5eCapvYSmHUjt7JQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/espree": {
      "version": "10.4.0",
      "resolved": "https://registry.npmjs.org/espree/-/espree-10.4.0.tgz",
      "integrity": "sha512-j6PAQ2uUr79PZhBjP5C5fhl8e39FmRnOjsD5lGnWrFU8i2G776tBK7+nP8KuQUTTyAZUwfQqXAgrVH5MbH9CYQ==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "acorn": "^8.15.0",
        "acorn-jsx": "^5.3.2",
        "eslint-visitor-keys": "^4.2.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/esquery": {
      "version": "1.6.0",
      "resolved": "https://registry.npmjs.org/esquery/-/esquery-1.6.0.tgz",
      "integrity": "sha512-ca9pw9fomFcKPvFLXhBKUK90ZvGibiGOvRJNbjljY7s7uq/5YO4BOzcYtJqExdx99rF6aAcnRxHmcUHcz6sQsg==",
      "dev": true,
      "license": "BSD-3-Clause",
      "dependencies": {
        "estraverse": "^5.1.0"
      },
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/esrecurse": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/esrecurse/-/esrecurse-4.3.0.tgz",
      "integrity": "sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/estraverse": {
      "version": "5.3.0",
      "resolved": "https://registry.npmjs.org/estraverse/-/estraverse-5.3.0.tgz",
      "integrity": "sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/esutils": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/esutils/-/esutils-2.0.3.tgz",
      "integrity": "sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/fast-deep-equal": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/fast-deep-equal/-/fast-deep-equal-3.1.3.tgz",
      "integrity": "sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-equals": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/fast-equals/-/fast-equals-4.0.3.tgz",
      "integrity": "sha512-G3BSX9cfKttjr+2o1O22tYMLq0DPluZnYtq1rXumE1SpL/F/SLIfHx08WYQoWSIpeMYf8sRbJ8++71+v6Pnxfg==",
      "license": "MIT"
    },
    "node_modules/fast-json-stable-stringify": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/fast-json-stable-stringify/-/fast-json-stable-stringify-2.1.0.tgz",
      "integrity": "sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-levenshtein": {
      "version": "2.0.6",
      "resolved": "https://registry.npmjs.org/fast-levenshtein/-/fast-levenshtein-2.0.6.tgz",
      "integrity": "sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fdir": {
      "version": "6.5.0",
      "resolved": "https://registry.npmjs.org/fdir/-/fdir-6.5.0.tgz",
      "integrity": "sha512-tIbYtZbucOs0BRGqPJkshJUYdL+SDH7dVM8gjy+ERp3WAUjLEFJE+02kanyHtwjWOnwrKYBiwAmM0p4kLJAnXg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12.0.0"
      },
      "peerDependencies": {
        "picomatch": "^3 || ^4"
      },
      "peerDependenciesMeta": {
        "picomatch": {
          "optional": true
        }
      }
    },
    "node_modules/file-entry-cache": {
      "version": "8.0.0",
      "resolved": "https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-8.0.0.tgz",
      "integrity": "sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flat-cache": "^4.0.0"
      },
      "engines": {
        "node": ">=16.0.0"
      }
    },
    "node_modules/find-up": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/find-up/-/find-up-5.0.0.tgz",
      "integrity": "sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "locate-path": "^6.0.0",
        "path-exists": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/flat-cache": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/flat-cache/-/flat-cache-4.0.1.tgz",
      "integrity": "sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flatted": "^3.2.9",
        "keyv": "^4.5.4"
      },
      "engines": {
        "node": ">=16"
      }
    },
    "node_modules/flatted": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/flatted/-/flatted-3.3.3.tgz",
      "integrity": "sha512-GX+ysw4PBCz0PzosHDepZGANEuFCMLrnRTiEy9McGjmkCQYwRq4A/X786G/fjM/+OjsWSU1ZrY5qyARZmO/uwg==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/fsevents": {
      "version": "2.3.3",
      "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz",
      "integrity": "sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^8.16.0 || ^10.6.0 || >=11.0.0"
      }
    },
    "node_modules/gensync": {
      "version": "1.0.0-beta.2",
      "resolved": "https://registry.npmjs.org/gensync/-/gensync-1.0.0-beta.2.tgz",
      "integrity": "sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/glob-parent": {
      "version": "6.0.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-6.0.2.tgz",
      "integrity": "sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.3"
      },
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/globals": {
      "version": "16.5.0",
      "resolved": "https://registry.npmjs.org/globals/-/globals-16.5.0.tgz",
      "integrity": "sha512-c/c15i26VrJ4IRt5Z89DnIzCGDn9EcebibhAOjw5ibqEHsE1wLUgkPn9RDmNcUKyU87GeaL633nyJ+pplFR2ZQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/has-flag": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-4.0.0.tgz",
      "integrity": "sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/hermes-estree": {
      "version": "0.25.1",
      "resolved": "https://registry.npmjs.org/hermes-estree/-/hermes-estree-0.25.1.tgz",
      "integrity": "sha512-0wUoCcLp+5Ev5pDW2OriHC2MJCbwLwuRx+gAqMTOkGKJJiBCLjtrvy4PWUGn6MIVefecRpzoOZ/UV6iGdOr+Cw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/hermes-parser": {
      "version": "0.25.1",
      "resolved": "https://registry.npmjs.org/hermes-parser/-/hermes-parser-0.25.1.tgz",
      "integrity": "sha512-6pEjquH3rqaI6cYAXYPcz9MS4rY6R4ngRgrgfDshRptUZIc3lw0MCIJIGDj9++mfySOuPTHB4nrSW99BCvOPIA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "hermes-estree": "0.25.1"
      }
    },
    "node_modules/ignore": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/ignore/-/ignore-5.3.2.tgz",
      "integrity": "sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/import-fresh": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/import-fresh/-/import-fresh-3.3.1.tgz",
      "integrity": "sha512-TR3KfrTZTYLPB6jUjfx6MF9WcWrHL9su5TObK4ZkYgBdWKPOFoSoQIdEuTuR82pmtxH2spWG9h6etwfr1pLBqQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "parent-module": "^1.0.0",
        "resolve-from": "^4.0.0"
      },
      "engines": {
        "node": ">=6"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/imurmurhash": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/imurmurhash/-/imurmurhash-0.1.4.tgz",
      "integrity": "sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.8.19"
      }
    },
    "node_modules/is-extglob": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/is-extglob/-/is-extglob-2.1.1.tgz",
      "integrity": "sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/is-glob": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/is-glob/-/is-glob-4.0.3.tgz",
      "integrity": "sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-extglob": "^2.1.1"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/isexe": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
      "integrity": "sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/js-tokens": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-4.0.0.tgz",
      "integrity": "sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==",
      "license": "MIT"
    },
    "node_modules/js-yaml": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.1.tgz",
      "integrity": "sha512-qQKT4zQxXl8lLwBtHMWwaTcGfFOZviOJet3Oy/xmGk2gZH677CJM9EvtfdSkgWcATZhj/55JZ0rmy3myCT5lsA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "argparse": "^2.0.1"
      },
      "bin": {
        "js-yaml": "bin/js-yaml.js"
      }
    },
    "node_modules/jsesc": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/jsesc/-/jsesc-3.1.0.tgz",
      "integrity": "sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "jsesc": "bin/jsesc"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/json-buffer": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/json-buffer/-/json-buffer-3.0.1.tgz",
      "integrity": "sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-schema-traverse": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",
      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-stable-stringify-without-jsonify": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/json-stable-stringify-without-jsonify/-/json-stable-stringify-without-jsonify-1.0.1.tgz",
      "integrity": "sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json5": {
      "version": "2.2.3",
      "resolved": "https://registry.npmjs.org/json5/-/json5-2.2.3.tgz",
      "integrity": "sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "json5": "lib/cli.js"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/keyv": {
      "version": "4.5.4",
      "resolved": "https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz",
      "integrity": "sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "json-buffer": "3.0.1"
      }
    },
    "node_modules/levn": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/levn/-/levn-0.4.1.tgz",
      "integrity": "sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1",
        "type-check": "~0.4.0"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/locate-path": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/locate-path/-/locate-path-6.0.0.tgz",
      "integrity": "sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-locate": "^5.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/lodash.merge": {
      "version": "4.6.2",
      "resolved": "https://registry.npmjs.org/lodash.merge/-/lodash.merge-4.6.2.tgz",
      "integrity": "sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/loose-envify": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/loose-envify/-/loose-envify-1.4.0.tgz",
      "integrity": "sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==",
      "license": "MIT",
      "dependencies": {
        "js-tokens": "^3.0.0 || ^4.0.0"
      },
      "bin": {
        "loose-envify": "cli.js"
      }
    },
    "node_modules/lru-cache": {
      "version": "5.1.1",
      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-5.1.1.tgz",
      "integrity": "sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "yallist": "^3.0.2"
      }
    },
    "node_modules/minimatch": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "brace-expansion": "^1.1.7"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/nanoid": {
      "version": "3.3.11",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.3.11.tgz",
      "integrity": "sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.cjs"
      },
      "engines": {
        "node": "^10 || ^12 || ^13.7 || ^14 || >=15.0.1"
      }
    },
    "node_modules/natural-compare": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/natural-compare/-/natural-compare-1.4.0.tgz",
      "integrity": "sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/node-releases": {
      "version": "2.0.27",
      "resolved": "https://registry.npmjs.org/node-releases/-/node-releases-2.0.27.tgz",
      "integrity": "sha512-nmh3lCkYZ3grZvqcCH+fjmQ7X+H0OeZgP40OierEaAptX4XofMh5kwNbWh7lBduUzCcV/8kZ+NDLCwm2iorIlA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/object-assign": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
      "integrity": "sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/optionator": {
      "version": "0.9.4",
      "resolved": "https://registry.npmjs.org/optionator/-/optionator-0.9.4.tgz",
      "integrity": "sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "deep-is": "^0.1.3",
        "fast-levenshtein": "^2.0.6",
        "levn": "^0.4.1",
        "prelude-ls": "^1.2.1",
        "type-check": "^0.4.0",
        "word-wrap": "^1.2.5"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/p-limit": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-3.1.0.tgz",
      "integrity": "sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "yocto-queue": "^0.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-locate": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/p-locate/-/p-locate-5.0.0.tgz",
      "integrity": "sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-limit": "^3.0.2"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/parent-module": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/parent-module/-/parent-module-1.0.1.tgz",
      "integrity": "sha512-GQ2EWRpQV8/o+Aw8YqtfZZPfNRWZYkbidE9k5rpl/hC3vtHHBfGm2Ifi6qWV+coDGkrUKZAxE3Lot5kcsRlh+g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "callsites": "^3.0.0"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/path-exists": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/path-exists/-/path-exists-4.0.0.tgz",
      "integrity": "sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/path-key": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",
      "integrity": "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/picocolors": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
      "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/picomatch": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-4.0.3.tgz",
      "integrity": "sha512-5gTmgEY/sqK6gFXLIsQNH19lWb4ebPDLA4SdLP7dsWkIXHWlG66oPuVvXSGFPppYZz8ZDZq0dYYrbHfBCVUb1Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/jonschlinkert"
      }
    },
    "node_modules/postcss": {
      "version": "8.5.6",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.5.6.tgz",
      "integrity": "sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.11",
        "picocolors": "^1.1.1",
        "source-map-js": "^1.2.1"
      },
      "engines": {
        "node": "^10 || ^12 || >=14"
      }
    },
    "node_modules/prelude-ls": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.2.1.tgz",
      "integrity": "sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/prop-types": {
      "version": "15.8.1",
      "resolved": "https://registry.npmjs.org/prop-types/-/prop-types-15.8.1.tgz",
      "integrity": "sha512-oj87CgZICdulUohogVAR7AjlC0327U4el4L6eAvOqCeudMDVU0NThNaV+b9Df4dXgSP1gXMTnPdhfe/2qDH5cg==",
      "license": "MIT",
      "dependencies": {
        "loose-envify": "^1.4.0",
        "object-assign": "^4.1.1",
        "react-is": "^16.13.1"
      }
    },
    "node_modules/punycode": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/punycode/-/punycode-2.3.1.tgz",
      "integrity": "sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/react": {
      "version": "19.2.0",
      "resolved": "https://registry.npmjs.org/react/-/react-19.2.0.tgz",
      "integrity": "sha512-tmbWg6W31tQLeB5cdIBOicJDJRR2KzXsV7uSK9iNfLWQ5bIZfxuPEHp7M8wiHyHnn0DD1i7w3Zmin0FtkrwoCQ==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/react-dom": {
      "version": "19.2.0",
      "resolved": "https://registry.npmjs.org/react-dom/-/react-dom-19.2.0.tgz",
      "integrity": "sha512-UlbRu4cAiGaIewkPyiRGJk0imDN2T3JjieT6spoL2UeSf5od4n5LB/mQ4ejmxhCFT1tYe8IvaFulzynWovsEFQ==",
      "license": "MIT",
      "dependencies": {
        "scheduler": "^0.27.0"
      },
      "peerDependencies": {
        "react": "^19.2.0"
      }
    },
    "node_modules/react-draggable": {
      "version": "4.5.0",
      "resolved": "https://registry.npmjs.org/react-draggable/-/react-draggable-4.5.0.tgz",
      "integrity": "sha512-VC+HBLEZ0XJxnOxVAZsdRi8rD04Iz3SiiKOoYzamjylUcju/hP9np/aZdLHf/7WOD268WMoNJMvYfB5yAK45cw==",
      "license": "MIT",
      "dependencies": {
        "clsx": "^2.1.1",
        "prop-types": "^15.8.1"
      },
      "peerDependencies": {
        "react": ">= 16.3.0",
        "react-dom": ">= 16.3.0"
      }
    },
    "node_modules/react-grid-layout": {
      "version": "1.5.2",
      "resolved": "https://registry.npmjs.org/react-grid-layout/-/react-grid-layout-1.5.2.tgz",
      "integrity": "sha512-vT7xmQqszTT+sQw/LfisrEO4le1EPNnSEMVHy6sBZyzS3yGkMywdOd+5iEFFwQwt0NSaGkxuRmYwa1JsP6OJdw==",
      "license": "MIT",
      "dependencies": {
        "clsx": "^2.1.1",
        "fast-equals": "^4.0.3",
        "prop-types": "^15.8.1",
        "react-draggable": "^4.4.6",
        "react-resizable": "^3.0.5",
        "resize-observer-polyfill": "^1.5.1"
      },
      "peerDependencies": {
        "react": ">= 16.3.0",
        "react-dom": ">= 16.3.0"
      }
    },
    "node_modules/react-icons": {
      "version": "5.5.0",
      "resolved": "https://registry.npmjs.org/react-icons/-/react-icons-5.5.0.tgz",
      "integrity": "sha512-MEFcXdkP3dLo8uumGI5xN3lDFNsRtrjbOEKDLD7yv76v4wpnEq2Lt2qeHaQOr34I/wPN3s3+N08WkQ+CW37Xiw==",
      "license": "MIT",
      "peerDependencies": {
        "react": "*"
      }
    },
    "node_modules/react-is": {
      "version": "16.13.1",
      "resolved": "https://registry.npmjs.org/react-is/-/react-is-16.13.1.tgz",
      "integrity": "sha512-24e6ynE2H+OKt4kqsOvNd8kBpV65zoxbA4BVsEOB3ARVWQki/DHzaUoC5KuON/BiccDaCCTZBuOcfZs70kR8bQ==",
      "license": "MIT"
    },
    "node_modules/react-refresh": {
      "version": "0.18.0",
      "resolved": "https://registry.npmjs.org/react-refresh/-/react-refresh-0.18.0.tgz",
      "integrity": "sha512-QgT5//D3jfjJb6Gsjxv0Slpj23ip+HtOpnNgnb2S5zU3CB26G/IDPGoy4RJB42wzFE46DRsstbW6tKHoKbhAxw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/react-resizable": {
      "version": "3.0.5",
      "resolved": "https://registry.npmjs.org/react-resizable/-/react-resizable-3.0.5.tgz",
      "integrity": "sha512-vKpeHhI5OZvYn82kXOs1bC8aOXktGU5AmKAgaZS4F5JPburCtbmDPqE7Pzp+1kN4+Wb81LlF33VpGwWwtXem+w==",
      "license": "MIT",
      "dependencies": {
        "prop-types": "15.x",
        "react-draggable": "^4.0.3"
      },
      "peerDependencies": {
        "react": ">= 16.3"
      }
    },
    "node_modules/react-router": {
      "version": "7.9.6",
      "resolved": "https://registry.npmjs.org/react-router/-/react-router-7.9.6.tgz",
      "integrity": "sha512-Y1tUp8clYRXpfPITyuifmSoE2vncSME18uVLgaqyxh9H35JWpIfzHo+9y3Fzh5odk/jxPW29IgLgzcdwxGqyNA==",
      "license": "MIT",
      "dependencies": {
        "cookie": "^1.0.1",
        "set-cookie-parser": "^2.6.0"
      },
      "engines": {
        "node": ">=20.0.0"
      },
      "peerDependencies": {
        "react": ">=18",
        "react-dom": ">=18"
      },
      "peerDependenciesMeta": {
        "react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/react-router-dom": {
      "version": "7.9.6",
      "resolved": "https://registry.npmjs.org/react-router-dom/-/react-router-dom-7.9.6.tgz",
      "integrity": "sha512-2MkC2XSXq6HjGcihnx1s0DBWQETI4mlis4Ux7YTLvP67xnGxCvq+BcCQSO81qQHVUTM1V53tl4iVVaY5sReCOA==",
      "license": "MIT",
      "dependencies": {
        "react-router": "7.9.6"
      },
      "engines": {
        "node": ">=20.0.0"
      },
      "peerDependencies": {
        "react": ">=18",
        "react-dom": ">=18"
      }
    },
    "node_modules/resize-observer-polyfill": {
      "version": "1.5.1",
      "resolved": "https://registry.npmjs.org/resize-observer-polyfill/-/resize-observer-polyfill-1.5.1.tgz",
      "integrity": "sha512-LwZrotdHOo12nQuZlHEmtuXdqGoOD0OhaxopaNFxWzInpEgaLWoVuAMbTzixuosCx2nEG58ngzW3vxdWoxIgdg==",
      "license": "MIT"
    },
    "node_modules/resolve-from": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/resolve-from/-/resolve-from-4.0.0.tgz",
      "integrity": "sha512-pb/MYmXstAkysRFx8piNI1tGFNQIFA3vkE3Gq4EuA1dF6gHp/+vgZqsCGJapvy8N3Q+4o7FwvquPJcnZ7RYy4g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/rollup": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/rollup/-/rollup-4.53.3.tgz",
      "integrity": "sha512-w8GmOxZfBmKknvdXU1sdM9NHcoQejwF/4mNgj2JuEEdRaHwwF12K7e9eXn1nLZ07ad+du76mkVsyeb2rKGllsA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/estree": "1.0.8"
      },
      "bin": {
        "rollup": "dist/bin/rollup"
      },
      "engines": {
        "node": ">=18.0.0",
        "npm": ">=8.0.0"
      },
      "optionalDependencies": {
        "@rollup/rollup-android-arm-eabi": "4.53.3",
        "@rollup/rollup-android-arm64": "4.53.3",
        "@rollup/rollup-darwin-arm64": "4.53.3",
        "@rollup/rollup-darwin-x64": "4.53.3",
        "@rollup/rollup-freebsd-arm64": "4.53.3",
        "@rollup/rollup-freebsd-x64": "4.53.3",
        "@rollup/rollup-linux-arm-gnueabihf": "4.53.3",
        "@rollup/rollup-linux-arm-musleabihf": "4.53.3",
        "@rollup/rollup-linux-arm64-gnu": "4.53.3",
        "@rollup/rollup-linux-arm64-musl": "4.53.3",
        "@rollup/rollup-linux-loong64-gnu": "4.53.3",
        "@rollup/rollup-linux-ppc64-gnu": "4.53.3",
        "@rollup/rollup-linux-riscv64-gnu": "4.53.3",
        "@rollup/rollup-linux-riscv64-musl": "4.53.3",
        "@rollup/rollup-linux-s390x-gnu": "4.53.3",
        "@rollup/rollup-linux-x64-gnu": "4.53.3",
        "@rollup/rollup-linux-x64-musl": "4.53.3",
        "@rollup/rollup-openharmony-arm64": "4.53.3",
        "@rollup/rollup-win32-arm64-msvc": "4.53.3",
        "@rollup/rollup-win32-ia32-msvc": "4.53.3",
        "@rollup/rollup-win32-x64-gnu": "4.53.3",
        "@rollup/rollup-win32-x64-msvc": "4.53.3",
        "fsevents": "~2.3.2"
      }
    },
    "node_modules/scheduler": {
      "version": "0.27.0",
      "resolved": "https://registry.npmjs.org/scheduler/-/scheduler-0.27.0.tgz",
      "integrity": "sha512-eNv+WrVbKu1f3vbYJT/xtiF5syA5HPIMtf9IgY/nKg0sWqzAUEvqY/xm7OcZc/qafLx/iO9FgOmeSAp4v5ti/Q==",
      "license": "MIT"
    },
    "node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/set-cookie-parser": {
      "version": "2.7.2",
      "resolved": "https://registry.npmjs.org/set-cookie-parser/-/set-cookie-parser-2.7.2.tgz",
      "integrity": "sha512-oeM1lpU/UvhTxw+g3cIfxXHyJRc/uidd3yK1P242gzHds0udQBYzs3y8j4gCCW+ZJ7ad0yctld8RYO+bdurlvw==",
      "license": "MIT"
    },
    "node_modules/shebang-command": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",
      "integrity": "sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "shebang-regex": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/shebang-regex": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz",
      "integrity": "sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/source-map-js": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
      "integrity": "sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==",
      "dev": true,
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/strip-json-comments": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/strip-json-comments/-/strip-json-comments-3.1.1.tgz",
      "integrity": "sha512-6fPc+R4ihwqP6N/aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS/mEHLp7Vehlt3ql6lEig==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/supports-color": {
      "version": "7.2.0",
      "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-7.2.0.tgz",
      "integrity": "sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "has-flag": "^4.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/tinyglobby": {
      "version": "0.2.15",
      "resolved": "https://registry.npmjs.org/tinyglobby/-/tinyglobby-0.2.15.tgz",
      "integrity": "sha512-j2Zq4NyQYG5XMST4cbs02Ak8iJUdxRM0XI5QyxXuZOzKOINmWurp3smXu3y5wDcJrptwpSjgXHzIQxR0omXljQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fdir": "^6.5.0",
        "picomatch": "^4.0.3"
      },
      "engines": {
        "node": ">=12.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/SuperchupuDev"
      }
    },
    "node_modules/type-check": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/type-check/-/type-check-0.4.0.tgz",
      "integrity": "sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/update-browserslist-db": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/update-browserslist-db/-/update-browserslist-db-1.1.4.tgz",
      "integrity": "sha512-q0SPT4xyU84saUX+tomz1WLkxUbuaJnR1xWt17M7fJtEJigJeWUNGUqrauFXsHnqev9y9JTRGwk13tFBuKby4A==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/browserslist"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "escalade": "^3.2.0",
        "picocolors": "^1.1.1"
      },
      "bin": {
        "update-browserslist-db": "cli.js"
      },
      "peerDependencies": {
        "browserslist": ">= 4.21.0"
      }
    },
    "node_modules/uri-js": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/uri-js/-/uri-js-4.4.1.tgz",
      "integrity": "sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "punycode": "^2.1.0"
      }
    },
    "node_modules/vite": {
      "version": "7.2.4",
      "resolved": "https://registry.npmjs.org/vite/-/vite-7.2.4.tgz",
      "integrity": "sha512-NL8jTlbo0Tn4dUEXEsUg8KeyG/Lkmc4Fnzb8JXN/Ykm9G4HNImjtABMJgkQoVjOBN/j2WAwDTRytdqJbZsah7w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "esbuild": "^0.25.0",
        "fdir": "^6.5.0",
        "picomatch": "^4.0.3",
        "postcss": "^8.5.6",
        "rollup": "^4.43.0",
        "tinyglobby": "^0.2.15"
      },
      "bin": {
        "vite": "bin/vite.js"
      },
      "engines": {
        "node": "^20.19.0 || >=22.12.0"
      },
      "funding": {
        "url": "https://github.com/vitejs/vite?sponsor=1"
      },
      "optionalDependencies": {
        "fsevents": "~2.3.3"
      },
      "peerDependencies": {
        "@types/node": "^20.19.0 || >=22.12.0",
        "jiti": ">=1.21.0",
        "less": "^4.0.0",
        "lightningcss": "^1.21.0",
        "sass": "^1.70.0",
        "sass-embedded": "^1.70.0",
        "stylus": ">=0.54.8",
        "sugarss": "^5.0.0",
        "terser": "^5.16.0",
        "tsx": "^4.8.1",
        "yaml": "^2.4.2"
      },
      "peerDependenciesMeta": {
        "@types/node": {
          "optional": true
        },
        "jiti": {
          "optional": true
        },
        "less": {
          "optional": true
        },
        "lightningcss": {
          "optional": true
        },
        "sass": {
          "optional": true
        },
        "sass-embedded": {
          "optional": true
        },
        "stylus": {
          "optional": true
        },
        "sugarss": {
          "optional": true
        },
        "terser": {
          "optional": true
        },
        "tsx": {
          "optional": true
        },
        "yaml": {
          "optional": true
        }
      }
    },
    "node_modules/which": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/which/-/which-2.0.2.tgz",
      "integrity": "sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "isexe": "^2.0.0"
      },
      "bin": {
        "node-which": "bin/node-which"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/word-wrap": {
      "version": "1.2.5",
      "resolved": "https://registry.npmjs.org/word-wrap/-/word-wrap-1.2.5.tgz",
      "integrity": "sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/yallist": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-3.1.1.tgz",
      "integrity": "sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/yocto-queue": {
      "version": "0.1.0",
      "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-0.1.0.tgz",
      "integrity": "sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/zod": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/zod/-/zod-4.1.13.tgz",
      "integrity": "sha512-AvvthqfqrAhNH9dnfmrfKzX5upOdjUVJYFqNSlkmGf64gRaTzlPwz99IHYnVs28qYAybvAlBV+H7pn0saFY4Ig==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/colinhacks"
      }
    },
    "node_modules/zod-validation-error": {
      "version": "4.0.2",
      "resolved": "https://registry.npmjs.org/zod-validation-error/-/zod-validation-error-4.0.2.tgz",
      "integrity": "sha512-Q6/nZLe6jxuU80qb/4uJ4t5v2VEZ44lzQjPDhYJNztRQ4wyWc6VF3D3Kb/fAuPetZQnhS3hnajCf9CsWesghLQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18.0.0"
      },
      "peerDependencies": {
        "zod": "^3.25.0 || ^4.0.0"
      }
    }
  }
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\package.json
// ==================================================

{
  "name": "zen-youtube-coach-dashboard",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-draggable": "^4.5.0",
    "react-grid-layout": "^1.5.2",
    "react-icons": "^5.5.0",
    "react-resizable": "^3.0.5",
    "react-router-dom": "^7.9.6"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4"
  }
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\pages\AnalyzerPage.jsx
// ==================================================

export default function NomePage() {
  return <div>NomePage</div>;
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\pages\DashboardPage.jsx
// ==================================================

export default function NomePage() {
  return <div>NomePage</div>;
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\pages\DropoffPage.jsx
// ==================================================

export default function NomePage() {
  return <div>NomePage</div>;
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\pages\OutlierEngine.jsx
// ==================================================

import React, { useState } from "react";
import "./OutlierEngine.css";

export default function OutlierEngine({ callApi, loading, setError, setOutput }) {
  const [videoUrl, setVideoUrl] = useState("");
  const [audience, setAudience] = useState("over60");

  const isValidYouTubeUrl = (url) =>
    url.includes("youtube.com/watch?v=") || url.includes("youtu.be/") || url.includes("/shorts/");

  const runOutlier = () => {
    if (!isValidYouTubeUrl(videoUrl)) {
      setError(" Inserisci un URL YouTube valido.");
      return;
    }

    setError("");
    setOutput(null);

    callApi("/outlier-engine", {
      url: videoUrl,
      audience,
    });
  };

  return (
    <section className="panel outlier-panel">
      <div className="outlier-header">
        <h2> Outlier Engine</h2>
        <p className="panel-subtitle">Analisi predittiva UltraPremium del potenziale virale dei tuoi video.</p>
      </div>

      <div className="outlier-body">
        <div className="input-block">
          <label>URL del video YouTube</label>
          <input
            type="text"
            placeholder="https://www.youtube.com/watch?v=..."
            value={videoUrl}
            onChange={(e) => setVideoUrl(e.target.value)}
          />
        </div>

        <div className="input-block">
          <label>Target Audience</label>
          <select value={audience} onChange={(e) => setAudience(e.target.value)}>
            <option value="over50">Over 50</option>
            <option value="over60">Over 60</option>
            <option value="over70">Over 70</option>
          </select>
        </div>

        <button className="outlier-btn" onClick={runOutlier} disabled={loading}>
          {loading ? "Analisi in corso..." : "Analizza Potenziale Virale"}
        </button>
      </div>
    </section>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\pages\SEOPage.jsx
// ==================================================

export default function NomePage() {
  return <div>NomePage</div>;
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\pages\ScriptPage.jsx
// ==================================================

export default function NomePage() {
  return <div>NomePage</div>;
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\pages\TrendsPage.jsx
// ==================================================

export default function NomePage() {
  return <div>NomePage</div>;
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\App.css
// ==================================================

/* ===========================
    THEME & GLOBAL RESET
   =========================== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body, #root {
  height: 100%;
  background: #0b0e13;
  color: #e2e6ed;
  font-family: "Inter", sans-serif;
  overflow: hidden; /* Gestiamo noi gli scroll */
}

/* Scrollbar elegante */
::-webkit-scrollbar {
  height: 8px;
  width: 8px;
}
::-webkit-scrollbar-thumb {
  background: #3d4250;
  border-radius: 10px;
}
::-webkit-scrollbar-track {
  background: #1c1f26;
}


/* ===========================
    APP LAYOUT
   =========================== */
.app-root {
  display: flex;
  height: 100vh;
  width: 100%;
  overflow: hidden;
}

/* SIDEBAR */
.sidebar {
  width: 240px;
  background: #11141b;
  border-right: 1px solid #1d222d;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  overflow-y: auto;
}

.sidebar-header {
  display: flex;
  align-items: center;
  gap: 12px;
}

.avatar {
  background: #3d8bfd;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 700;
}

.app-title {
  font-size: 17px;
  font-weight: 600;
}

.app-subtitle {
  font-size: 12px;
  opacity: 0.6;
}

/* Sidebar Navigation */
.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.nav-item {
  background: transparent;
  border: none;
  padding: 10px 12px;
  border-radius: 8px;
  color: #b5b9c5;
  font-size: 14px;
  display: flex;
  justify-content: flex-start;
  gap: 10px;
  cursor: pointer;
  transition: 0.2s;
}

.nav-item:hover {
  background: #1b1f27;
  color: #fff;
}

.nav-item-active {
  background: #3d8bfd;
  color: white !important;
}

.nav-icon {
  width: 22px;
}

/* ===========================
    MAIN CONTENT
   =========================== */
.main {
  flex: 1;
  overflow-x: auto !important;  /*  Scroll orizzontale */
  overflow-y: hidden;
  display: flex;
}

.main-inner {
  flex: 1;
  padding: 25px;
  overflow-y: auto !important;  /*  Scroll verticale */
  overflow-x: visible;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* ===========================
    PANEL (Blocchi)
   =========================== */
.panel {
  background: #11141b;
  border: 1px solid #1d222d;
  padding: 20px;
  border-radius: 12px;
  min-width: 650px;     /*  Evita rotture layout */
  width: fit-content;
}

.panel-output {
  overflow-x: auto !important;
}

.panel-subtitle {
  font-size: 13px;
  opacity: 0.7;
}

/* ===========================
    OUTPUT BOX
   =========================== */
.output-box {
  background: #0d0f14;
  padding: 16px;
  border-radius: 10px;
  border: 1px solid #1b1f26;
  overflow-x: auto !important;
  max-width: 100%;
}

.output-pre {
  font-family: "JetBrains Mono", monospace;
  white-space: pre;
  overflow-x: auto !important;
  display: block;
  font-size: 13px;
}

/* Badges */
.badge {
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  display: inline-block;
}

.badge-error {
  background: #c0392b;
}
.badge-loading {
  background: #3d8bfd;
}

/* Buttons */
.primary-btn {
  padding: 12px 16px;
  background: #3d8bfd;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.primary-btn:hover {
  background: #3174d3;
}

/* Cards */
.card {
  background: #0f1218;
  border: 1px solid #1d222d;
  padding: 16px;
  border-radius: 8px;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\App.jsx
// ==================================================

import { useState } from "react";
import "./App.css";

// API centralizzata
import { API_BASE, callApi } from "./config/api";

// Pagine
import Home from "./pages/Home";
import Settings from "./pages/Settings";
import Transcript from "./pages/Transcript";
import AnalyzeTranscript from "./pages/AnalyzeTranscript";
import AnalyzeVideo from "./pages/AnalyzeVideo";
import AnalyzerPro from "./pages/AnalyzerPro";
import CompareVideos from "./pages/CompareVideos";
import CompareTranscript from "./pages/CompareTranscript";
import TrendScan from "./pages/TrendScan";

/* ============================================================
   SIDEBAR PRO
============================================================ */
function Sidebar({ activeTab, setActiveTab }) {
  const items = [
    { id: "home", label: "Home", icon: "" },
    { id: "settings", label: "Settings", icon: "" },
    { id: "transcript", label: "Transcript", icon: "" },
    { id: "analyze-transcript", label: "Analyze Transcript", icon: "" },
    { id: "analyze-video", label: "Analyze Video", icon: "" },
    { id: "analyzer-pro", label: "Analyzer PRO", icon: "" },
    { id: "compare-transcript", label: "Compare Transcript", icon: "" },
    { id: "compare-videos", label: "Compare Videos", icon: "" },
    { id: "trend-scan", label: "Trend Scanner", icon: "" },
    { id: "health", label: "Health Check", icon: "" }
  ];

  return (
    <aside className="sidebar">
      <div className="sidebar-header">
        <div className="avatar">Z</div>
        <div>
          <div className="app-title">Zen YouTube Coach Pro</div>
          <div className="app-subtitle">{API_BASE}</div>
        </div>
      </div>

      <nav className="sidebar-nav">
        {items.map((item) => (
          <button
            key={item.id}
            className={
              "nav-item" + (activeTab === item.id ? " nav-item-active" : "")
            }
            onClick={() => setActiveTab(item.id)}
          >
            <span className="nav-icon">{item.icon}</span>
            <span>{item.label}</span>
          </button>
        ))}
      </nav>
    </aside>
  );
}

/* ============================================================
   OUTPUT PANEL PRO
============================================================ */
function OutputPanel({ output, error, loading }) {
  return (
    <section className="panel panel-output">
      <h2> Output</h2>
      <div className="output-box">
        {loading && <div className="badge badge-loading">Caricamento</div>}
        {error && <div className="badge badge-error">{error}</div>}

        {!loading && !error && !output && (
          <div className="output-placeholder">
            Esegui una richiesta per vedere la risposta.
          </div>
        )}

        {!loading && output && (
          <pre className="output-pre">
            {typeof output === "string"
              ? output
              : JSON.stringify(output, null, 2)}
          </pre>
        )}
      </div>
    </section>
  );
}

/* ============================================================
   APP PRINCIPALE
============================================================ */
export default function App() {
  const [activeTab, setActiveTab] = useState("home");

  const [audience, setAudience] = useState("over60");
  const [loading, setLoading] = useState(false);
  const [output, setOutput] = useState(null);
  const [error, setError] = useState("");

  const [settings, setSettings] = useState({
    heroImage: "",
    widget1Image: "",
    widget2Image: "",
    widget3Image: "",
    columnWidth: 50
  });

  // Funzione API PRO
  async function handleCallApi(path, body = null, method = "POST") {
    setLoading(true);
    setError("");
    setOutput(null);

    const result = await callApi(path, body, method);

    if (result.error) {
      setError(result.message || "Errore API");
      setOutput(result.raw || null);
    } else {
      setOutput(result);
    }

    setLoading(false);
  }

  /* ============================================================
       SWITCH PAGINE
  ============================================================ */
  function renderPage() {
    switch (activeTab) {
      case "home":
        return <Home settings={settings} />;

      case "settings":
        return <Settings settings={settings} setSettings={setSettings} />;

      case "transcript":
        return (
          <Transcript
            callApi={handleCallApi}
            loading={loading}
            setError={setError}
            setOutput={setOutput}
          />
        );

      case "analyze-transcript":
        return (
          <AnalyzeTranscript
            callApi={handleCallApi}
            loading={loading}
            setError={setError}
            setOutput={setOutput}
            audience={audience}
            setAudience={setAudience}
          />
        );

      case "analyze-video":
        return (
          <AnalyzeVideo
            callApi={handleCallApi}
            loading={loading}
            setError={setError}
            setOutput={setOutput}
            audience={audience}
            setAudience={setAudience}
          />
        );

      case "analyzer-pro":
        return (
          <AnalyzerPro
            callApi={handleCallApi}
            loading={loading}
            setError={setError}
            setOutput={setOutput}
          />
        );

      case "compare-videos":
        return (
          <CompareVideos
            callApi={handleCallApi}
            loading={loading}
            setError={setError}
            setOutput={setOutput}
            audience={audience}
            setAudience={setAudience}
          />
        );

      case "compare-transcript":
        return (
          <CompareTranscript
            callApi={handleCallApi}
            loading={loading}
            setError={setError}
            setOutput={setOutput}
            audience={audience}
            setAudience={setAudience}
          />
        );

      case "trend-scan":
        return (
          <TrendScan
            callApi={handleCallApi}
            loading={loading}
            setError={setError}
            setOutput={setOutput}
            audience={audience}
            setAudience={setAudience}
          />
        );

      case "health":
        return (
          <section className="panel">
            <h2> Health Check</h2>
            <button
              className="primary-btn"
              onClick={() => handleCallApi("/health", null, "GET")}
            >
              Esegui Health Check
            </button>
          </section>
        );

      default:
        return <div>Errore pagina</div>;
    }
  }

  /* ============================================================
       LAYOUT
  ============================================================ */
  return (
    <div className="app-root">
      <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} />

      <main className="main">
        <div className="main-inner">
          {renderPage()}
          <OutputPanel output={output} error={error} loading={loading} />
        </div>
      </main>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\components\GridLayout.jsx
// ==================================================



// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\components\Sidebar.css
// ==================================================

.sidebar {
  width: 240px;
  background: #ffffff;
  height: 100vh;
  padding: 24px 18px;
  box-shadow: 2px 0 16px rgba(0, 0, 0, 0.06);
  border-right: 1px solid #e6e6e6;
  position: fixed;
  left: 0;
  top: 0;
  display: flex;
  flex-direction: column;
  gap: 30px;
}

.sidebar-title {
  font-size: 22px;
  font-weight: 800;
  color: #ff4d4d;
  letter-spacing: -0.5px;
  margin-bottom: 10px;
}

.sidebar-menu {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.sidebar-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 15px;
  color: #444;
  font-weight: 600;
  transition: 0.2s all ease;
  border: 1px solid transparent;
}

.sidebar-item:hover {
  background: #fff4f4;
  border-color: #ffcccc;
  transform: translateX(3px);
}

.sidebar-item.active {
  background: linear-gradient(135deg, #ff4d4d, #ff1a1a);
  color: white;
  border-color: transparent;
  box-shadow: 0 4px 12px rgba(255, 70, 70, 0.35);
}

.sidebar-icon {
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\components\Sidebar.jsx
// ==================================================

import React from "react";
import "./Sidebar.css";

export default function Sidebar({ activeTab, setActiveTab }) {
  const items = [
    { id: "home", label: "Home", icon: "" },
    { id: "settings", label: "Settings", icon: "" },
    { id: "transcript", label: "Transcript", icon: "" },
    { id: "analyze-transcript", label: "Analyze Transcript", icon: "" },
    { id: "analyze-video", label: "Analyze Video", icon: "" },
    { id: "compare-transcript", label: "Compare Transcript", icon: "" },
    { id: "compare-videos", label: "Compare Videos", icon: "" },
    { id: "trend-scan", label: "Trend DeepSearch", icon: "" },

    //  NUOVA FUNZIONE ULTRA-PREMIUM
    { id: "outlier-engine", label: "Outlier Engine", icon: "" },
  ];

  return (
    <aside className="sidebar">
      <div className="sidebar-title">Zen Coach Pro</div>

      <nav className="sidebar-menu">
        {items.map((item) => (
          <div
            key={item.id}
            className={
              activeTab === item.id ? "sidebar-item active" : "sidebar-item"
            }
            onClick={() => setActiveTab(item.id)}
          >
            <span className="sidebar-icon">{item.icon}</span>
            <span>{item.label}</span>
          </div>
        ))}
      </nav>
    </aside>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\components\analyzer\AnalyzeResultCard.jsx
// ==================================================

export default function AnalyzeResultCard({ result }) {
  if (!result) return null;

  return (
    <div
      style={{
        marginTop: "30px",
        background: "#f3f3f3",
        padding: "25px",
        borderRadius: "12px",
        width: "100%",
        boxShadow: "0 0 10px rgba(0,0,0,0.08)"
      }}
    >
      <h2 style={{ marginBottom: "15px" }}>Risultati Analisi</h2>

      {/* Hook */}
      {result.hook && (
        <>
          <h3 style={{ marginTop: "20px" }}>Hook Identificato</h3>
          <p style={{ fontSize: "16px" }}>{result.hook}</p>
        </>
      )}

      {/* Debolezze */}
      {result.weaknesses && (
        <>
          <h3 style={{ marginTop: "20px" }}>Punti deboli</h3>
          <ul>
            {result.weaknesses.map((w, i) => (
              <li key={i} style={{ marginBottom: "6px" }}>
                {w}
              </li>
            ))}
          </ul>
        </>
      )}

      {/* Opportunit */}
      {result.opportunities && (
        <>
          <h3 style={{ marginTop: "20px" }}>Opportunit di miglioramento</h3>
          <ul>
            {result.opportunities.map((o, i) => (
              <li key={i} style={{ marginBottom: "6px" }}>
                {o}
              </li>
            ))}
          </ul>
        </>
      )}

      {/* Riscrittura */}
      {result.rewrite && (
        <>
          <h3 style={{ marginTop: "20px" }}>Riscrittura ad alta retention</h3>
          <p style={{ whiteSpace: "pre-wrap", lineHeight: "1.6" }}>
            {result.rewrite}
          </p>
        </>
      )}
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\components\common\Sidebar.jsx
// ==================================================

import { Link, useLocation } from "react-router-dom";
import {
  FaHome,
  FaChartBar,
  FaPenNib,
  FaFire,
  FaSearch,
  FaArrowDown,
} from "react-icons/fa";

export default function Sidebar() {
  const { pathname } = useLocation();

  const menu = [
    { label: "Transcript Tool", path: "/transcript" },
    { label: "Dashboard", path: "/", icon: <FaHome /> },
    { label: "Analyzer Pro", path: "/analyze", icon: <FaChartBar /> },
    { label: "Script Generator", path: "/generateScriptPro", icon: <FaPenNib /> },
    { label: "Trend Scanner", path: "/trend-scan", icon: <FaFire /> },
    { label: "SEO Insights", path: "/seo", icon: <FaSearch /> },
    { label: "Drop-off Analyzer", path: "/dropoff", icon: <FaArrowDown /> },
  ];

  return (
    <aside
      style={{
        width: "240px",
        background: "#111",
        color: "#fff",
        padding: "20px 10px",
        display: "flex",
        flexDirection: "column",
      }}
    >
      <h2 style={{ marginBottom: "30px" }}>Zen Coach Pro</h2>

      {menu.map((item) => (
        <Link
          key={item.path}
          to={item.path}
          style={{
            padding: "12px 14px",
            marginBottom: "8px",
            borderRadius: "6px",
            color: pathname === item.path ? "#000" : "#fff",
            background: pathname === item.path ? "#00DFA2" : "transparent",
            textDecoration: "none",
            fontWeight: 600,
            display: "flex",
            alignItems: "center",
            gap: "10px",
          }}
        >
          {item.icon}
          {item.label}
        </Link>
      ))}
    </aside>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\components\common\Topbar.jsx
// ==================================================

export default function Topbar() {
  return (
    <header
      style={{
        height: "60px",
        background: "#222",
        color: "#fff",
        display: "flex",
        alignItems: "center",
        justifyContent: "space-between",
        padding: "0 20px",
        borderBottom: "1px solid #333",
      }}
    >
      <h3 style={{ margin: 0 }}>Zen YouTube Coach Pro</h3>

      <div style={{ opacity: 0.7 }}>v2025 Enterprise</div>
    </header>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\config\api.js
// ==================================================

// ======================================================
//  Zen YouTube Coach Pro  API Client Centralizzato
// Versione PRO  Compatibile con Render e Locale
// ======================================================

//  METTI SOLO QUESTA RIGA PER CAMBIARE AMBIENTE
export const API_BASE =
  import.meta.env.VITE_API_BASE ||
  "https://zen-youtube-coach-backend.onrender.com";

// ------------------------------------------------------
// HELPER GENERALE PER TUTTE LE CHIAMATE DELLA UI
// ------------------------------------------------------
export async function callApi(path, body = null, method = "POST") {
  try {
    const options = {
      method,
      headers: {
        "Content-Type": "application/json",
      },
    };

    if (method !== "GET" && body) {
      options.body = JSON.stringify(body);
    }

    const response = await fetch(`${API_BASE}${path}`, options);
    const text = await response.text();

    let json;
    try {
      json = JSON.parse(text);
    } catch {
      json = text;
    }

    if (!response.ok) {
      return {
        error: true,
        status: response.status,
        message: json?.message || `Errore API (${response.status})`,
        raw: json,
      };
    }

    return json;
  } catch (err) {
    return {
      error: true,
      message: err.message || "Errore connessione al backend",
    };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\config\apiClient.js
// ==================================================

const API_BASE_URL = "http://localhost:3000";

// GET
export async function apiGet(path) {
  try {
    const res = await fetch(`${API_BASE_URL}${path}`);

    const contentType = res.headers.get("content-type") || "";
    const raw = await res.text();

    if (contentType.includes("application/json")) {
      return JSON.parse(raw);
    }

    console.error(" Risposta NON JSON (GET)", {
      path,
      status: res.status,
      raw,
    });

    return {
      ok: false,
      error: `Risposta non JSON dal backend (status ${res.status})`,
      raw,
    };
  } catch (err) {
    return { ok: false, error: err.message };
  }
}

// POST
export async function apiPost(path, body = {}) {
  try {
    const res = await fetch(`${API_BASE_URL}${path}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });

    const contentType = res.headers.get("content-type") || "";
    const raw = await res.text();

    if (contentType.includes("application/json")) {
      return JSON.parse(raw);
    }

    console.error(" Risposta NON JSON (POST)", {
      path,
      status: res.status,
      raw,
    });

    return {
      ok: false,
      error: `Risposta non JSON dal backend (status ${res.status})`,
      raw,
    };
  } catch (err) {
    return { ok: false, error: err.message };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\hooks\useDashboardConfig.js
// ==================================================

// src/hooks/useDashboardConfig.js
import { useEffect, useState } from "react";

const STORAGE_KEY = "zenDashboardConfig_v1";

const defaultConfig = {
  theme: {
    background:
      "radial-gradient(circle at top, #111827, #020617 45%, #000 80%)",
    accent: "#ef4444"
  },
  cards: [
    {
      id: "find-keywords",
      title: "Find Trending Keywords",
      subtitle: "Scopri le keyword che stanno esplodendo ora.",
      imageUrl: "",
      bgColor: "#111827",
      enabled: true
    },
    {
      id: "video-ideas",
      title: "Get Video Ideas",
      subtitle: "Genera idee video pronte per Over 50/60/70.",
      imageUrl: "",
      bgColor: "#111827",
      enabled: true
    },
    {
      id: "trending-videos",
      title: "Find Trending Videos",
      subtitle: "Analizza i video che stanno esplodendo nel tuo settore.",
      imageUrl: "",
      bgColor: "#111827",
      enabled: true
    },
    {
      id: "thumbnails",
      title: "Create Thumbnails",
      subtitle: "Genera thumbnail con CTR alto.",
      imageUrl: "",
      bgColor: "#111827",
      enabled: true
    }
  ],
  layout: [
    // layout iniziale (colonne: 12)
    { i: "find-keywords", x: 0, y: 0, w: 3, h: 3, minW: 2, minH: 2 },
    { i: "video-ideas", x: 3, y: 0, w: 3, h: 3, minW: 2, minH: 2 },
    { i: "trending-videos", x: 6, y: 0, w: 3, h: 3, minW: 2, minH: 2 },
    { i: "thumbnails", x: 9, y: 0, w: 3, h: 3, minW: 2, minH: 2 }
  ]
};

function loadConfig() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return defaultConfig;
    const parsed = JSON.parse(raw);
    return { ...defaultConfig, ...parsed };
  } catch {
    return defaultConfig;
  }
}

export function useDashboardConfig() {
  const [config, setConfig] = useState(loadConfig);

  // salva su localStorage
  useEffect(() => {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(config));
    } catch (e) {
      console.warn(" Impossibile salvare config in localStorage:", e);
    }
  }, [config]);

  // applica tema alle CSS vars
  useEffect(() => {
    if (config.theme?.background) {
      document.body.style.background = config.theme.background;
    }
    if (config.theme?.accent) {
      document.documentElement.style.setProperty(
        "--accent",
        config.theme.accent
      );
    }
  }, [config.theme]);

  const updateTheme = (patch) => {
    setConfig((prev) => ({
      ...prev,
      theme: { ...prev.theme, ...patch }
    }));
  };

  const updateCard = (id, patch) => {
    setConfig((prev) => ({
      ...prev,
      cards: prev.cards.map((c) =>
        c.id === id ? { ...c, ...patch } : c
      )
    }));
  };

  const setLayout = (layout) => {
    setConfig((prev) => ({
      ...prev,
      layout
    }));
  };

  return {
    config,
    updateTheme,
    updateCard,
    setLayout
  };
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\index.css
// ==================================================

:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  display: flex;
  place-items: center;
  min-width: 320px;
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\layout\MainLayout.jsx
// ==================================================

import Sidebar from "../components/common/Sidebar";
import Topbar from "../components/common/Topbar";

export default function MainLayout({ children }) {
  return (
    <div className="app-layout" style={{ display: "flex", height: "100vh" }}>
      
      {/* Sidebar laterale */}
      <Sidebar />

      {/* Contenuto */}
      <div style={{ flex: 1, display: "flex", flexDirection: "column" }}>
        
        {/* Barra superiore */}
        <Topbar />

        {/* Area principale */}
        <main style={{ padding: "20px", overflowY: "auto", flex: 1 }}>
          {children}
        </main>
      </div>

    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\main.jsx
// ==================================================

import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import App from "./App";

import "./index.css";

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\AnalyzeTranscript.css
// ==================================================

.analyze-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.analyze-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
}

.audience-switch {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 8px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.85);
  border: 1px solid rgba(148, 163, 184, 0.6);
}

.audience-label {
  font-size: 0.8rem;
  opacity: 0.9;
}

.audience-btn {
  border-radius: 999px;
  border: 1px solid transparent;
  padding: 4px 10px;
  font-size: 0.8rem;
  cursor: pointer;
  background: transparent;
  transition: 0.15s;
}

.audience-btn:hover {
  border-color: rgba(96, 165, 250, 0.7);
}

.audience-active {
  border-color: rgba(59, 130, 246, 1);
  background: rgba

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\AnalyzeTranscript.jsx
// ==================================================

import React, { useState, useMemo } from "react";
import "./AnalyzeTranscript.css";

const AnalyzeTranscript = ({
  callApi,
  loading,
  setError,
  setOutput,
  output,
  audience,
  setAudience
}) => {
  const [rawTranscript, setRawTranscript] = useState("");

  // Pulizia transcript (senza rompere nulla)
  const cleanTranscript = (text) => {
    if (!text) return "";
    return text
      .replace(/\d{1,2}:\d{2}/g, "") // 00:00
      .replace(/\d{1,2}:\d{2}:\d{2}/g, "") // 00:00:00
      .replace(/[ ]{2,}/g, " ")
      .trim();
  };

  const handleClean = () => {
    setRawTranscript((prev) => cleanTranscript(prev));
  };

  const handleReset = () => {
    setRawTranscript("");
    setOutput(null);
    setError("");
  };

  const charCount = rawTranscript.length;

  const handleAnalyze = () => {
    if (!rawTranscript.trim()) {
      setError(" Inserisci o incolla un transcript da analizzare.");
      return;
    }

    setError("");
    setOutput(null);

    callApi("/analyze-transcript", {
      audience, // over50 / over60 / over70
      transcript: rawTranscript
    });
  };

  // Estraggo qualche dato di massima se il backend li espone
  const scores = useMemo(() => {
    if (!output || typeof output !== "object") return {};

    // Provo varie strutture possibili senza rompere se non ci sono
    const root = output.result || output.data || output;

    return {
      ideaScore:
        root.ideaScore ||
        root.idea_score ||
        root.ideaRating ||
        root.scores?.idea ||
        null,
      hookScore:
        root.hookScore ||
        root.hook_score ||
        root.scores?.hook ||
        null,
      retentionScore:
        root.retentionScore ||
        root.retention_score ||
        root.scores?.retention ||
        null,
      structureScore:
        root.structureScore ||
        root.structure_score ||
        root.scores?.structure ||
        null,
      summary:
        root.summary ||
        root.overview ||
        root.recapture ||
        null,
      quickFixes:
        root.quickFixes ||
        root.fixes ||
        root.quick_actions ||
        null
    };
  }, [output]);

  const openExportNotion = () => {
    alert(
      "Funzione 'Esporta in Notion' prevista nella roadmap.\nPer ora copia l'output JSON dal pannello a destra e incollalo nella tua pagina Notion."
    );
  };

  const openExportSheet = () => {
    alert(
      "Funzione 'Esporta in Google Sheet' prevista nella roadmap.\nIn futuro Zen Coach compiler in automatico la riga nel foglio."
    );
  };

  return (
    <section className="panel analyze-panel">
      <div className="analyze-header">
        <div>
          <h2> Analyze Transcript PRO</h2>
          <p className="panel-subtitle">
            Trasforma il transcript in insight strategici per Over 50 / 60 / 70.
          </p>
        </div>

        {/* Audience selector */}
        <div className="audience-switch">
          <span className="audience-label">Audience:</span>
          <button
            type="button"
            className={
              "audience-btn" + (audience === "over50" ? " audience-active" : "")
            }
            onClick={() => setAudience("over50")}
          >
            Over 50
          </button>
          <button
            type="button"
            className={
              "audience-btn" + (audience === "over60" ? " audience-active" : "")
            }
            onClick={() => setAudience("over60")}
          >
            Over 60
          </button>
          <button
            type="button"
            className={
              "audience-btn" + (audience === "over70" ? " audience-active" : "")
            }
            onClick={() => setAudience("over70")}
          >
            Over 70
          </button>
        </div>
      </div>

      <div className="analyze-grid">
        {/* COLONNA SINISTRA - INPUT */}
        <div className="analyze-left">
          <div className="analyze-block">
            <label className="input-label">
              Transcript da analizzare
              <span className="input-hint">
                Suggerimento: usa prima il <strong>Transcript Engine PRO</strong> per
                pulire il testo, poi incolla qui il risultato.
              </span>
            </label>
            <textarea
              className="textarea analyze-textarea"
              rows="14"
              value={rawTranscript}
              onChange={(e) => setRawTranscript(e.target.value)}
              placeholder="Incolla qui il transcript del video (gi pulito dai timestamp, se possibile)..."
            />
            <div className="analyze-meta-row">
              <span className="analyze-charcount">
                Caratteri: <strong>{charCount}</strong>
              </span>
              <div className="analyze-input-buttons">
                <button
                  type="button"
                  className="secondary-btn"
                  onClick={handleClean}
                >
                   Pulisci testo
                </button>
                <button
                  type="button"
                  className="ghost-btn"
                  onClick={handleReset}
                >
                   Reset
                </button>
              </div>
            </div>
          </div>

          <button
            type="button"
            className="primary-btn analyze-run-btn"
            disabled={loading}
            onClick={handleAnalyze}
          >
            {loading ? " Analisi in corso" : " Analizza Transcript con AI"}
          </button>

          <div className="analyze-export-row">
            <button
              type="button"
              className="outline-btn"
              onClick={openExportNotion}
            >
               Esporta in Notion
            </button>
            <button
              type="button"
              className="outline-btn"
              onClick={openExportSheet}
            >
               Esporta in Google Sheet
            </button>
          </div>
        </div>

        {/* COLONNA DESTRA - CARDS INSIGHT */}
        <div className="analyze-right">
          <h3 className="analyze-right-title">Insight veloci dal risultato</h3>
          {!output && (
            <p className="analyze-placeholder">
              Lancia unanalisi per vedere qui una sintesi dei punteggi
              (Hook, Retention, Struttura, Idea Score) basata sulla risposta del
              backend. Il dettaglio completo lo trovi sempre nel pannello
              <strong> Output</strong> a destra.
            </p>
          )}

          {/* SCORE CARDS */}
          <div className="score-grid">
            <div className="score-card">
              <div className="score-label">Idea Score</div>
              <div className="score-value">
                {scores.ideaScore != null ? scores.ideaScore : ""}
              </div>
              <div className="score-sub">Potenziale complessivo del video</div>
            </div>

            <div className="score-card">
              <div className="score-label">Hook</div>
              <div className="score-value">
                {scores.hookScore != null ? scores.hookScore : ""}
              </div>
              <div className="score-sub">
                Forza del gancio iniziale nei primi 30 secondi
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Retention</div>
              <div className="score-value">
                {scores.retentionScore != null ? scores.retentionScore : ""}
              </div>
              <div className="score-sub">
                Quanto il testo aiuta a trattenere lo spettatore
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Struttura</div>
              <div className="score-value">
                {scores.structureScore != null ? scores.structureScore : ""}
              </div>
              <div className="score-sub">
                Chiarezza della sequenza: hook  storia  soluzione  CTA
              </div>
            </div>
          </div>

          {/* SUMMARY / QUICK FIXES */}
          {scores.summary && (
            <div className="analyze-summary-block">
              <h4>Riassunto strategico</h4>
              <p className="analyze-summary-text">{scores.summary}</p>
            </div>
          )}

          {scores.quickFixes && Array.isArray(scores.quickFixes) && (
            <div className="analyze-fixes-block">
              <h4>Fix immediati consigliati</h4>
              <ul className="analyze-fixes-list">
                {scores.quickFixes.map((fix, idx) => (
                  <li key={idx}>{fix}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      </div>
    </section>
  );
};

export default AnalyzeTranscript;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\AnalyzeVideo.css
// ==================================================

.analyzevideo-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.analyzevideo-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
}

.analyzevideo-header-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
}

.analyzevideo-info-btn {
  font-size: 0.8rem;
  padding: 4px 10px;
}

/* GRID */
.analyzevideo-grid {
  display: grid;
  grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.5fr);
  gap: 16px;
}

.analyzevideo-left {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.analyzevideo-right {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.analyzevideo-block {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.input-label {
  font-size: 0.85rem;
  opacity: 0.85;
}

.input {
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.6);
  border-radius: 8px;
  padding: 8px;
  color: white;
}

/* DEPTH BUTTONS */
.depth-row {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.depth-btn {
  width: 100%;
  text-align: left;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.6);
  background: rgba(15, 23, 42, 0.95);
  padding: 8px 10px;
  cursor: pointer;
  font-size: 0.85rem;
  display: flex;
  flex-direction: column;
  gap: 2px;
  transition: 0.15s;
}

.depth-btn span {
  font-size: 0.75rem;
  opacity: 0.85;
}

.depth-btn:hover {
  border-color: rgba(96, 165, 250, 0.9);
}

.depth-active {
  border-color: rgba(59, 130, 246, 1);
  background: rgba(37, 99, 235, 0.25);
}

/* RUN BUTTON */
.analyzevideo-run-btn {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
}

.analyzevideo-hint {
  margin: 0;
  font-size: 0.8rem;
  opacity: 0.85;
}

/* SCORE GRID (riusa stile generale) */
.score-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 8px;
}

.score-card {
  padding: 8px 10px;
  border-radius: 10px;
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(148, 163, 184, 0.6);
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.score-label {
  font-size: 0.8rem;
  opacity: 0.85;
}

.score-value {
  font-size: 1.1rem;
  font-weight: 700;
}

.score-sub {
  font-size: 0.75rem;
  opacity: 0.8;
}

/* TEXT BLOCKS */
.analyzevideo-placeholder {
  font-size: 0.8rem;
  opacity: 0.85;
}

.analyzevideo-summary-block,
.analyzevideo-seo-block,
.analyzevideo-fixes-block {
  margin-top: 6px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.6);
  background: rgba(15, 23, 42, 0.9);
}

.analyzevideo-summary-block h4,
.analyzevideo-seo-block h4,
.analyzevideo-fixes-block h4 {
  margin: 0 0 4px;
  font-size: 0.9rem;
}

.analyzevideo-summary-text,
.analyzevideo-seo-text {
  margin: 0;
  font-size: 0.8rem;
  opacity: 0.9;
}

.analyzevideo-fixes-list {
  margin: 0;
  padding-left: 18px;
  font-size: 0.8rem;
  opacity: 0.9;
}

.analyzevideo-fixes-list li {
  margin-bottom: 3px;
}

/* RESPONSIVE */
@media (max-width: 1100px) {
  .analyzevideo-grid {
    grid-template-columns: 1fr;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\AnalyzeVideo.jsx
// ==================================================

import React, { useState, useMemo } from "react";
import "./AnalyzeVideo.css";

const isValidYouTubeUrl = (url) => {
  if (!url) return false;
  return url.includes("youtube.com/watch?v=") || url.includes("youtu.be/");
};

const AnalyzeVideo = ({
  callApi,
  loading,
  setError,
  setOutput,
  output,
  audience,
  setAudience
}) => {
  const [videoUrl, setVideoUrl] = useState("");
  const [depth, setDepth] = useState("full"); // full | hook | quick

  const handleAnalyze = () => {
    setOutput(null);
    setError("");

    if (!isValidYouTubeUrl(videoUrl)) {
      setError(" Inserisci un URL YouTube valido.");
      return;
    }

    callApi("/analyze-video", {
      url: videoUrl.trim(),
      audience,
      mode: depth
    });
  };

  const openInfo = () => {
    alert(
      "Analyze Video PRO analizza direttamente il video tramite transcript automatico.\n" +
        "- Hook e primi 30 secondi\n" +
        "- Struttura narrativa\n" +
        "- Retention potenziale\n" +
        "- Allineamento al pubblico Over 50/60/70\n" +
        "Il dettaglio tecnico completo lo trovi nel pannello Output a destra."
    );
  };

  // Provo a estrarre eventuali punteggi dal JSON del backend (se presenti)
  const scores = useMemo(() => {
    if (!output || typeof output !== "object") return {};

    const root = output.result || output.data || output;

    return {
      ideaScore:
        root.ideaScore ||
        root.idea_score ||
        root.scores?.idea ||
        null,
      hookScore:
        root.hookScore ||
        root.hook_score ||
        root.scores?.hook ||
        null,
      retentionScore:
        root.retentionScore ||
        root.retention_score ||
        root.scores?.retention ||
        null,
      structureScore:
        root.structureScore ||
        root.structure_score ||
        root.scores?.structure ||
        null,
      titleScore:
        root.titleScore ||
        root.title_score ||
        root.scores?.title ||
        null,
      seoNotes: root.seoNotes || root.seo_notes || null,
      summary: root.summary || root.overview || null,
      quickFixes:
        root.quickFixes ||
        root.fixes ||
        root.quick_actions ||
        null
    };
  }, [output]);

  return (
    <section className="panel analyzevideo-panel">
      <div className="analyzevideo-header">
        <div>
          <h2> Analyze Video PRO</h2>
          <p className="panel-subtitle">
            Analisi completa del video YouTube: hook, struttura, retention, titolo e
            allineamento al pubblico Over 50/60/70.
          </p>
        </div>

        <div className="analyzevideo-header-right">
          <div className="audience-switch">
            <span className="audience-label">Audience:</span>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over50" ? " audience-active" : "")
              }
              onClick={() => setAudience("over50")}
            >
              Over 50
            </button>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over60" ? " audience-active" : "")
              }
              onClick={() => setAudience("over60")}
            >
              Over 60
            </button>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over70" ? " audience-active" : "")
              }
              onClick={() => setAudience("over70")}
            >
              Over 70
            </button>
          </div>

          <button
            type="button"
            className="ghost-btn analyzevideo-info-btn"
            onClick={openInfo}
          >
             Come funziona
          </button>
        </div>
      </div>

      <div className="analyzevideo-grid">
        {/* SINISTRA: INPUT */}
        <div className="analyzevideo-left">
          <div className="analyzevideo-block">
            <label className="input-label">URL del video YouTube</label>
            <input
              type="text"
              className="input"
              placeholder="https://www.youtube.com/watch?v=XXXXXXX"
              value={videoUrl}
              onChange={(e) => setVideoUrl(e.target.value)}
            />
          </div>

          <div className="analyzevideo-block">
            <label className="input-label">Profondit analisi</label>
            <div className="depth-row">
              <button
                type="button"
                className={
                  "depth-btn" + (depth === "full" ? " depth-active" : "")
                }
                onClick={() => setDepth("full")}
              >
                 Completa
                <span>Hook + struttura + retention + titolo + SEO</span>
              </button>
              <button
                type="button"
                className={
                  "depth-btn" + (depth === "hook" ? " depth-active" : "")
                }
                onClick={() => setDepth("hook")}
              >
                 Focus Hook
                <span>Solo primi 3060 secondi</span>
              </button>
              <button
                type="button"
                className={
                  "depth-btn" + (depth === "quick" ? " depth-active" : "")
                }
                onClick={() => setDepth("quick")}
              >
                 Analisi Rapida
                <span>Panoramica veloce + fix</span>
              </button>
            </div>
          </div>

          <button
            type="button"
            className="primary-btn analyzevideo-run-btn"
            disabled={loading}
            onClick={handleAnalyze}
          >
            {loading ? " Analisi in corso" : " Avvia Analyze Video PRO"}
          </button>

          <p className="analyzevideo-hint">
            Suggerimento: usa questo modulo per decodificare i video outlier dei
            competitor e capire cosa replicare nei tuoi contenuti.
          </p>
        </div>

        {/* DESTRA: SCORE CARDS */}
        <div className="analyzevideo-right">
          <h3 className="analyzevideo-right-title">Insight veloci dal risultato</h3>
          {!output && (
            <p className="analyzevideo-placeholder">
              Lancia unanalisi per vedere qui i punteggi principali.
              Il dettaglio completo  sempre visibile nel pannello <strong>Output</strong>.
            </p>
          )}

          <div className="score-grid">
            <div className="score-card">
              <div className="score-label">Idea Score</div>
              <div className="score-value">
                {scores.ideaScore != null ? scores.ideaScore : ""}
              </div>
              <div className="score-sub">
                Potenziale complessivo del contenuto per la nicchia target.
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Hook</div>
              <div className="score-value">
                {scores.hookScore != null ? scores.hookScore : ""}
              </div>
              <div className="score-sub">
                Forza del gancio nei primi 30 secondi.
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Retention</div>
              <div className="score-value">
                {scores.retentionScore != null ? scores.retentionScore : ""}
              </div>
              <div className="score-sub">
                Capacit del video di trattenere lattenzione.
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Struttura</div>
              <div className="score-value">
                {scores.structureScore != null ? scores.structureScore : ""}
              </div>
              <div className="score-sub">
                Logica narrativa: hook  storia  rivelazione  CTA.
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Titolo / SEO</div>
              <div className="score-value">
                {scores.titleScore != null ? scores.titleScore : ""}
              </div>
              <div className="score-sub">
                Coerenza di titolo e SEO con il contenuto.
              </div>
            </div>
          </div>

          {scores.summary && (
            <div className="analyzevideo-summary-block">
              <h4>Riassunto strategico</h4>
              <p className="analyzevideo-summary-text">{scores.summary}</p>
            </div>
          )}

          {scores.seoNotes && (
            <div className="analyzevideo-seo-block">
              <h4>Note SEO</h4>
              <p className="analyzevideo-seo-text">{scores.seoNotes}</p>
            </div>
          )}

          {scores.quickFixes && Array.isArray(scores.quickFixes) && (
            <div className="analyzevideo-fixes-block">
              <h4>Fix immediati consigliati</h4>
              <ul className="analyzevideo-fixes-list">
                {scores.quickFixes.map((fix, idx) => (
                  <li key={idx}>{fix}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      </div>
    </section>
  );
};

export default AnalyzeVideo;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\AnalyzerPage.jsx
// ==================================================

export default function AnalyzerPage() {
  return (
    <div>
      <h1>Analyzer</h1>
      <p>Qui potrai analizzare transcript, drop-off e benchmark.</p>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\AnalyzerPro.css
// ==================================================

.analyzerpro-panel {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.analyzerpro-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.audience-switch {
  display: inline-flex;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.85);
  border: 1px solid rgba(148, 163, 184, 0.5);
}

.audience-label {
  font-size: 0.8rem;
  opacity: 0.8;
}

.audience-btn {
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid transparent;
  cursor: pointer;
  background: transparent;
  font-size: 0.8rem;
  transition: 0.15s;
}

.audience-btn:hover {
  border-color: rgba(96, 165, 250, 0.7);
}

.audience-active {
  border-color: rgba(59, 130, 246, 1);
  background: rgba(37, 99, 235, 0.25);
}

.analyzerpro-block {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.input-label {
  font-size: 0.85rem;
  opacity: 0.85;
}

.input {
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.6);
  border-radius: 8px;
  padding: 8px;
  color: white;
}

.analyzerpro-run-btn {
  width: 100%;
  padding: 12px;
  font-size: 1rem;
}

.analyzerpro-info {
  padding: 14px;
  border-radius: 12px;
  background: rgba(15, 23, 42, 0.8);
  border: 1px solid rgba(148, 163, 184, 0.3);
}

.analyzerpro-info ul {
  margin: 0;
  padding-left: 18px;
  opacity: 0.9;
}

.analyzerpro-info li {
  margin-bottom: 6px;
  font-size: 0.85rem;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\AnalyzerPro.jsx
// ==================================================

import React, { useState } from "react";
import "./AnalyzerPro.css";

const AnalyzerPro = () => {
  const [videoUrl, setVideoUrl] = useState("");
  const [audience, setAudience] = useState("over60");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [output, setOutput] = useState(null);

  // ----------------------------------------
  // Validazione URL YouTube
  // ----------------------------------------
  const isValidYouTubeUrl = (url) => {
    return (
      url.includes("youtube.com/watch?v=") ||
      url.includes("youtu.be/")
    );
  };

  // ----------------------------------------
  // Call API universale
  // ----------------------------------------
  const callApi = async (endpoint, body) => {
    try {
      setLoading(true);
      setError("");
      setOutput(null);

      const response = await fetch(
        `http://localhost:4000${endpoint}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        }
      );

      const data = await response.json();
      setLoading(false);

      if (!data.success) {
        setError(data.error || "Errore sconosciuto nell'analisi.");
        return;
      }

      setOutput(data.result);
    } catch (err) {
      setLoading(false);
      setError("Errore di connessione al server.");
    }
  };

  // ----------------------------------------
  // Avvia analisi avanzata
  // ----------------------------------------
  const runAnalysis = () => {
    if (!isValidYouTubeUrl(videoUrl)) {
      setError(" Inserisci un URL YouTube valido.");
      return;
    }

    callApi("/analyzer-pro/analyzer-pro", {
      url: videoUrl,
      audience,
    });
  };

  // ----------------------------------------
  // RENDER UI
  // ----------------------------------------
  return (
    <section className="panel analyzerpro-panel">

      {/* Header */}
      <div className="analyzerpro-header">
        <div>
          <h2> Analyzer PRO  Ultra Premium</h2>
          <p className="panel-subtitle">
            Analisi avanzata del video: hook, struttura, psychological patterns, retention e SEO.
          </p>
        </div>

        {/* Audience Switch */}
        <div className="audience-switch">
          <span className="audience-label">Target:</span>

          {["over50", "over60", "over70"].map((a) => (
            <button
              key={a}
              type="button"
              className={
                "audience-btn" + (audience === a ? " audience-active" : "")
              }
              onClick={() => setAudience(a)}
            >
              {a.toUpperCase()}
            </button>
          ))}
        </div>
      </div>

      {/* URL Input */}
      <div className="analyzerpro-block">
        <label className="input-label">URL del video YouTube</label>
        <input
          type="text"
          className="input"
          placeholder="https://www.youtube.com/watch?v=XYZ"
          value={videoUrl}
          onChange={(e) => setVideoUrl(e.target.value)}
        />
      </div>

      {/* Action Button */}
      <button
        className="primary-btn analyzerpro-run-btn"
        disabled={loading}
        onClick={runAnalysis}
      >
        {loading ? " Analisi in corso" : " Avvia Analisi Ultra-Premium"}
      </button>

      {/* Error Display */}
      {error && <p className="error-text">{error}</p>}

      {/* Output */}
      {output && (
        <div className="analyzerpro-output">
          <h3> Risultati Analisi</h3>

          <pre className="output-json">
            {JSON.stringify(output, null, 2)}
          </pre>
        </div>
      )}

      {/* Info Section */}
      <div className="analyzerpro-info">
        <h3> Cosa fa lAnalyzer PRO</h3>
        <ul>
          <li> Analisi intensiva dei primi 30 secondi</li>
          <li> Identificazione dei cali di attenzione</li>
          <li> Valutazione della struttura narrativa</li>
          <li> Psychological Patterns</li>
          <li> Retention Blueprint</li>
          <li> Idea Score + Title Score</li>
          <li> Debolezze & Soluzioni immediate</li>
          <li> SEO, hooks, tags, long-tail opportunities</li>
        </ul>
      </div>
    </section>
  );
};

export default AnalyzerPro;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\CompareTranscript.css
// ==================================================

.compareT-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.compareT-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.compareT-grid {
  display: grid;
  grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.6fr);
  gap: 16px;
}

.compareT-left,
.compareT-right {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.compareT-block {
  padding: 10px 12px;
  border-radius: 10px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.5);
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.textarea {
  min-height: 160px;
  background: rgba(15, 23, 42, 0.95);
  border-radius: 8px;
  padding: 8px;
  border: 1px solid rgba(148,163,184,0.6);
  color: white;
}

.compareT-run {
  width: 100%;
  padding: 10px;
}

.compareT-placeholder {
  opacity: 0.85;
}

/* Winner */
.winner-card {
  padding: 10px;
  border-radius: 10px;
  background: rgba(15,23,42,0.95);
  border: 1px solid rgba(148,163,184,0.6);
}

.winner-reason {
  opacity: 0.85;
}

/* Scores */
.score-section {}

.score-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px,1fr));
  gap: 10px;
}

.score-card {
  background: rgba(15,23,42,0.9);
  border: 1px solid rgba(148,163,184,0.6);
  padding: 8px;
  border-radius: 10px;
}

.score-line {
  display: flex;
  justify-content: space-between;
}

/* improvements */
.improvement-section {}

.improvement-block ul {
  padding-left: 18px;
}

/* steal & pattern */
.steal-section,
.pattern-section {
  background: rgba(15,23,42,0.9);
  border: 1px solid rgba(148,163,184,0.6);
  padding: 8px;
  border-radius: 10px;
}

.pattern-section ul,
.steal-section ul {
  padding-left: 18px;
}

/* Responsive */
@media (max-width: 1100px) {
  .compareT-grid {
    grid-template-columns: 1fr;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\CompareTranscript.jsx
// ==================================================

import React, { useState, useMemo } from "react";
import "./CompareTranscript.css";

const CompareTranscript = ({
  callApi,
  loading,
  setError,
  setOutput,
  output,
  audience,
  setAudience
}) => {
  const [A_title, setA_title] = useState("Mio Video");
  const [A_text, setA_text] = useState("");

  const [B_title, setB_title] = useState("Competitor");
  const [B_text, setB_text] = useState("");

  const handleCompare = () => {
    setOutput(null);
    setError("");

    if (!A_text.trim() || !B_text.trim()) {
      setError(" Inserisci entrambi i transcript.");
      return;
    }

    callApi("/compare-transcript", {
      audience,
      A: { title: A_title, transcript: A_text },
      B: { title: B_title, transcript: B_text }
    });
  };

  const parsed = useMemo(() => {
    if (!output || typeof output !== "object") return null;
    return output.data || output.result || output;
  }, [output]);

  return (
    <section className="panel compareT-panel">
      <div className="compareT-header">
        <h2> Compare Transcript PRO</h2>
        <div className="audience-switch">
          <span className="audience-label">Audience:</span>
          {["over50", "over60", "over70"].map((a) => (
            <button
              key={a}
              type="button"
              className={
                "audience-btn" + (audience === a ? " audience-active" : "")
              }
              onClick={() => setAudience(a)}
            >
              {a.toUpperCase()}
            </button>
          ))}
        </div>
      </div>

      <div className="compareT-grid">
        {/* LEFT  INPUT */}
        <div className="compareT-left">
          {/* Transcript A */}
          <div className="compareT-block">
            <h4>Transcript A (Tuo Video)</h4>

            <label className="input-label">Titolo</label>
            <input
              className="input"
              value={A_title}
              onChange={(e) => setA_title(e.target.value)}
            />

            <label className="input-label">Contenuto</label>
            <textarea
              className="textarea"
              value={A_text}
              onChange={(e) => setA_text(e.target.value)}
            />
          </div>

          {/* Transcript B */}
          <div className="compareT-block">
            <h4>Transcript B (Competitor)</h4>

            <label className="input-label">Titolo</label>
            <input
              className="input"
              value={B_title}
              onChange={(e) => setB_title(e.target.value)}
            />

            <label className="input-label">Contenuto</label>
            <textarea
              className="textarea"
              value={B_text}
              onChange={(e) => setB_text(e.target.value)}
            />
          </div>

          <button
            type="button"
            className="primary-btn compareT-run"
            disabled={loading}
            onClick={handleCompare}
          >
            {loading ? " Confronto" : " Confronta Transcript"}
          </button>
        </div>

        {/* RIGHT  RISULTATO */}
        <div className="compareT-right">
          {!parsed && (
            <p className="compareT-placeholder">
              Inserisci due transcript e avvia il confronto.
            </p>
          )}

          {parsed && (
            <>
              {/* Winner */}
              <div className="winner-card">
                <h4> Vincitore</h4>
                <p>
                  <strong>{parsed.winner}</strong>
                </p>
                <p className="winner-reason">{parsed.reason}</p>
              </div>

              {/* Scores */}
              <div className="score-section">
                <h4> Punteggi</h4>
                <div className="score-grid">
                  {["A", "B"].map((key) => (
                    <div key={key} className="score-card">
                      <h5>{key === "A" ? A_title : B_title}</h5>
                      {Object.entries(parsed.scores[key]).map(
                        ([k, v], i) => (
                          <div className="score-line" key={i}>
                            <span>{k}:</span>
                            <strong>{v}</strong>
                          </div>
                        )
                      )}
                    </div>
                  ))}
                </div>
              </div>

              {/* Improvements */}
              <div className="improvement-section">
                <h4> Miglioramenti</h4>
                {["A", "B"].map((side) => (
                  <div key={side} className="improvement-block">
                    <h5>{side === "A" ? A_title : B_title}</h5>
                    <ul>
                      {parsed.improvements[side].map((fix, i) => (
                        <li key={i}>{fix}</li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>

              {/* STEAL */}
              <div className="steal-section">
                <h4> Cosa rubare</h4>
                <h5>{A_title}  da {B_title}</h5>
                <ul>
                  {parsed.stealFromEachOther.A_should_steal_from_B.map(
                    (s, i) => (
                      <li key={i}>{s}</li>
                    )
                  )}
                </ul>

                <h5>{B_title}  da {A_title}</h5>
                <ul>
                  {parsed.stealFromEachOther.B_should_steal_from_A.map(
                    (s, i) => (
                      <li key={i}>{s}</li>
                    )
                  )}
                </ul>
              </div>

              {/* PATTERNS */}
              <div className="pattern-section">
                <h4> Pattern condivisi</h4>
                <ul>
                  {parsed.patternsShared.map((p, i) => (
                    <li key={i}>{p}</li>
                  ))}
                </ul>
              </div>
            </>
          )}
        </div>
      </div>
    </section>
  );
};

export default CompareTranscript;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\CompareVideos.css
// ==================================================

.compare-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.compare-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
}

.compare-header-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
}

.compare-info-btn {
  font-size: 0.8rem;
  padding: 4px 10px;
}

/* GRID */
.compare-grid {
  display: grid;
  grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.6fr);
  gap: 16px;
}

.compare-left {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.compare-right {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.compare-block {
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.5);
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.compare-block-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.compare-chip {
  font-size: 0.75rem;
  padding: 3px 8px;
  border-radius: 999px;
  background: rgba(59, 130, 246, 0.3);
  border: 1px solid rgba(59, 130, 246, 0.8);
}

.compare-run-btn {
  width: 100%;
  margin-top: 4px;
  padding: 10px;
}

/* PAYLOAD BOX */
.compare-payload-section {
  margin-top: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: rgba(15, 23, 42, 0.9);
}

.compare-payload-section h4 {
  margin: 0 0 4px;
  font-size: 0.9rem;
}

.compare-right-sub {
  margin: 0 0 4px;
  font-size: 0.8rem;
  opacity: 0.85;
}

.compare-payload-box {
  margin-top: 6px;
  background: rgba(15, 23, 42, 0.95);
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.6);
  padding: 10px;
  font-size: 0.78rem;
  max-height: 260px;
  overflow: auto;
}

/* RIGHT SIDE: RESULT */
.compare-right-title {
  margin: 0;
  font-size: 0.95rem;
}

.compare-placeholder {
  margin: 0;
  font-size: 0.8rem;
  opacity: 0.85;
}

/* RANKING */
.compare-ranking {
  margin-top: 6px;
}

.compare-ranking h4 {
  margin: 0 0 4px;
  font-size: 0.9rem;
}

.ranking-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 8px;
}

.ranking-card {
  padding: 8px 10px;
  border-radius: 10px;
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(148, 163, 184, 0.6);
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.ranking-position {
  font-size: 0.85rem;
  font-weight: 700;
}

.ranking-label {
  font-size: 0.9rem;
  font-weight: 600;
}

.ranking-scores {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  font-size: 0.7rem;
  opacity: 0.85;
}

.ranking-reason {
  margin: 2px 0 0;
  font-size: 0.78rem;
  opacity: 0.9;
}

/* NICHE FIT */
.compare-nichefit,
.compare-improvements,
.compare-steal,
.compare-avoid,
.compare-patterns,
.compare-notes {
  margin-top: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: rgba(15, 23, 42, 0.9);
}

.compare-nichefit h4,
.compare-improvements h4,
.compare-steal h4,
.compare-avoid h4,
.compare-patterns h4,
.compare-notes h4 {
  margin: 0 0 4px;
  font-size: 0.9rem;
}

.compare-nichefit ul,
.compare-steal ul,
.compare-avoid ul,
.compare-patterns ul,
.compare-notes p {
  margin: 0;
  padding-left: 18px;
  font-size: 0.8rem;
  opacity: 0.9;
}

.improvement-block {
  margin-top: 6px;
}

.improvement-block h5 {
  margin: 0 0 2px;
  font-size: 0.85rem;
}

.improvement-block ul {
  margin: 0;
  padding-left: 18px;
  font-size: 0.8rem;
  opacity: 0.9;
}

/* RESPONSIVE */
@media (max-width: 1100px) {
  .compare-grid {
    grid-template-columns: 1fr;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\CompareVideos.jsx
// ==================================================

import React, { useState, useMemo } from "react";
import "./CompareVideos.css";

const isValidYouTubeUrl = (url) => {
  if (!url) return false;
  return url.includes("youtube.com/watch?v=") || url.includes("youtu.be/");
};

const CompareVideos = ({
  callApi,
  loading,
  setError,
  setOutput,
  output,
  audience,
  setAudience
}) => {
  const [videos, setVideos] = useState([
    {
      label: "Mio Video",
      url: "https://www.youtube.com/watch?v=LO7gcz58tOE"
    },
    {
      label: "Competitor 1",
      url: "https://www.youtube.com/watch?v=kDsRmrrk9Bk"
    },
    {
      label: "Competitor 2",
      url: "https://www.youtube.com/watch?v=mRLOJaC3jaM"
    }
  ]);

  // ==========================
  // GESTIONE FORM
  // ==========================
  const handleChangeLabel = (index, value) => {
    setVideos((prev) => {
      const clone = [...prev];
      clone[index] = { ...clone[index], label: value };
      return clone;
    });
  };

  const handleChangeUrl = (index, value) => {
    setVideos((prev) => {
      const clone = [...prev];
      clone[index] = { ...clone[index], url: value };
      return clone;
    });
  };

  const payload = useMemo(
    () => ({
      audience,
      videos: videos
        .filter((v) => v.url.trim())
        .map((v) => ({
          label: v.label || "Video",
          videoIdOrUrl: v.url.trim()
        }))
    }),
    [videos, audience]
  );

  const handleCompare = () => {
    setOutput(null);
    setError("");

    const nonEmpty = videos.filter((v) => v.url.trim());
    if (nonEmpty.length < 2) {
      setError(" Inserisci almeno 2 URL validi per fare il confronto.");
      return;
    }

    for (const v of nonEmpty) {
      if (!isValidYouTubeUrl(v.url)) {
        setError(` URL non valido: ${v.url}`);
        return;
      }
    }

    callApi("/compare-videos", payload);
  };

  const openInfo = () => {
    alert(
      "Compare Videos PRO confronta struttura, hook, retention, chiarezza, valore ed emozione dei video.\n" +
        "Usa questi insight per capire cosa copiare, cosa evitare e come superare i competitor."
    );
  };

  // ==========================
  // PARSING RISPOSTA BACKEND
  // ==========================
  const parsed = useMemo(() => {
    if (!output || typeof output !== "object") {
      return {
        ranking: [],
        nicheFit: {},
        improvementsByVideo: {},
        whatToSteal: [],
        whatToAvoid: [],
        patternShared: [],
        notes: ""
      };
    }

    const root = output.data || output.result || output;

    return {
      ranking: Array.isArray(root.ranking) ? root.ranking : [],
      nicheFit: root.nicheFit || {},
      improvementsByVideo: root.improvementsByVideo || {},
      whatToSteal: Array.isArray(root.whatToSteal)
        ? root.whatToSteal
        : [],
      whatToAvoid: Array.isArray(root.whatToAvoid)
        ? root.whatToAvoid
        : [],
      patternShared: Array.isArray(root.patternShared)
        ? root.patternShared
        : [],
      notes: root.notes || ""
    };
  }, [output]);

  const { ranking, nicheFit, improvementsByVideo, whatToSteal, whatToAvoid, patternShared, notes } =
    parsed;

  return (
    <section className="panel compare-panel">
      <div className="compare-header">
        <div>
          <h2> Compare Videos PRO  Ultra</h2>
          <p className="panel-subtitle">
            Confronta il tuo video con 2 competitor su hook, retention, struttura, chiarezza,
            valore ed emozione, specifici per Over 50/60/70.
          </p>
        </div>

        <div className="compare-header-right">
          <div className="audience-switch">
            <span className="audience-label">Audience:</span>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over50" ? " audience-active" : "")
              }
              onClick={() => setAudience("over50")}
            >
              Over 50
            </button>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over60" ? " audience-active" : "")
              }
              onClick={() => setAudience("over60")}
            >
              Over 60
            </button>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over70" ? " audience-active" : "")
              }
              onClick={() => setAudience("over70")}
            >
              Over 70
            </button>
          </div>

          <button
            type="button"
            className="ghost-btn compare-info-btn"
            onClick={openInfo}
          >
             Come funziona
          </button>
        </div>
      </div>

      <div className="compare-grid">
        {/* SINISTRA: FORM + PAYLOAD */}
        <div className="compare-left">
          {videos.map((video, index) => (
            <div className="compare-block" key={index}>
              <div className="compare-block-header">
                <span className="compare-chip">
                  {index === 0 ? "Tuo Video" : `Competitor ${index}`}
                </span>
              </div>

              <label className="input-label">Label</label>
              <input
                type="text"
                className="input"
                value={video.label}
                onChange={(e) => handleChangeLabel(index, e.target.value)}
                placeholder={
                  index === 0 ? "Es. Mio video: dormire tutta la notte" : ""
                }
              />

              <label className="input-label">URL YouTube</label>
              <input
                type="text"
                className="input"
                value={video.url}
                onChange={(e) => handleChangeUrl(index, e.target.value)}
                placeholder="https://www.youtube.com/watch?v=XXXXXXX"
              />
            </div>
          ))}

          <button
            type="button"
            className="primary-btn compare-run-btn"
            disabled={loading}
            onClick={handleCompare}
          >
            {loading ? " Confronto in corso" : " Avvia Confronto PRO"}
          </button>

          <div className="compare-payload-section">
            <h4>Payload inviato al backend</h4>
            <p className="compare-right-sub">
              Questo  il JSON che Zen Coach invia alla route <code>/compare-videos</code>.
            </p>
            <pre className="compare-payload-box">
{JSON.stringify(payload, null, 2)}
            </pre>
          </div>
        </div>

        {/* DESTRA: RISULTATO INTELLIGENTE */}
        <div className="compare-right">
          <h3 className="compare-right-title">Risultato analisi AI</h3>

          {!output && (
            <p className="compare-placeholder">
              Esegui un confronto per vedere qui il ranking, i punteggi e gli insight principali.
              Il dettaglio completo  sempre visibile nel pannello <strong>Output</strong> a destra.
            </p>
          )}

          {/* RANKING */}
          {ranking && ranking.length > 0 && (
            <div className="compare-ranking">
              <h4> Ranking dei video</h4>
              <div className="ranking-grid">
                {ranking.map((item, idx) => (
                  <div className="ranking-card" key={idx}>
                    <div className="ranking-position">
                      #{item.position ?? idx + 1}
                    </div>
                    <div className="ranking-label">{item.label}</div>
                    {item.scores && (
                      <div className="ranking-scores">
                        <span>Hook: {item.scores.hook ?? ""}</span>
                        <span>Ret.: {item.scores.retention ?? ""}</span>
                        <span>Str.: {item.scores.structure ?? ""}</span>
                        <span>Valore: {item.scores.value ?? ""}</span>
                        <span>Emoz.: {item.scores.emotional ?? ""}</span>
                      </div>
                    )}
                    {item.reason && (
                      <p className="ranking-reason">{item.reason}</p>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* NICHE FIT */}
          {nicheFit && Object.keys(nicheFit).length > 0 && (
            <div className="compare-nichefit">
              <h4> Adattamento al pubblico Over 50/60/70</h4>
              <ul>
                {Object.entries(nicheFit).map(([label, desc]) => (
                  <li key={label}>
                    <strong>{label}:</strong> {desc}
                  </li>
                ))}
              </ul>
            </div>
          )}

          {/* IMPROVEMENTS */}
          {improvementsByVideo &&
            Object.keys(improvementsByVideo).length > 0 && (
              <div className="compare-improvements">
                <h4> Miglioramenti suggeriti per ogni video</h4>
                {Object.entries(improvementsByVideo).map(
                  ([label, list], idx) => (
                    <div className="improvement-block" key={idx}>
                      <h5>{label}</h5>
                      <ul>
                        {Array.isArray(list) &&
                          list.map((fix, i) => <li key={i}>{fix}</li>)}
                      </ul>
                    </div>
                  )
                )}
              </div>
            )}

          {/* WHAT TO STEAL */}
          {whatToSteal && whatToSteal.length > 0 && (
            <div className="compare-steal">
              <h4> Cosa COPIARE dai migliori</h4>
              <ul>
                {whatToSteal.map((item, idx) => (
                  <li key={idx}>{item}</li>
                ))}
              </ul>
            </div>
          )}

          {/* WHAT TO AVOID */}
          {whatToAvoid && whatToAvoid.length > 0 && (
            <div className="compare-avoid">
              <h4> Cosa evitare</h4>
              <ul>
                {whatToAvoid.map((item, idx) => (
                  <li key={idx}>{item}</li>
                ))}
              </ul>
            </div>
          )}

          {/* PATTERN SHARED */}
          {patternShared && patternShared.length > 0 && (
            <div className="compare-patterns">
              <h4> Pattern comuni tra i video vincenti</h4>
              <ul>
                {patternShared.map((item, idx) => (
                  <li key={idx}>{item}</li>
                ))}
              </ul>
            </div>
          )}

          {/* NOTE FINALI */}
          {notes && (
            <div className="compare-notes">
              <h4> Note generali</h4>
              <p>{notes}</p>
            </div>
          )}
        </div>
      </div>
    </section>
  );
};

export default CompareVideos;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\DashboardPage.jsx
// ==================================================

import { useState } from "react";
import { apiGet } from "../config/apiClient";

export default function DashboardPage() {
  const [health, setHealth] = useState(null);

  async function testBackend() {
    //  ENDPOINT CORRETTO
    const result = await apiGet("/admin/health");
    setHealth(result);
  }

  return (
    <div>
      <h1>Dashboard</h1>
      <p>Benvenuto in Zen YouTube Coach Pro  versione Enterprise 2025.</p>

      <button
        onClick={testBackend}
        style={{
          padding: "12px 20px",
          marginTop: "20px",
          background: "#00dfa2",
          border: "none",
          borderRadius: "6px",
          fontWeight: "bold",
          cursor: "pointer",
        }}
      >
         Test connessione backend
      </button>

      {health && (
        <pre
          style={{
            marginTop: "20px",
            padding: "20px",
            background: "#f4f4f4",
            borderRadius: "8px",
            fontSize: "14px",
            color: "#333",
          }}
        >
          {JSON.stringify(health, null, 2)}
        </pre>
      )}
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\DropoffPage.jsx
// ==================================================

export default function DropoffPage() {
  return (
    <div>
      <h1>Drop-off Analyzer</h1>
      <p>Analisi retention, hook e punti di abbandono del pubblico.</p>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\Home.css
// ==================================================

.home {
  padding: 24px 28px;
  height: 100%;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  gap: 24px;
}

/* HEADER */

.home-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
}

.home-header-left {
  max-width: 70%;
}

.home-title {
  font-size: 1.7rem;
  font-weight: 700;
  letter-spacing: 0.02em;
  margin: 0 0 4px;
}

.home-subtitle {
  margin: 0;
  font-size: 0.95rem;
  opacity: 0.8;
}

.home-header-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

.home-badge {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: #020617;
}

.home-env-pill {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: rgba(15, 23, 42, 0.7);
  backdrop-filter: blur(10px);
}

/* GRID PRINCIPALE */

.home-grid {
  display: grid;
  grid-template-columns: minmax(0, 2.2fr) minmax(260px, 1fr);
  gap: 20px;
  flex: 1;
  min-height: 0;
}

.home-main {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.home-side {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* PANNELLI */

.home-panel {
  background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent),
    radial-gradient(circle at bottom right, rgba(34, 197, 94, 0.08), transparent),
    rgba(15, 23, 42, 0.9);
  border-radius: 18px;
  padding: 16px 18px;
  border: 1px solid rgba(148, 163, 184, 0.45);
  box-shadow: 0 18px 45px rgba(15, 23, 42, 0.85);
  position: relative;
  overflow: hidden;
}

.home-panel--primary {
  border: 1px solid rgba(96, 165, 250, 0.8);
  box-shadow: 0 20px 60px rgba(37, 99, 235, 0.35);
}

.home-panel-header {
  margin-bottom: 14px;
}

.home-panel-header h2,
.home-panel-header h3 {
  margin: 0 0 4px;
  font-size: 1.05rem;
}

.home-panel-header p {
  margin: 0;
  font-size: 0.88rem;
  opacity: 0.85;
}

.home-panel-header--row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.home-pill {
  font-size: 0.7rem;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.7);
  opacity: 0.9;
}

/* QUICK ACTIONS */

.home-quick-actions-row {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
  margin-top: 10px;
}

.home-quick-action {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  border-radius: 14px;
  padding: 10px 11px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.7);
  cursor: pointer;
  text-align: left;
  transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
    border-color 0.12s ease-out, background 0.12s ease-out;
}

.home-quick-action:hover {
  transform: translateY(-1px);
  box-shadow: 0 16px 35px rgba(15, 23, 42, 0.85);
  border-color: rgba(59, 130, 246, 0.85);
  background: radial-gradient(circle at top, rgba(59, 130, 246, 0.18), rgba(15, 23, 42, 0.98));
}

.home-quick-action-icon {
  font-size: 1.3rem;
  margin-top: 2px;
}

.home-quick-action-text {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.home-quick-action-label {
  font-size: 0.9rem;
  font-weight: 600;
}

.home-quick-action-description {
  font-size: 0.78rem;
  opacity: 0.85;
}

.home-hint {
  margin: 12px 2px 0;
  font-size: 0.8rem;
  opacity: 0.85;
}

/* STATISTICHE */

.home-stats-row {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
}

.home-stat-card {
  border-radius: 14px;
  padding: 10px 11px;
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(148, 163, 184, 0.7);
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.home-stat-value {
  font-size: 1.1rem;
  font-weight: 700;
}

.home-stat-label {
  font-size: 0.78rem;
  opacity: 0.85;
}

.home-stat-subtitle {
  font-size: 0.74rem;
  opacity: 0.72;
}

/* ATTIVIT RECENTI */

.home-activity-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.home-activity-item {
  padding: 8px 9px;
  border-radius: 12px;
  border: 1px solid rgba(51, 65, 85, 0.9);
  background: rgba(15, 23, 42, 0.94);
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.home-activity-main {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.home-activity-tag {
  font-size: 0.7rem;
  padding: 3px 7px;
  border-radius: 999px;
  background: rgba(37, 99, 235, 0.25);
  border: 1px solid rgba(59, 130, 246, 0.7);
}

.home-activity-tag--secondary {
  background: rgba(34, 197, 94, 0.25);
  border-color: rgba(34, 197, 94, 0.7);
}

.home-activity-tag--tertiary {
  background: rgba(244, 114, 182, 0.22);
  border-color: rgba(236, 72, 153, 0.7);
}

.home-activity-title {
  font-size: 0.82rem;
}

.home-activity-meta {
  font-size: 0.75rem;
  opacity: 0.8;
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

/* STATUS PANEL */

.home-status-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.home-status-item {
  display: flex;
  gap: 8px;
  align-items: flex-start;
}

.home-status-dot {
  width: 10px;
  height: 10px;
  border-radius: 999px;
  margin-top: 4px;
}

.home-status-dot--ok {
  background: #22c55e;
  box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.25);
}

.home-status-dot--warn {
  background: #f97316;
  box-shadow: 0 0 0 5px rgba(249, 115, 22, 0.25);
}

.home-status-text {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.home-status-label {
  font-size: 0.8rem;
  font-weight: 600;
}

.home-status-sub {
  font-size: 0.75rem;
  opacity: 0.85;
}

/* TODO LIST */

.home-todo-list {
  margin: 6px 0 0;
  padding-left: 18px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: 0.8rem;
}

.home-todo-list li {
  line-height: 1.3;
}

/* NOTE */

.home-note-text {
  margin: 6px 0 0;
  font-size: 0.8rem;
  opacity: 0.9;
}

/* LINK BUTTON */

.home-link-button {
  border: none;
  background: transparent;
  color: #60a5fa;
  font-size: 0.78rem;
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 999px;
  border: 1px solid transparent;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.home-link-button:hover {
  border-color: rgba(96, 165, 250, 0.8);
  background: rgba(15, 23, 42, 0.9);
}

/* RESPONSIVE */

@media (max-width: 1100px) {
  .home-grid {
    grid-template-columns: 1fr;
  }

  .home-header-left {
    max-width: 100%;
  }
}

@media (max-width: 900px) {
  .home-quick-actions-row {
    grid-template-columns: 1fr;
  }

  .home-stats-row {
    grid-template-columns: 1fr;
  }

  .home {
    padding: 16px;
  }
}

@media (max-width: 600px) {
  .home-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .home-header-right {
    align-self: stretch;
    justify-content: flex-start;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\Home.jsx
// ==================================================

import React from "react";
import "./Home.css";

function StatCard({ label, value, subtitle }) {
  return (
    <div className="home-stat-card">
      <div className="home-stat-value">{value}</div>
      <div className="home-stat-label">{label}</div>
      {subtitle && <div className="home-stat-subtitle">{subtitle}</div>}
    </div>
  );
}

function QuickAction({ icon, label, description, onClick }) {
  return (
    <button className="home-quick-action" type="button" onClick={onClick}>
      <div className="home-quick-action-icon">{icon}</div>
      <div className="home-quick-action-text">
        <div className="home-quick-action-label">{label}</div>
        <div className="home-quick-action-description">{description}</div>
      </div>
    </button>
  );
}

const Home = () => {
  const handlePlaceholder = () => {
    alert(
      "Questa  solo una preview della dashboard PRO.\nUsa la sidebar per accedere alle funzioni gi attive (Transcript, Analyze Transcript, Analyze Video, Settings, ecc.)."
    );
  };

  return (
    <div className="home">
      {/* HEADER */}
      <header className="home-header">
        <div className="home-header-left">
          <h1 className="home-title">Zen YouTube Coach Pro</h1>
          <p className="home-subtitle">
            La tua control room per analizzare, ottimizzare e far crescere il canale YouTube.
          </p>
        </div>
        <div className="home-header-right">
          <span className="home-badge">Dashboard PRO</span>
          <span className="home-env-pill">Local Dev</span>
        </div>
      </header>

      {/* GRID PRINCIPALE */}
      <section className="home-grid">
        {/* COLONNA PRINCIPALE */}
        <div className="home-main">
          {/* PANNELLO HERO */}
          <div className="home-panel home-panel--primary">
            <div className="home-panel-header">
              <h2>Da dove vuoi partire oggi?</h2>
              <p>
                Scegli lazione principale. Le analisi dettagliate le trovi sempre nelle sezioni della
                sidebar.
              </p>
            </div>

            <div className="home-quick-actions-row">
              <QuickAction
                icon=""
                label="Nuova analisi Transcript"
                description="Incolla la trascrizione di un video e genera lanalisi completa Over 50/60/70."
                onClick={handlePlaceholder}
              />
              <QuickAction
                icon=""
                label="Analyze Video (URL)"
                description="Inserisci un link YouTube e lascia che Zen Coach faccia il lavoro sporco."
                onClick={handlePlaceholder}
              />
              <QuickAction
                icon=""
                label="Compare Video"
                description="Confronta due video e scopri perch uno performa meglio dellaltro."
                onClick={handlePlaceholder}
              />
            </div>

            <p className="home-hint">
              Suggerimento: per i test reali usa le voci <strong>Transcript</strong> e{" "}
              <strong>Analyze Transcript</strong> nella sidebar.
            </p>
          </div>

          {/* STATISTICHE QUICK VIEW (MOCK) */}
          <div className="home-panel">
            <div className="home-panel-header home-panel-header--row">
              <h3>Panoramica veloce (mock)</h3>
              <span className="home-pill">Demo dati fittizi</span>
            </div>

            <div className="home-stats-row">
              <StatCard
                label="Analisi effettuate (7 giorni)"
                value="14"
                subtitle="Transcript + Video completi"
              />
              <StatCard
                label="Video Over 60 analizzati"
                value="9"
                subtitle="Focus pubblico target"
              />
              <StatCard
                label="Idea score medio"
                value="8.6 / 10"
                subtitle="Potenziale contenuti rilevati"
              />
            </div>
          </div>

          {/* ATTIVIT RECENTI (STATICHE) */}
          <div className="home-panel">
            <div className="home-panel-header home-panel-header--row">
              <h3>Ultime attivit (esempio)</h3>
              <button
                type="button"
                className="home-link-button"
                onClick={handlePlaceholder}
              >
                Vedi tutto
              </button>
            </div>

            <ul className="home-activity-list">
              <li className="home-activity-item">
                <div className="home-activity-main">
                  <span className="home-activity-tag">Analyze Transcript</span>
                  <span className="home-activity-title">
                    Urologa rivela: la bevanda notturna che ferma la minzione
                  </span>
                </div>
                <div className="home-activity-meta">
                  <span>Retention Hook: <strong>Molto forte</strong></span>
                  <span></span>
                  <span>Target: Over 60</span>
                  <span></span>
                  <span>5 min fa</span>
                </div>
              </li>

              <li className="home-activity-item">
                <div className="home-activity-main">
                  <span className="home-activity-tag home-activity-tag--secondary">
                    Analyze Video
                  </span>
                  <span className="home-activity-title">
                    Caff e rischio diabete: quello che non ti dicono
                  </span>
                </div>
                <div className="home-activity-meta">
                  <span>CTR stimato: <strong>Buono</strong></span>
                  <span></span>
                  <span>Thumbnail: da migliorare</span>
                  <span></span>
                  <span>1 ora fa</span>
                </div>
              </li>

              <li className="home-activity-item">
                <div className="home-activity-main">
                  <span className="home-activity-tag home-activity-tag--tertiary">
                    Trend Scan
                  </span>
                  <span className="home-activity-title">
                    Sonno Over 70 inserito nella watchlist tendenze
                  </span>
                </div>
                <div className="home-activity-meta">
                  <span>Priorit: <strong>Alta</strong></span>
                  <span></span>
                  <span>Nuove idee: 7</span>
                  <span></span>
                  <span>Oggi</span>
                </div>
              </li>
            </ul>
          </div>
        </div>

        {/* SIDEBAR DESTRA DELLA HOME */}
        <aside className="home-side">
          {/* STATO SISTEMA */}
          <div className="home-panel">
            <h3>Stato sistema</h3>
            <div className="home-status-list">
              <div className="home-status-item">
                <span className="home-status-dot home-status-dot--ok" />
                <div className="home-status-text">
                  <div className="home-status-label">Backend</div>
                  <div className="home-status-sub">Server in esecuzione su http://localhost:4000</div>
                </div>
              </div>
              <div className="home-status-item">
                <span className="home-status-dot home-status-dot--ok" />
                <div className="home-status-text">
                  <div className="home-status-label">Connessione AI</div>
                  <div className="home-status-sub">
                    OPENAI / GROQ configurati tramite file <code>.env</code>
                  </div>
                </div>
              </div>
              <div className="home-status-item">
                <span className="home-status-dot home-status-dot--warn" />
                <div className="home-status-text">
                  <div className="home-status-label">Feature Premium</div>
                  <div className="home-status-sub">
                    /compare-videos, /trend-deepsearch: in sviluppo (roadmap).
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* PROSSIMI STEP CONSIGLIATI */}
          <div className="home-panel">
            <h3>Prossimi step consigliati</h3>
            <ol className="home-todo-list">
              <li>
                Testa lendpoint <strong>/transcript</strong> con 23 video reali del tuo canale.
              </li>
              <li>
                Usa <strong>/analyze</strong> per estrarre gli insight Over 50/60/70 e confrontali con le
                tue idee.
              </li>
              <li>
                Individua 1 solo video outlier di un competitor e analizzalo per intero.
              </li>
              <li>
                Salva gli output migliori in Notion / Google Sheet come base dati per Zen Coach.
              </li>
            </ol>
          </div>

          {/* BLOCCO NOTE RAPIDE */}
          <div className="home-panel">
            <h3>Nota rapida</h3>
            <p className="home-note-text">
              Ricorda: lobiettivo non  solo capire i video, ma trovare pattern ripetibili che puoi
              trasformare in sistema dentro Zen YouTube Coach Pro.
            </p>
          </div>
        </aside>
      </section>
    </div>
  );
};

export default Home;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\OutlierEngine.css
// ==================================================

.outlier-panel {
  background: #ffffff;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
  margin: 20px auto;
  max-width: 850px;
  border: 1px solid #e6e6e6;
}

.outlier-header h2 {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 4px;
  color: #ff4d4d;
}

.outlier-header .panel-subtitle {
  font-size: 15px;
  color: #666;
  margin-bottom: 20px;
}

.outlier-body {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.input-block {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.input-block label {
  font-weight: 600;
  font-size: 15px;
  color: #333;
}

.input-block input,
.input-block select {
  padding: 12px 14px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #ccc;
  outline: none;
  transition: 0.2s all;
}

.input-block input:focus,
.input-block select:focus {
  border-color: #ff4d4d;
  box-shadow: 0 0 0 2px rgba(255, 77, 77, 0.25);
}

.outlier-btn {
  padding: 14px;
  background: linear-gradient(135deg, #ff4d4d, #ff1a1a);
  color: white;
  font-size: 16px;
  font-weight: 700;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.2s;
}

.outlier-btn:hover {
  background: linear-gradient(135deg, #ff1a1a, #e60000);
  transform: translateY(-2px);
}

.outlier-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
}

/* MODALE OVERLAY */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.45);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.25s ease-out forwards;
  z-index: 999;
}

/* MODALE CONTAINER */
.modal-container {
  width: 90%;
  max-width: 720px;
  max-height: 85vh;
  background: #ffffff;
  border-radius: 18px;
  padding: 24px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
  position: relative;
  overflow-y: auto;
  animation: slideUp 0.25s ease-out forwards;
}

/* BOTTONE CHIUSURA */
.modal-close {
  position: absolute;
  top: 14px;
  right: 14px;
  background: #ff4d4d;
  color: #fff;
  border: none;
  padding: 8px 10px;
  font-size: 14px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

.modal-close:hover {
  background: #e60000;
}

/* ANIMAZIONI */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { transform: translateY(30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\OutlierEngine.jsx
// ==================================================

import React, { useState } from "react";
import "./OutlierEngine.css";

export default function OutlierEngine({ callApi, loading, setError, setOutput }) {
  const [videoUrl, setVideoUrl] = useState("");
  const [audience, setAudience] = useState("over60");

  const isValidYouTubeUrl = (url) =>
    url.includes("youtube.com/watch?v=") || url.includes("youtu.be/") || url.includes("/shorts/");

  const runOutlier = () => {
    if (!isValidYouTubeUrl(videoUrl)) {
      setError(" Inserisci un URL YouTube valido.");
      return;
    }

    setError("");
    setOutput(null);

    callApi("/outlier-engine", {
      url: videoUrl,
      audience,
    });
  };

  return (
    <section className="panel outlier-panel">
      <div className="outlier-header">
        <h2> Outlier Engine</h2>
        <p className="panel-subtitle">Analisi predittiva UltraPremium del potenziale virale dei tuoi video.</p>
      </div>

      <div className="outlier-body">
        <div className="input-block">
          <label>URL del video YouTube</label>
          <input
            type="text"
            placeholder="https://www.youtube.com/watch?v=..."
            value={videoUrl}
            onChange={(e) => setVideoUrl(e.target.value)}
          />
        </div>

        <div className="input-block">
          <label>Target Audience</label>
          <select value={audience} onChange={(e) => setAudience(e.target.value)}>
            <option value="over50">Over 50</option>
            <option value="over60">Over 60</option>
            <option value="over70">Over 70</option>
          </select>
        </div>

        <button className="outlier-btn" onClick={runOutlier} disabled={loading}>
          {loading ? "Analisi in corso..." : "Analizza Potenziale Virale"}
        </button>
      </div>
    </section>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\OutlierResults.css
// ==================================================

.results-panel {
  padding: 24px;
  border-radius: 16px;
  background: #ffffff;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  max-height: 80vh;
  overflow-y: auto;
}

.results-title {
  font-size: 24px;
  font-weight: 700;
  color: #ff1a1a;
  margin-bottom: 20px;
  text-align: center;
}

/* SCORE GRID */
.score-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
  margin-bottom: 28px;
}

.score-card {
  background: #fff4f4;
  padding: 16px;
  border-radius: 12px;
  text-align: center;
  border: 1px solid #ffd6d6;
}

.score-label {
  font-size: 14px;
  color: #555;
  margin-bottom: 6px;
  text-transform: capitalize;
}

.score-value {
  font-size: 22px;
  font-weight: 800;
  color: #ff1a1a;
}

/* ANALYSIS SECTIONS */
.analysis-section {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #eee;
}

.analysis-section h3 {
  font-size: 18px;
  color: #333;
  margin-bottom: 8px;
}

.analysis-section p {
  color: #555;
  line-height: 1.5;
}

/* LIST BLOCKS */
.list-block {
  margin-bottom: 26px;
}

.list-block h3 {
  margin-bottom: 6px;
  font-size: 18px;
  color: #333;
}

.list-block ul {
  padding-left: 20px;
}

.list-block li {
  color: #444;
  margin-bottom: 4px;
}

/* PREDICTIONS */
.prediction-block {
  background: #f8f8f8;
  padding: 16px;
  border-radius: 12px;
  border: 1px solid #ddd;
}

.prediction-block h3 {
  font-size: 18px;
  margin-bottom: 8px;
  color: #111;
}

.prediction-block p {
  color: #333;
  margin-bottom: 4px;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\OutlierResults.jsx
// ==================================================

import React, { useState } from "react";
import "./OutlierEngine.css";
import OutlierResults from "./OutlierResults.jsx";

export default function OutlierEngine({ callApi, loading, setError, setOutput }) {
  const [videoUrl, setVideoUrl] = useState("");
  const [audience, setAudience] = useState("over60");
  const [showModal, setShowModal] = useState(false);

  const isValidYouTubeUrl = (url) =>
    url.includes("youtube.com/watch?v=") || url.includes("youtu.be/") || url.includes("/shorts/");

  const runOutlier = async () => {
    if (!isValidYouTubeUrl(videoUrl)) {
      setError(" Inserisci un URL YouTube valido.");
      return;
    }

    setError("");
    setOutput(null);

    const result = await callApi("/outlier-engine", {
      url: videoUrl,
      audience,
    });

    if (result) {
      setShowModal(true);
    }
  };

  const closeModal = () => {
    setShowModal(false);
  };

  return (
    <section className="panel outlier-panel">
      <div className="outlier-header">
        <h2> Outlier Engine</h2>
        <p className="panel-subtitle">Analisi predittiva UltraPremium del potenziale virale dei tuoi video.</p>
      </div>

      <div className="outlier-body">
        <div className="input-block">
          <label>URL del video YouTube</label>
          <input
            type="text"
            placeholder="https://www.youtube.com/watch?v=..."
            value={videoUrl}
            onChange={(e) => setVideoUrl(e.target.value)}
          />
        </div>

        <div className="input-block">
          <label>Target Audience</label>
          <select value={audience} onChange={(e) => setAudience(e.target.value)}>
            <option value="over50">Over 50</option>
            <option value="over60">Over 60</option>
            <option value="over70">Over 70</option>
          </select>
        </div>

        <button className="outlier-btn" onClick={runOutlier} disabled={loading}>
          {loading ? "Analisi in corso..." : "Analizza Potenziale Virale"}
        </button>
      </div>

      {/* MODALE PREMIUM */}
      {showModal && (
        <div className="modal-overlay" onClick={closeModal}>
          <div className="modal-container" onClick={(e) => e.stopPropagation()}>
            <button className="modal-close" onClick={closeModal}></button>
            <OutlierResults />
          </div>
        </div>
      )}
    </section>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\SEOPage.jsx
// ==================================================

export default function SEOPage() {
  return (
    <div>
      <h1>SEO Insights</h1>
      <p>Ottimizzazione titolo, descrizione, keyword e CTR.</p>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\ScriptGenerator.jsx
// ==================================================

import { useState } from "react";
import { apiPost } from "../config/apiClient";

export default function ScriptGenerator() {
  const [topic, setTopic] = useState("");
  const [loading, setLoading] = useState(false);
  const [script, setScript] = useState(null);
  const [error, setError] = useState(null);

  async function generate() {
    setLoading(true);
    setError(null);
    setScript(null);

    try {
      const data = await apiPost("/generateScriptPro", {
        topic,
      });

      if (data.error) {
        setError(data.error);
      } else {
        setScript(data.script);
      }
    } catch (err) {
      setError("Errore durante il collegamento al backend.");
    }

    setLoading(false);
  }

  return (
    <div style={{ padding: "30px" }}>
      <h1 className="page-title">Script Generator Pro</h1>
      <p className="page-subtitle">
        Inserisci un argomento e genera uno script completo, ottimizzato per il tuo canale Zen Salute e Benessere.
      </p>

      <input
        type="text"
        placeholder="Es. I benefici dell'acqua calda la sera"
        value={topic}
        onChange={(e) => setTopic(e.target.value)}
        style={{
          width: "100%",
          padding: "12px",
          marginTop: "15px",
          borderRadius: "10px",
          border: "1px solid #ccc",
          fontSize: "16px",
        }}
      />

      <button
        onClick={generate}
        disabled={loading || !topic}
        style={{
          marginTop: "15px",
          padding: "12px 18px",
          background: "#00DFA2",
          border: "none",
          borderRadius: "8px",
          cursor: "pointer",
          fontSize: "16px",
          fontWeight: 600,
        }}
      >
        {loading ? "Generazione in corso..." : "Genera Script"}
      </button>

      {error && (
        <div style={{ marginTop: "20px", color: "red", fontWeight: "600" }}>
           {error}
        </div>
      )}

      {script && (
        <div
          style={{
            marginTop: "30px",
            padding: "20px",
            background: "#f4f4f4",
            borderRadius: "10px",
            whiteSpace: "pre-wrap",
            lineHeight: "1.6",
          }}
        >
          <h2>Script Generato</h2>
          <p>{script}</p>
        </div>
      )}
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\ScriptPage.jsx
// ==================================================

export default function ScriptPage() {
  return (
    <div>
      <h1>Script Generator</h1>
      <p>Genera script ad alta retention per il pubblico Over 50/60/70.</p>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\SeoInsights.jsx
// ==================================================

export default function SeoInsights() {
  return (
    <div style={{ padding: "20px" }}>
      <h1 className="page-title">SEO Insights</h1>
      <p className="page-subtitle">Ottimizza titoli, descrizioni, tag e CTR.</p>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\Settings.css
// ==================================================

/* =============================
   Settings  Zen YouTube Coach Pro
   Super Clean SaaS Dark UI
============================= */

.settings-container {
  padding: 22px 26px;
  display: flex;
  flex-direction: column;
  gap: 38px;
  color: var(--text-main);
}

/* Title */
.settings-title {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
}

.settings-subtitle {
  margin-top: 4px;
  font-size: 13px;
  color: var(--text-muted);
}

/* Sections */
.settings-section {
  background: rgba(2, 6, 23, 0.8);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.35);
}

.settings-head {
  margin-top: 0;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 14px;
}

/* Image preview */
.image-preview-box {
  width: 100%;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--border);
  margin-bottom: 12px;
}

.image-preview {
  width: 100%;
  height: 180px;
  object-fit: cover;
  background: #111;
  display: block;
}

/* File upload */
.file-upload-btn {
  display: inline-block;
  background: var(--accent);
  padding: 8px 16px;
  color: #fff;
  font-size: 13px;
  font-weight: 600;
  border-radius: 999px;
  cursor: pointer;
  user-select: none;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 18px rgba(239, 68, 68, 0.45);
  transition: 0.15s all ease;
}

.file-upload-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 22px rgba(239, 68, 68, 0.6);
}

.file-upload-btn input {
  opacity: 0;
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  cursor: pointer;
}

/* Widget grid */
.widget-settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 18px;
}

.widget-settings-card {
  background: rgba(2, 6, 23, 0.55);
  padding: 14px;
  border-radius: 12px;
  border: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.widget-settings-img {
  width: 100%;
  height: 140px;
  border-radius: 10px;
  object-fit: cover;
  border: 1px solid var(--border);
  background: #111;
}

/* Slider */
.slider-label {
  margin: 0 0 6px;
  font-size: 13px;
}

.range-slider {
  width: 100%;
  appearance: none;
  height: 6px;
  background: #1f2937;
  border-radius: 4px;
  outline: none;
  cursor: pointer;
}

.range-slider::-webkit-slider-thumb {
  appearance: none;
  width: 14px;
  height: 14px;
  background: var(--accent);
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(239, 68, 68, 0.7);
}

.range-slider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  background: var(--accent);
  border-radius: 50%;
  cursor: pointer;
}

/* Reset button */
.settings-footer {
  margin-top: 10px;
}

.reset-btn {
  background: transparent;
  border: 1px solid #f87171;
  color: #fca5a5;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.15s all ease;
}

.reset-btn:hover {
  background: rgba(248, 113, 113, 0.15);
  border-color: #ef4444;
  color: #fff;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\Settings.jsx
// ==================================================

import { useState, useEffect } from "react";
import "./Settings.css";

export default function Settings({ settings, setSettings }) {
  // Carica da localStorage
  useEffect(() => {
    const saved = localStorage.getItem("zenSettings");
    if (saved) {
      setSettings(JSON.parse(saved));
    }
  }, []);

  // Salvataggio automatico
  useEffect(() => {
    localStorage.setItem("zenSettings", JSON.stringify(settings));
  }, [settings]);

  // Gestione upload immagine (usa base64)
  const handleImageUpload = (event, key) => {
    const file = event.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      setSettings((prev) => ({
        ...prev,
        [key]: e.target.result
      }));
    };

    reader.readAsDataURL(file);
  };

  const resetSettings = () => {
    setSettings({
      heroImage: "",
      widget1Image: "",
      widget2Image: "",
      widget3Image: "",
      columnWidth: 50
    });
    localStorage.removeItem("zenSettings");
  };

  return (
    <div className="settings-container">

      <h1 className="settings-title"> Settings</h1>
      <p className="settings-subtitle">
        Personalizza laspetto della tua Dashboard.
      </p>

      {/* ====================
          HERO IMAGE
      ==================== */}
      <div className="settings-section">
        <h2 className="settings-head"> Hero Image</h2>

        <div className="image-preview-box">
          <img
            src={
              settings.heroImage ||
              "https://placehold.co/1200x250/1e1e1e/FFF?text=Hero+Image"
            }
            alt=""
            className="image-preview"
          />
        </div>

        <label className="file-upload-btn">
          Carica immagine
          <input
            type="file"
            accept="image/*"
            onChange={(e) => handleImageUpload(e, "heroImage")}
          />
        </label>
      </div>

      {/* ====================
          WIDGET IMAGES
      ==================== */}
      <div className="settings-section">
        <h2 className="settings-head"> Widget Images</h2>

        <div className="widget-settings-grid">

          {/* WIDGET 1 */}
          <div className="widget-settings-card">
            <img
              src={
                settings.widget1Image ||
                "https://placehold.co/350x180/1e1e1e/FFF?text=Widget+1"
              }
              alt="Widget 1"
              className="widget-settings-img"
            />

            <label className="file-upload-btn">
              Carica Widget 1
              <input
                type="file"
                accept="image/*"
                onChange={(e) => handleImageUpload(e, "widget1Image")}
              />
            </label>
          </div>

          {/* WIDGET 2 */}
          <div className="widget-settings-card">
            <img
              src={
                settings.widget2Image ||
                "https://placehold.co/350x180/1e1e1e/FFF?text=Widget+2"
              }
              alt="Widget 2"
              className="widget-settings-img"
            />

            <label className="file-upload-btn">
              Carica Widget 2
              <input
                type="file"
                accept="image/*"
                onChange={(e) => handleImageUpload(e, "widget2Image")}
              />
            </label>
          </div>

          {/* WIDGET 3 */}
          <div className="widget-settings-card">
            <img
              src={
                settings.widget3Image ||
                "https://placehold.co/350x180/1e1e1e/FFF?text=Widget+3"
              }
              alt="Widget 3"
              className="widget-settings-img"
            />

            <label className="file-upload-btn">
              Carica Widget 3
              <input
                type="file"
                accept="image/*"
                onChange={(e) => handleImageUpload(e, "widget3Image")}
              />
            </label>
          </div>
        </div>
      </div>

      {/* ====================
          COLUMN WIDTH
      ==================== */}
      <div className="settings-section">
        <h2 className="settings-head"> Layout</h2>

        <p className="slider-label">
          Larghezza colonne widget: <b>{settings.columnWidth}%</b>
        </p>

        <input
          type="range"
          min="30"
          max="100"
          value={settings.columnWidth}
          onChange={(e) =>
            setSettings((prev) => ({
              ...prev,
              columnWidth: Number(e.target.value)
            }))
          }
          className="range-slider"
        />
      </div>

      {/* ====================
          RESET BUTTON
      ==================== */}
      <div className="settings-footer">
        <button className="reset-btn" onClick={resetSettings}>
           Reset impostazioni
        </button>
      </div>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\Transcript.css
// ==================================================

.transcript-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.transcript-block {
  padding: 12px;
  border-radius: 12px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.4);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.transcript-title {
  font-size: 1rem;
  margin-bottom: 4px;
  font-weight: 600;
}

.input-label {
  font-size: 0.8rem;
  opacity: 0.85;
  margin-bottom: 2px;
}

.transcript-input {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: rgba(15, 23, 42, 0.95);
  color: #fff;
}

.transcript-textarea {
  min-height: 180px;
  padding: 10px;
  border-radius: 8px;
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(148, 163, 184, 0.5);
  color: #fff;
  resize: vertical;
}

.transcript-btn {
  margin-top: 4px;
  padding: 10px;
  width: 100%;
}

.upload-info {
  font-size: 0.8rem;
  opacity: 0.75;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\Transcript.jsx
// ==================================================


import React, { useState } from "react";
import "./Transcript.css";

const Transcript = ({ callApi, setOutput, setError, loading }) => {
  const [mode, setMode] = useState("youtube"); // youtube | manual | file

  const [youtubeUrl, setYoutubeUrl] = useState("");
  const [manualTranscript, setManualTranscript] = useState("");
  const [uploadedFileName, setUploadedFileName] = useState("");
  const [localTranscript, setLocalTranscript] = useState("");

  // ==========================
  // VALIDATORE URL YOUTUBE
  // ==========================
  const isValidYouTubeUrl = (url) => {
    return (
      url.includes("youtube.com/watch?v=") ||
      url.includes("youtu.be/")
    );
  };

  // ==========================
  // PULIZIA TIMESTAMP
  // ==========================
  const cleanTranscript = (text) => {
    if (!text) return "";
    return text
      .replace(/\d{1,2}:\d{2}/g, "") // 00:00
      .replace(/\d{1,2}:\d{2}:\d{2}/g, "") // 00:00:00
      .replace(/[ ]{2,}/g, " ")
      .trim();
  };

  // ==========================
  // GESTIONE FILE .TXT
  // ==========================
  const handleFileUpload = (e) => {
    const file = e.target.files?.[0];
    if (!file) return;

    if (!file.name.toLowerCase().endsWith(".txt")) {
      setError(" Supportiamo solo file .txt per il transcript.");
      return;
    }

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target.result;
      const cleaned = cleanTranscript(String(text));

      setLocalTranscript(cleaned);
      setManualTranscript(cleaned);
      setUploadedFileName(file.name);
      setError("");
    };

    reader.readAsText(file);
  };

  // ==========================
  // INVIA AI BACKEND
  // ==========================
  const sendTranscriptRequest = () => {
    setOutput(null);
    setError("");

    if (mode === "youtube") {
      if (!isValidYouTubeUrl(youtubeUrl)) {
        setError(" Inserisci un URL YouTube valido.");
        return;
      }

      callApi("/transcript", { url: youtubeUrl });
      return;
    }

    if (mode === "manual") {
      if (!manualTranscript.trim()) {
        setError(" Inserisci un testo valido.");
        return;
      }

      callApi("/transcript", { transcript: manualTranscript });
      return;
    }

    if (mode === "file") {
      if (!localTranscript.trim()) {
        setError(" Nessun file caricato o file vuoto.");
        return;
      }
      callApi("/transcript", { transcript: localTranscript });
      return;
    }
  };

  return (
    <section className="panel transcript-panel">
      <h2> Transcript Engine PRO</h2>
      <p className="panel-subtitle">
        Recupera, pulisci e prepara la trascrizione pronta per lanalisi.
      </p>

      {/* MODALIT */}
      <div className="transcript-mode-row">
        <button
          className={"mode-btn " + (mode === "youtube" ? "mode-active" : "")}
          onClick={() => setMode("youtube")}
        >
           YouTube URL
        </button>

        <button
          className={"mode-btn " + (mode === "file" ? "mode-active" : "")}
          onClick={() => setMode("file")}
        >
           File .txt
        </button>

        <button
          className={"mode-btn " + (mode === "manual" ? "mode-active" : "")}
          onClick={() => setMode("manual")}
        >
           Manuale
        </button>
      </div>

      {/* ============================ */}
      {/* YOUTUBE MODE */}
      {/* ============================ */}
      {mode === "youtube" && (
        <div className="transcript-block">
          <label className="input-label">URL del video YouTube</label>
          <input
            type="text"
            className="input"
            placeholder="https://www.youtube.com/watch?v=XXXXXXX"
            value={youtubeUrl}
            onChange={(e) => setYoutubeUrl(e.target.value)}
          />
        </div>
      )}

      {/* ============================ */}
      {/* FILE MODE */}
      {/* ============================ */}
      {mode === "file" && (
        <div className="transcript-block">
          <label className="input-label">Carica file .txt</label>
          <input type="file" accept=".txt" onChange={handleFileUpload} />

          {uploadedFileName && (
            <div className="file-preview">
              <span> {uploadedFileName}</span>
            </div>
          )}
        </div>
      )}

      {/* ============================ */}
      {/* MANUAL MODE */}
      {/* ============================ */}
      {mode === "manual" && (
        <div className="transcript-block">
          <label className="input-label">Incolla transcript</label>
          <textarea
            className="textarea"
            rows="10"
            value={manualTranscript}
            onChange={(e) =>
              setManualTranscript(cleanTranscript(e.target.value))
            }
            placeholder="Incolla qui il testo del transcript..."
          />
        </div>
      )}

      {/* SEND BUTTON */}
      <button
        className="primary-btn run-btn"
        disabled={loading}
        onClick={sendTranscriptRequest}
      >
        {loading ? " Elaborazione" : " Estrai Transcript"}
      </button>
    </section>
  );
};

export default Transcript;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\TranscriptTool.jsx
// ==================================================

import React, { useState, useMemo } from "react";
import "./AnalyzeTranscript.css";

const AnalyzeTranscript = ({
  callApi,
  loading,
  setError,
  setOutput,
  output,
  audience,
  setAudience
}) => {
  const [rawTranscript, setRawTranscript] = useState("");

  // Pulizia transcript (senza rompere nulla)
  const cleanTranscript = (text) => {
    if (!text) return "";
    return text
      .replace(/\d{1,2}:\d{2}/g, "") // 00:00
      .replace(/\d{1,2}:\d{2}:\d{2}/g, "") // 00:00:00
      .replace(/[ ]{2,}/g, " ")
      .trim();
  };

  const handleClean = () => {
    setRawTranscript((prev) => cleanTranscript(prev));
  };

  const handleReset = () => {
    setRawTranscript("");
    setOutput(null);
    setError("");
  };

  const charCount = rawTranscript.length;

  const handleAnalyze = () => {
    if (!rawTranscript.trim()) {
      setError(" Inserisci o incolla un transcript da analizzare.");
      return;
    }

    setError("");
    setOutput(null);

    callApi("/analyze-transcript", {
      audience, // over50 / over60 / over70
      transcript: rawTranscript
    });
  };

  // Estraggo qualche dato di massima se il backend li espone
  const scores = useMemo(() => {
    if (!output || typeof output !== "object") return {};

    // Provo varie strutture possibili senza rompere se non ci sono
    const root = output.result || output.data || output;

    return {
      ideaScore:
        root.ideaScore ||
        root.idea_score ||
        root.ideaRating ||
        root.scores?.idea ||
        null,
      hookScore:
        root.hookScore ||
        root.hook_score ||
        root.scores?.hook ||
        null,
      retentionScore:
        root.retentionScore ||
        root.retention_score ||
        root.scores?.retention ||
        null,
      structureScore:
        root.structureScore ||
        root.structure_score ||
        root.scores?.structure ||
        null,
      summary:
        root.summary ||
        root.overview ||
        root.recapture ||
        null,
      quickFixes:
        root.quickFixes ||
        root.fixes ||
        root.quick_actions ||
        null
    };
  }, [output]);

  const openExportNotion = () => {
    alert(
      "Funzione 'Esporta in Notion' prevista nella roadmap.\nPer ora copia l'output JSON dal pannello a destra e incollalo nella tua pagina Notion."
    );
  };

  const openExportSheet = () => {
    alert(
      "Funzione 'Esporta in Google Sheet' prevista nella roadmap.\nIn futuro Zen Coach compiler in automatico la riga nel foglio."
    );
  };

  return (
    <section className="panel analyze-panel">
      <div className="analyze-header">
        <div>
          <h2> Analyze Transcript PRO</h2>
          <p className="panel-subtitle">
            Trasforma il transcript in insight strategici per Over 50 / 60 / 70.
          </p>
        </div>

        {/* Audience selector */}
        <div className="audience-switch">
          <span className="audience-label">Audience:</span>
          <button
            type="button"
            className={
              "audience-btn" + (audience === "over50" ? " audience-active" : "")
            }
            onClick={() => setAudience("over50")}
          >
            Over 50
          </button>
          <button
            type="button"
            className={
              "audience-btn" + (audience === "over60" ? " audience-active" : "")
            }
            onClick={() => setAudience("over60")}
          >
            Over 60
          </button>
          <button
            type="button"
            className={
              "audience-btn" + (audience === "over70" ? " audience-active" : "")
            }
            onClick={() => setAudience("over70")}
          >
            Over 70
          </button>
        </div>
      </div>

      <div className="analyze-grid">
        {/* COLONNA SINISTRA - INPUT */}
        <div className="analyze-left">
          <div className="analyze-block">
            <label className="input-label">
              Transcript da analizzare
              <span className="input-hint">
                Suggerimento: usa prima il <strong>Transcript Engine PRO</strong> per
                pulire il testo, poi incolla qui il risultato.
              </span>
            </label>
            <textarea
              className="textarea analyze-textarea"
              rows="14"
              value={rawTranscript}
              onChange={(e) => setRawTranscript(e.target.value)}
              placeholder="Incolla qui il transcript del video (gi pulito dai timestamp, se possibile)..."
            />
            <div className="analyze-meta-row">
              <span className="analyze-charcount">
                Caratteri: <strong>{charCount}</strong>
              </span>
              <div className="analyze-input-buttons">
                <button
                  type="button"
                  className="secondary-btn"
                  onClick={handleClean}
                >
                   Pulisci testo
                </button>
                <button
                  type="button"
                  className="ghost-btn"
                  onClick={handleReset}
                >
                   Reset
                </button>
              </div>
            </div>
          </div>

          <button
            type="button"
            className="primary-btn analyze-run-btn"
            disabled={loading}
            onClick={handleAnalyze}
          >
            {loading ? " Analisi in corso" : " Analizza Transcript con AI"}
          </button>

          <div className="analyze-export-row">
            <button
              type="button"
              className="outline-btn"
              onClick={openExportNotion}
            >
               Esporta in Notion
            </button>
            <button
              type="button"
              className="outline-btn"
              onClick={openExportSheet}
            >
               Esporta in Google Sheet
            </button>
          </div>
        </div>

        {/* COLONNA DESTRA - CARDS INSIGHT */}
        <div className="analyze-right">
          <h3 className="analyze-right-title">Insight veloci dal risultato</h3>
          {!output && (
            <p className="analyze-placeholder">
              Lancia unanalisi per vedere qui una sintesi dei punteggi
              (Hook, Retention, Struttura, Idea Score) basata sulla risposta del
              backend. Il dettaglio completo lo trovi sempre nel pannello
              <strong> Output</strong> a destra.
            </p>
          )}

          {/* SCORE CARDS */}
          <div className="score-grid">
            <div className="score-card">
              <div className="score-label">Idea Score</div>
              <div className="score-value">
                {scores.ideaScore != null ? scores.ideaScore : ""}
              </div>
              <div className="score-sub">Potenziale complessivo del video</div>
            </div>

            <div className="score-card">
              <div className="score-label">Hook</div>
              <div className="score-value">
                {scores.hookScore != null ? scores.hookScore : ""}
              </div>
              <div className="score-sub">
                Forza del gancio iniziale nei primi 30 secondi
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Retention</div>
              <div className="score-value">
                {scores.retentionScore != null ? scores.retentionScore : ""}
              </div>
              <div className="score-sub">
                Quanto il testo aiuta a trattenere lo spettatore
              </div>
            </div>

            <div className="score-card">
              <div className="score-label">Struttura</div>
              <div className="score-value">
                {scores.structureScore != null ? scores.structureScore : ""}
              </div>
              <div className="score-sub">
                Chiarezza della sequenza: hook  storia  soluzione  CTA
              </div>
            </div>
          </div>

          {/* SUMMARY / QUICK FIXES */}
          {scores.summary && (
            <div className="analyze-summary-block">
              <h4>Riassunto strategico</h4>
              <p className="analyze-summary-text">{scores.summary}</p>
            </div>
          )}

          {scores.quickFixes && Array.isArray(scores.quickFixes) && (
            <div className="analyze-fixes-block">
              <h4>Fix immediati consigliati</h4>
              <ul className="analyze-fixes-list">
                {scores.quickFixes.map((fix, idx) => (
                  <li key={idx}>{fix}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      </div>
    </section>
  );
};

export default AnalyzeTranscript;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\TrendScan.css
// ==================================================

.trend-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.trend-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
}

.trend-header-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
}

/* GRID */
.trend-grid {
  display: grid;
  grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.6fr);
  gap: 16px;
}

.trend-left,
.trend-right {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.trend-block {
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.5);
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* Language pills */
.trend-row {
  display: flex;
  gap: 8px;
}

.pill-btn {
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.7);
  background: rgba(15, 23, 42, 0.95);
  padding: 4px 10px;
  cursor: pointer;
  font-size: 0.85rem;
}

.pill-active {
  border-color: rgba(59, 130, 246, 1);
  background: rgba(37, 99, 235, 0.25);
}

/* Mode buttons */
.trend-mode-row {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.mode-btn {
  width: 100%;
  text-align: left;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.6);
  background: rgba(15, 23, 42, 0.95);
  padding: 8px 10px;
  cursor: pointer;
  font-size: 0.85rem;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.mode-btn span {
  font-size: 0.75rem;
  opacity: 0.85;
}

.mode-btn:hover {
  border-color: rgba(96, 165, 250, 0.9);
}

.mode-active {
  border-color: rgba(59, 130, 246, 1);
  background: rgba(37, 99, 235, 0.25);
}

/* Run btn */
.trend-run-btn {
  width: 100%;
  padding: 10px;
}

/* Payload */
.trend-payload-box {
  margin-top: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: rgba(15, 23, 42, 0.9);
}

.trend-payload-box h4 {
  margin: 0 0 4px;
  font-size: 0.9rem;
}

.trend-payload-pre {
  margin: 0;
  background: rgba(15, 23, 42, 0.95);
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.6);
  padding: 8px;
  font-size: 0.78rem;
  max-height: 220px;
  overflow: auto;
}

/* RIGHT SIDE */
.trend-placeholder {
  font-size: 0.8rem;
  opacity: 0.85;
}

.trend-section {
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: rgba(15, 23, 42, 0.9);
}

.trend-section h4 {
  margin: 0 0 4px;
  font-size: 0.9rem;
}

.trend-section ul {
  margin: 0;
  padding-left: 18px;
  font-size: 0.8rem;
  opacity: 0.9;
}

.trend-idea-card {
  margin-top: 6px;
  padding: 8px;
  border-radius: 10px;
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(148, 163, 184, 0.6);
}

.trend-idea-title {
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 2px;
}

.trend-idea-text {
  margin: 0 0 3px;
  font-size: 0.8rem;
  opacity: 0.9;
}

/* Responsive */
@media (max-width: 1100px) {
  .trend-grid {
    grid-template-columns: 1fr;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\TrendScan.jsx
// ==================================================

import React, { useState, useMemo } from "react";
import "./TrendScan.css";

const TrendScan = ({
  callApi,
  loading,
  setError,
  setOutput,
  output,
  audience,
  setAudience
}) => {
  const [niche, setNiche] = useState("sonno notturno over 60");
  const [language, setLanguage] = useState("it");
  const [mode, setMode] = useState("explore");

  const payload = useMemo(
    () => ({
      niche,
      audience,
      language,
      mode
    }),
    [niche, audience, language, mode]
  );

  const handleScan = () => {
    setError("");
    setOutput(null);

    if (!niche.trim()) {
      setError(" Inserisci una nicchia o un tema da analizzare.");
      return;
    }

    callApi("/trend-scan", payload);
  };

  const parsed = useMemo(() => {
    if (!output || typeof output !== "object") return null;
    return output.data || output.result || output;
  }, [output]);

  return (
    <section className="panel trend-panel">
      <div className="trend-header">
        <div>
          <h2> Trend Scanner PRO v2</h2>
          <p className="panel-subtitle">
            Scansiona la nicchia e genera idee video + pattern vincenti per il
            pubblico Over 50/60/70.
          </p>
        </div>

        <div className="trend-header-right">
          <div className="audience-switch">
            <span className="audience-label">Audience:</span>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over50" ? " audience-active" : "")
              }
              onClick={() => setAudience("over50")}
            >
              Over 50
            </button>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over60" ? " audience-active" : "")
              }
              onClick={() => setAudience("over60")}
            >
              Over 60
            </button>
            <button
              type="button"
              className={
                "audience-btn" +
                (audience === "over70" ? " audience-active" : "")
              }
              onClick={() => setAudience("over70")}
            >
              Over 70
            </button>
          </div>
        </div>
      </div>

      <div className="trend-grid">
        {/* SINISTRA: FORM + PAYLOAD */}
        <div className="trend-left">
          <div className="trend-block">
            <label className="input-label">Nicchia / Tema</label>
            <input
              className="input"
              value={niche}
              onChange={(e) => setNiche(e.target.value)}
              placeholder="es. Sonno notturno per over 60"
            />
          </div>

          <div className="trend-block">
            <label className="input-label">Lingua contenuti</label>
            <div className="trend-row">
              <button
                type="button"
                className={
                  "pill-btn" + (language === "it" ? " pill-active" : "")
                }
                onClick={() => setLanguage("it")}
              >
                 Italiano
              </button>
              <button
                type="button"
                className={
                  "pill-btn" + (language === "en" ? " pill-active" : "")
                }
                onClick={() => setLanguage("en")}
              >
                 Inglese
              </button>
            </div>
          </div>

          <div className="trend-block">
            <label className="input-label">Modalit analisi</label>
            <div className="trend-mode-row">
              <button
                type="button"
                className={
                  "mode-btn" + (mode === "explore" ? " mode-active" : "")
                }
                onClick={() => setMode("explore")}
              >
                 Esplora nicchia
                <span>Trend caldi + idee nuove</span>
              </button>
              <button
                type="button"
                className={
                  "mode-btn" + (mode === "doubleDown" ? " mode-active" : "")
                }
                onClick={() => setMode("doubleDown")}
              >
                 Spingi ci che funziona
                <span>Amplifica i contenuti vincenti</span>
              </button>
              <button
                type="button"
                className={
                  "mode-btn" + (mode === "rescue" ? " mode-active" : "")
                }
                onClick={() => setMode("rescue")}
              >
                 Rescue Channel
                <span>Strategia per canale in calo</span>
              </button>
            </div>
          </div>

          <button
            type="button"
            className="primary-btn trend-run-btn"
            disabled={loading}
            onClick={handleScan}
          >
            {loading ? " Analisi in corso" : " Avvia Trend Scan"}
          </button>

          <div className="trend-payload-box">
            <h4>Payload inviato al backend</h4>
            <pre className="trend-payload-pre">
{JSON.stringify(payload, null, 2)}
            </pre>
          </div>
        </div>

        {/* DESTRA: RISULTATO */}
        <div className="trend-right">
          {!parsed && (
            <p className="trend-placeholder">
              Lancia una scansione per vedere qui i trend principali, le idee
              video e il calendario consigliato. Il JSON completo lo trovi nel
              pannello <strong>Output</strong> a destra.
            </p>
          )}

          {parsed && (
            <>
              {/* Trend principali */}
              {parsed.trendPrincipali && parsed.trendPrincipali.length > 0 && (
                <div className="trend-section">
                  <h4> Trend principali</h4>
                  <ul>
                    {parsed.trendPrincipali.map((t, i) => (
                      <li key={i}>{t}</li>
                    ))}
                  </ul>
                </div>
              )}

              {/* Formati */}
              {parsed.formatiCheFunzionano &&
                parsed.formatiCheFunzionano.length > 0 && (
                  <div className="trend-section">
                    <h4> Formati che funzionano</h4>
                    <ul>
                      {parsed.formatiCheFunzionano.map((f, i) => (
                        <li key={i}>{f}</li>
                      ))}
                    </ul>
                  </div>
                )}

              {/* Idee video lunghi */}
              {parsed.ideeVideoLunghi &&
                parsed.ideeVideoLunghi.length > 0 && (
                  <div className="trend-section">
                    <h4> Idee per video lunghi</h4>
                    {parsed.ideeVideoLunghi.map((idea, i) => (
                      <div key={i} className="trend-idea-card">
                        <div className="trend-idea-title">
                          {idea.titolo || "Idea senza titolo"}
                        </div>
                        {idea.angolo && (
                          <p className="trend-idea-text">
                            <strong>Angolo:</strong> {idea.angolo}
                          </p>
                        )}
                        {idea.percheFunzionaOver50 && (
                          <p className="trend-idea-text">
                            <strong>Perch funziona Over 50/60/70:</strong>{" "}
                            {idea.percheFunzionaOver50}
                          </p>
                        )}
                        {idea.hookSuggerito && (
                          <p className="trend-idea-text">
                            <strong>Hook suggerito:</strong>{" "}
                            {idea.hookSuggerito}
                          </p>
                        )}
                      </div>
                    ))}
                  </div>
                )}

              {/* Idee Shorts */}
              {parsed.ideeShorts && parsed.ideeShorts.length > 0 && (
                <div className="trend-section">
                  <h4> Idee per Shorts</h4>
                  {parsed.ideeShorts.map((s, i) => (
                    <div key={i} className="trend-idea-card">
                      <div className="trend-idea-title">
                        {s.titolo || "Short senza titolo"}
                      </div>
                      {s.concept && (
                        <p className="trend-idea-text">
                          <strong>Concept:</strong> {s.concept}
                        </p>
                      )}
                      {s.cta && (
                        <p className="trend-idea-text">
                          <strong>CTA:</strong> {s.cta}
                        </p>
                      )}
                    </div>
                  ))}
                </div>
              )}

              {/* Hook patterns */}
              {parsed.hookPatterns && parsed.hookPatterns.length > 0 && (
                <div className="trend-section">
                  <h4> Pattern di hook</h4>
                  <ul>
                    {parsed.hookPatterns.map((h, i) => (
                      <li key={i}>{h}</li>
                    ))}
                  </ul>
                </div>
              )}

              {/* Errori da evitare */}
              {parsed.erroriDaEvitare && parsed.erroriDaEvitare.length > 0 && (
                <div className="trend-section">
                  <h4> Errori da evitare</h4>
                  <ul>
                    {parsed.erroriDaEvitare.map((e, i) => (
                      <li key={i}>{e}</li>
                    ))}
                  </ul>
                </div>
              )}

              {/* Calendario */}
              {parsed.calendarSuggerito && (
                <div className="trend-section">
                  <h4> Calendario consigliato</h4>
                  <p className="trend-idea-text">
                    <strong>Frequenza:</strong>{" "}
                    {parsed.calendarSuggerito.frequenza}
                  </p>
                  {parsed.calendarSuggerito.giorniConsigliati && (
                    <p className="trend-idea-text">
                      <strong>Giorni consigliati:</strong>{" "}
                      {parsed.calendarSuggerito.giorniConsigliati.join(", ")}
                    </p>
                  )}
                  {parsed.calendarSuggerito.note && (
                    <p className="trend-idea-text">
                      <strong>Note:</strong> {parsed.calendarSuggerito.note}
                    </p>
                  )}
                </div>
              )}

              {/* Note strategiche */}
              {parsed.noteStrategiche && (
                <div className="trend-section">
                  <h4> Note strategiche</h4>
                  <p className="trend-idea-text">{parsed.noteStrategiche}</p>
                </div>
              )}
            </>
          )}
        </div>
      </div>
    </section>
  );
};

export default TrendScan;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\TrendScanner.jsx
// ==================================================

export default function TrendScanner() {
  return (
    <div style={{ padding: "20px" }}>
      <h1 className="page-title">Trend Scanner</h1>
      <p className="page-subtitle">Scopri i trend del momento e anticipa la concorrenza.</p>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\src\pages\TrendsPage.jsx
// ==================================================

export default function TrendsPage() {
  return (
    <div>
      <h1>Trend Scanner</h1>
      <p>Scansione delle tendenze in tempo reale con AI Engine 3.0.</p>
    </div>
  );
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\0000 PROGETTO ZEN COACH CHRY\zen-youtube-coach-dashboard\vite.config.js
// ==================================================

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})



--- Files from Project Root: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine ---

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine\package-lock.json
// ==================================================

{
  "name": "zentranscriptengine",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "zentranscriptengine",
      "version": "1.0.0",
      "dependencies": {
        "playwright": "^1.57.0"
      }
    },
    "node_modules/fsevents": {
      "version": "2.3.2",
      "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.2.tgz",
      "integrity": "sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==",
      "hasInstallScript": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^8.16.0 || ^10.6.0 || >=11.0.0"
      }
    },
    "node_modules/playwright": {
      "version": "1.57.0",
      "resolved": "https://registry.npmjs.org/playwright/-/playwright-1.57.0.tgz",
      "integrity": "sha512-ilYQj1s8sr2ppEJ2YVadYBN0Mb3mdo9J0wQ+UuDhzYqURwSoW4n1Xs5vs7ORwgDGmyEh33tRMeS8KhdkMoLXQw==",
      "license": "Apache-2.0",
      "dependencies": {
        "playwright-core": "1.57.0"
      },
      "bin": {
        "playwright": "cli.js"
      },
      "engines": {
        "node": ">=18"
      },
      "optionalDependencies": {
        "fsevents": "2.3.2"
      }
    },
    "node_modules/playwright-core": {
      "version": "1.57.0",
      "resolved": "https://registry.npmjs.org/playwright-core/-/playwright-core-1.57.0.tgz",
      "integrity": "sha512-agTcKlMw/mjBWOnD6kFZttAAGHgi/Nw0CZ2o6JqWSbMlI219lAFLZZCyqByTsvVAJq5XA5H8cA6PrvBRpBWEuQ==",
      "license": "Apache-2.0",
      "bin": {
        "playwright-core": "cli.js"
      },
      "engines": {
        "node": ">=18"
      }
    }
  }
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine\package.json
// ==================================================

{
  "name": "zentranscriptengine",
  "version": "1.0.0",
  "main": "transcript-extractor.js",
  "type": "module",
  "scripts": {
    "test": "echo \"No test\" && exit 0"
  },
  "dependencies": {
    "playwright": "^1.57.0"
  }
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine\transcript-extractor-headless.js
// ==================================================

import fs from 'fs';
import path from 'path';

// ======================================================================
//  ZenTranscriptEngine  Fixed Version
// Estrae i sottotitoli cercando "captionTracks" nell'HTML della pagina.
// ======================================================================

//  Estrae il videoId da URL YouTube (normale o shorts)
function getVideoId(urlOrId) {
  if (!urlOrId) return null;
  
  // Se sembra gi un ID (11 caratteri, niente http)
  if (!urlOrId.startsWith('http') && urlOrId.length === 11) {
    return urlOrId;
  }

  try {
    const u = new URL(urlOrId);
    if (u.searchParams.get('v')) return u.searchParams.get('v');

    // formato shorts
    if (u.pathname.includes('shorts')) {
      const parts = u.pathname.split('/shorts/');
      return parts[1] ? parts[1].split(/[&?]/)[0] : null;
    }
    // formato youtu.be
    if (u.hostname === 'youtu.be') {
        return u.pathname.slice(1);
    }
    return null;
  } catch {
    return null;
  }
}

//  Decodifica entit HTML (&amp; -> &, ecc.)
function htmlDecode(text) {
  if (!text) return '';
  return text
    .replace(/&amp;/g, '&')
    .replace(/&lt;/g, '<')
    .replace(/&gt;/g, '>')
    .replace(/&quot;/g, '"')
    .replace(/&#39;/g, "'");
}

//  Pulisce il testo XML grezzo
function cleanTranscriptXml(xmlText) {
  // Rimuove i tag XML <text ...> e </text>
  // Esempio: <text start="0.5" dur="3.2">Ciao a tutti</text>
  
  // Usiamo una regex per catturare il contenuto dentro i tag <text>
  const regex = /<text[^>]*>(.*?)<\/text>/g;
  let matches;
  let lines = [];

  while ((matches = regex.exec(xmlText)) !== null) {
    let content = matches[1];
    content = htmlDecode(content); // Decodifica caratteri speciali
    if (content.trim().length > 0) {
      lines.push(content);
    }
  }

  return lines.join(' ');
}

//  Tentativo principale: Scraping della Watch Page
async function fetchTranscript(videoId) {
  const watchUrl = `https://www.youtube.com/watch?v=${videoId}`;
  
  // Header falsi per sembrare un browser vero (importante per evitare blocchi immediati)
  const headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36",
    "Accept-Language": "en-US,en;q=0.9"
  };

  console.log(` Scarico pagina HTML per ID: ${videoId}...`);
  const res = await fetch(watchUrl, { headers });

  if (!res.ok) {
    throw new Error(`Errore HTTP ${res.status} scaricando la pagina video.`);
  }

  const html = await res.text();

  // Cerca la struttura JSON che contiene captionTracks
  // Solitamente si trova dentro "captionTracks": [ ... ]
  const match = html.match(/"captionTracks":(\[.*?\])/);

  if (!match) {
    throw new Error("Nessuna traccia di sottotitoli trovata (captionTracks assente). Il video potrebbe non avere sottotitoli.");
  }

  let tracks;
  try {
    tracks = JSON.parse(match[1]);
  } catch (e) {
    throw new Error("Errore nel parsing del JSON dei sottotitoli.");
  }

  if (!Array.isArray(tracks) || tracks.length === 0) {
    throw new Error("Lista sottotitoli vuota.");
  }

  // 1. Cerca Italiano (automatico o manuale)
  // 2. Altrimenti Inglese
  // 3. Altrimenti il primo disponibile
  let track = tracks.find(t => t.languageCode === 'it'); 
  if (!track) track = tracks.find(t => t.languageCode === 'en');
  if (!track) track = tracks[0];

  console.log(` Trovata traccia: ${track.name.simpleText} (${track.languageCode})`);

  // Prendi l'URL base dei sottotitoli
  const baseUrl = track.baseUrl;
  if (!baseUrl) {
    throw new Error("URL sottotitoli non trovato nell'oggetto traccia.");
  }

  // Scarica l'XML dei sottotitoli
  console.log(` Scarico XML sottotitoli...`);
  const subRes = await fetch(baseUrl);
  if (!subRes.ok) {
    throw new Error(`Errore scaricamento XML sottotitoli: ${subRes.status}`);
  }

  const xmlBody = await subRes.text();
  
  // Pulisci il testo
  const cleanText = cleanTranscriptXml(xmlBody);

  return {
    lang: track.languageCode,
    text: cleanText
  };
}

//  MAIN
(async () => {
  const videoInput = process.argv[2];

  if (!videoInput) {
    console.log(" Errore: Inserisci un URL o ID video.");
    console.log("   Esempio: node youtube-sub.js https://www.youtube.com/watch?v=dQw4w9WgXcQ");
    process.exit(1);
  }

  try {
    const videoId = getVideoId(videoInput);
    if (!videoId) throw new Error("ID Video non valido.");

    const result = await fetchTranscript(videoId);

    console.log("\n TRANSCRIPT ESTRATTO:\n");
    console.log(result.text.slice(0, 500) + (result.text.length > 500 ? "..." : ""));
    console.log("\n------------------------------------------------");

    // Salva su file
    const fileName = `transcript_${videoId}.txt`;
    const outputPath = path.join(process.cwd(), fileName);
    fs.writeFileSync(outputPath, result.text, 'utf8');
    console.log(` Salvato in: ${fileName}`);

  } catch (err) {
    console.error(` ERRORE: ${err.message}`);
  }
})();

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine\transcript-extractor-human.js
// ==================================================

import { chromium } from "playwright";
import fs from "fs";

async function extractHuman(url) {
  console.log(" Avvio Chrome reale (NO headless)");

  const browser = await chromium.launch({
    headless: false, // finestra visibile
    args: [
      "--disable-blink-features=AutomationControlled",
      "--disable-web-security",
      "--disable-features=IsolateOrigins,site-per-process",
      "--start-maximized",
    ],
  });

  const context = await browser.newContext({
    viewport: null,
    userAgent:
      "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36",
    locale: "it-IT",
  });

  const page = await context.newPage();

  console.log(" Carico pagina:", url);
  await page.goto(url, { waitUntil: "networkidle" });
  await page.waitForTimeout(3000);

  // 1 prova ad espandere la descrizione (...altro)
  try {
    console.log(" Cerco ...altro");
    const expandBtn = page.locator("tp-yt-paper-button#expand");
    if ((await expandBtn.count()) > 0) {
      await expandBtn.first().evaluate((el) => el.click());
      console.log(" Cliccato ...altro");
      await page.waitForTimeout(1500);
    } else {
      console.log(" Nessun ...altro (gi espanso o layout diverso)");
    }
  } catch (e) {
    console.log(" Errore su ...altro (ignoro):", e.message);
  }

  // 2 clicca Mostra trascrizione / Show transcript
  console.log(" Cerco 'Mostra trascrizione'");
  const transBtn = page.locator(
    "button[aria-label='Mostra trascrizione'], button[aria-label='Show transcript']"
  );

  try {
    await transBtn.waitFor({ timeout: 15000 });
    console.log(" Trovato pulsante transcript, clicco");
    await transBtn.first().evaluate((el) => el.click());
    await page.waitForTimeout(2000);
  } catch (e) {
    console.log(" Pulsante 'Mostra trascrizione' non trovato:", e.message);
    await browser.close();
    return null;
  }

  // 3 estrai il testo dal pannello transcript
  console.log(" Estraggo segmenti");
  const text = await page.evaluate(() => {
    const root = document.querySelector("yt-transcript-segment-list-renderer");
    if (!root) return null;

    const segments = Array.from(
      root.querySelectorAll("yt-transcript-segment-renderer")
    ).map((n) => {
      const el = n.querySelector(".segment-text");
      return el ? el.innerText.trim() : "";
    });

    return segments.filter(Boolean).join(" ");
  });

  if (!text || text.length < 10) {
    console.log(" Transcript vuoto o mancante.");
    await browser.close();
    return null;
  }

  fs.writeFileSync("transcript_output.txt", text, "utf8");
  console.log(" Salvato transcript_output.txt");

  await browser.close();
  return text;
}

// MAIN
const url = process.argv[2];

if (!url) {
  console.log(" Usa: node transcript-extractor-human.js <URL_YOUTUBE>");
  process.exit(1);
}

extractHuman(url)
  .then((t) => {
    if (!t) {
      console.log(" Nessun transcript estratto.");
    } else {
      console.log("\n PRIMI 300 CARATTERI:\n");
      console.log(t.slice(0, 300), "");
    }
  })
  .catch((e) => {
    console.error(" Errore generale:", e);
  });


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine\transcript-extractor.js
// ==================================================

// ======================================================================
//  ZenTranscriptEngine  Transcript Extractor Ultra-Pro (NO COOKIE)
// Versione 2025  stile YouTube Summary / Glasp
// - Niente login, niente SAPISID, niente cookie.
// - 1 livello: API timedtext pubblica (fmt=vtt)
// - 2 livello: captionTracks dal codice HTML della watch page
// - Output: transcript pulito in transcript_output.txt
// ======================================================================

import fs from "fs";
import path from "path";

// In Node 18+ fetch  globale  non serve node-fetch.

// -------------------------------------------------------------
//  Estrae il videoId da URL YouTube (normale, shorts, youtu.be)
// -------------------------------------------------------------
function getVideoId(urlOrId) {
  if (!urlOrId) return null;

  // Se sembra gi un ID (11 caratteri, niente http)
  if (!urlOrId.startsWith("http") && urlOrId.length === 11) {
    return urlOrId;
  }

  try {
    const u = new URL(urlOrId);

    // https://www.youtube.com/watch?v=ID
    const v = u.searchParams.get("v");
    if (v) return v;

    // https://youtu.be/ID
    if (u.hostname === "youtu.be" && u.pathname.length > 1) {
      return u.pathname.slice(1).split(/[?&]/)[0];
    }

    // https://www.youtube.com/shorts/ID
    if (u.pathname.includes("/shorts/")) {
      return u.pathname.split("/shorts/")[1].split(/[?&]/)[0];
    }

    return null;
  } catch {
    return null;
  }
}

// -------------------------------------------------------------
//  Pulisce il testo VTT / grezzo (toglie numeri, timestamp, WEBVTT)
// -------------------------------------------------------------
function cleanTranscriptText(raw) {
  if (!raw) return "";
  const lines = raw
    .split(/\r?\n/)
    .map((l) => l.trim())
    .filter((l) => l.length > 0);

  const cleaned = lines.filter((l) => {
    if (/^\d+$/.test(l)) return false; // linee solo numeri
    if (l.includes("-->")) return false; // timestamp VTT
    if (l.toUpperCase().startsWith("WEBVTT")) return false;
    return true;
  });

  return cleaned.join(" ");
}

// -------------------------------------------------------------
//  Decodifica entit HTML (&amp;  &, ecc.)
// -------------------------------------------------------------
function htmlDecode(text) {
  if (!text) return "";
  return text
    .replace(/&amp;/g, "&")
    .replace(/&lt;/g, "<")
    .replace(/&gt;/g, ">")
    .replace(/&quot;/g, '"')
    .replace(/&#39;/g, "'");
}

// -------------------------------------------------------------
//  Tentativo 1  API timedtext pubblica
//   https://www.youtube.com/api/timedtext?lang=it&v=VIDEO_ID&fmt=vtt
// -------------------------------------------------------------
async function tryTimedText(videoId) {
  const langs = ["it", "it-IT", "en", "en-US", "en-GB"];

  for (const lang of langs) {
    const url = `https://www.youtube.com/api/timedtext?lang=${lang}&v=${videoId}&fmt=vtt`;
    console.log(` timedtext: provo lang=${lang}`);

    const res = await fetch(url);
    if (!res.ok) {
      continue;
    }

    const body = await res.text();
    if (!body || body.trim().length === 0) continue;

    const cleaned = cleanTranscriptText(body);
    if (cleaned && cleaned.length > 0) {
      return {
        success: true,
        provider: "timedtext",
        lang,
        text: cleaned,
      };
    }
  }

  return { success: false };
}

// -------------------------------------------------------------
//  Estrae captionTracks dal codice HTML
//   Usa regex robusta e doppio tentativo (grezzo + escapato)
// -------------------------------------------------------------
function extractCaptionTracksJson(html) {
  // 1 tentativo: captionTracks in JSON non escapato
  let match = html.match(/"captionTracks":(\[.*?\])[,}]/s);
  if (match) {
    return match[1];
  }

  // 2 tentativo: captionTracks con backslash escapati
  match = html.match(/"captionTracks\\":(\[.*?\])[,}]/s);
  if (match) {
    let raw = match[1];
    // rimuove gli escape delle virgolette
    raw = raw.replace(/\\"/g, '"');
    return raw;
  }

  return null;
}

// -------------------------------------------------------------
//  Tentativo 2  captionTracks dalla pagina HTML
// -------------------------------------------------------------
async function tryCaptionTracks(videoId) {
  const watchUrl = `https://www.youtube.com/watch?v=${videoId}&hl=en`;
  console.log(` Scarico watch page: ${watchUrl}`);

  const headers = {
    "User-Agent":
      "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "Accept-Language": "en-US,en;q=0.9",
  };

  const res = await fetch(watchUrl, { headers });

  if (!res.ok) {
    return { success: false, reason: `HTTP ${res.status} sulla watch page` };
  }

  const html = await res.text();

  const tracksJsonString = extractCaptionTracksJson(html);
  if (!tracksJsonString) {
    return { success: false, reason: "captionTracks non trovati nell'HTML" };
  }

  let tracks;
  try {
    tracks = JSON.parse(tracksJsonString);
  } catch (err) {
    return {
      success: false,
      reason: "JSON captionTracks non parseable: " + err.message,
    };
  }

  if (!Array.isArray(tracks) || tracks.length === 0) {
    return { success: false, reason: "captionTracks vuoti" };
  }

  // Preferisci Italiano, poi Inglese, poi la prima traccia disponibile
  let track =
    tracks.find((t) => t.languageCode && t.languageCode.startsWith("it")) ||
    tracks.find((t) => t.languageCode && t.languageCode.startsWith("en")) ||
    tracks[0];

  if (!track || !track.baseUrl) {
    return { success: false, reason: "baseUrl assente in track" };
  }

  console.log(
    ` Traccia sottotitoli: ${track.languageCode || "unknown"} (${track.name?.simpleText || "no-name"})`
  );

  let trackUrl = track.baseUrl;
  if (!trackUrl.includes("fmt=")) {
    trackUrl += (trackUrl.includes("?") ? "&" : "?") + "fmt=vtt";
  }

  console.log(" Scarico testo sottotitoli da:", trackUrl);

  const tRes = await fetch(trackUrl, { headers });
  if (!tRes.ok) {
    return { success: false, reason: `HTTP ${tRes.status} scaricando track` };
  }

  const tBody = await tRes.text();
  if (!tBody || tBody.trim().length === 0) {
    return { success: false, reason: "corpo track vuoto" };
  }

  let transcript = "";

  // Caso XML / <text>...
  if (tBody.includes("<text")) {
    const regex = /<text[^>]*>(.*?)<\/text>/gs;
    const pieces = [];
    let m;
    while ((m = regex.exec(tBody)) !== null) {
      const rawSegment = m[1].replace(/\s+/g, " ").trim();
      if (rawSegment.length > 0) {
        pieces.push(htmlDecode(rawSegment));
      }
    }
    transcript = pieces.join(" ");
  } else {
    // Caso VTT o simile
    transcript = cleanTranscriptText(tBody);
  }

  if (!transcript || transcript.trim().length === 0) {
    return { success: false, reason: "transcript vuoto dopo pulizia" };
  }

  return {
    success: true,
    provider: "captionTracks",
    lang: track.languageCode || "unknown",
    text: transcript,
  };
}

// -------------------------------------------------------------
//  Orchestratore  prova timedtext, poi captionTracks
// -------------------------------------------------------------
async function extractTranscript(videoUrl) {
  const videoId = getVideoId(videoUrl);
  if (!videoId) {
    throw new Error("URL / ID video non valido.");
  }

  console.log(" Video ID:", videoId);

  // 1 tentativo: API timedtext
  console.log(" Tentativo 1: API timedtext");
  try {
    const timed = await tryTimedText(videoId);
    if (timed.success) {
      console.log(` Transcript trovato via timedtext (lang: ${timed.lang})`);
      return timed;
    } else {
      console.log(" timedtext non disponibile, passo a captionTracks");
    }
  } catch (err) {
    console.log(" Errore timedtext:", err.message);
  }

  // 2 tentativo: captionTracks da HTML
  console.log(" Tentativo 2: captionTracks da pagina HTML");
  try {
    const cap = await tryCaptionTracks(videoId);
    if (cap.success) {
      console.log(
        ` Transcript trovato via captionTracks (lang: ${cap.lang})`
      );
      return cap;
    } else {
      console.log(
        " captionTracks fallito:",
        cap.reason || "motivo sconosciuto"
      );
    }
  } catch (err) {
    console.log(" Errore captionTracks:", err.message);
  }

  throw new Error("Nessun transcript disponibile con metodi pubblici.");
}

// -------------------------------------------------------------
//  MAIN CLI
// -------------------------------------------------------------
(async () => {
  const videoUrl = process.argv[2];

  if (!videoUrl) {
    console.log(" Devi inserire un URL o ID YouTube, es:");
    console.log(
      "   node transcript-extractor.js https://www.youtube.com/watch?v=LO7gcz58tOE"
    );
    console.log("   node transcript-extractor.js LO7gcz58tOE");
    process.exit(1);
  }

  try {
    const result = await extractTranscript(videoUrl);

    console.log("\n TRANSCRIPT ESTRATTO CON SUCCESSO\n");
    console.log(
      result.text.slice(0, 600) +
        (result.text.length > 600 ? "..." : "")
    );
    console.log(
      `\n Provider: ${result.provider} | Lang: ${result.lang}\n`
    );

    const outputPath = path.join(process.cwd(), "transcript_output.txt");
    fs.writeFileSync(outputPath, result.text, "utf8");
    console.log(` Transcript salvato in: ${outputPath}\n`);
  } catch (err) {
    console.error(" Errore:", err.message);
    process.exit(1);
  }
})();


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine\youtube-cookies.json
// ==================================================

{
"APISID": "geaE75XoIka561f5/A6X54VCvbYEVcGNrL",
"HSID": "AiXWY68xv1NTp3JuA",
"IDE": "AHWqTUlo8js_cFLSip_KBoy10MKX9iL2zPGIUK0FD5hks9IaM9sepO2gC-tt0MGSPZc",
"LOGIN_INFO": "AFmmF2swRgIhAKSXYQfzYv-CtcS7wBaZgC9tNGaGkNKXaM7y4hbdOhmDAiEA9wogT63NYyFgNwMlj64HEAzb1XgJHv4oJ7m5VRLo6SI:QUQ3MjNmeUY5WHFaQ2Q5RThIS2xPMUtCRnEyeEUzaHZNNGRHZGRnbEo0WjdVV1lpSjN5UXJuRkpQbVZIZF8wMlRVTXRvU0YyczliZml5X3ZoNC1TanUtX0oyekVYYzBjcGR5dVVHVXByNUlDWTVMZThMNkRJMWJmdUY0Q1lMLU40ZXFUdFhPWHdMMkI1ektTMXdMQlM4SlExUWZfRXdGcm5n",
"PREF": "tz=Europe.Rome&f5=30000",
"SAPISID": "3xksBzcZdxEv3jAy/AI85czebhW-DKpZ59",
"SID": "g.a0004AirSZeTnCNtrYwX22HCQyYWWkXUuHG5r44VwHzYJu94LYzGwxX2upZT-AImCxJhCA8UuwACgYKAf8SARESFQHGX2MiNxGDlFN0Y4haihdJ5quzVhoVAUF8yKqbs_410Q1_Ki4-hn607waa0076",
"SIDCC": "AKEyXzXZ1_BlHa7iPtUtcbwybkzrj_QZrjV0for2gsqZwKAt5PfsYGgmhrboiDons7D6UZa0Y6o",
"SSID": "A6x1wNGTjNuYr0kAL",
"VISITOR_PRIVACY_METADATA": "CgJJVBIhEh0SGwsMDg8QERITFBUWFxgZGhscHR4fICEiIyQlJiAN",
"YSC": "D0yZGcykgGo",
"__Secure-1PAPISID": "3xksBzcZdxEv3jAy/AI85czebhW-DKpZ59",
"__Secure-1PSID": "g.a0004AirSZeTnCNtrYwX22HCQyYWWkXUuHG5r44VwHzYJu94LYzGd3ky9CZU23xktoTF3_RffQACgYKARUSARESFQHGX2Mi3CdhggjnnFQz3Wzqj2stthoVAUF8yKrEgEEKnIeJVgIA1jmkEp4z0076",
"__Secure-1PSIDCC": "AKEyXzWYYHNibWSmJ1DtDgA1ZY2XullsY0CNm-umf1ahHs0e6CMmqaSUwYOd873XJOm_jWBHs9A",
"__Secure-1PSIDTS": "sidts-CjUBwQ9iI0yV7iZWqw45ACMxU8v5BZ_1KVNr4WRdKsy1xdhNF8VkqCoS3FcY0ZbW-C99lgDPvRAA",
"__Secure-3PAPISID": "3xksBzcZdxEv3jAy/AI85czebhW-DKpZ59",
"__Secure-3PSID": "g.a0004AirSZeTnCNtrYwX22HCQyYWWkXUuHG5r44VwHzYJu94LYzGpljwZZg5TWBnn7Tc25gmgwACgYKAa0SARESFQHGX2MiKYZukKG0v-136f_Pb5hGnhoVAUF8yKoTTOeMGlgWtMcrav67OY4Y0076",
"__Secure-3PSIDCC": "AKEyXzWxspWPyuqZ2vVYopOLBiRlXVESmTafRXev7Is9dsfiTGQIWGsUki66S9GR_2m70Pmj7Q",
"__Secure-3PSIDTS": "sidts-CjUBwQ9iI0yV7iZWqw45ACMxU8v5BZ_1KVNr4WRdKsy1xdhNF8VkqCoS3FcY0ZbW-C99lgDPvRAA",
"__Secure-ROLL_OUT_TOKEN": "CNTVivn19puygwEQtLWJmaKikQMY8suAmqKikQM%3D",
"__Secure-YENID": "11.YTE=kaj3zUi33vIhpfxKOqbtt8SY8E5OdoH8197CIF-orPPTViViFt-cjn0PRsuhlkTbY-fxuJSnh9IPgwqAnn0y9somuC3FqwtE_EBFUDAStQWojDRhb0cI-VvjsezwqE72KqiSTnuXjJB4-vjqwFuU4y2ju2x0ZQXPEEkoUfn5HjKw6zQ6R5JaVmQcTw-Y6vUwyva_XTURi5CJhNpvWHfOGxi8DDYVVKM3ZcBOUcIy5l66w4sbEORBzsQu_UFNZl8kYr-tNDmXPqF5ZCrU0aYtuKuEzReP9Adc9pfRT5Y-Ar6bE8OES8sdn_RPa3pDbwwaL44Y-OIIUeogwsKokaBM3w"
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\Documents\ZenTranscriptEngine\youtube-session.json
// ==================================================

{
  "cookies": [
    {
      "name": "__Secure-YENID",
      "value": "11.YTE=CHQB9XeCWb1YgsVI5CZPFF2K8YM1A-RjUGvJpqEMTLkc2dyOOrGOvG9vZxcph3PlizzIKGu2fmfWiYDpMQQtwY5E7MJ9PkmCAx2yPCKxdx1Vr6MAaAQCRaudhBZYOS-rFjOiZ_lQc4sEU6itPoaESeNbz-9hOyz3yg0MbfCtwr73j1gg2Tw48IW0xkXuX0ZEP0aUqjn3AygFdE8ZWKSRUVta5zAKOEMiFv_qLk5XFWGcatsjF0gVcgc_-jH7eOln6b7Gutwy0byheZfB2xqZT9r3Q_JUb4ZI2Pb_viICBM6J7mBV-SvcckmaNI-WbXyKwWgAJzF4xdfN4wAjLacWaA",
      "domain": ".youtube.com",
      "path": "/",
      "expires": 1798926581.974997,
      "httpOnly": true,
      "secure": true,
      "sameSite": "Lax"
    },
    {
      "name": "YSC",
      "value": "xmD9LYWWuZY",
      "domain": ".youtube.com",
      "path": "/",
      "expires": -1,
      "httpOnly": true,
      "secure": true,
      "sameSite": "None",
      "partitionKey": "https://youtube.com",
      "_crHasCrossSiteAncestor": false
    },
    {
      "name": "__Secure-YEC",
      "value": "CgstYkg4ZE42VkFnVSj34MLJBjInCgJJVBIhEh0SGwsMDg8QERITFBUWFxgZGhscHR4fICEiIyQlJiAkYuACCt0CMTEuWVRFPUNIUUI5WGVDV2IxWWdzVkk1Q1pQRkYySzhZTTFBLVJqVUd2SnBxRU1UTGtjMmR5T09yR092Rzl2WnhjcGgzUGxpenpJS0d1MmZtZldpWURwTVFRdHdZNUU3TUo5UGttQ0F4MnlQQ0t4ZHgxVnI2TUFhQVFDUmF1ZGhCWllPUy1yRmpPaVpfbFFjNHNFVTZpdFBvYUVTZU5iei05aE95ejN5ZzBNYmZDdHdyNzNqMWdnMlR3NDhJVzB4a1h1WDBaRVAwYVVxam4zQXlnRmRFOFpXS1NSVVZ0YTV6QUtPRU1pRnZfcUxrNVhGV0djYXRzakYwZ1ZjZ2NfLWpIN2VPbG42YjdHdXR3eTBieWhlWmZCMnhxWlQ5cjNRX0pVYjRaSTJQYl92aUlDQk02SjdtQlYtU3ZjY2ttYU5JLVdiWHlLd1dnQUp6RjR4ZGZONHdBakxhY1dhQQ%3D%3D",
      "domain": ".youtube.com",
      "path": "/",
      "expires": 1798926580.975247,
      "httpOnly": true,
      "secure": true,
      "sameSite": "Lax"
    },
    {
      "name": "VISITOR_PRIVACY_METADATA",
      "value": "CgJJVBIhEh0SGwsMDg8QERITFBUWFxgZGhscHR4fICEiIyQlJiAk",
      "domain": ".youtube.com",
      "path": "/",
      "expires": 1798926581.97539,
      "httpOnly": true,
      "secure": true,
      "sameSite": "None",
      "partitionKey": "https://youtube.com",
      "_crHasCrossSiteAncestor": false
    },
    {
      "name": "PREF",
      "value": "tz=Europe.Rome&f4=4000000",
      "domain": ".youtube.com",
      "path": "/",
      "expires": 1799358585.081443,
      "httpOnly": false,
      "secure": true,
      "sameSite": "Lax"
    }
  ],
  "origins": [
    {
      "origin": "https://www.youtube.com",
      "localStorage": [
        {
          "name": "yt-player-user-settings",
          "value": "{\"data\":\"{\\\"484\\\":{\\\"stringValue\\\":\\\"\\\"}}\",\"expiration\":1767390582994,\"creation\":1764798582994}"
        },
        {
          "name": "yt-remote-connected-devices",
          "value": "{\"data\":\"[]\",\"expiration\":1764884983010,\"creation\":1764798583010}"
        },
        {
          "name": "ytidb::LAST_RESULT_ENTRY_KEY",
          "value": "{\"data\":{\"hasSucceededOnce\":true},\"expiration\":1767390584907,\"creation\":1764798584907}"
        },
        {
          "name": "V1d660159||::yt-player::yt-player-lv",
          "value": "{\"data\":\"{}\",\"creation\":1764798584252}"
        },
        {
          "name": "yt-remote-device-id",
          "value": "{\"data\":\"5c127124-dcb7-4827-9370-f1c18ef7b1d7\",\"expiration\":1796334583007,\"creation\":1764798583007}"
        },
        {
          "name": "yt-icons-last-purged",
          "value": "1763848183957"
        }
      ]
    }
  ]
}


--- Files from Project Root: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend ---

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\package-lock.json
// ==================================================

{
  "name": "zen-youtube-coach-pro-backend",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "zen-youtube-coach-pro-backend",
      "version": "1.0.0",
      "license": "ISC",
      "dependencies": {
        "axios": "^1.13.2",
        "compression": "^1.7.4",
        "cors": "^2.8.5",
        "dotenv": "^16.3.1",
        "express": "^4.19.2",
        "express-rate-limit": "^8.2.1",
        "form-data": "^4.0.5",
        "groq-sdk": "^0.5.0",
        "helmet": "^8.1.0",
        "morgan": "^1.10.1",
        "node-fetch": "^3.3.2",
        "openai": "^4.26.1",
        "p-limit": "^4.0.0",
        "ytdl-core": "^4.11.5"
      },
      "engines": {
        "node": ">=18.x"
      }
    },
    "node_modules/@types/node": {
      "version": "24.10.1",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-24.10.1.tgz",
      "integrity": "sha512-GNWcUTRBgIRJD5zj+Tq0fKOJ5XZajIiBroOF0yvj2bSU1WvNdYS/dn9UxwsujGW4JX06dnHyjV2y9rRaybH0iQ==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~7.16.0"
      }
    },
    "node_modules/@types/node-fetch": {
      "version": "2.6.13",
      "resolved": "https://registry.npmjs.org/@types/node-fetch/-/node-fetch-2.6.13.tgz",
      "integrity": "sha512-QGpRVpzSaUs30JBSGPjOg4Uveu384erbHBoT1zeONvyCfwQxIkUshLAOqN/k9EjGviPRmWTTe6aH2qySWKTVSw==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*",
        "form-data": "^4.0.4"
      }
    },
    "node_modules/abort-controller": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/abort-controller/-/abort-controller-3.0.0.tgz",
      "integrity": "sha512-h8lQ8tacZYnR3vNQTgibj+tODHI5/+l06Au2Pcriv/Gmet0eaj4TwWH41sO9wnHDiQsEj19q0drzdWdeAHtweg==",
      "license": "MIT",
      "dependencies": {
        "event-target-shim": "^5.0.0"
      },
      "engines": {
        "node": ">=6.5"
      }
    },
    "node_modules/accepts": {
      "version": "1.3.8",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-1.3.8.tgz",
      "integrity": "sha512-PYAthTa2m2VKxuvSD3DPC/Gy+U+sOA1LAuT8mkmRuvw+NACSaeXEQ+NHcVF7rONl6qcaxV3Uuemwawk+7+SJLw==",
      "license": "MIT",
      "dependencies": {
        "mime-types": "~2.1.34",
        "negotiator": "0.6.3"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/agentkeepalive": {
      "version": "4.6.0",
      "resolved": "https://registry.npmjs.org/agentkeepalive/-/agentkeepalive-4.6.0.tgz",
      "integrity": "sha512-kja8j7PjmncONqaTsB8fQ+wE2mSU2DJ9D4XKoJ5PFWIdRMa6SLSN1ff4mOr4jCbfRSsxR4keIiySJU0N9T5hIQ==",
      "license": "MIT",
      "dependencies": {
        "humanize-ms": "^1.2.1"
      },
      "engines": {
        "node": ">= 8.0.0"
      }
    },
    "node_modules/array-flatten": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/array-flatten/-/array-flatten-1.1.1.tgz",
      "integrity": "sha512-PCVAQswWemu6UdxsDFFX/+gVeYqKAod3D3UVm91jHwynguOwAvYPhx8nNlM++NqRcK6CxxpUafjmhIdKiHibqg==",
      "license": "MIT"
    },
    "node_modules/asynckit": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/asynckit/-/asynckit-0.4.0.tgz",
      "integrity": "sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==",
      "license": "MIT"
    },
    "node_modules/axios": {
      "version": "1.13.2",
      "resolved": "https://registry.npmjs.org/axios/-/axios-1.13.2.tgz",
      "integrity": "sha512-VPk9ebNqPcy5lRGuSlKx752IlDatOjT9paPlm8A7yOuW2Fbvp4X3JznJtT4f0GzGLLiWE9W8onz51SqLYwzGaA==",
      "license": "MIT",
      "dependencies": {
        "follow-redirects": "^1.15.6",
        "form-data": "^4.0.4",
        "proxy-from-env": "^1.1.0"
      }
    },
    "node_modules/basic-auth": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/basic-auth/-/basic-auth-2.0.1.tgz",
      "integrity": "sha512-NF+epuEdnUYVlGuhaxbbq+dvJttwLnGY+YixlXlME5KpQ5W3CnXA5cVTneY3SPbPDRkcjMbifrwmFYcClgOZeg==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "5.1.2"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/basic-auth/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "license": "MIT"
    },
    "node_modules/body-parser": {
      "version": "1.20.3",
      "resolved": "https://registry.npmjs.org/body-parser/-/body-parser-1.20.3.tgz",
      "integrity": "sha512-7rAxByjUMqQ3/bHJy7D6OGXvx/MMc4IqBn/X0fcM1QUcAItpZrBEYhWGem+tzXH90c+G01ypMcYJBO9Y30203g==",
      "license": "MIT",
      "dependencies": {
        "bytes": "3.1.2",
        "content-type": "~1.0.5",
        "debug": "2.6.9",
        "depd": "2.0.0",
        "destroy": "1.2.0",
        "http-errors": "2.0.0",
        "iconv-lite": "0.4.24",
        "on-finished": "2.4.1",
        "qs": "6.13.0",
        "raw-body": "2.5.2",
        "type-is": "~1.6.18",
        "unpipe": "1.0.0"
      },
      "engines": {
        "node": ">= 0.8",
        "npm": "1.2.8000 || >= 1.4.16"
      }
    },
    "node_modules/bytes": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/bytes/-/bytes-3.1.2.tgz",
      "integrity": "sha512-/Nf7TyzTx6S3yRJObOAV7956r8cr2+Oj8AC5dt8wSP3BQAoeX58NoHyCU8P8zGkNXStjTSi6fzO6F0pBdcYbEg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/call-bound": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/call-bound/-/call-bound-1.0.4.tgz",
      "integrity": "sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "get-intrinsic": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/combined-stream": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/combined-stream/-/combined-stream-1.0.8.tgz",
      "integrity": "sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==",
      "license": "MIT",
      "dependencies": {
        "delayed-stream": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/compressible": {
      "version": "2.0.18",
      "resolved": "https://registry.npmjs.org/compressible/-/compressible-2.0.18.tgz",
      "integrity": "sha512-AF3r7P5dWxL8MxyITRMlORQNaOA2IkAFaTr4k7BUumjPtRpGDTZpl0Pb1XCO6JeDCBdp126Cgs9sMxqSjgYyRg==",
      "license": "MIT",
      "dependencies": {
        "mime-db": ">= 1.43.0 < 2"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/compression": {
      "version": "1.8.1",
      "resolved": "https://registry.npmjs.org/compression/-/compression-1.8.1.tgz",
      "integrity": "sha512-9mAqGPHLakhCLeNyxPkK4xVo746zQ/czLH1Ky+vkitMnWfWZps8r0qXuwhwizagCRttsL4lfG4pIOvaWLpAP0w==",
      "license": "MIT",
      "dependencies": {
        "bytes": "3.1.2",
        "compressible": "~2.0.18",
        "debug": "2.6.9",
        "negotiator": "~0.6.4",
        "on-headers": "~1.1.0",
        "safe-buffer": "5.2.1",
        "vary": "~1.1.2"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/compression/node_modules/negotiator": {
      "version": "0.6.4",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-0.6.4.tgz",
      "integrity": "sha512-myRT3DiWPHqho5PrJaIRyaMv2kgYf0mUVgBNOYMuCH5Ki1yEiQaf/ZJuQ62nvpc44wL5WDbTX7yGJi1Neevw8w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/content-disposition": {
      "version": "0.5.4",
      "resolved": "https://registry.npmjs.org/content-disposition/-/content-disposition-0.5.4.tgz",
      "integrity": "sha512-FveZTNuGw04cxlAiWbzi6zTAL/lhehaWbTtgluJh4/E95DqMwTmha3KZN1aAWA8cFIhHzMZUvLevkw5Rqk+tSQ==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "5.2.1"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/content-type": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/content-type/-/content-type-1.0.5.tgz",
      "integrity": "sha512-nTjqfcBFEipKdXCv4YDQWCfmcLZKm81ldF0pAopTvyrFGVbcR6P/VAAd5G7N+0tTr8QqiU0tFadD6FK4NtJwOA==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie": {
      "version": "0.7.1",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-0.7.1.tgz",
      "integrity": "sha512-6DnInpx7SJ2AK3+CTUE/ZM0vWTUboZCegxhC2xiIydHR9jNuTAASBrfEpHhiGOZw/nX51bHt6YQl8jsGo4y/0w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie-signature": {
      "version": "1.0.6",
      "resolved": "https://registry.npmjs.org/cookie-signature/-/cookie-signature-1.0.6.tgz",
      "integrity": "sha512-QADzlaHc8icV8I7vbaJXJwod9HWYp8uCqf1xa4OfNu1T7JVxQIrUgOWtHdNDtPiywmFbiS12VjotIXLrKM3orQ==",
      "license": "MIT"
    },
    "node_modules/cors": {
      "version": "2.8.5",
      "resolved": "https://registry.npmjs.org/cors/-/cors-2.8.5.tgz",
      "integrity": "sha512-KIHbLJqu73RGr/hnbrO9uBeixNGuvSQjul/jdFvS/KFSIH1hWVd1ng7zOHx+YrEfInLG7q4n6GHQ9cDtxv/P6g==",
      "license": "MIT",
      "dependencies": {
        "object-assign": "^4",
        "vary": "^1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/data-uri-to-buffer": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/data-uri-to-buffer/-/data-uri-to-buffer-4.0.1.tgz",
      "integrity": "sha512-0R9ikRb668HB7QDxT1vkpuUBtqc53YyAwMwGeUFKRojY/NWKvdZ+9UYtRfGmhqNbRkTSVpMbmyhXipFFv2cb/A==",
      "license": "MIT",
      "engines": {
        "node": ">= 12"
      }
    },
    "node_modules/debug": {
      "version": "2.6.9",
      "resolved": "https://registry.npmjs.org/debug/-/debug-2.6.9.tgz",
      "integrity": "sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==",
      "license": "MIT",
      "dependencies": {
        "ms": "2.0.0"
      }
    },
    "node_modules/delayed-stream": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/delayed-stream/-/delayed-stream-1.0.0.tgz",
      "integrity": "sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==",
      "license": "MIT",
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/depd": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/depd/-/depd-2.0.0.tgz",
      "integrity": "sha512-g7nH6P6dyDioJogAAGprGpCtVImJhpPk/roCzdb3fIh61/s/nPsfR6onyMwkCAR/OlC3yBC0lESvUoQEAssIrw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/destroy": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/destroy/-/destroy-1.2.0.tgz",
      "integrity": "sha512-2sJGJTaXIIaR1w4iJSNoN0hnMY7Gpc/n8D4qSCJw8QqFWXf7cuAgnEHxBpweaVcPevC2l3KpjYCx3NypQQgaJg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8",
        "npm": "1.2.8000 || >= 1.4.16"
      }
    },
    "node_modules/dotenv": {
      "version": "16.6.1",
      "resolved": "https://registry.npmjs.org/dotenv/-/dotenv-16.6.1.tgz",
      "integrity": "sha512-uBq4egWHTcTt33a72vpSG0z3HnPuIl6NqYcTrKEg2azoEyl2hpW0zqlxysq2pK9HlDIHyHyakeYaYnSAwd8bow==",
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://dotenvx.com"
      }
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/ee-first": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/ee-first/-/ee-first-1.1.1.tgz",
      "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==",
      "license": "MIT"
    },
    "node_modules/encodeurl": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-2.0.0.tgz",
      "integrity": "sha512-Q0n9HRi4m6JuGIV1eFlmvJB7ZEVxu93IrMyiMsGC0lrMJMWzRgx6WGquyfQgZVb31vhGgXnfmPNNXmxnOkRBrg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-set-tostringtag": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz",
      "integrity": "sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/escape-html": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/escape-html/-/escape-html-1.0.3.tgz",
      "integrity": "sha512-NiSupZ4OeuGwr68lGIeym/ksIZMJodUGOSCZ/FSnTxcrekbvqrgdUxlJOMpijaKZVjAJrWrGs/6Jy8OMuyj9ow==",
      "license": "MIT"
    },
    "node_modules/etag": {
      "version": "1.8.1",
      "resolved": "https://registry.npmjs.org/etag/-/etag-1.8.1.tgz",
      "integrity": "sha512-aIL5Fx7mawVa300al2BnEE4iNvo1qETxLrPI/o05L7z6go7fCw1J6EQmbK4FmJ2AS7kgVF/KEZWufBfdClMcPg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/event-target-shim": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/event-target-shim/-/event-target-shim-5.0.1.tgz",
      "integrity": "sha512-i/2XbnSz/uxRCU6+NdVJgKWDTM427+MqYbkQzD321DuCQJUqOuJKIA0IM2+W2xtYHdKOmZ4dR6fExsd4SXL+WQ==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/express": {
      "version": "4.21.2",
      "resolved": "https://registry.npmjs.org/express/-/express-4.21.2.tgz",
      "integrity": "sha512-28HqgMZAmih1Czt9ny7qr6ek2qddF4FclbMzwhCREB6OFfH+rXAnuNCwo1/wFvrtbgsQDb4kSbX9de9lFbrXnA==",
      "license": "MIT",
      "dependencies": {
        "accepts": "~1.3.8",
        "array-flatten": "1.1.1",
        "body-parser": "1.20.3",
        "content-disposition": "0.5.4",
        "content-type": "~1.0.4",
        "cookie": "0.7.1",
        "cookie-signature": "1.0.6",
        "debug": "2.6.9",
        "depd": "2.0.0",
        "encodeurl": "~2.0.0",
        "escape-html": "~1.0.3",
        "etag": "~1.8.1",
        "finalhandler": "1.3.1",
        "fresh": "0.5.2",
        "http-errors": "2.0.0",
        "merge-descriptors": "1.0.3",
        "methods": "~1.1.2",
        "on-finished": "2.4.1",
        "parseurl": "~1.3.3",
        "path-to-regexp": "0.1.12",
        "proxy-addr": "~2.0.7",
        "qs": "6.13.0",
        "range-parser": "~1.2.1",
        "safe-buffer": "5.2.1",
        "send": "0.19.0",
        "serve-static": "1.16.2",
        "setprototypeof": "1.2.0",
        "statuses": "2.0.1",
        "type-is": "~1.6.18",
        "utils-merge": "1.0.1",
        "vary": "~1.1.2"
      },
      "engines": {
        "node": ">= 0.10.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/express-rate-limit": {
      "version": "8.2.1",
      "resolved": "https://registry.npmjs.org/express-rate-limit/-/express-rate-limit-8.2.1.tgz",
      "integrity": "sha512-PCZEIEIxqwhzw4KF0n7QF4QqruVTcF73O5kFKUnGOyjbCCgizBBiFaYpd/fnBLUMPw/BWw9OsiN7GgrNYr7j6g==",
      "license": "MIT",
      "dependencies": {
        "ip-address": "10.0.1"
      },
      "engines": {
        "node": ">= 16"
      },
      "funding": {
        "url": "https://github.com/sponsors/express-rate-limit"
      },
      "peerDependencies": {
        "express": ">= 4.11"
      }
    },
    "node_modules/fetch-blob": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/fetch-blob/-/fetch-blob-3.2.0.tgz",
      "integrity": "sha512-7yAQpD2UMJzLi1Dqv7qFYnPbaPx7ZfFK6PiIxQ4PfkGPyNyl2Ugx+a/umUonmKqjhM4DnfbMvdX6otXq83soQQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/jimmywarting"
        },
        {
          "type": "paypal",
          "url": "https://paypal.me/jimmywarting"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "node-domexception": "^1.0.0",
        "web-streams-polyfill": "^3.0.3"
      },
      "engines": {
        "node": "^12.20 || >= 14.13"
      }
    },
    "node_modules/finalhandler": {
      "version": "1.3.1",
      "resolved": "https://registry.npmjs.org/finalhandler/-/finalhandler-1.3.1.tgz",
      "integrity": "sha512-6BN9trH7bp3qvnrRyzsBz+g3lZxTNZTbVO2EV1CS0WIcDbawYVdYvGflME/9QP0h0pYlCDBCTjYa9nZzMDpyxQ==",
      "license": "MIT",
      "dependencies": {
        "debug": "2.6.9",
        "encodeurl": "~2.0.0",
        "escape-html": "~1.0.3",
        "on-finished": "2.4.1",
        "parseurl": "~1.3.3",
        "statuses": "2.0.1",
        "unpipe": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/follow-redirects": {
      "version": "1.15.11",
      "resolved": "https://registry.npmjs.org/follow-redirects/-/follow-redirects-1.15.11.tgz",
      "integrity": "sha512-deG2P0JfjrTxl50XGCDyfI97ZGVCxIpfKYmfyrQ54n5FO/0gfIES8C/Psl6kWVDolizcaaxZJnTS0QSMxvnsBQ==",
      "funding": [
        {
          "type": "individual",
          "url": "https://github.com/sponsors/RubenVerborgh"
        }
      ],
      "license": "MIT",
      "engines": {
        "node": ">=4.0"
      },
      "peerDependenciesMeta": {
        "debug": {
          "optional": true
        }
      }
    },
    "node_modules/form-data": {
      "version": "4.0.5",
      "resolved": "https://registry.npmjs.org/form-data/-/form-data-4.0.5.tgz",
      "integrity": "sha512-8RipRLol37bNs2bhoV67fiTEvdTrbMUYcFTiy3+wuuOnUog2QBHCZWXDRijWQfAkhBj2Uf5UnVaiWwA5vdd82w==",
      "license": "MIT",
      "dependencies": {
        "asynckit": "^0.4.0",
        "combined-stream": "^1.0.8",
        "es-set-tostringtag": "^2.1.0",
        "hasown": "^2.0.2",
        "mime-types": "^2.1.12"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/form-data-encoder": {
      "version": "1.7.2",
      "resolved": "https://registry.npmjs.org/form-data-encoder/-/form-data-encoder-1.7.2.tgz",
      "integrity": "sha512-qfqtYan3rxrnCk1VYaA4H+Ms9xdpPqvLZa6xmMgFvhO32x7/3J/ExcTd6qpxM0vH2GdMI+poehyBZvqfMTto8A==",
      "license": "MIT"
    },
    "node_modules/formdata-node": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/formdata-node/-/formdata-node-4.4.1.tgz",
      "integrity": "sha512-0iirZp3uVDjVGt9p49aTaqjk84TrglENEDuqfdlZQ1roC9CWlPk6Avf8EEnZNcAqPonwkG35x4n3ww/1THYAeQ==",
      "license": "MIT",
      "dependencies": {
        "node-domexception": "1.0.0",
        "web-streams-polyfill": "4.0.0-beta.3"
      },
      "engines": {
        "node": ">= 12.20"
      }
    },
    "node_modules/formdata-node/node_modules/web-streams-polyfill": {
      "version": "4.0.0-beta.3",
      "resolved": "https://registry.npmjs.org/web-streams-polyfill/-/web-streams-polyfill-4.0.0-beta.3.tgz",
      "integrity": "sha512-QW95TCTaHmsYfHDybGMwO5IJIM93I/6vTRk+daHTWFPhwh+C8Cg7j7XyKrwrj8Ib6vYXe0ocYNrmzY4xAAN6ug==",
      "license": "MIT",
      "engines": {
        "node": ">= 14"
      }
    },
    "node_modules/formdata-polyfill": {
      "version": "4.0.10",
      "resolved": "https://registry.npmjs.org/formdata-polyfill/-/formdata-polyfill-4.0.10.tgz",
      "integrity": "sha512-buewHzMvYL29jdeQTVILecSaZKnt/RJWjoZCF5OW60Z67/GmSLBkOFM7qh1PI3zFNtJbaZL5eQu1vLfazOwj4g==",
      "license": "MIT",
      "dependencies": {
        "fetch-blob": "^3.1.2"
      },
      "engines": {
        "node": ">=12.20.0"
      }
    },
    "node_modules/forwarded": {
      "version": "0.2.0",
      "resolved": "https://registry.npmjs.org/forwarded/-/forwarded-0.2.0.tgz",
      "integrity": "sha512-buRG0fpBtRHSTCOASe6hD258tEubFoRLb4ZNA6NxMVHNw2gOcwHo9wyablzMzOA5z9xA9L1KNjk/Nt6MT9aYow==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/fresh": {
      "version": "0.5.2",
      "resolved": "https://registry.npmjs.org/fresh/-/fresh-0.5.2.tgz",
      "integrity": "sha512-zJ2mQYM18rEFOudeV4GShTGIQ7RbzA7ozbU9I/XBpm7kqgMywgmylMwXHxZJmkVoYkna9d2pVXVXPdYTP9ej8Q==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/groq-sdk": {
      "version": "0.5.0",
      "resolved": "https://registry.npmjs.org/groq-sdk/-/groq-sdk-0.5.0.tgz",
      "integrity": "sha512-RVmhW7qZ+XZoy5fIuSdx/LGQJONpL8MHgZEW7dFwTdgkzStub2XQx6OKv28CHogijdwH41J+Npj/z2jBPu3vmw==",
      "license": "Apache-2.0",
      "dependencies": {
        "@types/node": "^18.11.18",
        "@types/node-fetch": "^2.6.4",
        "abort-controller": "^3.0.0",
        "agentkeepalive": "^4.2.1",
        "form-data-encoder": "1.7.2",
        "formdata-node": "^4.3.2",
        "node-fetch": "^2.6.7",
        "web-streams-polyfill": "^3.2.1"
      }
    },
    "node_modules/groq-sdk/node_modules/@types/node": {
      "version": "18.19.130",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-18.19.130.tgz",
      "integrity": "sha512-GRaXQx6jGfL8sKfaIDD6OupbIHBr9jv7Jnaml9tB7l4v068PAOXqfcujMMo5PhbIs6ggR1XODELqahT2R8v0fg==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~5.26.4"
      }
    },
    "node_modules/groq-sdk/node_modules/node-fetch": {
      "version": "2.7.0",
      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-2.7.0.tgz",
      "integrity": "sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==",
      "license": "MIT",
      "dependencies": {
        "whatwg-url": "^5.0.0"
      },
      "engines": {
        "node": "4.x || >=6.0.0"
      },
      "peerDependencies": {
        "encoding": "^0.1.0"
      },
      "peerDependenciesMeta": {
        "encoding": {
          "optional": true
        }
      }
    },
    "node_modules/groq-sdk/node_modules/undici-types": {
      "version": "5.26.5",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-5.26.5.tgz",
      "integrity": "sha512-JlCMO+ehdEIKqlFxk6IfVoAUVmgz7cU7zD/h9XZ0qzeosSHmUJVOzSQvvYSYWXkFXC+IfLKSIffhv0sVZup6pA==",
      "license": "MIT"
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-tostringtag": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz",
      "integrity": "sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==",
      "license": "MIT",
      "dependencies": {
        "has-symbols": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "license": "MIT",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/helmet": {
      "version": "8.1.0",
      "resolved": "https://registry.npmjs.org/helmet/-/helmet-8.1.0.tgz",
      "integrity": "sha512-jOiHyAZsmnr8LqoPGmCjYAaiuWwjAPLgY8ZX2XrmHawt99/u1y6RgrZMTeoPfpUbV96HOalYgz1qzkRbw54Pmg==",
      "license": "MIT",
      "engines": {
        "node": ">=18.0.0"
      }
    },
    "node_modules/http-errors": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.0.tgz",
      "integrity": "sha512-FtwrG/euBzaEjYeRqOgly7G0qviiXoJWnvEH2Z1plBdXgbyjv34pHTSb9zoeHMyDy33+DWy5Wt9Wo+TURtOYSQ==",
      "license": "MIT",
      "dependencies": {
        "depd": "2.0.0",
        "inherits": "2.0.4",
        "setprototypeof": "1.2.0",
        "statuses": "2.0.1",
        "toidentifier": "1.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/humanize-ms": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/humanize-ms/-/humanize-ms-1.2.1.tgz",
      "integrity": "sha512-Fl70vYtsAFb/C06PTS9dZBo7ihau+Tu/DNCk/OyHhea07S+aeMWpFFkUaXRa8fI+ScZbEI8dfSxwY7gxZ9SAVQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.0.0"
      }
    },
    "node_modules/iconv-lite": {
      "version": "0.4.24",
      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.4.24.tgz",
      "integrity": "sha512-v3MXnZAcvnywkTUEZomIActle7RXXeedOR31wwl7VlyoXO4Qi9arvSenNQWne1TcRwhCL1HwLI21bEqdpj8/rA==",
      "license": "MIT",
      "dependencies": {
        "safer-buffer": ">= 2.1.2 < 3"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/inherits": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",
      "integrity": "sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==",
      "license": "ISC"
    },
    "node_modules/ip-address": {
      "version": "10.0.1",
      "resolved": "https://registry.npmjs.org/ip-address/-/ip-address-10.0.1.tgz",
      "integrity": "sha512-NWv9YLW4PoW2B7xtzaS3NCot75m6nK7Icdv0o3lfMceJVRfSoQwqD4wEH5rLwoKJwUiZ/rfpiVBhnaF0FK4HoA==",
      "license": "MIT",
      "engines": {
        "node": ">= 12"
      }
    },
    "node_modules/ipaddr.js": {
      "version": "1.9.1",
      "resolved": "https://registry.npmjs.org/ipaddr.js/-/ipaddr.js-1.9.1.tgz",
      "integrity": "sha512-0KI/607xoxSToH7GjN1FfSbLoU0+btTicjsQSWQlh/hZykN8KpmMf7uYwPW3R+akZ6R/w18ZlXSHBYXiYUPO3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/m3u8stream": {
      "version": "0.8.6",
      "resolved": "https://registry.npmjs.org/m3u8stream/-/m3u8stream-0.8.6.tgz",
      "integrity": "sha512-LZj8kIVf9KCphiHmH7sbFQTVe4tOemb202fWwvJwR9W5ENW/1hxJN6ksAWGhQgSBSa3jyWhnjKU1Fw1GaOdbyA==",
      "license": "MIT",
      "dependencies": {
        "miniget": "^4.2.2",
        "sax": "^1.2.4"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/media-typer": {
      "version": "0.3.0",
      "resolved": "https://registry.npmjs.org/media-typer/-/media-typer-0.3.0.tgz",
      "integrity": "sha512-dq+qelQ9akHpcOl/gUVRTxVIOkAJ1wR3QAvb4RsVjS8oVoFjDGTc679wJYmUmknUF5HwMLOgb5O+a3KxfWapPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/merge-descriptors": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-1.0.3.tgz",
      "integrity": "sha512-gaNvAS7TZ897/rVaZ0nMtAyxNyi/pdbjbAwUpFQpN70GqnVfOiXpeUUMKRBmzXaSQ8DdTX4/0ms62r2K+hE6mQ==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/methods": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/methods/-/methods-1.1.2.tgz",
      "integrity": "sha512-iclAHeNqNm68zFtnZ0e+1L2yUIdvzNoauKU4WBA3VvH/vPFieF7qfRlwUZU+DA9P9bPXIS90ulxoUoCH23sV2w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime": {
      "version": "1.6.0",
      "resolved": "https://registry.npmjs.org/mime/-/mime-1.6.0.tgz",
      "integrity": "sha512-x0Vn8spI+wuJ1O6S7gnbaQg8Pxh4NNHb7KSINmEWKiPE4RKOplvijn+NkmYmmRgP68mc70j2EbeTFRsrswaQeg==",
      "license": "MIT",
      "bin": {
        "mime": "cli.js"
      },
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/miniget": {
      "version": "4.2.3",
      "resolved": "https://registry.npmjs.org/miniget/-/miniget-4.2.3.tgz",
      "integrity": "sha512-SjbDPDICJ1zT+ZvQwK0hUcRY4wxlhhNpHL9nJOB2MEAXRGagTljsO8MEDzQMTFf0Q8g4QNi8P9lEm/g7e+qgzA==",
      "license": "MIT",
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/morgan": {
      "version": "1.10.1",
      "resolved": "https://registry.npmjs.org/morgan/-/morgan-1.10.1.tgz",
      "integrity": "sha512-223dMRJtI/l25dJKWpgij2cMtywuG/WiUKXdvwfbhGKBhy1puASqXwFzmWZ7+K73vUPoR7SS2Qz2cI/g9MKw0A==",
      "license": "MIT",
      "dependencies": {
        "basic-auth": "~2.0.1",
        "debug": "2.6.9",
        "depd": "~2.0.0",
        "on-finished": "~2.3.0",
        "on-headers": "~1.1.0"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/morgan/node_modules/on-finished": {
      "version": "2.3.0",
      "resolved": "https://registry.npmjs.org/on-finished/-/on-finished-2.3.0.tgz",
      "integrity": "sha512-ikqdkGAAyf/X/gPhXGvfgAytDZtDbr+bkNUJ0N9h5MI/dmdgCs3l6hoHrcUv41sRKew3jIwrp4qQDXiK99Utww==",
      "license": "MIT",
      "dependencies": {
        "ee-first": "1.1.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/ms": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.0.0.tgz",
      "integrity": "sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==",
      "license": "MIT"
    },
    "node_modules/negotiator": {
      "version": "0.6.3",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-0.6.3.tgz",
      "integrity": "sha512-+EUsqGPLsM+j/zdChZjsnX51g4XrHFOIXwfnCVPGlQk/k5giakcKsuxCObBRu6DSm9opw/O6slWbJdghQM4bBg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/node-domexception": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/node-domexception/-/node-domexception-1.0.0.tgz",
      "integrity": "sha512-/jKZoMpw0F8GRwl4/eLROPA3cfcXtLApP0QzLmUT/HuPCZWyB7IY9ZrMeKw2O/nFIqPQB3PVM9aYm0F312AXDQ==",
      "deprecated": "Use your platform's native DOMException instead",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/jimmywarting"
        },
        {
          "type": "github",
          "url": "https://paypal.me/jimmywarting"
        }
      ],
      "license": "MIT",
      "engines": {
        "node": ">=10.5.0"
      }
    },
    "node_modules/node-fetch": {
      "version": "3.3.2",
      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-3.3.2.tgz",
      "integrity": "sha512-dRB78srN/l6gqWulah9SrxeYnxeddIG30+GOqK/9OlLVyLg3HPnr6SqOWTWOXKRwC2eGYCkZ59NNuSgvSrpgOA==",
      "license": "MIT",
      "dependencies": {
        "data-uri-to-buffer": "^4.0.0",
        "fetch-blob": "^3.1.4",
        "formdata-polyfill": "^4.0.10"
      },
      "engines": {
        "node": "^12.20.0 || ^14.13.1 || >=16.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/node-fetch"
      }
    },
    "node_modules/object-assign": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
      "integrity": "sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/object-inspect": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/object-inspect/-/object-inspect-1.13.4.tgz",
      "integrity": "sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/on-finished": {
      "version": "2.4.1",
      "resolved": "https://registry.npmjs.org/on-finished/-/on-finished-2.4.1.tgz",
      "integrity": "sha512-oVlzkg3ENAhCk2zdv7IJwd/QUD4z2RxRwpkcGY8psCVcCYZNq4wYnVWALHM+brtuJjePWiYF/ClmuDr8Ch5+kg==",
      "license": "MIT",
      "dependencies": {
        "ee-first": "1.1.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/on-headers": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/on-headers/-/on-headers-1.1.0.tgz",
      "integrity": "sha512-737ZY3yNnXy37FHkQxPzt4UZ2UWPWiCZWLvFZ4fu5cueciegX0zGPnrlY6bwRg4FdQOe9YU8MkmJwGhoMybl8A==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/openai": {
      "version": "4.104.0",
      "resolved": "https://registry.npmjs.org/openai/-/openai-4.104.0.tgz",
      "integrity": "sha512-p99EFNsA/yX6UhVO93f5kJsDRLAg+CTA2RBqdHK4RtK8u5IJw32Hyb2dTGKbnnFmnuoBv5r7Z2CURI9sGZpSuA==",
      "license": "Apache-2.0",
      "dependencies": {
        "@types/node": "^18.11.18",
        "@types/node-fetch": "^2.6.4",
        "abort-controller": "^3.0.0",
        "agentkeepalive": "^4.2.1",
        "form-data-encoder": "1.7.2",
        "formdata-node": "^4.3.2",
        "node-fetch": "^2.6.7"
      },
      "bin": {
        "openai": "bin/cli"
      },
      "peerDependencies": {
        "ws": "^8.18.0",
        "zod": "^3.23.8"
      },
      "peerDependenciesMeta": {
        "ws": {
          "optional": true
        },
        "zod": {
          "optional": true
        }
      }
    },
    "node_modules/openai/node_modules/@types/node": {
      "version": "18.19.130",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-18.19.130.tgz",
      "integrity": "sha512-GRaXQx6jGfL8sKfaIDD6OupbIHBr9jv7Jnaml9tB7l4v068PAOXqfcujMMo5PhbIs6ggR1XODELqahT2R8v0fg==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~5.26.4"
      }
    },
    "node_modules/openai/node_modules/node-fetch": {
      "version": "2.7.0",
      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-2.7.0.tgz",
      "integrity": "sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==",
      "license": "MIT",
      "dependencies": {
        "whatwg-url": "^5.0.0"
      },
      "engines": {
        "node": "4.x || >=6.0.0"
      },
      "peerDependencies": {
        "encoding": "^0.1.0"
      },
      "peerDependenciesMeta": {
        "encoding": {
          "optional": true
        }
      }
    },
    "node_modules/openai/node_modules/undici-types": {
      "version": "5.26.5",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-5.26.5.tgz",
      "integrity": "sha512-JlCMO+ehdEIKqlFxk6IfVoAUVmgz7cU7zD/h9XZ0qzeosSHmUJVOzSQvvYSYWXkFXC+IfLKSIffhv0sVZup6pA==",
      "license": "MIT"
    },
    "node_modules/p-limit": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-4.0.0.tgz",
      "integrity": "sha512-5b0R4txpzjPWVw/cXXUResoD4hb6U/x9BH08L7nw+GN1sezDzPdxeRvpc9c433fZhBan/wusjbCsqwqm4EIBIQ==",
      "license": "MIT",
      "dependencies": {
        "yocto-queue": "^1.0.0"
      },
      "engines": {
        "node": "^12.20.0 || ^14.13.1 || >=16.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/parseurl": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/parseurl/-/parseurl-1.3.3.tgz",
      "integrity": "sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/path-to-regexp": {
      "version": "0.1.12",
      "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-0.1.12.tgz",
      "integrity": "sha512-RA1GjUVMnvYFxuqovrEqZoxxW5NUZqbwKtYz/Tt7nXerk0LbLblQmrsgdeOxV5SFHf0UDggjS/bSeOZwt1pmEQ==",
      "license": "MIT"
    },
    "node_modules/proxy-addr": {
      "version": "2.0.7",
      "resolved": "https://registry.npmjs.org/proxy-addr/-/proxy-addr-2.0.7.tgz",
      "integrity": "sha512-llQsMLSUDUPT44jdrU/O37qlnifitDP+ZwrmmZcoSKyLKvtZxpyV0n2/bD/N4tBAAZ/gJEdZU7KMraoK1+XYAg==",
      "license": "MIT",
      "dependencies": {
        "forwarded": "0.2.0",
        "ipaddr.js": "1.9.1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/proxy-from-env": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/proxy-from-env/-/proxy-from-env-1.1.0.tgz",
      "integrity": "sha512-D+zkORCbA9f1tdWRK0RaCR3GPv50cMxcrz4X8k5LTSUD1Dkw47mKJEZQNunItRTkWwgtaUSo1RVFRIG9ZXiFYg==",
      "license": "MIT"
    },
    "node_modules/qs": {
      "version": "6.13.0",
      "resolved": "https://registry.npmjs.org/qs/-/qs-6.13.0.tgz",
      "integrity": "sha512-+38qI9SOr8tfZ4QmJNplMUxqjbe7LKvvZgWdExBOmd+egZTtjLB67Gu0HRX3u/XOq7UU2Nx6nsjvS16Z9uwfpg==",
      "license": "BSD-3-Clause",
      "dependencies": {
        "side-channel": "^1.0.6"
      },
      "engines": {
        "node": ">=0.6"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/range-parser": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/range-parser/-/range-parser-1.2.1.tgz",
      "integrity": "sha512-Hrgsx+orqoygnmhFbKaHE6c296J+HTAQXoxEF6gNupROmmGJRoyzfG3ccAveqCBrwr/2yxQ5BVd/GTl5agOwSg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/raw-body": {
      "version": "2.5.2",
      "resolved": "https://registry.npmjs.org/raw-body/-/raw-body-2.5.2.tgz",
      "integrity": "sha512-8zGqypfENjCIqGhgXToC8aB2r7YrBX+AQAfIPs/Mlk+BtPTztOvTS01NRW/3Eh60J+a48lt8qsCzirQ6loCVfA==",
      "license": "MIT",
      "dependencies": {
        "bytes": "3.1.2",
        "http-errors": "2.0.0",
        "iconv-lite": "0.4.24",
        "unpipe": "1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/safe-buffer": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.1.tgz",
      "integrity": "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/safer-buffer": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/safer-buffer/-/safer-buffer-2.1.2.tgz",
      "integrity": "sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==",
      "license": "MIT"
    },
    "node_modules/sax": {
      "version": "1.4.3",
      "resolved": "https://registry.npmjs.org/sax/-/sax-1.4.3.tgz",
      "integrity": "sha512-yqYn1JhPczigF94DMS+shiDMjDowYO6y9+wB/4WgO0Y19jWYk0lQ4tuG5KI7kj4FTp1wxPj5IFfcrz/s1c3jjQ==",
      "license": "BlueOak-1.0.0"
    },
    "node_modules/send": {
      "version": "0.19.0",
      "resolved": "https://registry.npmjs.org/send/-/send-0.19.0.tgz",
      "integrity": "sha512-dW41u5VfLXu8SJh5bwRmyYUbAoSB3c9uQh6L8h/KtsFREPWpbX1lrljJo186Jc4nmci/sGUZ9a0a0J2zgfq2hw==",
      "license": "MIT",
      "dependencies": {
        "debug": "2.6.9",
        "depd": "2.0.0",
        "destroy": "1.2.0",
        "encodeurl": "~1.0.2",
        "escape-html": "~1.0.3",
        "etag": "~1.8.1",
        "fresh": "0.5.2",
        "http-errors": "2.0.0",
        "mime": "1.6.0",
        "ms": "2.1.3",
        "on-finished": "2.4.1",
        "range-parser": "~1.2.1",
        "statuses": "2.0.1"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/send/node_modules/encodeurl": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-1.0.2.tgz",
      "integrity": "sha512-TPJXq8JqFaVYm2CWmPvnP2Iyo4ZSM7/QKcSmuMLDObfpH5fi7RUGmd/rTDf+rut/saiDiQEeVTNgAmJEdAOx0w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/send/node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "license": "MIT"
    },
    "node_modules/serve-static": {
      "version": "1.16.2",
      "resolved": "https://registry.npmjs.org/serve-static/-/serve-static-1.16.2.tgz",
      "integrity": "sha512-VqpjJZKadQB/PEbEwvFdO43Ax5dFBZ2UECszz8bQ7pi7wt//PWe1P6MN7eCnjsatYtBT6EuiClbjSWP2WrIoTw==",
      "license": "MIT",
      "dependencies": {
        "encodeurl": "~2.0.0",
        "escape-html": "~1.0.3",
        "parseurl": "~1.3.3",
        "send": "0.19.0"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/setprototypeof": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/setprototypeof/-/setprototypeof-1.2.0.tgz",
      "integrity": "sha512-E5LDX7Wrp85Kil5bhZv46j8jOeboKq5JMmYM3gVGdGH8xFpPWXUMsNrlODCrkoxMEeNi/XZIwuRvY4XNwYMJpw==",
      "license": "ISC"
    },
    "node_modules/side-channel": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/side-channel/-/side-channel-1.1.0.tgz",
      "integrity": "sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3",
        "side-channel-list": "^1.0.0",
        "side-channel-map": "^1.0.1",
        "side-channel-weakmap": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-list": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/side-channel-list/-/side-channel-list-1.0.0.tgz",
      "integrity": "sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-map": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/side-channel-map/-/side-channel-map-1.0.1.tgz",
      "integrity": "sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-weakmap": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/side-channel-weakmap/-/side-channel-weakmap-1.0.2.tgz",
      "integrity": "sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3",
        "side-channel-map": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/statuses": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/statuses/-/statuses-2.0.1.tgz",
      "integrity": "sha512-RwNA9Z/7PrK06rYLIzFMlaF+l73iwpzsqRIFgbMLbTcLD6cOao82TaWefPXQvB2fOC4AjuYSEndS7N/mTCbkdQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/toidentifier": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",
      "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",
      "license": "MIT",
      "engines": {
        "node": ">=0.6"
      }
    },
    "node_modules/tr46": {
      "version": "0.0.3",
      "resolved": "https://registry.npmjs.org/tr46/-/tr46-0.0.3.tgz",
      "integrity": "sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==",
      "license": "MIT"
    },
    "node_modules/type-is": {
      "version": "1.6.18",
      "resolved": "https://registry.npmjs.org/type-is/-/type-is-1.6.18.tgz",
      "integrity": "sha512-TkRKr9sUTxEH8MdfuCSP7VizJyzRNMjj2J2do2Jr3Kym598JVdEksuzPQCnlFPW4ky9Q+iA+ma9BGm06XQBy8g==",
      "license": "MIT",
      "dependencies": {
        "media-typer": "0.3.0",
        "mime-types": "~2.1.24"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/undici-types": {
      "version": "7.16.0",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-7.16.0.tgz",
      "integrity": "sha512-Zz+aZWSj8LE6zoxD+xrjh4VfkIG8Ya6LvYkZqtUQGJPZjYl53ypCaUwWqo7eI0x66KBGeRo+mlBEkMSeSZ38Nw==",
      "license": "MIT"
    },
    "node_modules/unpipe": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",
      "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/utils-merge": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/utils-merge/-/utils-merge-1.0.1.tgz",
      "integrity": "sha512-pMZTvIkT1d+TFGvDOqodOclx0QWkkgi6Tdoa8gC8ffGAAqz9pzPTZWAybbsHHoED/ztMtkv/VoYTYyShUn81hA==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4.0"
      }
    },
    "node_modules/vary": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",
      "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/web-streams-polyfill": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/web-streams-polyfill/-/web-streams-polyfill-3.3.3.tgz",
      "integrity": "sha512-d2JWLCivmZYTSIoge9MsgFCZrt571BikcWGYkjC1khllbTeDlGqZ2D8vD8E/lJa8WGWbb7Plm8/XJYV7IJHZZw==",
      "license": "MIT",
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/webidl-conversions": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/webidl-conversions/-/webidl-conversions-3.0.1.tgz",
      "integrity": "sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==",
      "license": "BSD-2-Clause"
    },
    "node_modules/whatwg-url": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/whatwg-url/-/whatwg-url-5.0.0.tgz",
      "integrity": "sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==",
      "license": "MIT",
      "dependencies": {
        "tr46": "~0.0.3",
        "webidl-conversions": "^3.0.0"
      }
    },
    "node_modules/yocto-queue": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-1.2.2.tgz",
      "integrity": "sha512-4LCcse/U2MHZ63HAJVE+v71o7yOdIe4cZ70Wpf8D/IyjDKYQLV5GD46B+hSTjJsvV5PztjvHoU580EftxjDZFQ==",
      "license": "MIT",
      "engines": {
        "node": ">=12.20"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/ytdl-core": {
      "version": "4.11.5",
      "resolved": "https://registry.npmjs.org/ytdl-core/-/ytdl-core-4.11.5.tgz",
      "integrity": "sha512-27LwsW4n4nyNviRCO1hmr8Wr5J1wLLMawHCQvH8Fk0hiRqrxuIu028WzbJetiYH28K8XDbeinYW4/wcHQD1EXA==",
      "license": "MIT",
      "dependencies": {
        "m3u8stream": "^0.8.6",
        "miniget": "^4.2.2",
        "sax": "^1.1.3"
      },
      "engines": {
        "node": ">=12"
      }
    }
  }
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\package.json
// ==================================================

{
  "name": "zen-youtube-coach-pro-backend",
  "version": "1.0.0",
  "description": "Backend Ultra-Premium 2025 per Zen YouTube Coach Pro",
  "type": "module",
  "main": "src/index.js",
  "scripts": {
    "start": "node src/index.js",
    "dev": "nodemon src/index.js",
    "health": "node src/health-check.js"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "compression": "^1.7.4",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.19.2",
    "express-rate-limit": "^8.2.1",
    "form-data": "^4.0.5",
    "groq-sdk": "^0.5.0",
    "helmet": "^8.1.0",
    "morgan": "^1.10.1",
    "node-fetch": "^3.3.2",
    "openai": "^4.26.1",
    "p-limit": "^4.0.0",
    "ytdl-core": "^4.11.5"
  },
  "engines": {
    "node": ">=18.x"
  },
  "author": "Chry",
  "license": "ISC"
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\Zen-Youtube-Coach-Pro.postman_collection.json
// ==================================================

{
  "info": {
    "name": "Zen YouTube Coach Pro",
    "_postman_id": "b7af9a24-8a91-4bf6-96e8-zen-coach-pro",
    "description": "Collezione ufficiale per testare tutte le API del backend Zen YouTube Coach Pro.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Test Server",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "http://localhost:3000/",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": [""]
        }
      }
    },
    {
      "name": "/analyze  Singolo video",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"id\": \"VIDEO_ID\",\n  \"title\": \"Titolo del video\",\n  \"description\": \"Descrizione...\",\n  \"thumbnail\": \"https://...\",\n  \"views\": 12345,\n  \"likes\": 345,\n  \"comments\": 67\n}"
        },
        "url": {
          "raw": "http://localhost:3000/analyze",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["analyze"]
        }
      }
    },
    {
      "name": "/compare  Confronto video",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"videos\": [\n    { \"id\": \"AAA\", \"title\": \"Video 1\", \"views\": 1000 },\n    { \"id\": \"BBB\", \"title\": \"Video 2\", \"views\": 3000 }\n  ]\n}"
        },
        "url": {
          "raw": "http://localhost:3000/compare",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["compare"]
        }
      }
    },
    {
      "name": "/pattern  Pattern generale da 5 video",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"videos\": [\n    { \"title\": \"Video 1\", \"description\": \"...\" },\n    { \"title\": \"Video 2\", \"description\": \"...\" },\n    { \"title\": \"Video 3\", \"description\": \"...\" },\n    { \"title\": \"Video 4\", \"description\": \"...\" },\n    { \"title\": \"Video 5\", \"description\": \"...\" }\n  ]\n}"
        },
        "url": {
          "raw": "http://localhost:3000/pattern",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["pattern"]
        }
      }
    },
    {
      "name": "/pattern/zen  Pattern adattato al tuo canale",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"pattern\": { \"patternSummary\": \"...\", \"idealVideoBlueprint\": {} }\n}"
        },
        "url": {
          "raw": "http://localhost:3000/pattern/zen",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["pattern", "zen"]
        }
      }
    },
    {
      "name": "/pattern/suggest-next-video  Generatore video automatico",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"zenPattern\": { \"zenPatternSummary\": \"...\", \"zenIdealVideoBlueprint\": {} }\n}"
        },
        "url": {
          "raw": "http://localhost:3000/pattern/suggest-next-video",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["pattern", "suggest-next-video"]
        }
      }
    },
    {
      "name": "/trend-scan  Scansione trend competitor",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"channels\": [\n    \"https://www.youtube.com/@ViviVitale\",\n    \"https://www.youtube.com/@BenessereSegreto\"\n  ]\n}"
        },
        "url": {
          "raw": "http://localhost:3000/trend-scan",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["trend-scan"]
        }
      }
    }
  ]
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\config\db.js
// ==================================================

import { createClient } from "@supabase/supabase-js";

export const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_KEY
);


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\config\openai.js
// ==================================================

export const OPENAI_API_KEY = process.env.OPENAI_API_KEY;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\config\youtube.js
// ==================================================

export const YOUTUBE_API_KEY = process.env.YOUTUBE_API_KEY;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\data\channelProfiles.json
// ==================================================

[
  {
    "handle": "@ZenSaluteBenessere",
    "channelName": "Zen Salute e Benessere",
    "niche": "Alimentazione sana, movimento, prevenzione, benessere over 50/60/70",
    "targetAges": ["Over 50", "Over 60", "Over 70"],
    "toneOfVoice": "Calmo, rassicurante, empatico, autorevole ma semplice",
    "psychologyDrivers": ["Fiducia", "Prevenzione", "Serenit", "Autonomia", "Longevit"],
    "contentPillars": [
      "Alimentazione anti-infiammazione",
      "Rimedi naturali validati",
      "Mobilit e movimento leggero",
      "Cuore, sonno, articolazioni",
      "Longevit e vita attiva"
    ]
  }
]


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\index.js
// ==================================================

// =====================================================================
//   src/index.js  Zen YouTube Coach Pro (Ultra-Premium Edition)
//  Backend Entry Point: routing, middlewares, logging, error handling
// =====================================================================

import express from "express";
import cors from "cors";
import dotenv from "dotenv";

dotenv.config();

// -----------------------------
//  Import Router Modules
// -----------------------------
import healthRouter from "./routes/health.js";
import transcriptRouter from "./routes/transcript.js";
import analyzeRouter from "./routes/analyze.js";
import analyzerProRouter from "./routes/analyzer-pro.js";
import compareTranscriptRouter from "./routes/compare-transcript.js";
import compareVideosRouter from "./routes/compare-videos.js";
import trendDeepSearchRouter from "./routes/trend-deepsearch.js";
import outlierEngineRouter from "./routes/outlier-engine.js";

// -----------------------------
//  App Setup
// -----------------------------
const app = express();
const PORT = process.env.PORT || 4000;
const NODE_ENV = process.env.NODE_ENV || "development";

// -----------------------------
//  Global Middlewares
// -----------------------------
app.use(
  cors({
    origin: "*",
    methods: ["GET", "POST", "OPTIONS"],
    allowedHeaders: ["Content-Type", "Authorization"],
  })
);

app.use(express.json({ limit: "5mb" }));

//  Logger avanzato
app.use((req, res, next) => {
  console.log(
    `[${new Date().toISOString()}] ${req.method} ${req.originalUrl}`
  );
  next();
});

// -----------------------------
//  Root Endpoint
// -----------------------------
app.get("/", (req, res) => {
  res.json({
    status: "OK",
    timestamp: new Date().toISOString(),
    uptime_seconds: process.uptime(),
    app: "Zen YouTube Coach Pro",
    version: "Ultra-Premium 2025",
    environment: NODE_ENV,
    node: process.version,
  });
});

// -----------------------------
//  Mount Primary Routers
// -----------------------------
app.use("/health", healthRouter);                     //  Health Check
app.use("/transcript", transcriptRouter);             //  Transcript Engine
app.use("/analyze", analyzeRouter);                   //  Analyze Classic
app.use("/analyzer-pro", analyzerProRouter);          //  Analyzer Pro
app.use("/compare-transcript", compareTranscriptRouter); //  Compare Transcript
app.use("/compare-videos", compareVideosRouter);      //  Compare Video Assets
app.use("/trend-deepsearch", trendDeepSearchRouter);  //  Trend Intelligence DeepSearch

//  NEW  OUTLIER ANALYZER ULTRA PREMIUM
app.use("/outlier-engine", outlierEngineRouter);

// -----------------------------
//  404 Handler
// -----------------------------
app.use((req, res) => {
  res.status(404).json({
    error: true,
    message: `Endpoint non trovato: ${req.originalUrl}`,
  });
});

// -----------------------------
//  Global Error Handler
// -----------------------------
app.use((err, req, res, next) => {
  console.error(" Errore Interno Server:", err);

  res.status(500).json({
    error: true,
    message: "Errore interno del server",
    details: NODE_ENV === "development" ? err.message : undefined,
  });
});

// -----------------------------
//  Start Server
// -----------------------------
app.listen(PORT, () => {
  console.log(` Zen YouTube Coach Pro attivo su http://localhost:${PORT}`);
});

export default app;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\node_modules\.package-lock.json
// ==================================================

{
  "name": "src",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {}
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\package-lock.json
// ==================================================

{
  "name": "src",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {}
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\ROUTES_MAP.json
// ==================================================

{
  "app": "Zen YouTube Coach Pro",
  "version": "3.0",
  "description": "Mappa completa delle API del backend (modello Enterprise).",
  "routes": [
    {
      "route": "/transcript",
      "method": "POST",
      "task": "Transcript Extraction",
      "body": {
        "videoUrl": "https://youtu.be/XXXXXXXXXXX"
      },
      "returns": ["text", "segments", "provider"]
    },

    {
      "route": "/video-info",
      "method": "POST",
      "task": "Video Metadata Extraction",
      "body": { "videoUrl": "..." },
      "returns": ["title", "description", "durationSec", "thumbnailHD", "tags"]
    },

    {
      "route": "/analyze-transcript",
      "method": "POST",
      "task": "Transcript Analysis",
      "aiTask": "analyze-transcript",
      "body": {
        "transcript": "string",
        "audience": "over60",
        "forceProvider": "auto"
      },
      "returns": [
        "diagnosiGenerale",
        "hookSuggeriti",
        "titleIdeas",
        "strutturaNarrativa",
        "thumbnailConcepts"
      ]
    },

    {
      "route": "/compare-transcript",
      "method": "POST",
      "task": "Transcript Comparison",
      "aiTask": "compare-videos",
      "body": {
        "videoA": { "transcript": "..." },
        "videoB": { "transcript": "..." }
      },
      "returns": [
        "vincitoreGenerale",
        "confrontoHook",
        "confrontoStrutturaNarrativa",
        "ideeHookIbrido"
      ]
    },

    {
      "route": "/compare-videos",
      "method": "POST",
      "task": "Video-to-Video Analysis",
      "aiTask": "compare-videos",
      "body": {
        "videoA": { "title": "..." },
        "videoB": { "title": "..." }
      },
      "returns": [
        "vincitoreGenerale",
        "dettaglioTitolo",
        "dettaglioThumbnail",
        "ideaTitoloIbrido"
      ]
    },

    {
      "route": "/trend-scan",
      "method": "POST",
      "task": "Trend Generator",
      "aiTask": "trend-scan",
      "body": {
        "niche": "salute e benessere",
        "audience": "over60"
      },
      "returns": [
        "trendPrincipali",
        "ideeVideo",
        "angoliPNL"
      ]
    },

    {
      "route": "/trend-deepsearch",
      "method": "POST",
      "task": "Trend Deep Analysis",
      "aiTask": "trend-deepsearch",
      "returns": [
        "trendEmergenti",
        "mapCompetitor",
        "gapDiMercato",
        "videoConsigliati"
      ]
    },

    {
      "route": "/title-opt",
      "method": "POST",
      "task": "Title Optimization",
      "aiTask": "title-opt",
      "returns": ["varianti", "versioneMigliore"]
    },

    {
      "route": "/thumbnail-ideas",
      "method": "POST",
      "task": "Thumbnail Concepts Generator",
      "aiTask": "thumbnail-opt",
      "returns": ["testiSovraimpressi", "visualConcepts", "psicologia"]
    },

    {
      "route": "/retention-analyze",
      "method": "POST",
      "task": "Retention Analyzer",
      "aiTask": "retention",
      "returns": ["puntiCritici", "momentiForti", "riscrittureSuggerite"]
    },

    {
      "route": "/script-from-video",
      "method": "POST",
      "task": "Video to Script Transformation",
      "aiTask": "script-drafting",
      "returns": ["hook", "script", "sezioni", "cta"]
    },

    {
      "route": "/video-summary",
      "method": "POST",
      "task": "Video Summary",
      "aiTask": "summary",
      "returns": ["riassunto", "puntiChiave", "takeaway"]
    },

    {
      "route": "/hook-generator",
      "method": "POST",
      "task": "Hook Generator",
      "aiTask": "hook",
      "returns": ["hooks"]
    },

    {
      "route": "/outline-generator",
      "method": "POST",
      "task": "Outline Builder",
      "aiTask": "outline",
      "returns": ["hookIniziale", "sezioni", "ctaFinale"]
    },

    {
      "route": "/shorts-generator",
      "method": "POST",
      "task": "Shorts Script Generator",
      "aiTask": "shorts",
      "returns": ["shorts"]
    },

    {
      "route": "/keyword-research",
      "method": "POST",
      "task": "Keyword Intelligence",
      "aiTask": "keyword-research",
      "returns": [
        "keywordPrincipale",
        "keywordSecondarie",
        "longTail",
        "ideeTagYouTube"
      ]
    },

    {
      "route": "/dropoff-explain",
      "method": "POST",
      "task": "Drop-off Explanation",
      "aiTask": "dropoff-explain",
      "returns": ["analisiDropoff", "lineeGuidaGenerali"]
    },

    {
      "route": "/description-opt",
      "method": "POST",
      "task": "Description Optimization",
      "aiTask": "description-opt",
      "returns": ["descrizioneOttimizzata", "bulletPuntiChiave", "callToAction"]
    },

    {
      "route": "/hashtag-opt",
      "method": "POST",
      "task": "Hashtag Optimization",
      "aiTask": "hashtag-opt",
      "returns": ["hashtagYouTube", "hashtagShorts", "mixConsigliato"]
    }
  ]
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\admin.js
// ==================================================

import express from "express";
import fs from "fs";
import path from "path";

const router = express.Router();

const SETTINGS_FILE = path.resolve("settings.json");

// Se non esiste, crearlo
if (!fs.existsSync(SETTINGS_FILE)) {
  fs.writeFileSync(
    SETTINGS_FILE,
    JSON.stringify(
      {
        monthlyBudget: 10,
        fallbackEnabled: true,
        cachingEnabled: true
      },
      null,
      2
    )
  );
}

// Carica impostazioni
function loadSettings() {
  return JSON.parse(fs.readFileSync(SETTINGS_FILE));
}

// Salva impostazioni
function saveSettings(settings) {
  fs.writeFileSync(SETTINGS_FILE, JSON.stringify(settings, null, 2));
}

/**
 * GET /admin/settings
 * Restituisce lo stato attuale delle impostazioni
 */
router.get("/settings", (req, res) => {
  const settings = loadSettings();
  res.json(settings);
});

/**
 * POST /admin/settings
 * Aggiorna le impostazioni
 */
router.post("/settings", (req, res) => {
  const newSettings = req.body;

  let settings = loadSettings();
  settings = { ...settings, ...newSettings };

  saveSettings(settings);

  res.json({
    status: "ok",
    updated: settings
  });
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\analyze-transcript.js
// ==================================================

// ======================================================================
//  analyze-transcript.js  Versione Ultra-Premium V4 (2025)
// Analisi completa per pubblico Over50/60/70
// KPI  Hook  Storytelling  Retention  SEO  Energia  CTA
// ======================================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import {
  getProfileByHandle,
  getDefaultProfile,
} from "../services/profileManager.js";

const router = express.Router();

// -------------------------------------------------------------
// JSON Extractor robusto (taglia tutto fino al primo { e ultimo })
// -------------------------------------------------------------
function extractJSON(raw) {
  try {
    const first = raw.indexOf("{");
    const last = raw.lastIndexOf("}");
    if (first === -1 || last === -1) return null;
    return raw.substring(first, last + 1);
  } catch {
    return null;
  }
}

// ======================================================================
//  POST /analyze-transcript
// Body:
// {
//   "transcript": "...",
//   "videoId": "...",
//   "audience": "over50|over60|over70",
//   "debug": false
// }
// ======================================================================

router.post("/", async (req, res) => {
  try {
    const {
      transcript,
      videoId = null,
      audience = "over60",
      debug = false,
    } = req.body || {};

    if (!transcript || transcript.trim().length < 40) {
      return res.status(400).json({
        success: false,
        error: true,
        message:
          "Transcript troppo breve o mancante. Incolla un transcript valido.",
      });
    }

    // Profilo Over 50/60/70
    const profile =
      getProfileByHandle(audience.toLowerCase()) || getDefaultProfile();

    //  Prompt Ultra-Premium V4
    const prompt = `
Sei "Zen YouTube Coach Pro", il pi avanzato analista YouTube specializzato
nel pubblico ${profile.label}.
Analizza questo transcript e restituisci TUTTO in JSON VALIDO, SENZA testo fuori dal JSON.

TRANSCRIPT:
${transcript}

Restituisci un JSON ESATTAMENTE con questa struttura:

{
  "ZenCoachScore": {
    "punteggio": 0-100,
    "motivoSintetico": "..."
  },
  "Hook": {
    "valutazione": "forte|medio|debole",
    "perche": "...",
    "come_migliorarlo": "..."
  },
  "MicroNarrazione": {
    "presente": true|false,
    "qualita": "alta|media|bassa",
    "perche": "..."
  },
  "Primi30Secondi": {
    "intensita": "alta|media|bassa",
    "puntiForti": ["...", "..."],
    "debolezze": ["...", "..."],
    "retentionStimata": "alta|media|bassa"
  },
  "StrutturaNarrativa": {
    "hookShock": true|false,
    "storiaPersonale": true|false,
    "rivelazione": true|false,
    "soluzioni": true|false,
    "trasformazione": true|false,
    "ctaPresente": true|false
  },
  "StileTonale": {
    "tono": "empatico|calmo|energico|motivazionale|tecnico",
    "energia": "alta|media|bassa",
    "adeguatoPerPubblico": true|false
  },
  "Linguaggio": {
    "complessita": "semplice|medio|complesso",
    "chiarezza": "alta|media|bassa",
    "erroriComuni": ["..."]
  },
  "ContenutiChiave": {
    "keywordsEstratte": ["...", "...", "..."],
    "argomentiPrincipali": ["...", "...", "..."],
    "promesse": ["...", "..."],
    "soluzioniOfferte": ["...", "..."]
  },
  "CTA": {
    "presente": true|false,
    "efficacia": "alta|media|bassa",
    "come_migliorarla": "..."
  },
  "ConsigliStrategici": {
    "perPubblicoOver50_60_70": ["...", "..."],
    "perCTR": ["...", "..."],
    "perRetention": ["...", "..."],
    "perStorytelling": ["...", "..."]
  },
  "TitoliSuggeriti": [
    {
      "titolo": "...",
      "angolo": "...",
      "promessa": "..."
    }
  ]
}

REGOLE:
- Rispondi SOLO con JSON valido.
- Nessuna frase fuori dal JSON.
- Nessuna spiegazione.
- Usa sempre il soggetto tu (seconda persona).
- Ottimizza lanalisi per pubblico maturo (over50/60/70).
    `.trim();

    if (debug) console.log(" Prompt inviato all'AI...");

    //  AI Call
    const raw = await callAIModel(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.35,
      maxTokens: 7000,
    });

    const jsonBlock = extractJSON(raw);

    if (!jsonBlock) {
      return res.status(200).json({
        success: false,
        warning: true,
        message: "La risposta AI non contiene JSON valido.",
        rawAIResponse: raw,
      });
    }

    const parsed = JSON.parse(jsonBlock);

    return res.json({
      success: true,
      audience: profile.label,
      videoId,
      analytics: parsed,
      rawAIResponse: raw,
    });
  } catch (error) {
    console.error(" Errore in /analyze-transcript:", error);

    return res.status(500).json({
      success: false,
      error: true,
      message: "Errore interno nell'analisi del transcript.",
      details: error.message,
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\analyze-video.js
// ==================================================

// ======================================================
//  /analyze-video  Analyze Video PRO Ultra 2025
// ======================================================

import express from "express";
import { getTranscript } from "../services/transcriptService.js";
import { getYouTubeTitle } from "../services/youtubeTitleService.js";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body:
 * { "url": "...", "audience": "over60" }
 */

router.post("/", async (req, res) => {
  try {
    const { url, audience = "over60" } = req.body || {};

    if (!url)
      return res.status(400).json({
        success: false,
        message: "Serve un campo 'url'"
      });

    // 1 Transcript
    const transcriptData = await getTranscript(url);
    if (!transcriptData || transcriptData.error) {
      return res.status(400).json({
        success: false,
        message: "Impossibile ottenere transcript"
      });
    }

    const text = transcriptData.aiText || transcriptData.continuousText;
    if (!text || text.length < 80) {
      return res.status(400).json({
        success: false,
        message: "Transcript insufficiente o vuoto"
      });
    }

    // 2 Titolo da YouTube
    const realTitle = await getYouTubeTitle(url);

    // 3 Prompt per AI
    const prompt = `
Sei "Zen YouTube Coach Pro". Analizza un video per pubblico ${audience}
(Over 50 / Over 60 / Over 70).

Titolo effettivo del video:
"${realTitle || "Nessun titolo recuperato"}"

Transcript del video:
${text}

Devi generare il seguente output:

{
  "ideaScore": 0-10,
  "hookScore": 0-10,
  "retentionScore": 0-10,
  "structureScore": 0-10,
  "titleScore": 0-10,
  "summary": "riassunto strategico",
  "strengths": ["...", "..."],
  "weaknesses": ["...", "..."],
  "titleImprovements": ["...", "..."],
  "alternateTitles": ["titolo 1", "titolo 2", ... 10 varianti],
  "seoNotes": "consigli SEO su titolo/descrizione/tag",
  "quickFixes": ["...", "..."]
}

 Rispondi SOLO con JSON valido.
`.trim();

    let raw = await callAIModel(prompt, "text", {
      provider: "groq",
      temperature: 0.25,
      maxTokens: 5500
    });

    // JSON extractor
    const first = raw.indexOf("{");
    const last = raw.lastIndexOf("}");
    let parsed = null;
    if (first !== -1 && last !== -1) {
      try {
        parsed = JSON.parse(raw.substring(first, last + 1));
      } catch {
        parsed = null;
      }
    }

    if (!parsed) {
      return res.status(500).json({
        success: false,
        message: "JSON non valido",
        raw
      });
    }

    return res.json({
      success: true,
      url,
      title: realTitle || "Titolo non recuperato",
      audience,
      data: parsed
    });
  } catch (err) {
    console.error(" analyze-video error:", err);
    return res.status(500).json({
      success: false,
      message: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\analyze.js
// ==================================================

// ======================================================
//  /analyze  Analisi "video completo" (via transcript)
// ======================================================

import express from "express";
import { getTranscript } from "../services/transcriptService.js";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const {
      videoIdOrUrl,
      audience = "over60"
    } = req.body || {};

    if (!videoIdOrUrl) {
      return res.status(400).json({
        success: false,
        message: "Devi passare videoIdOrUrl per /analyze."
      });
    }

    const t = await getTranscript(videoIdOrUrl);
    if (t.error) {
      return res.status(500).json({
        success: false,
        message: t.message || "Impossibile recuperare transcript."
      });
    }

    const transcriptText = t.aiText || t.continuousText;
    if (!transcriptText || transcriptText.length < 50) {
      return res.status(400).json({
        success: false,
        message: "Transcript troppo corto o mancante per /analyze."
      });
    }

    const prompt = `
Sei "YouTube Coach Pro". Analizza questo video per il pubblico ${audience}.

Transcript:

"""${transcriptText}"""

Devi restituire SOLO un JSON con:
{
  "hookScore": 0-10,
  "structureScore": 0-10,
  "clarityScore": 0-10,
  "valueScore": 0-10,
  "overallScore": 0-10,
  "hookNotes": "...",
  "structureNotes": "...",
  "clarityNotes": "...",
  "valueNotes": "...",
  "suggestedImprovements": ["...", "...", "..."],
  "titleIdeas": ["...", "..."],
  "shortsIdeas": ["...", "..."]
}
`.trim();

    const raw = await callAIModel(prompt, "text", {
      provider: "groq",
      temperature: 0.25,
      maxTokens: 4000
    });

    const first = raw.indexOf("{");
    const last = raw.lastIndexOf("}");
    let parsed = null;
    if (first !== -1 && last !== -1) {
      try {
        parsed = JSON.parse(raw.substring(first, last + 1));
      } catch (e) {
        console.error(" JSON parse error /analyze:", e);
      }
    }

    if (!parsed) {
      return res.status(500).json({
        success: false,
        message: "AI ha prodotto JSON non valido in /analyze.",
        raw
      });
    }

    return res.json({
      success: true,
      meta: {
        audience,
        provider: t.provider,
        videoId: t.videoId || null
      },
      analysis: parsed
    });
  } catch (err) {
    console.error(" /analyze ERROR:", err);
    return res.status(500).json({
      success: false,
      message: "Errore interno /analyze: " + err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\analyzeTranscriptPro.js
// ==================================================

// ============================================================
//  /analyze/transcriptPro  Premium Narrative & Retention Analyzer
// ============================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import {
  getProfileByHandle,
  getDefaultProfile,
} from "../services/profileManager.js";   //  NOME CORRETTO

const router = express.Router();

/**
 *  Estrae il primo oggetto JSON valido da una stringa
 */
function extractJsonObject(text) {
  if (typeof text !== "string") return null;
  const first = text.indexOf("{");
  const last = text.lastIndexOf("}");
  if (first === -1 || last === -1 || last <= first) return null;
  return text.substring(first, last + 1);
}

/**
 *  Safe JSON parse con fallback
 */
function safeParseJSON(raw) {
  try {
    if (typeof raw === "object") return raw;
    const sliced = extractJsonObject(raw);
    if (!sliced) return null;
    return JSON.parse(sliced);
  } catch (err) {
    console.error(" JSON PARSE ERROR (transcriptPro):", err);
    return null;
  }
}

router.post("/transcriptPro", async (req, res) => {
  try {
    const {
      transcript,
      title = null,
      url = null,
      profileHandle = null,
      options = {},
    } = req.body || {};

    if (!transcript || typeof transcript !== "string" || transcript.trim().length < 100) {
      return res.status(400).json({
        error: "Missing or too short 'transcript'. Minimo 100 caratteri di testo reale.",
      });
    }

    //  Auto-Profile
    const activeProfile =
      (profileHandle && getProfileByHandle(profileHandle)) ||
      getDefaultProfile();

    const {
      handle = "zen-over-50-60-70",
      audienceLabel = "Over 50 / Over 60 / Over 70",
      language = "it",
      tone = "caldo, empatico, incoraggiante, semplice",
    } = activeProfile || {};

    const boostQuestions =
      typeof options.boostQuestions === "boolean" ? options.boostQuestions : true;
    const hookSurgeon =
      typeof options.hookSurgeon === "boolean" ? options.hookSurgeon : true;

    //  PROMPT PREMIUM
    const prompt = `
Sei "Zen YouTube Coach Pro  Analyze Mode", un analista narrativo di altissimo livello,
specializzato in video di salute, sonno, benessere e alimentazione per pubblico
${audienceLabel}, lingua ${language}, tono ${tone}.

Il canale di riferimento  sempre "Zen Salute e Benessere".
Ogni suggerimento deve essere coerente con questo brand.

Devi analizzare lo SCRIPT / TRANSCRIPT qui sotto e restituire SOLO JSON valido.

===== TRANSCRIPT INIZIO =====
Titolo (se fornito): ${title || "N/D"}
URL (se fornita): ${url || "N/D"}

${transcript}
===== TRANSCRIPT FINE =====
`;

    //  AI CALL
    const rawAI = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.35,
      max_tokens: 4800,
    });

    const parsed = safeParseJSON(rawAI);

    if (!parsed || typeof parsed !== "object") {
      console.error(" /analyze/transcriptPro  AI response non valido:", rawAI);
      return res.status(500).json({
        error: "AI response not in expected JSON format (transcriptPro).",
        raw: typeof rawAI === "string" ? rawAI.slice(0, 500) : rawAI,
      });
    }

    //  Metadati aggiuntivi
    if (!parsed.meta) parsed.meta = {};
    parsed.meta.title = parsed.meta.title || title || "Analisi video";
    parsed.meta.sourceUrl = parsed.meta.sourceUrl || url || null;
    parsed.meta.profileHandleUsed = parsed.meta.profileHandleUsed || handle;
    parsed.meta.audience = parsed.meta.audience || audienceLabel;
    parsed.meta.language = parsed.meta.language || language;

    return res.json({
      success: true,
      result: parsed,
    });

  } catch (err) {
    console.error(" /analyze/transcriptPro error:", err);
    return res.status(500).json({
      error: "Internal Server Error on /analyze/transcriptPro",
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\analyzer-pro.js
// ==================================================

// =====================================================================
//   /analyzer-pro.js  VERSIONE TOP BEST ULTRA-PREMIUM
//  Lintelligenza centrale della tua app. Livello oltre VidIQ + TubeBuddy.
// =====================================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import {
  getProfileByHandle,
  getDefaultProfile,
} from "../services/profileManager.js";

const router = express.Router();

// ---------------------------------------------------------
//  UTIL  Estrazione JSON ultra-robusta
// ---------------------------------------------------------
function extractValidJson(text) {
  try {
    const first = text.indexOf("{");
    const last = text.lastIndexOf("}");
    if (first === -1 || last === -1) return null;
    return text.substring(first, last + 1);
  } catch {
    return null;
  }
}

// ---------------------------------------------------------
//  UTIL  Fix automatico JSON
// ---------------------------------------------------------
function autoFixJsonString(str) {
  return str
    .replace(/,\s*}/g, "}")
    .replace(/,\s*]/g, "]")
    .replace(/[\u2018\u2019]/g, "'")
    .replace(/[\u201C\u201D]/g, '"');
}

// ---------------------------------------------------------
//   Prompt Premium (Top Best)  Analisi completa
// ---------------------------------------------------------
function buildPrompt(transcript, profile) {
  return `
Sei "Zen YouTube Coach Pro  Analyzer Engine", la versione TOP BEST Ultra-Premium.

Analizza questo transcript YouTube e genera una risposta SOLO e UNICAMENTE in JSON PRECISO.

Transcript:
${transcript}

Target:
- Pubblico Over50 / Over60 / Over70
- Profilo richiesto: ${profile.label}

Genera il seguente JSON:

{
  "video_title": "",
  "estimatedDurationSec": 0,
  "sections": [],
  "retentionAnalysis": {
    "dropMoments": [],
    "weaknesses": [],
    "suggestedFixes": []
  },
  "valueAnalysis": {
    "clarity": "",
    "engagement": "",
    "psychologyPatterns": [],
    "emotionalScore": ""
  },
  "topicStrength": "",
  "audienceMatch": "",
  "keyQuotes": [],
  "viralPotential": "",
  "seo": {
    "bestTitle": "",
    "hooks": [],
    "tags": [],
    "searchQueries": []
  },
  "videoStrategy": {
    "thumbnailConcept": "",
    "openingFix": "",
    "ctaStrategy": "",
    "contentGapToExploit": ""
  }
}

REGOLE:
- Nessun testo fuori dal JSON.
- Nessuna spiegazione.
- Nessun markdown.
- No errori, no caratteri strani.
- Se non sai una sezione, metti "" o [].
`;
}

// ---------------------------------------------------------
//   Analize Pro  ENDPOINT ULTRA-PREMIUM
// ---------------------------------------------------------
router.post("/analyzer-pro", async (req, res) => {
  try {
    const { transcript, profileHandle } = req.body;

    if (!transcript) {
      return res.status(400).json({
        success: false,
        error: "Transcript mancante.",
      });
    }

    // Profilo utente
    const profile =
      getProfileByHandle(profileHandle) || getDefaultProfile();

    // Prompt
    const prompt = buildPrompt(transcript, profile);

    // -----------------------------------------------------
    //  1  Chiamata AI con fallback automatico integrato
    // -----------------------------------------------------
    let aiResponse = await callAIModel(prompt);

    // -----------------------------------------------------
    //  2  Estrazione JSON
    // -----------------------------------------------------
    let jsonRaw = extractValidJson(aiResponse);
    if (!jsonRaw) {
      jsonRaw = extractValidJson(autoFixJsonString(aiResponse));
    }

    if (!jsonRaw) {
      return res.status(500).json({
        success: false,
        error: "Impossibile estrarre JSON dalla risposta AI.",
        raw: aiResponse,
      });
    }

    // -----------------------------------------------------
    //  3  Fix finale del JSON
    // -----------------------------------------------------
    const fixedJson = autoFixJsonString(jsonRaw);

    // -----------------------------------------------------
    //  4  Parsing finale
    // -----------------------------------------------------
    let parsed;
    try {
      parsed = JSON.parse(fixedJson);
    } catch (err) {
      return res.status(500).json({
        success: false,
        error: "JSON non valido dopo il fix.",
        original: aiResponse,
        extracted: jsonRaw,
        fixed: fixedJson,
      });
    }

    // -----------------------------------------------------
    //  5  Risposta finale
    // -----------------------------------------------------
    return res.json({
      success: true,
      meta: {
        profile: profile.label,
      },
      result: parsed,
    });
  } catch (err) {
    console.error("ERRORE ANALYZER PRO:", err);
    return res.status(500).json({
      success: false,
      error: "Errore interno AnalyzerPro",
      details: err.message,
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\channel-intelligence.js
// ==================================================

import express from "express";
import {
  extractChannelOverview,
  extractAudienceInsights,
  extractCommunicationStyle,
  extractContentInsights,
  extractStrategicOpportunities
} from "../services/intelligenceService.js";

import { getProfileByHandle, getDefaultProfile } from "../services/profileManager.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { handle } = req.body;

    let channelProfile =
      getProfileByHandle(handle) || getDefaultProfile();

    if (channelProfile.handle === "@ZenSaluteBenessere") {
      channelProfile.targetAges = ["Over 50", "Over 60", "Over 70"];
    }

    res.status(200).json({
      overview: extractChannelOverview(channelProfile),
      audience: extractAudienceInsights(channelProfile),
      communication: extractCommunicationStyle(channelProfile),
      content: extractContentInsights(channelProfile),
      opportunities: extractStrategicOpportunities(channelProfile)
    });
  } catch (err) {
    console.error(" /channel-intelligence ERROR:", err);
    res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\cluster.js
// ==================================================

import express from "express";
import { analyzeVideoAI } from "../services/intelligenceService.js";
import { getVideoInfo } from "../services/youtubeService.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { videoUrls } = req.body;

    if (!videoUrls || !Array.isArray(videoUrls)) {
      return res.status(400).json({ error: "videoUrls must be an array" });
    }

    const results = [];

    for (const url of videoUrls) {
      const data = await getVideoInfo(url);
      const ai = await analyzeVideoAI(data);
      results.push({
        video: data.video,
        channel: data.channel,
        ai
      });
    }

    res.json({ results });

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Compare-multi error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\compare-multi.js
// ==================================================

import express from "express";
import { analyzeVideoAI } from "../services/intelligenceService.js";
import { getVideoInfo } from "../services/youtubeService.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { videoUrls } = req.body;

    if (!videoUrls || !Array.isArray(videoUrls)) {
      return res.status(400).json({ error: "videoUrls must be an array" });
    }

    const results = [];

    for (const url of videoUrls) {
      const data = await getVideoInfo(url);
      const ai = await analyzeVideoAI(data);
      results.push({
        video: data.video,
        channel: data.channel,
        ai
      });
    }

    res.json({ results });

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Compare-multi error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\compare-transcript.js
// ==================================================

// =====================================================================
//   /compare-transcript.js  VERSIONE TOP BEST ULTRA-PREMIUM
//  Confronto avanzato tra pi transcript YouTube.
//  App Zen YouTube Coach Pro  Livello superiore a VidIQ e TubeBuddy.
// =====================================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import {
  getProfileByHandle,
  getDefaultProfile,
} from "../services/profileManager.js";

const router = express.Router();

// ---------------------------------------------------------
//  UTIL  Estrazione JSON robusta
// ---------------------------------------------------------
function extractValidJson(text) {
  try {
    const first = text.indexOf("{");
    const last = text.lastIndexOf("}");
    if (first === -1 || last === -1) return null;
    return text.substring(first, last + 1);
  } catch {
    return null;
  }
}

// ---------------------------------------------------------
//  UTIL  Fix automatico JSON
// ---------------------------------------------------------
function autoFixJsonString(str) {
  if (!str || typeof str !== "string") return str;

  return str
    .replace(/,\s*}/g, "}")
    .replace(/,\s*]/g, "]")
    .replace(/[\u2018\u2019]/g, "'")
    .replace(/[\u201C\u201D]/g, '"');
}

// ---------------------------------------------------------
//   Prompt Premium  Confronto multiplo tra transcript
// ---------------------------------------------------------
function buildComparePrompt(videos, profile, primaryId) {
  const serialized = videos
    .map((v, i) => {
      return `
[VIDEO ${i + 1}]
id: ${v.id}
title: ${v.title}
notes: ${v.notes}
transcript:
${v.transcript}
`;
    })
    .join("\n\n");

  return `
Sei "Zen YouTube Coach Pro  Compare Engine", versione TOP BEST Ultra-Premium.

Obiettivo: confrontare questi video per capire:
- quale ha pi potenziale per Over50 / Over60 / Over70,
- quale struttura narrativa trattiene di pi,
- quale ha hook pi forte,
- qual  il miglior CTA,
- come creare un MASTER VIDEO che sintetizzi il meglio di tutti,
- come migliorare il video principale (primaryId: ${primaryId || "nessuno"}).

Target richiesto: pubblico Over50 / Over60 / Over70
Profilo: ${profile.label}

Ecco i video da analizzare:
${serialized}

Genera SOLO questo JSON (nessun testo fuori dal JSON):

{
  "videoCount": 0,
  "primaryId": "",
  "globalInsights": {
    "mainTheme": "",
    "audienceFitOver50": "",
    "audienceFitOver60": "",
    "audienceFitOver70": "",
    "psychologyPatterns": [],
    "commonMistakes": [],
    "missedOpportunities": []
  },
  "rankingByPotential": [
    {
      "id": "",
      "title": "",
      "reason": "",
      "scoreOver50": 0,
      "scoreOver60": 0,
      "scoreOver70": 0,
      "retentionPotential": "",
      "viralPotential": ""
    }
  ],
  "perVideoDetails": [
    {
      "id": "",
      "title": "",
      "hookStrength": "",
      "hookSuggestions": [],
      "structureStrengths": [],
      "structureWeaknesses": [],
      "clarity": "",
      "emotionalDepth": "",
      "ctaQuality": "",
      "ctaSuggestions": [],
      "seo": {
        "suggestedTitle": "",
        "suggestedHooks": [],
        "tags": [],
        "searchQueries": []
      }
    }
  ],
  "bestOfAllVideos": {
    "bestHookIdea": "",
    "bestOpening30SecondsBlueprint": "",
    "bestCTA": "",
    "bestTitleIdea": "",
    "bestEmotionalAngle": "",
    "notesForZenSaluteEBenessere": ""
  },
  "recommendedMasterVideoBlueprint": {
    "targetAudience": "",
    "estimatedDurationMinutes": 0,
    "narrativeFlow": [
      {
        "step": 1,
        "label": "",
        "description": ""
      }
    ],
    "openingHookExample": "",
    "storyCore": "",
    "valueDeliverySections": [],
    "finalCTAExample": "",
    "thumbnailConcept": ""
  }
}

REGOLE FERREE:
- Nessun testo fuori dal JSON.
- Nessuna frase extra.
- Se non sai qualcosa, usa "" oppure [] oppure 0.
`;
}

// ---------------------------------------------------------
//   Endpoint principale Ultra-Premium
// ---------------------------------------------------------
router.post("/compare-transcript-pro", async (req, res) => {
  try {
    const { videos, primaryId, profileHandle } = req.body;

    // Validazione
    if (!videos || !Array.isArray(videos) || videos.length < 2) {
      return res.status(400).json({
        success: false,
        error: "Servono almeno 2 video con transcript per il confronto.",
      });
    }

    // Pulizia dei video
    const cleanedVideos = videos
      .filter(
        (v) =>
          v &&
          typeof v.transcript === "string" &&
          v.transcript.trim().length > 0
      )
      .map((v, index) => ({
        id: v.id || `video_${index + 1}`,
        title: v.title || "",
        transcript: v.transcript,
        notes: v.notes || "",
      }));

    if (cleanedVideos.length < 2) {
      return res.status(400).json({
        success: false,
        error:
          "Dopo la pulizia, meno di 2 transcript erano validi. Controlla i dati.",
      });
    }

    // Profilo target
    const profile =
      getProfileByHandle(profileHandle) || getDefaultProfile();

    // Prompt Premium
    const prompt = buildComparePrompt(cleanedVideos, profile, primaryId);

    //  Chiamata AI
    const aiResponse = await callAIModel(prompt);

    // Estrazione JSON
    let jsonRaw = extractValidJson(aiResponse);
    if (!jsonRaw) jsonRaw = extractValidJson(autoFixJsonString(aiResponse));

    if (!jsonRaw) {
      return res.status(500).json({
        success: false,
        error: "Impossibile estrarre JSON.",
        raw: aiResponse,
      });
    }

    // Fix
    const fixedJson = autoFixJsonString(jsonRaw);

    // Parsing
    let parsed;
    try {
      parsed = JSON.parse(fixedJson);
    } catch (err) {
      return res.status(500).json({
        success: false,
        error: "JSON non valido dopo il fix.",
        original: aiResponse,
        extracted: jsonRaw,
        fixed: fixedJson,
      });
    }

    // Successo
    return res.json({
      success: true,
      meta: {
        profile: profile.label,
        primaryId: primaryId || null,
        videoCount: cleanedVideos.length,
      },
      result: parsed,
    });
  } catch (err) {
    console.error("ERRORE COMPARE TRANSCRIPT PRO:", err);
    return res.status(500).json({
      success: false,
      error: "Errore interno compare-transcript-pro",
      details: err.message,
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\compare-videos.js
// ==================================================

// =====================================================================
//   /compare-videos.js  VERSIONE TOP BEST ULTRA-PREMIUM
//  Confronto visivo + metadata + CTR prediction tra due o pi video.
//  Analisi: titoli, descrizioni, thumbnail, SEO, psicologia del click.
//  Modulo fondamentale di Zen YouTube Coach Pro.
// =====================================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import {
  getProfileByHandle,
  getDefaultProfile
} from "../services/profileManager.js";

const router = express.Router();

// ---------------------------------------------------------
// Utils
// ---------------------------------------------------------
function extractValidJson(text) {
  try {
    const first = text.indexOf("{");
    const last = text.lastIndexOf("}");
    if (first === -1 || last === -1) return null;
    return text.substring(first, last + 1);
  } catch {
    return null;
  }
}

function autoFixJsonString(str) {
  if (!str || typeof str !== "string") return str;
  return str
    .replace(/,\s*}/g, "}")
    .replace(/,\s*]/g, "]")
    .replace(/[\u2018\u2019]/g, "'")
    .replace(/[\u201C\u201D]/g, '"');
}

// ---------------------------------------------------------
// Prompt Ultra-Premium
// ---------------------------------------------------------
function buildComparePrompt(videos, profile, primaryId) {
  const serialized = videos
    .map((v, i) => {
      return `
[VIDEO ${i + 1}]
id: ${v.id}
title: ${v.title}
description: ${v.description}
thumbnail_url: ${v.thumbnail}
notes: ${v.notes}
`;
    })
    .join("\n\n");

  return `
Sei "Zen YouTube Coach Pro  CompareVideos Engine", versione TOP BEST Ultra-Premium.

Confronta i seguenti video YouTube in base a:
- Titolo (CTR, chiarezza, psicologia, promessa)
- Descrizione (SEO, struttura, keyword)
- Thumbnail (clickability, contrasto, emozione)
- Titolo + Thumbnail sinergia
- Target Over50/60/70
- Predictive CTR
- Potenziale virale
- Debolezze del video primario (primaryId: ${primaryId || "non definito"})

Video forniti:
${serialized}

Genera SOLO il seguente JSON:

{
  "videoCount": 0,
  "primaryId": "",
  "globalInsights": {
    "overallWinner": "",
    "reasonWinner": "",
    "audienceFitOver50": "",
    "audienceFitOver60": "",
    "audienceFitOver70": "",
    "patternDetected": [],
    "commonMistakes": []
  },
  "rankingCTR": [
    {
      "id": "",
      "titleCTRScore": 0,
      "thumbnailCTRScore": 0,
      "seoScore": 0,
      "finalCTRPrediction": 0,
      "reason": ""
    }
  ],
  "perVideo": [
    {
      "id": "",
      "titleAnalysis": {
        "score": 0,
        "clarity": "",
        "hookPower": "",
        "emotionalTriggers": [],
        "improvements": []
      },
      "thumbnailAnalysis": {
        "score": 0,
        "clarity": "",
        "emotion": "",
        "visualProblems": [],
        "improvements": []
      },
      "titleThumbnailSynergy": "",
      "seo": {
        "positiveKeywords": [],
        "missingKeywords": []
      },
      "predictiveCTR": 0,
      "strengths": [],
      "weaknesses": []
    }
  ],
  "recommendedFixForPrimary": {
    "betterTitleIdea": "",
    "betterThumbnailConcept": "",
    "betterDescription": "",
    "seoFixes": [],
    "overallImprovement": ""
  }
}

REGOLE:
- Nessun testo fuori dal JSON.
- Nessuna spiegazione.
- Se un campo  sconosciuto, usa "" o [] o 0.
`;
}

// ---------------------------------------------------------
// Endpoint Ultra-Premium
// ---------------------------------------------------------
router.post("/compare-videos-pro", async (req, res) => {
  try {
    const { videos, primaryId, profileHandle } = req.body;

    if (!videos || !Array.isArray(videos) || videos.length < 2) {
      return res.status(400).json({
        success: false,
        error: "Servono almeno 2 video completi (titolo, descrizione, thumbnail)."
      });
    }

    const cleanedVideos = videos.map((v, index) => ({
      id: v.id || `video_${index + 1}`,
      title: v.title || "",
      description: v.description || "",
      thumbnail: v.thumbnail || "",
      notes: v.notes || ""
    }));

    const profile =
      getProfileByHandle(profileHandle) || getDefaultProfile();

    const prompt = buildComparePrompt(cleanedVideos, profile, primaryId);

    const aiResponse = await callAIModel(prompt);

    // JSON extraction
    let jsonRaw = extractValidJson(aiResponse);
    if (!jsonRaw) {
      jsonRaw = extractValidJson(autoFixJsonString(aiResponse));
    }

    if (!jsonRaw) {
      return res.status(500).json({
        success: false,
        error: "Impossibile estrarre un JSON valido.",
        raw: aiResponse
      });
    }

    const fixedJson = autoFixJsonString(jsonRaw);

    let parsed;
    try {
      parsed = JSON.parse(fixedJson);
    } catch (err) {
      return res.status(500).json({
        success: false,
        error: "JSON non valido dopo il fix.",
        original: aiResponse,
        extracted: jsonRaw,
        fixed: fixedJson
      });
    }

    return res.json({
      success: true,
      meta: {
        profile: profile.label,
        primaryId: primaryId || null
      },
      result: parsed
    });
  } catch (err) {
    console.error("ERRORE COMPARE VIDEOS PRO:", err);
    return res.status(500).json({
      success: false,
      error: "Errore interno compare-videos-pro",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\compare.js
// ==================================================

import express from "express";
import { analyzeVideoAI } from "../services/intelligenceService.js";
import { getVideoInfo } from "../services/youtubeService.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { videoUrlA, videoUrlB } = req.body;

    if (!videoUrlA || !videoUrlB) {
      return res.status(400).json({ error: "Missing videoUrlA or videoUrlB" });
    }

    // Dati YouTube
    const dataA = await getVideoInfo(videoUrlA);
    const dataB = await getVideoInfo(videoUrlB);

    // Analisi AI
    const aiA = await analyzeVideoAI(dataA);
    const aiB = await analyzeVideoAI(dataB);

    res.json({
      A: { video: dataA.video, channel: dataA.channel, ai: aiA },
      B: { video: dataB.video, channel: dataB.channel, ai: aiB },
      winner: aiA.scores.retentionPotential > aiB.scores.retentionPotential ? "A" : "B"
    });

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Compare error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\creator-rank.js
// ==================================================

// ======================================================
//  /creator-rank  Complete Creator Rank Engine
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import { getProfileByHandle, getDefaultProfile } from "../services/profileManager.js";  //  FIX DEFINITIVO

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { handle, videos } = req.body;

    if (!Array.isArray(videos) || videos.length < 2) {
      return res.status(400).json({
        error: true,
        message: "Servono almeno 2 video in un array 'videos'."
      });
    }

    if (videos.length > 8) {
      return res.status(400).json({
        error: true,
        message: "Massimo 8 video per /creator-rank."
      });
    }

    const channelProfile = handle
      ? await getProfileByHandle(handle)
      : await getDefaultProfile();

    if (!channelProfile) {
      return res.status(500).json({
        error: true,
        message: "Profilo canale non trovato."
      });
    }

    const aiPrompt = `
Sei un analista YouTube Pro per pubblico Over 50/60/70.

VIDEO INPUT:
${JSON.stringify(videos, null, 2)}

PROFILO CANALE:
${JSON.stringify(channelProfile, null, 2)}

Valuta ogni video su:
- CTR POTENZIALE
- RETENTION POTENZIALE
- IMPATTO EMOTIVO
- FIT OVER 50/60/70
- CTA

Rispondi SOLO JSON:
{
  "ranking": [],
  "scores": {},
  "global_insights": {}
}
`;

    const raw = await callAIModel(aiPrompt, "text");

    const start = raw.indexOf("{");
    const end = raw.lastIndexOf("}");
    const parsed = JSON.parse(raw.slice(start, end + 1));

    return res.status(200).json({
      channelProfile,
      rankEngine: parsed
    });

  } catch (err) {
    console.error(" /creator-rank ERROR:", err);
    return res.status(500).json({
      error: "Errore interno server",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\description-opt.js
// ==================================================

// ======================================================
//  /description-opt  Ottimizzatore descrizione video
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body:
 * {
 *   "title": "titolo video",
 *   "currentDescription": "descrizione attuale (opzionale)",
 *   "audience": "over60",
 *   "forceProvider": "auto"
 * }
 */
router.post("/", async (req, res) => {
  try {
    const {
      title,
      currentDescription = "",
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!title) {
      return res.status(400).json({
        ok: false,
        error: "Missing 'title'"
      });
    }

    const prompt = `
Ottimizza la descrizione di un video YouTube.

Titolo: "${title}"
Descrizione attuale (se presente):
${currentDescription}

Target: ${audience}

Rispondi SOLO JSON:
{
  "descrizioneOttimizzata": "testo completo con paragrafi e spaziature",
  "primaRigaPotente": "prima riga che aggancia",
  "bulletPuntiChiave": ["..."],
  "callToAction": "..."
}
`.trim();

    const aiResp = await callAIModel(prompt, "json", {
      task: "description-opt",
      temperature: 0.3,
      maxTokens: 4000,
      forceProvider
    });

    if (aiResp?.error) {
      return res.status(502).json({
        ok: false,
        error: "AI description optimization failed",
        details: aiResp
      });
    }

    return res.json({
      ok: true,
      providerUsed: forceProvider,
      data: aiResp
    });

  } catch (err) {
    console.error(" /description-opt ERROR:", err);
    res.status(500).json({
      ok: false,
      error: "description-opt route crashed",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\dropoff-explain.js
// ==================================================

// ======================================================
//  /dropoff-explain  Spiegazione punti di abbandono
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body:
 * {
 *   "transcript": "testo completo",
 *   "dropPoints": ["0:30", "1:45", ...],
 *   "audience": "over60",
 *   "forceProvider": "auto"
 * }
 */
router.post("/", async (req, res) => {
  try {
    const {
      transcript,
      dropPoints = [],
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!transcript) {
      return res.status(400).json({
        ok: false,
        error: "Missing 'transcript'"
      });
    }

    if (!Array.isArray(dropPoints) || dropPoints.length === 0) {
      return res.status(400).json({
        ok: false,
        error: "dropPoints must be a non-empty array of timestamps"
      });
    }

    const prompt = `
Ti fornisco il transcript di un video e una lista di timestamp in cui la retention crolla.
Spiega perch le persone abbandonano e come riscrivere quei punti.

Target: ${audience}

Transcript:
${transcript}

Drop points:
${dropPoints.join(", ")}

Rispondi SOLO con JSON:
{
  "analisiDropoff": [
    {
      "timestamp": "0:30",
      "motivoProbabile": "...",
      "tipoProblema": "noia|confusione|tecnico|ripetizione",
      "riscritturaSuggerita": "testo alternativo pi forte"
    }
  ],
  "lineeGuidaGenerali": ["..."]
}
`.trim();

    const aiResp = await callAIModel(prompt, "json", {
      task: "dropoff-explain",
      temperature: 0.25,
      maxTokens: 4500,
      forceProvider
    });

    if (aiResp?.error) {
      return res.status(502).json({
        ok: false,
        error: "AI dropoff explanation failed",
        details: aiResp
      });
    }

    return res.json({
      ok: true,
      providerUsed: forceProvider,
      data: aiResp
    });

  } catch (err) {
    console.error(" /dropoff-explain ERROR:", err);
    res.status(500).json({
      ok: false,
      error: "dropoff-explain route crashed",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generate - 10 min video.js
// ==================================================

// ============================================================
//  generate.js  Script Builder YouTube Over60 (710 minuti)
// ============================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import { estimateSceneDurations } from "../utils/wordDuration.js";

const router = express.Router();

//  RUOLI CONSENTITI
const validRoles = [
  "HOOK",
  "PROBLEMA",
  "SPIEGAZIONE",
  "CAUSE",
  "SOLUZIONI",
  "STILE DI VITA",
  "BENEFICI",
  "MOTIVAZIONE",
  "CTA"
];

/**
 * POST /generate/script
 * Genera uno script YouTube per Over60 (710 min con voce Michele 145 wpm)
 */
router.post("/script", async (req, res) => {
  try {
    const { idea } = req.body;

    if (!idea) {
      return res.status(400).json({ error: "Missing 'idea' field" });
    }

    //  PROMPT tarato sui 710 minuti REALI
    const prompt = `
Sei uno YouTube Script Builder professionale specializzato in contenuti per pubblico Over60.
Genera SOLO JSON valido, nessun testo esterno.

 OBIETTIVO DURATA:
- Voce: Michele, 145 parole al minuto
- Durata finale: 810 minuti reali
- Totale parole: idealmente tra 2000 e 2300 parole

 STRUTTURA:
- Dividi lo script in 3550 scene
- Ogni scena deve avere tra 180 e 220 parole
- id numerico progressivo
- role deve essere uno di:
  HOOK, PROBLEMA, SPIEGAZIONE, CAUSE, SOLUZIONI, STILE DI VITA, BENEFICI, MOTIVAZIONE, CTA
- text: linguaggio naturale, colloquiale, caldo, empatico, NON medico

 FORMATO FINALE JSON (OBBLIGATORIO):
{
  "video_title": "",
  "scenes": [
    { "id": 1, "role": "HOOK", "text": "..." },
    { "id": 2, "role": "PROBLEMA", "text": "..." }
  ]
}

 REGOLE FERREE:
- Nessun markdown (no **bold**, no liste, no titoli)
- Nessun \\n, nessun a capo manuale
- Nessuna frase tipo "In questa scena..." o "Scene 1"
- Vietato usare ruoli diversi da quelli indicati
- Tono: calmo, umano, incoraggiante, vicino allascoltatore Over60

Argomento del video:
"${idea}"

Rispondi SOLO con JSON valido nel formato indicato.
`;

    //  Chiamata al modello AI
    const aiResponse = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.7,
      max_tokens: 4500
    });

    //  Validazione base
    if (!aiResponse || !aiResponse.scenes || !Array.isArray(aiResponse.scenes)) {
      throw new Error("Invalid AI response format");
    }

    //  Normalizzazione ruoli
    aiResponse.scenes = aiResponse.scenes.map((scene, index) => {
      const cleaned = { ...scene };

      // fallback id se mancante
      if (typeof cleaned.id !== "number") {
        cleaned.id = index + 1;
      }

      // ruolo non valido  CTA
      if (!validRoles.includes(cleaned.role)) {
        cleaned.role = "CTA";
      }

      // text sempre stringa
      if (typeof cleaned.text !== "string") {
        cleaned.text = String(cleaned.text || "");
      }

      return cleaned;
    });

    //  Stima durata e parole
    const {
      scenesWithTime,
      totalWords,
      totalDurationSec,
      totalDurationFormatted
    } = estimateSceneDurations(aiResponse.scenes);

    //  Risposta finale
    return res.json({
      success: true,
      result: {
        video_title: aiResponse?.video_title || null,
        voiceProfile: {
          id: "michele",
          label: "Michele (naturale, calmo)",
          wpm: 145
        },
        totalWords,
        estimatedDurationSec: totalDurationSec,
        estimatedDurationFormatted: totalDurationFormatted,
        sceneCount: scenesWithTime.length,
        scenes: scenesWithTime
      }
    });
  } catch (err) {
    console.error(" /generate/script error:", err);
    return res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generate - 753 min ok .js
// ==================================================

// ======================================================================
//  generate.js  Script Builder YouTube Over60 (710 min reali Fliki)
// Con Boost Mode, Hook Surgeon Mode, Fliki AutoScene Marker
// ======================================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import { estimateSceneDurations } from "../utils/wordDuration.js";

const router = express.Router();

//  RUOLI CONSENTITI
const validRoles = [
  "HOOK",
  "PROBLEMA",
  "SPIEGAZIONE",
  "CAUSE",
  "SOLUZIONI",
  "STILE DI VITA",
  "BENEFICI",
  "MOTIVAZIONE",
  "CTA"
];

// Marker per Fliki AutoScene Mode
const SCENE_MARKER = "[SCENE_CHANGE]";

// Boost Mode: Aggiunge domanda strategica ogni 3 scene
function applyBoostMode(text, index) {
  if ((index + 1) % 3 === 0) {
    return text.trim() + " Quale di queste idee ti rispecchia di pi?";
  }
  return text;
}

/**
 * POST /generate/script
 */
router.post("/script", async (req, res) => {
  try {
    const { idea } = req.body;
    if (!idea) {
      return res.status(400).json({ error: "Missing 'idea' field" });
    }

    //  Prompt finale, ottimizzato, stabile, senza frammentazione
    const prompt = `
Sei uno YouTube Script Builder di livello Top, specializzato in pubblico Over60.
Genera SOLO JSON valido, senza testo esterno.

 OBIETTIVO:
- Voce: Michele, 145 parole/minuto
- Durata finale: 710 minuti (minimo 1100 - massimo 1450 parole)
- Scene: tra 18 e 28
- Ogni scena tra 65 e 90 parole
- Hook Surgeon Mode  Prima scena deve essere la pi forte possibile, altissimo CTR
- Boost Mode  Inserisci una domanda diretta ogni 3 scene (naturale, non forzata)
- Fliki AutoScene Mode  Inserisci SEMPRE il marker finale: ${SCENE_MARKER}

 FORMATO JSON:
{
  "video_title": "",
  "scenes": [
    { "id": 1, "role": "HOOK", "text": "..." },
    { "id": 2, "role": "PROBLEMA", "text": "..." }
  ]
}

 REGOLE FERREE:
- Nessun markdown, nessun **bold**, nessun elenco
- Nessun a capo manuale o \\n
- Nessun titolo se non video_title
- Niente Scene 1 o In questa scena
- Linguaggio naturale, narrativo, empatico, conversazionale
- Vietato contenuto medico o clinico
- Ruoli ammessi: HOOK, PROBLEMA, SPIEGAZIONE, CAUSE, SOLUZIONI, STILE DI VITA, BENEFICI, MOTIVAZIONE, CTA

 TONO:
Caldo, umano, incoraggiante, con ritmo narrativo continuo, alta retention.

Argomento del video:
"${idea}"

Rispondi SOLO con JSON valido.
    `;

    //  Chiamata AI
    const aiResponse = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.7,
      max_tokens: 4500,
    });

    // Validazione
    if (!aiResponse || !aiResponse.scenes || !Array.isArray(aiResponse.scenes)) {
      throw new Error("Invalid AI response format");
    }

    //  Normalizzazione scene + Boost Mode + Marker automatico
    aiResponse.scenes = aiResponse.scenes.map((scene, index) => {
      const cleaned = { ...scene };

      // Fallback id
      cleaned.id = typeof cleaned.id === "number" ? cleaned.id : index + 1;

      // Ruolo valido
      cleaned.role = validRoles.includes(cleaned.role)
        ? cleaned.role
        : "CTA";

      // Testo pulito
      cleaned.text = String(cleaned.text || "").trim();

      // Boost Mode  domanda strategica ogni 3 scene
      cleaned.text = applyBoostMode(cleaned.text, index);

      // Fliki Scene Marker
      cleaned.text = cleaned.text + " " + SCENE_MARKER;

      return cleaned;
    });

    //  Calcolo durata
    const {
      scenesWithTime,
      totalWords,
      totalDurationSec,
      totalDurationFormatted,
    } = estimateSceneDurations(aiResponse.scenes);

    //  Risposta
    return res.json({
      success: true,
      result: {
        video_title: aiResponse?.video_title || null,
        voiceProfile: { id: "michele", label: "Michele (naturale, calmo)", wpm: 145 },
        totalWords,
        estimatedDurationSec: totalDurationSec,
        estimatedDurationFormatted: totalDurationFormatted,
        sceneCount: scenesWithTime.length,
        scenes: scenesWithTime,
      },
    });
  } catch (err) {
    console.error(" /generate/script error:", err);
    return res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generate-script-pro.js
// ==================================================

// ======================================================================
//  generate-script-pro.js  Ultra-Premium Script Generator V4
// Zen YouTube Coach Pro  2025
// Output strutturato, JSON pulito, scenes per Fliki, outline avanzato
// ======================================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import { getProfileByHandle, getDefaultProfile } from "../services/profileManager.js";

const router = express.Router();

// ======================================================================
//  JSON Extractor  prende SOLO il blocco JSON valido
// ======================================================================
function extractJsonObject(str) {
  if (!str) return null;
  try {
    const first = str.indexOf("{");
    const last = str.lastIndexOf("}");
    if (first === -1 || last === -1) return null;
    return str.substring(first, last + 1);
  } catch {
    return null;
  }
}

// ======================================================================
//  POST /generate-script-pro
// ======================================================================
router.post("/", async (req, res) => {
  try {
    const {
      topic,
      audience = "over60",
      durationMinutes = 8,
      language = "it",
    } = req.body;

    if (!topic) {
      return res.status(400).json({
        success: false,
        message: " Devi fornire almeno il campo 'topic'.",
      });
    }

    // Profilo pubblico Over50/60/70
    const profile = getProfileByHandle(audience) || getDefaultProfile();

    // Word count stimato per durata
    const targetWPM = 140;
    const estimatedWordCount = durationMinutes * targetWPM;

    // ==================================================================
    //  PROMPT  Versione V4 Ultra Premium
    // ==================================================================
    const prompt = `
Sei "Zen YouTube Coach Pro"  versione Ultra Premium 2025.
Crea uno script completo in stile trailer emozionale per un pubblico ${profile.label}.

Obiettivo:
- Durata: ${durationMinutes} minuti
- Lingua: ${language}
- Topic: "${topic}"
- Canale: Zen Salute e Benessere
- Output SOLO in JSON valido

STRUTTURA JSON RICHIESTA:

{
  "meta": {
    "topic": "",
    "audienceLabel": "",
    "language": "",
    "estimatedDurationMinutes": 0,
    "targetWPM": 0,
    "estimatedWordCount": 0
  },
  "script": {
    "hook": "",
    "introCanale": "",
    "sezioniPrincipali": [
      { "titoloSezione": "", "testo": "" }
    ],
    "consiglioExtra": "",
    "outro": ""
  },
  "outline": {
    "bulletPoints": [],
    "promessaCentrale": "",
    "problemaPrincipale": "",
    "trasformazionePromessa": ""
  },
  "scenes": [
    {
      "id": 1,
      "role": "",
      "label": "",
      "text": "",
      "wordCount": 0,
      "estimatedDurationSec": 0
    }
  ]
}

REGOLE DI STILE:
- Stile narrativo-emozionale
- Ritmo rapido, micro-storie, frasi corte
- Hook fortissimo nelle prime righe
- Target Over50/60/70: empatia, semplicit, chiarezza
- Evita linguaggio tecnico
- Ogni sezione deve essere leggibile e naturale
- Crea scenes per Fliki perfettamente separate
- Nessun testo fuori dal JSON
`.trim();

    // ===============================
    //  Chiamata AI
    // ===============================
    const aiResponse = await callAIModel(prompt, "text", {
      temperature: 0.65,
      maxTokens: 6000,
    });

    const jsonBlock = extractJsonObject(aiResponse);

    if (!jsonBlock) {
      return res.status(200).json({
        success: false,
        warning: true,
        message: "La risposta AI non contiene JSON valido.",
        rawAIResponse: aiResponse,
      });
    }

    let parsed;
    try {
      parsed = JSON.parse(jsonBlock);
    } catch (err) {
      return res.status(200).json({
        success: false,
        message: "JSON non valido.",
        rawAIResponse: aiResponse,
      });
    }

    // ===============================
    //  RISPOSTA OK
    // ===============================
    return res.status(200).json({
      success: true,
      meta: {
        topic,
        audienceLabel: profile.label,
        language,
        estimatedDurationMinutes: durationMinutes,
        targetWPM,
        estimatedWordCount,
      },
      script: parsed.script,
      outline: parsed.outline,
      scenes: parsed.scenes,
      rawAIResponse: jsonBlock,
    });

  } catch (error) {
    console.error(" ERRORE generate-script-pro:", error);
    return res.status(500).json({
      success: false,
      message: "Errore interno nella generazione dello script.",
      details: error.message,
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generate-smart-fliki.js
// ==================================================

// ===================================================================
//  /generate-smart/fliki  SMART Scene Builder per Fliki
// JSON + CSV + XLSX  Ottimizzato per voce MICHELE e target Over50/60/70
// ===================================================================

import express from "express";
import { callAIModel } from "../services/aiService.js";
import { safeParseJSON } from "../utils/jsonUtils.js";
import * as XLSX from "xlsx";

const router = express.Router();

/**
 *  Funzione che genera le scene usando AI
 */
async function buildFlikiScenes({ topic, trendData, dnaData, targetAge }) {
  const prompt = `
Genera uno script video in SCENE per Fliki, ottimizzato per:

 Pubblico: ${targetAge}, Over50/60/70
 Voce: MICHELE (Fliki)  maschile calda, empatica, ritmo naturale, non veloce
 Stile: Educativo, rassicurante, umano, empatico, lento, autorevole

Regole di scrittura:
- Massimo 14 parole per frase
- Linguaggio semplice, naturale, umano
- Frasi su righe separate per facilitare le pause vocali
- Ogni SCENA deve avere:
  - voiceText (testo parlato)
  - overlayText (max 8 parole)
  - visualSuggestion (immagine/video)
  - durationSec (612 secondi)

---

 Usa questi dati reali (Trend & DNA di contenuti vincenti):

 Trend Insights:
${JSON.stringify(trendData, null, 2)}

 DNA Contenuti Over50/60:
${JSON.stringify(dnaData, null, 2)}

---

 OUTPUT FINALE *VALIDO JSON*  niente testo fuori dalle {}

{
  "recommendedVoice": {
    "name": "Michele",
    "platform": "Fliki",
    "tone": "caldo, empatico, rassicurante, adulto maturo"
  },
  "videoIntro": {
    "voiceText": "",
    "visualSuggestion": "",
    "overlayText": "",
    "durationSec": 8
  },
  "scenes": [
    {
      "id": 1,
      "voiceText": "",
      "visualSuggestion": "",
      "overlayText": "",
      "durationSec": 10
    }
  ],
  "finalCTA": {
    "voiceText": "",
    "visualSuggestion": "",
    "overlayText": "",
    "durationSec": 8
  },
  "backgroundMusic": "soft gentle acoustic"
}
--- END
`;

  const response = await callAIModel(prompt, {
    model: "gpt-4o-mini",
    temperature: 0.6,
    max_tokens: 3800,
  });

  const parsed = safeParseJSON(response);

  if (!parsed || !parsed.scenes) {
    throw new Error("AI JSON malformed or missing 'scenes'");
  }

  return parsed;
}

/**
 *  Converte JSON scene  tabella usabile (CSV o Excel)
 */
function flikiScenesToRows(scriptScenes) {
  const rows = [];
  const voiceName =
    scriptScenes?.recommendedVoice?.name || "Michele";
  const bgMusic = scriptScenes?.backgroundMusic || "soft gentle acoustic";

  // Intro
  if (scriptScenes.videoIntro) {
    rows.push({
      section: "intro",
      scene_id: "",
      voice: voiceName,
      voiceText: scriptScenes.videoIntro.voiceText || "",
      overlayText: scriptScenes.videoIntro.overlayText || "",
      visualSuggestion: scriptScenes.videoIntro.visualSuggestion || "",
      durationSec: scriptScenes.videoIntro.durationSec || "",
      backgroundMusic: bgMusic,
    });
  }

  // Scene principali
  (scriptScenes.scenes || []).forEach((s) => {
    rows.push({
      section: "scene",
      scene_id: s.id ?? "",
      voice: voiceName,
      voiceText: s.voiceText || "",
      overlayText: s.overlayText || "",
      visualSuggestion: s.visualSuggestion || "",
      durationSec: s.durationSec || "",
      backgroundMusic: bgMusic,
    });
  });

  // CTA
  if (scriptScenes.finalCTA) {
    rows.push({
      section: "finalCTA",
      scene_id: "",
      voice: voiceName,
      voiceText: scriptScenes.finalCTA.voiceText || "",
      overlayText: scriptScenes.finalCTA.overlayText || "",
      visualSuggestion: scriptScenes.finalCTA.visualSuggestion || "",
      durationSec: scriptScenes.finalCTA.durationSec || "",
      backgroundMusic: bgMusic,
    });
  }

  return rows;
}

/**
 *  1 JSON puro  /generate-smart/fliki
 */
router.post("/fliki", async (req, res) => {
  try {
    const { topic, trendData, dnaData, targetAge = "over60" } = req.body;

    if (!topic || !trendData || !dnaData) {
      return res.status(400).json({
        error: "Missing 'topic', 'trendData' or 'dnaData'",
      });
    }

    const scriptScenes = await buildFlikiScenes({
      topic,
      trendData,
      dnaData,
      targetAge,
    });

    res.json({
      status: "success",
      engine: "SMART-FLIKI",
      targetAge,
      scriptScenes,
    });
  } catch (error) {
    console.error(" /generate-smart/fliki Error:", error);
    res.status(500).json({ error: "Errore generazione scene Fliki JSON" });
  }
});

/**
 *  2 CSV  /generate-smart/fliki/csv
 */
router.post("/fliki/csv", async (req, res) => {
  try {
    const { topic, trendData, dnaData, targetAge = "over60" } = req.body;

    const scriptScenes = await buildFlikiScenes({
      topic,
      trendData,
      dnaData,
      targetAge,
    });

    const rows = flikiScenesToRows(scriptScenes);

    const headers = Object.keys(rows[0] || {});
    const csvLines = [];
    csvLines.push(headers.join(";"));

    rows.forEach((row) => {
      const line = headers
        .map((h) => `"${(row[h] || "").toString().replace(/"/g, '""')}"`)
        .join(";");
      csvLines.push(line);
    });

    res.setHeader("Content-Type", "text/csv");
    res.setHeader(
      "Content-Disposition",
      'attachment; filename="fliki_scenes_smart.csv"'
    );
    res.send(csvLines.join("\n"));
  } catch (error) {
    console.error(" /generate-smart/fliki/csv Error:", error);
    res.status(500).json({ error: "Errore generazione CSV" });
  }
});

/**
 *  3 EXCEL  /generate-smart/fliki/xlsx
 */
router.post("/fliki/xlsx", async (req, res) => {
  try {
    const { topic, trendData, dnaData, targetAge = "over60" } = req.body;

    const scriptScenes = await buildFlikiScenes({
      topic,
      trendData,
      dnaData,
      targetAge,
    });

    const rows = flikiScenesToRows(scriptScenes);

    const worksheet = XLSX.utils.json_to_sheet(rows);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "FlikiScenes");

    const xlsxBuffer = XLSX.write(workbook, {
      type: "buffer",
      bookType: "xlsx",
    });

    res.setHeader(
      "Content-Disposition",
      'attachment; filename="fliki_scenes_smart.xlsx"'
    );
    res.setHeader(
      "Content-Type",
      "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    );
    res.send(xlsxBuffer);
  } catch (error) {
    console.error(" /generate-smart/fliki/xlsx Error:", error);
    res.status(500).json({ error: "Errore generazione Excel" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generate-smart.js
// ==================================================

// ======================================================
//  /generate-smart  Script Generator SMART
// Integra Trend + Compare + Script generator
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import { safeParseJSON } from "../utils/jsonUtils.js";

const router = express.Router();

router.post("/script", async (req, res) => {
  try {
    const { topic, trendData, dnaData, targetAge = "over50" } = req.body;

    if (!topic || !trendData || !dnaData) {
      return res.status(400).json({
        error: "Missing 'topic', 'trendData' or 'dnaData' in request body."
      });
    }

    const prompt = `
 Genera uno SCRIPT YouTube ottimizzato basato su:

 TOPIC: ${topic}
 TREND DATA (dal modulo Trend DeepSearch):
${JSON.stringify(trendData, null, 2)}

 WINNING CONTENT DNA (dal modulo Compare Transcript):
${JSON.stringify(dnaData, null, 2)}

 TARGET: ${targetAge}, pubblico reale (Italia)
 STILE: Zen Salute e Benessere (caldo, empatico, semplice, autorevole)

 Output richiesto IN JSON, diviso in blocchi precisi:

{
  "hook": "",
  "microStory": "",
  "topicTransition": "",
  "keySections": [
    {"title": "", "content": "", "visualSuggestion": ""}
  ],
  "emotionalTrigger": "",
  "cta": ""
}

Genera contenuti:
 Conversazionali, NON da chatbot
 Empatici per Over50/60/70
 Basati su paure reali, speranze concrete, soluzioni realistiche
 Pronti per Fliki/YouTube

--- INIZIA ---
`;

    const response = await callAIModel(prompt, {
      model: "gpt-4o-mini", // ottimizzato: qualit alta, costo basso
      max_tokens: 3000,
      temperature: 0.7
    });

    const result = safeParseJSON(response);

    return res.json({
      status: "success",
      engine: "SMART",
      targetAge,
      data: result
    });

  } catch (err) {
    console.error(" Errore /generate-smart/script:", err);
    res.status(500).json({ error: "Errore interno generazione script SMART." });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generate.js
// ==================================================

// ============================================================
//  generate.js  Script Builder YouTube Over50/60/70 (79 minuti)
// ============================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import { estimateSceneDurations } from "../utils/wordDuration.js";
import { getDefaultProfile, getProfileByHandle } from "../services/profileManager.js"; 
//   FIX DEFINITIVO: profileManager.js (no profile-Manager.js)

const router = express.Router();

//  RUOLI CONSENTITI
const validRoles = [
  "HOOK",
  "PROBLEMA",
  "SPIEGAZIONE",
  "CAUSE",
  "SOLUZIONI",
  "STILE DI VITA",
  "BENEFICI",
  "MOTIVAZIONE",
  "CTA"
];

/**
 * POST /generate/script
 * Genera uno script YouTube per pubblico Over 50 / Over 60 / Over 70
 * Durata target: 79 minuti con voce Michele 145 wpm
 */
router.post("/script", async (req, res) => {
  try {
    const { idea, handle } = req.body;

    if (!idea) {
      return res.status(400).json({ error: "Missing 'idea' field" });
    }

    //  Auto-profile
    const profile = handle ? getProfileByHandle(handle) : getDefaultProfile();

    const prompt = `
Sei uno YouTube Script Builder professionale per il canale "${profile.channelName}".
Pubblico: ${profile.targetAudience.join(", ")} (Over 50, Over 60, Over 70).
Nicho: ${profile.niche}.
Tono: ${profile.tone}.

Genera SOLO JSON valido, nessun testo esterno.

 OBIETTIVO DURATA (modalit BASE):
- Voce: Michele, 145 parole al minuto
- Durata target: tra 7 e 9 minuti
- Totale parole: idealmente tra 950 e 1200 parole

 STRUTTURA:
- Dividi lo script in 1622 scene
- Ogni scena tra 50 e 75 parole
- id: numero progressivo
- role: HOOK, PROBLEMA, SPIEGAZIONE, CAUSE, SOLUZIONI, STILE DI VITA, BENEFICI, MOTIVAZIONE, CTA
- text: linguaggio naturale, caldo, umano

 INTRO OBBLIGATORIA:
- La PRIMA scena (HOOK) deve:
  - aprire con immagine mentale o domanda forte
  - parlare direttamente a chi ha pi di 50/60/70 anni
  - citare il canale "${profile.channelName}"
  - promettere un beneficio concreto

 OUTRO OBBLIGATORIA:
- LULTIMA scena (CTA) deve:
  - invitare a ISCRIVERSI al canale "${profile.channelName}"
  - ricordare che  dedicato agli Over 50/60/70
  - invitare a commentare e condividere

 JSON FINALE:
{
  "video_title": "",
  "scenes": [
    { "id": 1, "role": "HOOK", "text": "..." }
  ]
}

 REGOLE FERREE:
- Nessun markdown
- Nessun \\n
- Nessuna frase tipo "Scena 1"
- Tono umano, non medico.

Argomento del video:
"${idea}"

Rispondi SOLO con JSON valido.
`;

    const aiRaw = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.7,
      max_tokens: 4500
    });

    const aiResponse =
      typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;

    if (!aiResponse || !aiResponse.scenes || !Array.isArray(aiResponse.scenes)) {
      throw new Error("Invalid AI response format from /generate/script");
    }

    //  Normalizzazione ruoli + testo
    aiResponse.scenes = aiResponse.scenes.map((scene, index) => {
      const cleaned = { ...scene };

      cleaned.id = typeof cleaned.id === "number" ? cleaned.id : index + 1;
      cleaned.role = validRoles.includes(cleaned.role) ? cleaned.role : "CTA";
      cleaned.text = typeof cleaned.text === "string" ? cleaned.text : String(cleaned.text || "");

      return cleaned;
    });

    //  Stima durata
    const {
      scenesWithTime,
      totalWords,
      totalDurationSec,
      totalDurationFormatted
    } = estimateSceneDurations(aiResponse.scenes);

    return res.json({
      success: true,
      result: {
        video_title: aiResponse?.video_title || null,
        profile,
        voiceProfile: {
          id: "michele",
          label: "Michele (naturale, calmo)",
          wpm: 145
        },
        totalWords,
        estimatedDurationSec: totalDurationSec,
        estimatedDurationFormatted: totalDurationFormatted,
        sceneCount: scenesWithTime.length,
        scenes: scenesWithTime
      }
    });

  } catch (err) {
    console.error(" /generate/script error:", err);
    return res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generateDescription.js
// ==================================================

// ============================================================
//  generateDescription.js  Descrizioni + Hashtag + Chapters
// ============================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import {
  getDefaultProfile,
  getProfileByHandle
} from "../services/profileManager.js"; //  FIX DEFINITIVO

const router = express.Router();

/**
 * POST /generate/description
 * Body: { title, idea?, keywords?, handle? }
 */
router.post("/description", async (req, res) => {
  try {
    const { title, idea, keywords = [], handle } = req.body;

    if (!title) {
      return res.status(400).json({ error: "Missing 'title' field" });
    }

    const profile = handle
      ? getProfileByHandle(handle)
      : getDefaultProfile();

    const prompt = `
Sei un YouTube SEO Writer per il canale "${profile.channelName}".
Pubblico: ${profile.targetAudience.join(", ")}.
Linguaggio: italiano.
Tono: semplice, umano, amichevole, non medico.

Genera SOLO JSON valido.

 OBIETTIVO:
- Descrizione ottimizzata per Over 50/60/70
- Invito a iscriversi al canale "${profile.channelName}"
- Testo scorrevole e motivante
- Inserire hashtag rilevanti
- Inserire chapters utili

 FORMATO JSON:
{
  "title": "",
  "description": "",
  "hashtags": ["#esempio1", "#esempio2"],
  "chapters": [
    { "time": "00:00", "label": "Intro" },
    { "time": "01:15", "label": "Problema principale" }
  ]
}

Titolo:
"${title}"

Idea:
"${idea || ""}"

Keywords:
${Array.isArray(keywords) && keywords.length > 0 ? keywords.join(", ") : "nessuna"}

Rispondi SOLO con JSON.
`;

    const aiRaw = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.7,
      max_tokens: 2000
    });

    const aiResponse =
      typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;

    if (!aiResponse || !aiResponse.description) {
      throw new Error("Invalid AI response format from /generate/description");
    }

    return res.json({
      success: true,
      result: {
        profile,
        title: aiResponse.title || title,
        description: aiResponse.description,
        hashtags: aiResponse.hashtags || [],
        chapters: aiResponse.chapters || []
      }
    });
  } catch (err) {
    console.error(" /generate/description error:", err);
    return res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generateRetentionScan.js
// ==================================================

// ============================================================
//  generateRetentionScan.js  Retention Predictor Engine
// ============================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import {
  getDefaultProfile,
  getProfileByHandle,
} from "../services/profileManager.js";   //  FIX DEFINITIVO

const router = express.Router();

async function resolveProfile(profileHandle) {
  try {
    if (profileHandle) {
      const p = await getProfileByHandle(profileHandle);
      if (p) return p;
    }
  } catch (e) {
    console.error(" profileHandle error (retention), fallback:", e);
  }

  try {
    const def = await getDefaultProfile();
    if (def) return def;
  } catch (e) {
    console.error(" getDefaultProfile error (retention):", e);
  }

  return {
    handle: "zen-default-over50-70",
    label: "Over 50/60/70  Salute e Benessere",
    description:
      "Pubblico Over 50, Over 60 e Over 70, interessato a sonno, salute semplice, alimentazione pratica e movimento dolce.",
  };
}

/**
 * POST /generate/retentionScan
 * Analizza uno script (array di scene) e predice punti di drop + suggerimenti
 */
router.post("/retentionScan", async (req, res) => {
  try {
    const { scenes, profileHandle } = req.body || {};

    if (!Array.isArray(scenes) || scenes.length === 0) {
      return res
        .status(400)
        .json({ error: "Provide non-empty 'scenes' array" });
    }

    const profile = await resolveProfile(profileHandle);
    const profileDescription =
      profile?.description || "Pubblico Over 50, Over 60 e Over 70.";

    const scenesForAi = scenes.map((s) => ({
      id: s.id,
      role: s.role,
      text: typeof s.text === "string" ? s.text : String(s.text || ""),
    }));

    const prompt = `
Sei un "Retention Predictor" per YouTube, specializzato in pubblico Over 50/60/70,
per il canale "Zen Salute e Benessere".

Profilo attivo: ${profileDescription}

SCRIPT (scene JSON):
${JSON.stringify(scenesForAi)}

 COMPITO:
Analizza lo script e restituisci SOLO JSON con:

- globalScore: 0100
- strengths: []
- weaknesses: []
- riskZones: [{ sceneId, reason, suggestedFix }]
- highImpactScenes: []
- recommendations: []
- hookRewriteSuggestion: ""

Nessun testo fuori dal JSON.
`;

    const aiResponse = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.55,
      max_tokens: 2500,
    });

    if (typeof aiResponse !== "object" || aiResponse === null) {
      throw new Error("Invalid AI response format from retentionScan");
    }

    return res.json({
      success: true,
      result: aiResponse,
    });
  } catch (err) {
    console.error(" /generate/retentionScan error:", err);
    return res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generateShorts.js
// ==================================================

// =======================================================
//  generateShorts.js  Shorts Generator (Premium)
// =======================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import {
  getDefaultProfile,
  getProfileByHandle
} from "../services/profileManager.js";   //  FIX DEFINITIVO

const router = express.Router();

/**
 * POST /generate/shorts
 * Genera 15 shorts ottimizzati per pubblico Over50/60/70
 * con hook ultra forti e CTA strategiche.
 */
router.post("/shorts", async (req, res) => {
  try {
    const { idea, profileHandle, count = 3 } = req.body || {};

    if (!idea) {
      return res.status(400).json({ error: "Missing 'idea' field" });
    }

    // Carica profilo corretto
    const profile =
      profileHandle
        ? await getProfileByHandle(profileHandle)
        : await getDefaultProfile();

    const profileDescription = profile?.description
      || "Pubblico Over 50, Over 60 e Over 70, interessato a salute, energia, cibo sano, movimenti semplici.";

    const prompt = `
Sei "Zen Shorts Coach Pro", specializzato in pubblico Over 50/60/70.
Crea SOLO JSON valido.

OBIETTIVO:
 Shorts virali (1545 secondi)
 Hook emotivi e shock
 Linguaggio semplice, diretto
 1 CTA finale leggera, non aggressiva

FORMAT JSON:
{
  "shorts": [
    {
      "id": 1,
      "hook": "",
      "body": "",
      "cta": ""
    }
  ]
}

Profilo del canale:
${profileDescription}

Tema richiesto:
"${idea}"

Genera esattamente ${Math.min(Math.max(count, 1), 5)} shorts.
`;

    const aiRaw = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.85,
      max_tokens: 2000
    });

    const aiResponse =
      typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;

    return res.json({
      success: true,
      profile,
      result: aiResponse
    });
  } catch (err) {
    console.error(" /generate/shorts ERROR:", err);
    return res.status(500).json({
      error: "Internal Server Error",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generateThumbnailIdeas.js
// ==================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import {
  getDefaultProfile,
  getProfileByHandle,
} from "../services/profileManager.js";

const router = express.Router();

async function resolveProfile(profileHandle) {
  try {
    if (profileHandle) {
      const p = await getProfileByHandle(profileHandle);
      if (p) return p;
    }
  } catch {}

  try {
    const def = await getDefaultProfile();
    if (def) return def;
  } catch {}

  return {
    handle: "zen-default-over50-70",
    label: "Over 50/60/70  Salute e Benessere",
    description:
      "Pubblico Over 50, Over 60 e Over 70, interessato a sonno, salute semplice, alimentazione pratica e movimento dolce.",
  };
}

router.post("/thumbnailIdeas", async (req, res) => {
  try {
    const { idea, scriptText, profileHandle } = req.body || {};

    if (!idea && !scriptText) {
      return res
        .status(400)
        .json({ error: "Provide at least 'idea' or 'scriptText'" });
    }

    const profile = await resolveProfile(profileHandle);
    const profileDescription = profile?.description;

    const base = scriptText
      ? String(scriptText).slice(0, 2000)
      : `Tema: ${idea}`;

    const prompt = `
Genera 3 idee di thumbnail Over50/60/70 per YouTube.
SOLO JSON:

{
 "thumbnails":[
   {
     "id":1,
     "styleLabel":"",
     "prompt":"",
     "textOverlay":"",
     "colors":[],
     "focalPoint":"",
     "notes":""
   }
 ]
}

Idea:
"${idea}"
`;

    const aiResponse = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.8,
      max_tokens: 1500,
    });

    return res.json({
      success: true,
      result: aiResponse,
    });
  } catch (err) {
    return res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\generateTitle.js
// ==================================================

import express from "express";
import { callAI } from "../services/aiService.js";
import { getDefaultProfile, getProfileByHandle } from "../services/profileManager.js";

const router = express.Router();

router.post("/title", async (req, res) => {
  try {
    const { idea, handle } = req.body;

    if (!idea) {
      return res.status(400).json({ error: "Missing 'idea' field" });
    }

    const profile = handle ? getProfileByHandle(handle) : getDefaultProfile();

    const prompt = `
Sei un Title Engineer per il canale YouTube "${profile.channelName}".
Pubblico: ${profile.targetAudience.join(", ")}.
Crea SOLO JSON valido.

{
  "idea": "",
  "titles": ["t1","t2","t3","t4","t5"],
  "best": ""
}

Argomento:
"${idea}"
`;

    const aiRaw = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.9,
      max_tokens: 1200
    });

    const aiResponse = typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;

    return res.json({
      success: true,
      result: {
        profile,
        idea: aiResponse.idea || idea,
        titles: aiResponse.titles,
        best: aiResponse.best || aiResponse.titles[0]
      }
    });
  } catch (err) {
    return res.status(500).json({ error: "Internal Server Error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\hashtag-opt.js
// ==================================================

// ======================================================
// # /hashtag-opt  Generatore hashtag ottimizzati
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body:
 * {
 *   "topic": "tema o titolo video",
 *   "audience": "over60",
 *   "forceProvider": "auto"
 * }
 */
router.post("/", async (req, res) => {
  try {
    const {
      topic,
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!topic) {
      return res.status(400).json({
        ok: false,
        error: "Missing 'topic'"
      });
    }

    const prompt = `
Genera hashtag per un video YouTube (e Shorts) sul tema:
"${topic}"
Target: ${audience}

Rispondi SOLO JSON:
{
  "hashtagYouTube": ["#...","#..."],
  "hashtagShorts": ["#shorts","#..."],
  "mixConsigliato": ["#...","#..."]
}
`.trim();

    const aiResp = await callAIModel(prompt, "json", {
      task: "hashtag-opt",
      temperature: 0.3,
      maxTokens: 2500,
      forceProvider
    });

    if (aiResp?.error) {
      return res.status(502).json({
        ok: false,
        error: "AI hashtag optimization failed",
        details: aiResp
      });
    }

    return res.json({
      ok: true,
      providerUsed: forceProvider,
      data: aiResp
    });

  } catch (err) {
    console.error(" /hashtag-opt ERROR:", err);
    res.status(500).json({
      ok: false,
      error: "hashtag-opt route crashed",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\health.js
// ==================================================

// ======================================================
//  Health Check  Zen YouTube Coach Pro (FULL COMPATIBILITY)
// ======================================================

import express from "express";
const router = express.Router();

// Risposta standard
function baseResponse() {
  return {
    status: "OK",
    timestamp: new Date().toISOString(),
    uptime_seconds: process.uptime(),
    memory: process.memoryUsage(),
    node: process.version,
    environment: process.env.NODE_ENV || "development",
    app: "Zen YouTube Coach Pro",
    version: "Ultra-Premium 2025"
  };
}

// ----------------------
// ROUTE PRINCIPALE
// ----------------------
router.get("/", (req, res) => {
  res.json(baseResponse());
});

// ----------------------
// WILDCARDS COMPLETE
// ----------------------
router.get("/*", (req, res) => {
  res.json(baseResponse());
});

// Esporta
export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\hook-generator.js
// ==================================================

// ======================================================
//  /hook-generator  Hook Engine Premium
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

router.post("/", async (req,res)=>{
  try{
    const {topic, audience="over60",forceProvider="auto"}=req.body;
    if(!topic) return res.status(400).json({ok:false,error:"Missing topic"});

    const prompt=`
Genera hook narrativi per: "${topic}"
Target: ${audience}

SOLO JSON:
{
  "hooks":[
    {"tipo":"shock","testo":"..."},
    {"tipo":"promessa","testo":"..."},
    {"tipo":"domanda","testo":"..."}
  ]
}
`;

    const out=await callAIModel(prompt,"json",{
      task:"hook",
      temperature:0.4,
      maxTokens:2500,
      forceProvider
    });

    res.json({ok:true,data:out});

  }catch(e){
    res.status(500).json({ok:false,error:e.message});
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\import-transcript.js
// ==================================================

// ======================================================================
//  import-transcript.js   Zen YouTube Coach Pro
// Endpoint UNIFICATO per importare transcript in un solo passaggio.
// ======================================================================

import express from "express";
import { getTranscript } from "../services/transcriptService.js";

const router = express.Router();

/**
 * POST /transcript/import
 *
 * Body:
 * {
 *   "videoUrl": "https://www.youtube.com/watch?v=...",
 *   "manualTranscript": "...",
 *   "manualSummary": "...",
 *   "debug": false
 * }
 */
router.post("/", async (req, res) => {
  try {
    const {
      videoUrl,
      manualTranscript,
      manualSummary,
      debug = false,
    } = req.body || {};

    if (!videoUrl) {
      return res.status(400).json({
        success: false,
        error: true,
        message: "videoUrl mancante. Devi fornire almeno l'URL del video YouTube.",
      });
    }

    //  Step 1  Estrarre Transcript con priorit assoluta a manualTranscript
    const transcriptResult = await getTranscript(videoUrl, {
      manualTranscript,
      manualSummary,
      forceRefresh: true,
      debug,
    });

    if (!transcriptResult.success) {
      return res.status(500).json({
        success: false,
        error: true,
        message: "Errore nell'import del transcript.",
        details: transcriptResult.message || "Unknown error.",
      });
    }

    //  Step 2  Preparare output UI Friendly
    const response = {
      success: true,
      imported: true,
      provider: transcriptResult.provider,
      videoId: transcriptResult.videoId,
      transcriptLength: transcriptResult.continuousText.length,
      preview: transcriptResult.continuousText.slice(0, 500) + "",
      fullTranscript: transcriptResult.continuousText,
      timestamp: new Date().toISOString(),

      //  Step successivi disponibili
      nextActions: {
        analyze: "/analyze-transcript",
        compare: "/compare-transcript",
        compareVideos: "/compare-videos",
        retention: "/retention-analyze",
        titles: "/generateTitle",
        script: "/generateScriptPro",
        thumbnails: "/generateThumbnailIdeas",
      },
    };

    return res.json(response);
  } catch (error) {
    console.error(" Errore in /transcript/import:", error);
    return res.status(500).json({
      success: false,
      error: true,
      message: "Errore interno durante l'import transcript.",
      details: error.message,
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\improve.js
// ==================================================

// src/routes/improve.js
import express from "express";
import { callAI } from "../services/aiService.js";

const router = express.Router();

/**
 * Migliora titolo e descrizione YouTube
 * POST /improve
 * Body: { title: "...", description: "..." }
 */
router.post("/", async (req, res) => {
  try {
    const { title, description } = req.body;

    if (!title && !description) {
      return res.status(400).json({ error: "Missing fields: provide title or description" });
    }

    const prompt = `
Migliora questo titolo e descrizione YouTube mantenendoli efficaci per CTR e SEO. 
Rispondi SOLO JSON:

{
  "title": "",
  "description": ""
}

Contenuti da migliorare:
- Titolo: "${title || ""}"
- Descrizione: "${description || ""}"
`;

    const raw = await callAI(prompt);

    try {
      const json = JSON.parse(raw);
      return res.json(json);
    } catch (e) {
      return res.json({ raw, error: "JSON parse failed, but AI response received." });
    }

  } catch (err) {
    console.error("Improve error:", err);
    res.status(500).json({ error: "Improve processing failed" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\keyword-research.js
// ==================================================

// ======================================================
//  /keyword-research  Ricerca keyword strategica
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body:
 * {
 *   "topic": "argomento principale",
 *   "audience": "over60",
 *   "forceProvider": "auto"
 * }
 */
router.post("/", async (req, res) => {
  try {
    const {
      topic,
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!topic) {
      return res.status(400).json({
        ok: false,
        error: "Missing 'topic'"
      });
    }

    const prompt = `
Sei un tool tipo VidIQ/Tubebuddy ma pi intelligente.
Tema: "${topic}"
Target: ${audience}

Genera SOLO JSON:

{
  "keywordPrincipale": "keyword",
  "keywordSecondarie": ["..."],
  "longTail": ["..."],
  "ideeTagYouTube": ["tag1", "tag2", "tag3"],
  "angoliRicerca": [
    {
      "nome": "dolore|desiderio|segreto",
      "esempi": ["...","..."]
    }
  ]
}
`.trim();

    const aiResp = await callAIModel(prompt, "json", {
      task: "keyword-research",
      temperature: 0.3,
      maxTokens: 4000,
      forceProvider
    });

    if (aiResp?.error) {
      return res.status(502).json({
        ok: false,
        error: "AI keyword research failed",
        details: aiResp
      });
    }

    return res.json({
      ok: true,
      providerUsed: forceProvider,
      data: aiResp
    });

  } catch (err) {
    console.error(" /keyword-research ERROR:", err);
    res.status(500).json({
      ok: false,
      error: "keyword-research route crashed",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\multi-analyze-transcript.js
// ==================================================

// ======================================================
//  /multi-analyze-transcript  Versione PRO
// Analisi multipla (3-5 transcript) con ranking
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import { getProfileByHandle, getDefaultProfile } from "../services/profileManager.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { transcripts, handle } = req.body;

    //  Serve un array con almeno 3 transcript
    if (!Array.isArray(transcripts) || transcripts.length < 3) {
      return res.status(400).json({
        error: true,
        message: "Servono almeno 3 transcript in un array chiamato 'transcripts'"
      });
    }

    if (transcripts.length > 5) {
      return res.status(400).json({
        error: true,
        message: "Massimo 5 transcript per analisi multipla"
      });
    }

    //  Profilo canale
    const channelProfile = handle
      ? getProfileByHandle(handle)
      : getDefaultProfile();

    if (!channelProfile) {
      return res.status(500).json({
        error: true,
        message: "Profilo canale non trovato"
      });
    }

    //  Prompt AI  JSON strutturato e PULITO
    const aiPrompt = `
Confronta i seguenti transcript video YouTube (pubblico over 50/60/70):

${JSON.stringify(transcripts, null, 2)}

Profilo canale:
${JSON.stringify(channelProfile, null, 2)}

Analizza SOLO questi criteri:
1 Hook iniziale (impatto, chiarezza, empatia)
2 Retention (capacit di mantenere attenzione)
3 Linguaggio e chiarezza (semplicit, comprensibilit)
4 Coinvolgimento emotivo (storie, paure, motivazione)
5 Adattabilit a Over50/60/70
6 CTA finale  efficacia per pubblico over

 OUTPUT OBBLIGATORIO (JSON puro, niente Markdown, niente testi extra):
{
  "ranking": [
    { "position": 1, "videoIndex": 0, "reason": "" },
    { "position": 2, "videoIndex": 2, "reason": "" }
  ],
  "hook_scores": {
    "0": "",
    "1": "",
    "2": ""
  },
  "retention_scores": {
    "0": "",
    "1": "",
    "2": ""
  },
  "over70_fit_scores": {
    "0": "",
    "1": "",
    "2": ""
  },
  "strength_matrix": [
    {
      "videoIndex": 0,
      "hook_strength": "",
      "emotional_trigger": "",
      "cta_effectiveness": "",
      "main_weakness": ""
    }
  ],
  "best_video": ""
}

 Nessun commento, nessuna spiegazione fuori dal JSON.
`;

    //  Chiamata AI
    const raw = await callAIModel(aiPrompt, "text");

    //  Pulisci & converte JSON
    const start = raw.indexOf("{");
    const end = raw.lastIndexOf("}");
    const cleanedJSON = JSON.parse(raw.slice(start, end + 1));

    return res.status(200).json({
      channelProfile,
      comparison: cleanedJSON
    });

  } catch (error) {
    console.error(" /multi-analyze-transcript ERROR:", error);
    res.status(500).json({ error: "Errore interno server" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\outlier-engine.js
// ==================================================

// ============================================================
//  OUTLIER ANALYZER  Zen YouTube Coach Pro (Ultra Premium)
// Analisi predittiva dei video: hook, ritenzione, narrativa,
// potenziale virale, punti deboli, fix immediati.
// ============================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import { extractYouTubeId, fetchTranscript } from "../services/youtubeTools.js";

const router = express.Router();

// Debug rapido: verifica che la route sia montata
router.get("/ping", (req, res) => {
  return res.json({
    ok: true,
    route: "/outlier-engine/ping",
    message: "Outlier Engine attivo",
  });
});

// ---------------------------------------------
//  Prompt: algoritmo Outlier Analyzer
// ---------------------------------------------
function buildPrompt(transcript, audience) {
  return `
Sei "Zen Outlier Engine", lAI pi avanzata al mondo per la previsione delle performance video.
Analizza questo transcript e produci:

1. Valutazioni numeriche (0100):
   - Viral Potential
   - Hook Power
   - Retention Forecast
   - Emotional Energy
   - Novelty Factor

2. Analisi qualitativa:
   - Analisi primi 30 secondi
   - Ritmo narrativo
   - Mappa emozionale
   - Forza dellidea
   - Chiarezza della promessa

3. Diagnosi profonda:
   - 5 punti di forza
   - 5 punti deboli
   - 5 opportunit di crescita
   - 5 fix immediati

4. Previsioni:
   - Performance previsionale a 24h, 48h, 7 giorni

Target: pubblico ${audience}.

Rispondi SOLO in questo JSON:

{
  "score": {
    "viralPotential": 0,
    "hookPower": 0,
    "retentionForecast": 0,
    "emotionalEnergy": 0,
    "noveltyFactor": 0
  },
  "analysis": {
    "hook": "",
    "structure": "",
    "strengths": [],
    "weaknesses": [],
    "opportunities": [],
    "immediateFixes": [],
    "predictions": {
      "24h": "",
      "48h": "",
      "7days": ""
    }
  }
}

TRANSCRIPT ANALIZZATO:
${transcript}
`;
}

// ---------------------------------------------
//  Route principale
// ---------------------------------------------
router.post("/", async (req, res) => {
  try {
    const { url, audience } = req.body;
    if (!url) return res.status(400).json({ error: "URL mancante." });

    const videoId = extractYouTubeId(url);
    if (!videoId) return res.status(400).json({ error: "URL YouTube non valido." });

    // Recupera transcript
    const transcript = await fetchTranscript(videoId);
    if (!transcript) {
      return res.status(500).json({ error: "Impossibile estrarre il transcript." });
    }

    // Prepara il prompt
    const prompt = buildPrompt(transcript, audience || "over60");

    // Chiama il modello AI
    const aiResponse = await callAIModel(prompt, "json");

    res.json({
      success: true,
      outlier: aiResponse
    });

  } catch (error) {
    console.error(" Errore OUTLIER ENGINE:", error);
    res.status(500).json({ error: "Errore interno del server." });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\outline-generator.js
// ==================================================

// ======================================================
//  /outline-generator  Generatore scaletta video
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body:
 * {
 *   "topic": "tema del video",
 *   "audience": "over60",
 *   "forceProvider": "auto|groq|openai"
 * }
 */
router.post("/", async (req, res) => {
  try {
    const {
      topic,
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!topic) {
      return res.status(400).json({
        ok: false,
        error: "Missing 'topic'"
      });
    }

    const prompt = `
Genera una scaletta dettagliata per un video YouTube sul tema:
"${topic}"
Target: ${audience} (salute, benessere, longevit).

Rispondi SOLO con JSON nel formato:

{
  "titoloProposto": "...",
  "hookIniziale": "...",
  "sezioni": [
    {
      "titolo": "Sezione 1",
      "obiettivo": "Cosa deve capire/sentire lo spettatore",
      "puntiChiave": ["punto 1", "punto 2"],
      "durataStimataSec": 60
    }
  ],
  "ctaFinale": "Testo CTA finale"
}
`.trim();

    const aiResp = await callAIModel(prompt, "json", {
      task: "outline",
      temperature: 0.35,
      maxTokens: 4000,
      forceProvider
    });

    if (aiResp?.error) {
      return res.status(502).json({
        ok: false,
        error: "AI outline generation failed",
        details: aiResp
      });
    }

    return res.json({
      ok: true,
      providerUsed: forceProvider,
      data: aiResp
    });

  } catch (err) {
    console.error(" /outline-generator ERROR:", err);
    res.status(500).json({
      ok: false,
      error: "outline-generator route crashed",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\pattern-for-me.js
// ==================================================

// =========================================================
//  pattern-for-me.js  Personal Pattern Generator
// Zen YouTube Coach Pro  AI Engine 3.0
// =========================================================

import express from "express";
import { callAI } from "../services/aiService.js";

const router = express.Router();

/**
 * POST /pattern-for-me
 * Genera una versione personalizzata dei pattern narrativi
 * per pubblico Over 50/60/70 + stile Zen Salute e Benessere.
 */
router.post("/", async (req, res) => {
  try {
    const { basePattern, topic } = req.body || {};

    if (!basePattern) {
      return res.status(400).json({
        error: true,
        message: "Missing 'basePattern' field."
      });
    }

    const prompt = `
Sei "Zen Narrative Pattern Master", esperto in storytelling Over50/60/70.

Genera SOLO JSON.

OBIETTIVO:
Adatta il seguente pattern narrativo per:
- pubblico Over 50/60/70
- canale "Zen Salute e Benessere"
- tono umano, empatico, semplice
- ritmo narrativo rapido ma dolce

PATTERN ORIGINALE:
${JSON.stringify(basePattern, null, 2)}

TEMA (opzionale):
${topic || "Nessun tema specifico"}

FORMAT JSON:
{
  "adaptedPattern": {
     "steps": [],
     "notes": ""
  }
}
`;

    const aiRaw = await callAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.65,
      max_tokens: 2500
    });

    const aiResponse =
      typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;

    return res.json({
      success: true,
      result: aiResponse
    });

  } catch (err) {
    console.error(" /pattern-for-me ERROR:", err);
    return res.status(500).json({
      error: "Internal Server Error",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\pattern.js
// ==================================================

// ==========================================================
//  pattern.js  Video Pattern Analyzer (AI Engine 3.0)
// ==========================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * POST /pattern
 * Analizza una trascrizione e restituisce:
 * - struttura narrativa
 * - punti di forza
 * - punti deboli
 * - pattern narrativo ricorrente
 * Versione compatibile con AI Engine 3.0
 */
router.post("/", async (req, res) => {
  try {
    const { transcript } = req.body;

    if (!transcript) {
      return res.status(400).json({
        error: "Missing 'transcript' field."
      });
    }

    const prompt = `
Sei "Zen Pattern Master AI".
Analizza il seguente transcript e restituisci SOLO JSON valido.

TRANSCRIPT:
${transcript.slice(0, 8000)}

FORMAT JSON:
{
  "structure": [],
  "strengths": [],
  "weaknesses": [],
  "recurringPattern": "",
  "insights": []
}
`;

    const ai = await callAIModel(prompt, "json", {
      task: "pattern-analysis",
      temperature: 0.5,
      maxTokens: 2500,
    });

    return res.json({
      success: true,
      result: ai
    });

  } catch (err) {
    console.error(" /pattern ERROR:", err);
    return res.status(500).json({
      error: "Internal Server Error",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\predict.js
// ==================================================

import express from "express";
import OpenAI from "openai";
import { OPENAI_API_KEY } from "../config/openai.js";

const client = new OpenAI({ apiKey: OPENAI_API_KEY });
const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { title, description } = req.body;

    const prompt = `
Stima potenziale CTR e retention per:
TITOLO: ${title}
DESCRIZIONE: ${description}
Rispondi SOLO JSON:
{
  "ctr": 0,
  "retention": 0,
  "warning": ""
}
`;

    const response = await client.responses.create({
      model: "gpt-4.1-mini",
      input: prompt,
    });

    res.json(JSON.parse(response.output_text));

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Predict error" });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\profile-manager.js
// ==================================================

// =======================================================
//  profile-manager.js  Route per gestione profili AI
// Compatibile con AI Engine 3.0
// =======================================================

import express from "express";
import {
  getDefaultProfile,
  getProfileByHandle
} from "../services/profileManager.js";   //  IMPORT CORRETTO

const router = express.Router();

/**
 * GET /profile/default
 * Restituisce il profilo di default
 */
router.get("/default", async (req, res) => {
  try {
    const profile = await getDefaultProfile();

    return res.json({
      success: true,
      profile
    });
  } catch (err) {
    console.error(" /profile/default ERROR:", err);
    return res.status(500).json({
      error: "Server error"
    });
  }
});

/**
 * GET /profile/:handle
 * Restituisce il profilo specificato dal suo handle
 */
router.get("/:handle", async (req, res) => {
  try {
    const { handle } = req.params;

    const profile = await getProfileByHandle(handle);

    if (!profile) {
      return res.status(404).json({
        error: `Profilo '${handle}' non trovato`
      });
    }

    return res.json({
      success: true,
      profile
    });
  } catch (err) {
    console.error(" /profile/:handle ERROR:", err);
    return res.status(500).json({
      error: "Server error"
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\retention-analyze.js
// ==================================================

// ======================================================
//  /retention-analyze  Retention AI MASTER
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const {
      transcript,
      audience = "over60",
      forceProvider = "auto"
    } = req.body;

    if (!transcript) return res.status(400).json({ ok: false, error: "Missing transcript" });

    const prompt = `
Analizza questo transcript per individuare i punti di drop-off.
Genera SOLO JSON:

{
  "puntiCritici": [
    {
      "timestampStimato": "0:30",
      "problema": "...",
      "rimedio": "..."
    }
  ],
  "momentiForti": ["..."],
  "riscrittureSuggerite": ["..."]
}

Transcript:
${transcript}
`;

    const aiResp = await callAIModel(prompt, "json", {
      task: "retention",
      temperature: 0.3,
      maxTokens: 4000,
      forceProvider
    });

    res.json({ ok: true, data: aiResp });

  } catch (err) {
    res.status(500).json({ ok: false, error: err.message });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\script-from-video.js
// ==================================================

// ======================================================
//  /script-from-video  Generate Script from Video Info
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import { getTranscript } from "../services/transcriptService.js";
import { getVideoInfo } from "../services/videoInfoService.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { videoUrl, audience = "over60", forceProvider = "auto" } = req.body;

    if (!videoUrl) return res.status(400).json({ ok: false, error: "Missing videoUrl" });

    const videoId = extractId(videoUrl);
    const transcript = await getTranscript(videoId);
    const info = await getVideoInfo(videoId);

    const prompt = `
Genera script completo stile Zen Salute e Benessere.
Pubblico: ${audience}
Titolo originale: ${info.data.title}

Transcript base:
${transcript.continuousText}

Rispondi JSON:
{
  "script": "...",
  "hook": "...",
  "sezioni": ["..."],
  "cta": "..."
}
`;

    const aiResp = await callAIModel(prompt, "json", {
      task: "script-drafting",
      temperature: 0.35,
      maxTokens: 6500,
      forceProvider
    });

    res.json({ ok: true, data: aiResp });

  } catch (err) {
    res.status(500).json({ ok: false, error: err.message });
  }
});

function extractId(u) {
  let m = u.match(/v=([\w-]{11})/); if (m) return m[1];
  m = u.match(/youtu\.be\/([\w-]{11})/); if (m) return m[1];
  return null;
}

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\shorts-generator.js
// ==================================================

// ======================================================
//  /shorts-generator  Ideen e script per Shorts
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body:
 * {
 *   "topic": "tema opzionale",
 *   "transcript": "testo lungo opzionale",
 *   "audience": "over60",
 *   "forceProvider": "auto"
 * }
 * Almeno topic O transcript devono essere presenti.
 */
router.post("/", async (req, res) => {
  try {
    const {
      topic = "",
      transcript = "",
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!topic && !transcript) {
      return res.status(400).json({
        ok: false,
        error: "Provide at least 'topic' or 'transcript'"
      });
    }

    const base = topic || transcript.slice(0, 2000);

    const prompt = `
Genera idee di YouTube Shorts sul tema seguente:
"${base}"

Target: ${audience}

Rispondi SOLO con JSON nel formato:

{
  "shorts": [
    {
      "titolo": "Titolo breve",
      "hookIniziale": "prima frase che blocca lo scroll",
      "script": "testo completo (max 45-50 secondi)",
      "testoSovraimpresso": ["max 3-4 parole"],
      "callToAction": "..."
    }
  ]
}
`.trim();

    const aiResp = await callAIModel(prompt, "json", {
      task: "shorts",
      temperature: 0.45,
      maxTokens: 5000,
      forceProvider
    });

    if (aiResp?.error) {
      return res.status(502).json({
        ok: false,
        error: "AI shorts generation failed",
        details: aiResp
      });
    }

    return res.json({
      ok: true,
      providerUsed: forceProvider,
      data: aiResp
    });

  } catch (err) {
    console.error(" /shorts-generator ERROR:", err);
    res.status(500).json({
      ok: false,
      error: "shorts-generator route crashed",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\thumbnail-ideas.js
// ==================================================

// ======================================================
//  /thumbnail-ideas  Thumbnail Psychology CTR Boost
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const {
      topic,
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!topic) return res.status(400).json({ ok: false, error: "Missing topic" });

    const prompt = `
Genera idee per una thumbnail YouTube per il tema: "${topic}".
Target: ${audience}

Rispondi SOLO JSON:
{
  "testiSovraimpressi": ["3-5 parole", "alternative"],
  "visualConcepts": [
    {"idea": "...", "elementi": "...", "palette": "..."}
  ],
  "psicologia": "perche funziona"
}
`;

    const aiResp = await callAIModel(prompt, "json", {
      task: "thumbnail-opt",
      temperature: 0.35,
      maxTokens: 3000,
      forceProvider
    });

    res.json({ ok: true, data: aiResp });

  } catch (err) {
    res.status(500).json({ ok: false, error: err.message });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\title-opt.js
// ==================================================

// ======================================================
//  /title-opt  CTR Title Optimizer (AI Engine 3.0)
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const {
      title,
      audience = "over60",
      forceProvider = "auto"
    } = req.body || {};

    if (!title) {
      return res.status(400).json({ ok: false, error: "Missing title" });
    }

    const prompt = `
Ottimizza questo titolo YouTube per massimo CTR per pubblico ${audience}:

"${title}"

Genera SOLO JSON:
{
  "varianti": [
    { "titolo": "...", "angolo": "...", "potenza": "alta|media|bassa" }
  ],
  "percheFunzionano": "...",
  "versioneMigliore": "..."
}
`;

    const aiResp = await callAIModel(prompt, "json", {
      task: "title-opt",
      temperature: 0.35,
      maxTokens: 3000,
      forceProvider
    });

    if (aiResp?.error) return res.status(502).json({ ok: false, error: aiResp });

    res.json({ ok: true, providerUsed: forceProvider, data: aiResp });

  } catch (err) {
    res.status(500).json({ ok: false, error: "title-opt crash", details: err.message });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\transcript.js
// ==================================================

// ===========================================================================
//   /transcript  Transcript Engine Ultra-Premium
//  USA LA PIPELINE COMPLETA:
//  1) YouTube timedtext
//  2) HTML captionTracks
//  3) Whisper fallback (placeholder, integrabile)
//  4) AI Summary fallback (placeholder, integrabile)
//
//  Questo  lo stesso approccio usato da YouTube Summary, Glasp e Eightify.
// ===========================================================================

import express from "express";
import { extractYouTubeId, fetchTranscript } from "../services/youtubeTools.js";

const router = express.Router();

// ===========================================================================
//  POST /transcript
// ===========================================================================
router.post("/", async (req, res) => {
  try {
    const { url } = req.body;

    if (!url) {
      return res.status(400).json({
        success: false,
        error: "URL mancante. Devi fornire un link YouTube.",
      });
    }

    // Estrazione videoId
    const videoId = extractYouTubeId(url);
    if (!videoId) {
      return res.status(400).json({
        success: false,
        error: "URL non valido. Impossibile estrarre il videoId.",
      });
    }

    console.log(` Richiesta transcript per videoId: ${videoId}`);

    // Pipeline Ultra-Premium
    const transcript = await fetchTranscript(videoId);

    if (!transcript) {
      return res.status(500).json({
        success: false,
        error: " Nessun transcript disponibile (tutti i livelli falliti).",
        details:
          "Possibile: video senza sottotitoli, HTML non accessibile, Whisper non attivo, fallback AI non disponibile.",
      });
    }

    // Tutto OK
    return res.json({
      success: true,
      videoId,
      length: transcript.length,
      transcript,
    });
  } catch (err) {
    console.error(" Errore interno /transcript:", err);

    return res.status(500).json({
      success: false,
      error: "Errore interno del server.",
      details: err.message,
    });
  }
});

// ===========================================================================
//  GET /transcript/ping   per test rapido
// ===========================================================================
router.get("/ping", (req, res) => {
  res.json({
    ok: true,
    route: "/transcript/ping",
    message: "Transcript Engine Ultra-Premium attivo",
  });
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\trend-deepsearch.js
// ==================================================

// =====================================================================
//   /trend-deepsearch.js  VERSIONE TOP BEST ULTRA-PREMIUM
//  Trend Scanner AI Over50/60/70
//  Livello oltre VidIQ, Glasp, TubeBuddy.
// =====================================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import {
  getProfileByHandle,
  getDefaultProfile,
} from "../services/profileManager.js";

const router = express.Router();

// ---------------------------------------------------------
//  UTIL  Estrazione JSON robusta
// ---------------------------------------------------------
function extractValidJson(text) {
  try {
    const first = text.indexOf("{");
    const last = text.lastIndexOf("}");
    if (first === -1 || last === -1) return null;
    return text.substring(first, last + 1);
  } catch {
    return null;
  }
}

// ---------------------------------------------------------
//  UTIL  Fix JSON
// ---------------------------------------------------------
function autoFixJsonString(str) {
  if (!str || typeof str !== "string") return str;

  return str
    .replace(/,\s*}/g, "}")
    .replace(/,\s*]/g, "]")
    .replace(/[\u2018\u2019]/g, "'")
    .replace(/[\u201C\u201D]/g, '"');
}

// ---------------------------------------------------------
//   Prompt Premium  Trend Deep Search
// ---------------------------------------------------------
function buildTrendPrompt(query, profile) {
  return `
Sei "Zen YouTube Coach Pro  TrendDeepSearch Engine", versione TOP BEST Ultra-Premium.

Analizza il TREND attorno al seguente tema:
"${query}"

Target: Over50 / Over60 / Over70
Profilo: ${profile.label}

OBIETTIVI:
- Scoprire le migliori opportunit di contenuti YouTube attuali.
- Analizzare trend globali, microtrend, long-tail, topic emergenti.
- Identificare i formati pi performanti.
- Capire cosa funziona nel pubblico Over50/60/70.
- Creare idee originali, uniche e non saturate.
- Fornire hooks e thumbnail concept psicologicamente ottimali.
- Detectare i GAP rispetto ai competitor.

Rispondi SOLO in JSON con questa struttura:

{
  "topic": "",
  "query": "",
  "interestLevelOver50": "",
  "interestLevelOver60": "",
  "interestLevelOver70": "",
  "trendCategory": "",
  "globalInsights": {
    "whyNow": "",
    "problemAudienceFeels": "",
    "emotionalDrivers": [],
    "informationGaps": []
  },
  "opportunityRanking": [
    {
      "title": "",
      "reason": "",
      "competitionLevel": "",
      "audienceDesireScore": 0,
      "uniquenessScore": 0,
      "formatRecommended": "",
      "idealDurationMinutes": 0
    }
  ],
  "longTailGems": [
    {
      "keyword": "",
      "whyWorks": "",
      "audienceIntent": ""
    }
  ],
  "videoIdeas": [
    {
      "title": "",
      "hook": "",
      "thumbnailConcept": "",
      "angle": "",
      "whyThisWorksOver50_60_70": ""
    }
  ],
  "competitorGapAnalysis": {
    "whatOthersMiss": [],
    "differentiationPoints": [],
    "contentAnglesToOwn": []
  },
  "scriptBlueprint": {
    "openingHook": "",
    "introAngle": "",
    "mainSections": [],
    "storytellingElement": "",
    "finalCTA": ""
  },
  "tags": [],
  "searchQueries": []
}

REGOLE:
- Nessun testo fuori dal JSON.
- Nessuna frase extra.
- Se non sai una sezione, usa "" o [] o 0.
`;
}

// ---------------------------------------------------------
//   Endpoint: Trend DeepSearch Pro
// ---------------------------------------------------------
router.post("/trend-deepsearch-pro", async (req, res) => {
  try {
    const { query, profileHandle } = req.body;

    if (!query || typeof query !== "string") {
      return res.status(400).json({
        success: false,
        error: "Parametro 'query' mancante o non valido.",
      });
    }

    // Profilo
    const profile =
      getProfileByHandle(profileHandle) || getDefaultProfile();

    // Prompt
    const prompt = buildTrendPrompt(query, profile);

    //  AI Request
    const aiResponse = await callAIModel(prompt);

    // Estrazione JSON
    let jsonRaw = extractValidJson(aiResponse);
    if (!jsonRaw) jsonRaw = extractValidJson(autoFixJsonString(aiResponse));

    if (!jsonRaw) {
      return res.status(500).json({
        success: false,
        error: "Impossibile estrarre JSON dalla risposta AI.",
        raw: aiResponse,
      });
    }

    // Fix finale
    const fixedJson = autoFixJsonString(jsonRaw);

    // Parsing
    let parsed;
    try {
      parsed = JSON.parse(fixedJson);
    } catch (err) {
      return res.status(500).json({
        success: false,
        error: "JSON non valido dopo fix.",
        original: aiResponse,
        extracted: jsonRaw,
        fixed: fixedJson,
      });
    }

    // Risposta finale
    return res.json({
      success: true,
      meta: {
        profile: profile.label,
        query,
      },
      result: parsed,
    });
  } catch (err) {
    console.error("ERRORE TREND DEEPSEARCH:", err);
    return res.status(500).json({
      success: false,
      error: "Errore interno TrendDeepSearch",
      details: err.message,
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\trend-scan.js
// ==================================================

// ======================================================
//  /trend-scan  Trend Scanner PRO v2
// Analisi AI dei trend per nicchia + Over 50/60/70
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";

const router = express.Router();

/**
 * Body atteso:
 * {
 *   "niche": "sonno over 60",
 *   "audience": "over60",
 *   "language": "it",
 *   "mode": "explore" | "doubleDown" | "rescue"
 * }
 */

router.post("/", async (req, res) => {
  try {
    const {
      niche = "salute e benessere over 60",
      audience = "over60",
      language = "it",
      mode = "explore"
    } = req.body || {};

    const modeLabel =
      mode === "doubleDown"
        ? "individua cosa sta gi funzionando e come spingerlo ancora di pi"
        : mode === "rescue"
        ? "aiuta un canale in difficolt a riprendersi"
        : "scansiona la nicchia e intercetta i temi caldi emergenti";

    const prompt = `
Sei Zen YouTube Coach Pro, analista YouTube specializzato in pubblico ${audience} (Over 50/60/70)
per la nicchia: "${niche}".

Lingua preferita dei contenuti: ${language === "it" ? "Italiano" : "Inglese"}.

Modalit: ${mode}  il tuo compito : ${modeLabel}.

Senza inventare dati falsi di analytics, ma ragionando sui trend reali e prevedibili della nicchia,
genera un piano strategico YouTube.

 RESTITUISCI SOLO UN JSON con questa struttura (nessun testo fuori dal JSON):

{
  "trendPrincipali": ["...", "..."],
  "formatiCheFunzionano": ["...", "..."],
  "ideeVideoLunghi": [
    {
      "titolo": "...",
      "angolo": "...",
      "percheFunzionaOver50": "...",
      "hookSuggerito": "..."
    }
  ],
  "ideeShorts": [
    {
      "titolo": "...",
      "concept": "...",
      "cta": "..."
    }
  ],
  "hookPatterns": ["...", "..."],
  "erroriDaEvitare": ["...", "..."],
  "calendarSuggerito": {
    "frequenza": "es. 3 video lunghi + 5 shorts a settimana",
    "giorniConsigliati": ["Luned", "Mercoled", "Sabato"],
    "note": "..."
  },
  "noteStrategiche": "..."
}
`.trim();

    // Prima passata: Groq
    let raw = await callAIModel(prompt, "text", {
      provider: "groq",
      temperature: 0.25,
      maxTokens: 6500
    });

    const extractJSON = (txt) => {
      try {
        const first = txt.indexOf("{");
        const last = txt.lastIndexOf("}");
        if (first === -1 || last === -1) return null;
        return JSON.parse(txt.substring(first, last + 1));
      } catch {
        return null;
      }
    };

    let parsed = extractJSON(raw);

    if (!parsed) {
      console.warn(" /trend-scan: fallback a GPT-4o-mini");
      raw = await callAIModel(prompt, "text", {
        provider: "openai",
        model: "gpt-4o-mini",
        temperature: 0.15,
        maxTokens: 7500
      });
      parsed = extractJSON(raw);
    }

    if (!parsed) {
      return res.status(500).json({
        success: false,
        message: "AI ha prodotto JSON non valido in /trend-scan.",
        raw
      });
    }

    return res.json({
      success: true,
      niche,
      audience,
      mode,
      data: parsed
    });
  } catch (err) {
    console.error(" /trend-scan ERROR:", err);
    return res.status(500).json({
      success: false,
      message: "Errore interno /trend-scan: " + err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\video-info.js
// ==================================================

// ======================================================
//  /video-info  Zen YouTube Coach Pro (2025)
// Estrae TUTTE le informazioni del video YouTube
// Usando videoInfoService ENTERPRISE
// ======================================================

import express from "express";
import { getVideoInfo } from "../services/videoInfoService.js";

const router = express.Router();

/**
 * Estrae ID video da una URL YouTube
 */
function extractVideoId(videoUrl) {
  if (!videoUrl || typeof videoUrl !== "string") return null;

  // https://www.youtube.com/watch?v=XXXXXXXXXXX
  let match = videoUrl.match(/v=([a-zA-Z0-9_-]{11})/);
  if (match) return match[1];

  // https://youtu.be/XXXXXXXXXXX
  match = videoUrl.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);
  if (match) return match[1];

  // https://www.youtube.com/embed/XXXXXXXXXXX
  match = videoUrl.match(/embed\/([a-zA-Z0-9_-]{11})/);
  if (match) return match[1];

  return null;
}

/**
 * POST /video-info
 * Body:
 * {
 *   "videoUrl": "https://youtu.be/XXXXXXXXXXX"
 * }
 */
router.post("/", async (req, res) => {
  try {
    const { videoUrl } = req.body || {};

    // ----------------------------
    //  Validazione
    // ----------------------------
    if (!videoUrl) {
      return res.status(400).json({
        ok: false,
        error: "Missing 'videoUrl' field"
      });
    }

    const videoId = extractVideoId(videoUrl);
    if (!videoId) {
      return res.status(400).json({
        ok: false,
        error: "Invalid YouTube URL format"
      });
    }

    // ----------------------------
    //  Estrarre info 
    // ----------------------------
    const result = await getVideoInfo(videoId);

    if (!result.ok) {
      return res.status(500).json({
        ok: false,
        videoId,
        error: result.error || "Unable to fetch video info"
      });
    }

    // ----------------------------
    //  Risposta finale
    // ----------------------------
    return res.json({
      ok: true,
      videoId,
      data: result.data
    });

  } catch (err) {
    console.error(" /video-info ERROR:", err);
    res.status(500).json({
      ok: false,
      error: "video-info route crashed",
      details: err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\video-summary.js
// ==================================================

// ======================================================
//  /video-summary  Summary + Key Points
// ======================================================

import express from "express";
import { callAIModel } from "../services/aiEngine.js";
import { getTranscript } from "../services/transcriptService.js";

const router = express.Router();

router.post("/", async (req, res) => {
  try {
    const { videoUrl, forceProvider="auto" } = req.body;
    const id = extract(videoUrl);
    const tr = await getTranscript(id);

    const prompt = `
Riassumi questo video in bullet points.
Transcript:
${tr.continuousText}

Rispondi SOLO JSON:
{
  "riassunto": ["..."],
  "puntiChiave": ["..."],
  "takeaway": "..."
}
`;
    const out = await callAIModel(prompt, "json", {
      task: "summary",
      temperature: 0.2,
      maxTokens: 3500,
      forceProvider
    });

    res.json({ ok:true, data: out });

  } catch (e) {
    res.status(500).json({ ok:false, error:e.message });
  }
})

function extract(u){
  let m=u.match(/v=([\w-]{11})/); if(m) return m[1];
  m=u.match(/youtu\.be\/([\w-]{11})/); if(m) return m[1];
  return null;
}

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\routes\youtube.js
// ==================================================

import express from "express";
import { getVideoInfo } from "../services/youtubeService.js";

const router = express.Router();

/**
 * Health-check rapido del modulo YouTube
 */
router.get("/test", (req, res) => {
  res.json({ status: "ok", message: "YouTube endpoint attivo" });
});

/**
 * Recupera info base da un video YouTube
 * Body:
 * { "videoUrl": "https://www.youtube.com/..." }
 */
router.post("/", async (req, res) => {
  try {
    const { videoUrl } = req.body;

    if (!videoUrl) {
      return res.status(400).json({ error: "Missing videoUrl" });
    }

    const data = await getVideoInfo(videoUrl);

    res.json({
      video: data.video,
      channel: data.channel,
    });
  } catch (error) {
    console.error("YouTube Route Error:", error);
    res.status(500).json({ error: "Error retrieving video info" });
  }
});

export default router;


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\aiEngine.js
// ==================================================

// =====================================================================
//   aiEngine.js  TOP BEST ULTRA-PREMIUM
//  Motore AI centrale di Zen YouTube Coach Pro
//  - Multi-provider: GROQ  OPENAI  LLAMA (via Groq)
//  - Fallback automatico
//  - Timeout di sicurezza
//  - Logging avanzato
// =====================================================================

import dotenv from "dotenv";
dotenv.config();

// ----------------------------------------------------------
//  ENV & Config
// ----------------------------------------------------------
const AI_PROVIDER = process.env.AI_PROVIDER || "groq"; // "groq" | "openai" | "llama"
const OPENAI_API_KEY = process.env.OPENAI_API_KEY || null;
const GROQ_API_KEY = process.env.GROQ_API_KEY || null;

// Modelli di default (puoi cambiarli dal .env)
const DEFAULT_OPENAI_MODEL =
  process.env.OPENAI_MODEL || "gpt-4.1-mini";
const DEFAULT_GROQ_MODEL =
  process.env.GROQ_MODEL || "llama-3.1-70b-versatile";
const DEFAULT_LLAMA_MODEL =
  process.env.LLAMA_MODEL || "llama-3.1-70b-versatile";

// Timeout massimo per ogni chiamata (ms)
const AI_TIMEOUT_MS = Number(process.env.AI_TIMEOUT_MS || 45000);

// ----------------------------------------------------------
//  Utility: timeout con AbortController
// ----------------------------------------------------------
async function withTimeout(promise, ms, contextLabel = "AI call") {
  const controller = new AbortController();
  const id = setTimeout(() => controller.abort(), ms);

  try {
    const result = await promise(controller.signal);
    clearTimeout(id);
    return result;
  } catch (err) {
    clearTimeout(id);
    if (err.name === "AbortError") {
      throw new Error(`Timeout durante ${contextLabel}`);
    }
    throw err;
  }
}

// ----------------------------------------------------------
//  Provider: OpenAI (API compatibile /v1/chat/completions)
// ----------------------------------------------------------
async function callOpenAI(prompt, options = {}, signal) {
  if (!OPENAI_API_KEY) {
    throw new Error("OPENAI_API_KEY non configurata.");
  }

  const {
    model = DEFAULT_OPENAI_MODEL,
    temperature = 0.3,
    maxTokens = 1200,
    systemPrompt = "Sei un assistente esperto di YouTube e contenuti per pubblico Over50/60/70.",
    jsonMode = false,
  } = options;

  const body = {
    model,
    messages: [
      { role: "system", content: systemPrompt },
      { role: "user", content: prompt },
    ],
    temperature,
    max_tokens: maxTokens,
  };

  if (jsonMode) {
    // Alcuni modelli supportano il response_format
    body.response_format = { type: "json_object" };
  }

  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    signal,
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${OPENAI_API_KEY}`,
    },
    body: JSON.stringify(body),
  });

  if (!response.ok) {
    const text = await response.text();
    throw new Error(
      `Errore OpenAI (${response.status}): ${text || response.statusText}`
    );
  }

  const data = await response.json();
  const choice = data.choices?.[0]?.message?.content;
  if (!choice) {
    throw new Error("Risposta OpenAI senza contenuto.");
  }
  return choice;
}

// ----------------------------------------------------------
//  Provider: Groq (compatibile OpenAI-style)
// ----------------------------------------------------------
async function callGroq(prompt, options = {}, signal) {
  if (!GROQ_API_KEY) {
    throw new Error("GROQ_API_KEY non configurata.");
  }

  const {
    model = DEFAULT_GROQ_MODEL,
    temperature = 0.3,
    maxTokens = 1200,
    systemPrompt = "Sei un analista YouTube per pubblico Over50/60/70, molto preciso e conciso.",
    jsonMode = false,
  } = options;

  const body = {
    model,
    messages: [
      { role: "system", content: systemPrompt },
      { role: "user", content: prompt },
    ],
    temperature,
    max_tokens: maxTokens,
  };

  // Groq al momento non richiede esplicitamente response_format,
  // ma se un domani lo far, siamo gi pronti.
  if (jsonMode) {
    body.response_format = { type: "json_object" };
  }

  const response = await fetch(
    "https://api.groq.com/openai/v1/chat/completions",
    {
      method: "POST",
      signal,
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${GROQ_API_KEY}`,
      },
      body: JSON.stringify(body),
    }
  );

  if (!response.ok) {
    const text = await response.text();
    throw new Error(
      `Errore Groq (${response.status}): ${text || response.statusText}`
    );
  }

  const data = await response.json();
  const choice = data.choices?.[0]?.message?.content;
  if (!choice) {
    throw new Error("Risposta Groq senza contenuto.");
  }
  return choice;
}

// ----------------------------------------------------------
//  Provider: LLaMA (via Groq, modello dedicato)
// ----------------------------------------------------------
async function callLlama(prompt, options = {}, signal) {
  // Riutilizziamo Groq con un modello LLaMA dedicato
  const llamaOptions = {
    ...options,
    model: options.model || DEFAULT_LLAMA_MODEL,
  };
  return callGroq(prompt, llamaOptions, signal);
}

// ----------------------------------------------------------
//  Strategia di fallback provider
// ----------------------------------------------------------
// In base a AI_PROVIDER, definiamo lordine con cui provare i provider.
function getProviderPriority() {
  const base = (AI_PROVIDER || "").toLowerCase().trim();

  switch (base) {
    case "openai":
      return ["openai", "groq", "llama"];
    case "llama":
      return ["llama", "groq", "openai"];
    case "groq":
    default:
      return ["groq", "openai", "llama"];
  }
}

// ----------------------------------------------------------
//  Funzione centrale: callAIModel
//  - prompt: stringa obbligatoria
//  - options: { model, temperature, maxTokens, systemPrompt, jsonMode }
// ----------------------------------------------------------
export async function callAIModel(prompt, options = {}) {
  if (!prompt || typeof prompt !== "string") {
    throw new Error("Prompt mancante o non valido in callAIModel.");
  }

  const providers = getProviderPriority();

  const errors = [];

  for (const provider of providers) {
    try {
      console.log(
        `[AI Engine] Provo provider: ${provider.toUpperCase()} (modello: ${
          options.model ||
          (provider === "openai"
            ? DEFAULT_OPENAI_MODEL
            : provider === "groq"
            ? DEFAULT_GROQ_MODEL
            : DEFAULT_LLAMA_MODEL)
        })`
      );

      const result = await withTimeout(
        (signal) => {
          if (provider === "openai") {
            return callOpenAI(prompt, options, signal);
          }
          if (provider === "groq") {
            return callGroq(prompt, options, signal);
          }
          if (provider === "llama") {
            return callLlama(prompt, options, signal);
          }
          throw new Error(`Provider AI sconosciuto: ${provider}`);
        },
        AI_TIMEOUT_MS,
        `chiamata ${provider}`
      );

      console.log(`[AI Engine] Provider ${provider.toUpperCase()} OK.`);
      return result;
    } catch (err) {
      console.error(
        `[AI Engine] Errore provider ${provider.toUpperCase()}:`,
        err.message
      );
      errors.push({
        provider,
        error: err.message,
      });
      // prova il provider successivo
    }
  }

  // Se siamo qui, tutti i provider sono falliti
  console.error("[AI Engine] Tutti i provider sono falliti:", errors);

  throw new Error(
    `Tutti i provider AI hanno fallito. Dettagli: ${JSON.stringify(
      errors,
      null,
      2
    )}`
  );
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\aiProviders.js
// ==================================================

// aiProviders.js
const Groq = require("groq-sdk");
const OpenAI = require("openai");

// Client GROQ (sempre, perch usiamo Groq come base gratuita)
const groqClient = new Groq({
  apiKey: process.env.GROQ_API_KEY
});

// Client OpenAI (solo se hai messo OPENAI_API_KEY nelle env)
let openaiClient = null;
if (process.env.OPENAI_API_KEY) {
  openaiClient = new OpenAI({
    apiKey: process.env.OPENAI_API_KEY
  });
}

// Modelli di default
const GROQ_MODEL = "llama-3.1-70b-versatile";
const OPENAI_MODEL = process.env.OPENAI_MODEL || "gpt-4.1-mini";

// ---- FUNZIONI DI BASE PER I DUE MOTORI ----

async function generateWithGroq({ systemPrompt, userPrompt, temperature = 0.8 }) {
  console.log("[AI] Using Groq:", GROQ_MODEL);

  const completion = await groqClient.chat.completions.create({
    model: GROQ_MODEL,
    messages: [
      { role: "system", content: systemPrompt },
      { role: "user", content: userPrompt }
    ],
    temperature
  });

  return completion.choices[0].message.content.trim();
}

async function generateWithOpenAI({ systemPrompt, userPrompt, temperature = 0.8, model = OPENAI_MODEL }) {
  if (!openaiClient) {
    throw new Error("OpenAI non configurato: manca OPENAI_API_KEY.");
  }

  console.log("[AI] Using OpenAI:", model);

  const completion = await openaiClient.chat.completions.create({
    model,
    messages: [
      { role: "system", content: systemPrompt },
      { role: "user", content: userPrompt }
    ],
    temperature
  });

  return completion.choices[0].message.content.trim();
}

module.exports = {
  generateWithGroq,
  generateWithOpenAI
};


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\aiService.js
// ==================================================

// src/services/aiService.js
// ======================================================
//  Servizio centrale AI  OpenAI / Groq
// Una sola funzione: callAI (pi alias callAIModel)
// ======================================================

import OpenAI from "openai";
import Groq from "groq-sdk";
import dotenv from "dotenv";

dotenv.config();

const aiProvider = process.env.AI_PROVIDER || "openai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

const groq = new Groq({
  apiKey: process.env.GROQ_API_KEY,
});

/**
 *  FUNZIONE UNICA PER TUTTE LE CHIAMATE AI
 * - prompt: string
 * - options: { model?, temperature?, max_tokens? } oppure string (retrocompatibilit)
 * - ritorna SEMPRE JSON.parse(content) se possibile
 */
export async function callAI(prompt, options = {}) {
  // Retrocompatibilit nel caso venga passato una stringa come secondo argomento (tipo "script")
  if (typeof options === "string") {
    options = {};
  }

  const model = options.model || "gpt-4o-mini";
  const temperature = options.temperature ?? 0.7;
  const max_tokens = options.max_tokens || 4000;

  try {
    let content;

    if (aiProvider === "groq") {
      const response = await groq.chat.completions.create({
        model,
        messages: [{ role: "user", content: prompt }],
        temperature,
        max_tokens,
      });
      content = response.choices[0]?.message?.content || "";
    } else {
      const response = await openai.chat.completions.create({
        model,
        messages: [{ role: "user", content: prompt }],
        temperature,
        max_tokens,
      });
      content = response.choices[0]?.message?.content || "";
    }

    // Prova a fare JSON.parse  se fallisce, ritorna un oggetto di errore
    try {
      // Pulizia base: se il modello mette ```json ... ```
      const first = content.indexOf("{");
      const last = content.lastIndexOf("}");
      if (first !== -1 && last !== -1) {
        const sliced = content.substring(first, last + 1);
        return JSON.parse(sliced);
      }
      return JSON.parse(content);
    } catch (parseErr) {
      console.error(" JSON PARSE ERROR (callAI):", parseErr, "\nRAW:", content);
      return { error: "Invalid JSON from AI", raw: content };
    }
  } catch (error) {
    console.error(" AI Service Error:", error);
    return { error: true, message: error.message };
  }
}

//  Alias retrocompatibile per vecchio codice
export const callAIModel = callAI;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\aiUsageLogger.js
// ==================================================


// ============================================================
//  aiUsageLogger.js  Tracciamento uso AI (OpenAI / Groq)
// ============================================================

import fs from "fs";
import path from "path";

const LOG_DIR = path.join(process.cwd(), "logs");
const LOG_FILE = path.join(LOG_DIR, "ai-usage.log");

// Assicura che la cartella logs esista
function ensureLogDir() {
  if (!fs.existsSync(LOG_DIR)) {
    fs.mkdirSync(LOG_DIR, { recursive: true });
  }
}

/**
 * Registra una chiamata AI su file (formato JSON per riga)
 *
 * expectedEntry:
 * {
 *   provider: "openai" | "groq" | "unknown",
 *   model: "gpt-4o-mini" | "llama-3.1-70b-versatile" | string,
 *   route: "/generate/scriptPro" | "/analyze/transcript" | string,
 *   tokens_prompt: number,
 *   tokens_completion: number,
 *   cost_usd: number,
 *   success: boolean,
 *   error_message?: string,
 *   meta?: object
 * }
 */
export function logAIUsage(expectedEntry = {}) {
  try {
    ensureLogDir();

    const entry = {
      timestamp: new Date().toISOString(),
      provider: expectedEntry.provider || "unknown",
      model: expectedEntry.model || "unknown",
      route: expectedEntry.route || "unknown",
      tokens_prompt: expectedEntry.tokens_prompt ?? null,
      tokens_completion: expectedEntry.tokens_completion ?? null,
      cost_usd: expectedEntry.cost_usd ?? null,
      success: expectedEntry.success ?? true,
      error_message: expectedEntry.error_message || null,
      meta: expectedEntry.meta || null,
    };

    const line = JSON.stringify(entry);
    fs.appendFile(LOG_FILE, line + "\n", (err) => {
      if (err) {
        console.error(" Errore salvataggio log AI:", err.message);
      }
    });
  } catch (err) {
    console.error(" logAIUsage fatal error:", err.message);
  }
}

/**
 * Legge le ultime N righe del log e produce un riepilogo.
 * Non  super ottimizzato, ma va benissimo per uso personale.
 */
export function getUsageSummary(limit = 100) {
  try {
    if (!fs.existsSync(LOG_FILE)) {
      return {
        calls_total: 0,
        by_provider: {},
        by_model: {},
        by_route: {},
        last_calls: [],
      };
    }

    const raw = fs.readFileSync(LOG_FILE, "utf8");
    const lines = raw
      .split("\n")
      .map((l) => l.trim())
      .filter((l) => l.length > 0);

    const slice = lines.slice(-limit);
    const last_calls = [];
    const by_provider = {};
    const by_model = {};
    const by_route = {};

    for (const line of slice) {
      try {
        const obj = JSON.parse(line);

        last_calls.push(obj);

        // provider
        const p = obj.provider || "unknown";
        by_provider[p] = (by_provider[p] || 0) + 1;

        // model
        const m = obj.model || "unknown";
        by_model[m] = (by_model[m] || 0) + 1;

        // route
        const r = obj.route || "unknown";
        by_route[r] = (by_route[r] || 0) + 1;
      } catch {
        // riga corrotta  ignoro
      }
    }

    return {
      calls_total: lines.length,
      calls_sampled: slice.length,
      by_provider,
      by_model,
      by_route,
      last_calls: last_calls.reverse(), // le pi recenti prima
    };
  } catch (err) {
    console.error(" getUsageSummary error:", err.message);
    return {
      calls_total: 0,
      by_provider: {},
      by_model: {},
      by_route: {},
      last_calls: [],
      error: err.message,
    };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\analyzeTranscriptService.js
// ==================================================

// src/services/analyzeTranscriptService.js
// ===================================================================
//  analyzeTranscriptService.js
// Analisi transcript  Hook, struttura, punti forti/deboli, retention
// ===================================================================

import { callAI } from "./aiService.js";

export async function analyzeTranscript(transcript) {
  const prompt = `
Sei uno YouTube Coach Pro specializzato in pubblico Over 50/60.
Analizza il transcript seguente e genera un output strutturato con:

1) Analisi hook iniziale (030 secondi): quanto  forte, chiaro, interessante?
2) Struttura narrativa rilevata (es. Hook  Problema  Soluzione  CTA)
3) Punti di forza principali del video (cosa funziona davvero)
4) Debolezze e possibili punti di drop di retention
5) Suggerimenti concreti per migliorare ritmo, chiarezza e coinvolgimento
6) Valutazione complessiva di efficacia per un pubblico Over50/60 (1100)

Transcript:
${transcript}

 Regole:
- Rispondi SOLO in JSON valido
- Nessun markdown, nessun elenco puntato markdown, nessun testo fuori JSON

Formato JSON richiesto:

{
  "hookStrength": "",
  "narrativeStructure": "",
  "strengths": [],
  "weaknesses": [],
  "improvementTips": [],
  "retentionScore": ""
}
`;

  const result = await callAI(prompt, {
    model: "gpt-4o-mini",
    temperature: 0.6,
    max_tokens: 2500,
  });

  return result;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\cacheService.js
// ==================================================

import fs from "fs";
import crypto from "crypto";

const CACHE_FILE = "ai-cache.json";

if (!fs.existsSync(CACHE_FILE)) {
  fs.writeFileSync(CACHE_FILE, JSON.stringify({}, null, 2));
}

function loadCache() {
  return JSON.parse(fs.readFileSync(CACHE_FILE, "utf-8"));
}

function saveCache(cache) {
  fs.writeFileSync(CACHE_FILE, JSON.stringify(cache, null, 2));
}

export function getCacheKey(prompt) {
  return crypto.createHash("sha256").update(prompt).digest("hex");
}

export function getCached(prompt) {
  const cache = loadCache();
  const key = getCacheKey(prompt);
  return cache[key] || null;
}

export function saveCached(prompt, result) {
  const cache = loadCache();
  const key = getCacheKey(prompt);
  cache[key] = result;
  saveCache(cache);
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\compareTranscriptService.js
// ==================================================

// src/services/compareTranscriptService.js
// ===================================================================
//  compareTranscriptService.js
// Confronto tra due transcript YouTube per capire quale funziona meglio
// ===================================================================

import { callAI } from "./aiService.js";

export async function compareTranscripts(transcriptA, transcriptB) {
  const prompt = `
Sei uno YouTube Coach Pro specializzato in pubblico Over50/60.
Confronta questi due transcript YouTube e stabilisci quale ha pi potenziale
in termini di retention, chiarezza, valore e aderenza al pubblico Over50.

Transcript A:
${transcriptA}

Transcript B:
${transcriptB}

Analizza e rispondi considerando:

1) Hook iniziale: quale cattura meglio attenzione e curiosit?
2) Struttura narrativa: quale  pi chiara e fluida?
3) Valore percepito: quale offre consigli pi utili, concreti, memorabili?
4) Tono e linguaggio: quale  pi adatto a un pubblico Over50/60?
5) Elementi di retention: ganci interni, ritmo, storytelling, domande allo spettatore

 Rispondi SOLO in JSON valido nel seguente formato:

{
  "hookWinner": "A o B",
  "structureWinner": "A o B",
  "valueWinner": "A o B",
  "audienceFitWinner": "A o B",
  "retentionWinner": "A o B",
  "finalVerdict": "Spiegazione dettagliata in linguaggio naturale, max 10 righe"
}
`;

  const result = await callAI(prompt, {
    model: "gpt-4o-mini",
    temperature: 0.6,
    max_tokens: 2600,
  });

  return result;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\costLimiter.js
// ==================================================

import fs from "fs";
import path from "path";

const COST_FILE = path.resolve("cost-usage.json");

// Carica lo stato
function loadState() {
  if (!fs.existsSync(COST_FILE)) {
    return { month: getCurrentMonth(), used: 0 };
  }

  return JSON.parse(fs.readFileSync(COST_FILE, "utf-8"));
}

function saveState(state) {
  fs.writeFileSync(COST_FILE, JSON.stringify(state, null, 2));
}

function getCurrentMonth() {
  return new Date().toISOString().slice(0, 7); // es: "2025-11"
}

export function initCostLimiter(limitEuro = 10) {
  return {
    limitEuro,

    checkAndConsume(costEuro) {
      const state = loadState();
      const currentMonth = getCurrentMonth();

      // Reset mensile
      if (state.month !== currentMonth) {
        state.month = currentMonth;
        state.used = 0;
      }

      // Se superiamo il limite  blocco
      if (state.used + costEuro > this.limitEuro) {
        throw new Error(
          `BUDGET SUPERATO: limite ${this.limitEuro}, usati ${state.used.toFixed(
            2
          )}. Richiesta bloccata.`
        );
      }

      // Aggiorna consumo
      state.used += costEuro;
      saveState(state);

      return state.used;
    },

    getUsage() {
      return loadState();
    },
  };
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\dbService.js
// ==================================================



// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\earningsService.js
// ==================================================

export function estimateEarnings(video) {
  const RPM = 1.2; // valore medio
  const earnings = (video.views / 1000) * RPM;

  return {
    estimatedRPM: RPM,
    estimatedEarnings: earnings.toFixed(2) + " "
  };
}


// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\fallbackModel.js
// ==================================================

export function getBestModelForCost(tokens) {
  // Stima costi (esempio ipotetico realistico 2025)
  const costHigh = tokens * 0.0000005;   // gpt-5.1
  const cost5mini = tokens * 0.00000015; // gpt-5-mini
  const costMid = tokens * 0.0000001;    // gpt-4.1
  const costLow = tokens * 0.00000005;   // gpt-4o-mini

  if (costHigh < 0.001) return "gpt-5.1";
  if (cost5mini < 0.001) return "gpt-5-mini";
  if (costMid < 0.001) return "gpt-4.1";
  return "gpt-4o-mini";
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\intelligenceService.js
// ==================================================

// ======================================================
//  Channel Intelligence Service
// Estrattore statico di insight strategici per canali YouTube
// ======================================================

/**
 * 1 Identit del canale e posizionamento
 */
export function extractChannelOverview(profile) {
  return {
    channelName: profile.channelName,
    niche: profile.niche,
    mission: profile.goals || ["Non definita"],
    targetAges: profile.targetAges || ["Over 50", "Over 60", "Over 70"],
    toneOfVoice: profile.communicationTone?.general || "Empatico, chiaro, rassicurante",
  };
}

/**
 * 2 Analisi pubblico per fasce d'et
 */
export function extractAudienceInsights(profile) {
  return {
    over50: {
      needs: ["energia", "metabolismo", "stress"],
      psychology: ["inizia a percepire cambiamenti", "cerca guida affidabile e semplice"],
    },
    over60: {
      needs: ["articolazioni", "circolazione", "dolore cronico"],
      psychology: ["paura di dipendere dagli altri", "ricerca routine lente e sicure"],
    },
    over70: {
      needs: ["movimenti adattati", "memoria", "solitudine"],
      psychology: ["bisogno di accompagnamento", "preferenza per voce calma e rassicurante"],
    },
  };
}

/**
 * 3 Stile di comunicazione consigliato
 */
export function extractCommunicationStyle(profile) {
  return {
    recommendedTone: "Calmo, spiegato con esempi, senza tecnicismi",
    avoid: [
      "ritmo veloce",
      "linguaggio tecnico",
      "call to action aggressive",
      "promesse esagerate"
    ],
    recommendedTechniques: [
      "pausa ogni 2 frasi",
      "esempi concreti",
      "parole semplici e ripetitive",
      "visuali guidati"
    ]
  };
}

/**
 * 4 Tipi di contenuti ideali
 */
export function extractContentInsights(profile) {
  return {
    idealFormats: [
      "Esercizi lenti guidati",
      "Storytelling personale",
      "Routine per Over 70",
      "Ricette naturali facili da seguire",
      "Consigli su mente e memoria"
    ],
    weakFormats: [
      "video veloci",
      "monologhi tecnici",
      "contenuti con linguaggio medico avanzato"
    ]
  };
}

/**
 * 5 Opportunit strategiche (Content Gap)
 */
export function extractStrategicOpportunities(profile) {
  return [
    "Mancano contenuti su esercizi da seduti per Over 70",
    "Nessuno spiega come affrontare la perdita di fiducia nel corpo dopo i 65 anni",
    "Scarso contenuto su memorie, routine lente e accompagnamento passo passo",
    "Pochi video con voce calma e rassicurante adatta al pubblico anziano"
  ];
}

// ======================================================
//  analyzeVideoAI  Funzione Premium Unificata
// Usa tutte le analisi del Channel Intelligence
// ======================================================
export function analyzeVideoAI(profile = {}) {
  return {
    overview: extractChannelOverview(profile),
    audience: extractAudienceInsights(profile),
    communication: extractCommunicationStyle(profile),
    content: extractContentInsights(profile),
    opportunities: extractStrategicOpportunities(profile),
  };
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\multiAnalyzeService.js
// ==================================================

// src/services/multiAnalyzeService.js

import { callAI } from "./aiService.js";

/**
 * Analisi multipla di pi trascrizioni
 */
export async function multiAnalyzeTranscripts(transcripts = []) {
  const formatted = transcripts
    .map((t, i) => `VIDEO ${i + 1}:\n"""\n${t}\n"""`)
    .join("\n\n");

  const prompt = `
Sei "Zen YouTube Coach Pro", un analista superiore a VidIQ e TubeBuddy.

Stai per analizzare MULTIPLE TRASCRIZIONI:

${formatted}

Rispondi SOLO in JSON nel formato:

{
  "summaries": [],
  "common_topics": [],
  "dominant_emotions": [],
  "psychological_patterns": [],
  "market_gaps": [],
  "unique_opportunities": [],
  "best_title_to_beat_all": "",
  "best_hook_to_beat_all": "",
  "super_script_blueprint": "",
  "cta_final": ""
}

Linee guida:
- Estrai temi e idee ricorrenti.
- Identifica leve psicologiche usate dai creator.
- Identifica gaps e opportunit non sfruttate.
- Genera un HOOK unico basato sui pattern vincenti.
- Genera un SUPER-SCRIPT sintetizzato da tutti.
- Crea titolo e CTA vincenti.
`;

  const raw = await callAI(prompt);

  try {
    return JSON.parse(raw);
  } catch (err) {
    return { error: "JSON_PARSE_ERROR", raw };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\patternService.js
// ==================================================

import OpenAI from "openai";
import { OPENAI_API_KEY } from "../config/openai.js";

const client = new OpenAI({ apiKey: OPENAI_API_KEY });

export async function runPatternAnalysis(videos) {
  // Pulizia dati dei video
  const cleaned = videos.map(v => ({
    title: v.title,
    description: v.description,
    views: v.views,
    likes: v.likes,
    comments: v.comments,
    channelSubs: v.channel?.subs || 0
  }));

  const prompt = `
Sei un analista professionista YouTube specializzato in CTR, Retention e Trend.

Analizza questi 5 video e produci SOLO JSON valido nel seguente formato:

{
  "patternSummary": "",
  "idealVideoBlueprint": {
    "idealLengthMinutes": 0,
    "idealTitleStyle": "",
    "idealDescriptionStructure": "",
    "idealHookFirst10Seconds": "",
    "idealCTAStyle": ""
  },
  "recurringElements": [],
  "mistakesToAvoid": [],
  "checklistForMyChannel": [],
  
  "zenPattern": {
    "summary": "",
    "idealVideoBlueprint": {},
    "recurringElements": [],
    "mistakesToAvoid": [],
    "checklist": []
  },

  "nextVideoIdea": {
    "title": "",
    "hook": "",
    "intro": "",
    "whyItWorks": ""
  }
}

Ecco i 5 video da analizzare:
${JSON.stringify(cleaned, null, 2)}
  `;

  const response = await client.responses.create({
    model: "gpt-5.1-mini",
    input: prompt
  });

  try {
    const raw = response.output_text.trim();
    const first = raw.indexOf("{");
    const last = raw.lastIndexOf("}");
    return JSON.parse(raw.substring(first, last + 1));
  } catch (err) {
    return { error: "Invalid JSON", raw: response.output_text };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\profileManager.js
// ==================================================

// ============================================================
//  profile-Manager.js  Auto Profile per Zen Salute e Benessere
// ============================================================

/**
 * Profilo di default per il tuo ecosistema.
 * Qui iniettiamo:
 * - Nome canale
 * - Pubblico Over 50 / Over 60 / Over 70
 * - Tone of voice
 */
const defaultProfile = {
  handle: "zen-salute-benessere",
  channelName: "Zen Salute e Benessere",
  niche: "salute, benessere, alimentazione, lunga vita",
  targetAudience: ["Over 50", "Over 60", "Over 70"],
  tone: "calmo, empatico, rassicurante, motivante",
  language: "it-IT",
  mentionChannelInIntro: true,
  mentionChannelInOutro: true
};

/**
 * Restituisce SEMPRE il profilo di default
 * (in futuro potrai gestire multi-profili).
 */
export function getDefaultProfile() {
  return defaultProfile;
}

/**
 * In futuro: profili multipli per pi canali.
 * Per ora qualunque handle  profilo di default.
 */
export function getProfileByHandle(handle) {
  if (!handle) return defaultProfile;

  // Qui potresti mettere una mappa di profili diversi.
  return defaultProfile;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\transcript-manual.js
// ==================================================

// ======================================================
//  /transcript/manual  transcript da testo incollato
// ======================================================

import express from "express";
import { processManualTranscript } from "../services/transcriptService.js";

const router = express.Router();

/**
 * POST /transcript/manual
 *
 * Body:
 * {
 *   "transcriptText": "testo incollato..."
 * }
 */
router.post("/", async (req, res) => {
  try {
    const { transcriptText } = req.body || {};

    if (!transcriptText || !String(transcriptText).trim()) {
      return res.status(400).json({
        success: false,
        message: "Devi passare transcriptText non vuoto."
      });
    }

    const result = await processManualTranscript(transcriptText);

    if (!result.success) {
      return res.status(500).json({
        success: false,
        message: result.message || "Errore processamento transcript manuale."
      });
    }

    return res.json(result);
  } catch (err) {
    console.error(" /transcript/manual ERROR:", err);
    return res.status(500).json({
      success: false,
      message: "Errore interno /transcript/manual: " + err.message
    });
  }
});

export default router;

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\transcriptService.js
// ==================================================

// ======================================================================
//  transcriptService.js  V6 Ultra-Premium 2025
//
// Pipeline definitiva per Zen YouTube Coach Pro:
//
// PRIORIT:
// 1) manualTranscript (incollato da te, dall'estensione, da YouTube, ecc.)
// 2) YouTube TimedText (sottotitoli ufficiali)
// 3) Proxy esterno (YT_TRANSCRIPT_PROXY_URL) se esiste
// 4) YouTube Summary API esterna (YT_SUMMARY_API_URL) se esiste
// 5) "Summary interno" via AI su titolo+descrizione
// 6) Scraper HTML + noembed per contesto
// 7) AI Transcript Rebuild + AI Cleanup
// 8) Fallback testuale (mai pi errori duri)
//
// Tutto viene cache-ato in memoria per videoId.
// ======================================================================

import dotenv from "dotenv";
import { callAIModel } from "./aiEngine.js";

dotenv.config();

// Cache in memoria (chiave: videoId normalizzato)
const transcriptCache = new Map();

// ======================================================================
//  Normalizzazione ID / URL YouTube
// ======================================================================

function normalizeVideoId(input) {
  if (!input) return null;
  let v = String(input).trim();

  // Se non  URL, lo considero un ID grezzo e ripulisco da parametri
  if (!v.startsWith("http")) {
    if (v.includes("&")) v = v.split("&")[0];
    if (v.includes("?")) v = v.split("?")[0];
    return v;
  }

  try {
    // Tieni solo il primo parametro di query
    if (v.includes("?")) {
      const [base, q] = v.split("?");
      v = `${base}?${q.split("&")[0]}`;
    }

    const url = new URL(v);

    // youtu.be/VIDEOID
    if (url.hostname.includes("youtu.be")) {
      let id = url.pathname.replace("/", "");
      if (id.includes("?")) id = id.split("?")[0];
      if (id.includes("&")) id = id.split("&")[0];
      return id;
    }

    // youtube.com/watch?v=VIDEOID
    if (url.hostname.includes("youtube.com")) {
      let id = url.searchParams.get("v");
      if (!id) return null;
      if (id.includes("&")) id = id.split("&")[0];
      if (id.includes("?")) id = id.split("?")[0];
      return id;
    }
  } catch {
    if (v.includes("&")) v = v.split("&")[0];
    if (v.includes("?")) v = v.split("?")[0];
    return v;
  }

  if (v.includes("&")) v = v.split("&")[0];
  if (v.includes("?")) v = v.split("?")[0];
  return v;
}

// ======================================================================
//  TimedText YouTube  testo continuo
// ======================================================================

function vttToPlainText(raw) {
  if (!raw) return "";
  const lines = raw.replace(/\r/g, "").split("\n").map((l) => l.trim());

  const clean = lines.filter((line) => {
    if (!line) return false;
    if (/^\d+$/.test(line)) return false;                // sequenza numerica
    if (line.includes("-->")) return false;              // timestamp
    if (/^(WEBVTT|Kind:|Language:)/i.test(line)) return false;
    return true;
  });

  return clean.join(" ").replace(/\s+/g, " ").trim();
}

async function fetchTimedText(videoId, lang) {
  const url = `https://www.youtube.com/api/timedtext?lang=${lang}&v=${videoId}&fmt=vtt`;
  try {
    const res = await fetch(url);
    if (!res.ok) return null;
    return await res.text();
  } catch {
    return null;
  }
}

async function tryTimedText(videoId, debug = false) {
  const langs = (process.env.TRANSCRIPT_LANGS || "it,en")
    .split(",")
    .map((x) => x.trim())
    .filter(Boolean);

  for (const lang of langs) {
    if (debug) console.log(` TimedText  ${videoId} [${lang}]`);
    const raw = await fetchTimedText(videoId, lang);
    if (!raw) continue;

    const plain = vttToPlainText(raw);
    if (plain && plain.length > 50) {
      if (debug) console.log(` TimedText OK (${lang})`);
      return { provider: `youtube-timedtext-${lang}`, plain };
    }
  }

  return null;
}

// ======================================================================
//  Proxy esterno (es. tuo micro-servizio transcript)
// ======================================================================

async function tryProxy(videoId, debug = false) {
  const base = process.env.YT_TRANSCRIPT_PROXY_URL;
  if (!base) return null;

  const url = `${base}?v=${encodeURIComponent(videoId)}`;

  try {
    if (debug) console.log(` Proxy transcript  ${url}`);
    const res = await fetch(url);
    if (!res.ok) return null;

    const data = await res.json().catch(() => null);
    if (!data) return null;

    const t = data.continuousText || data.text || "";
    if (!t || t.trim().length < 50) return null;

    if (debug) console.log(" Proxy transcript OK");
    return { provider: "proxy", plain: t.trim() };
  } catch {
    return null;
  }
}

// ======================================================================
//  YouTube Summary API esterna (YT_SUMMARY_API_URL)
//    Questa  la parte che pu usare YouTube Summary o simili,
//    via un tuo endpoint intermedio.
// ======================================================================

async function trySummaryApi(videoId, debug = false) {
  const base = process.env.YT_SUMMARY_API_URL;
  if (!base) return null;

  const url = `${base}?videoId=${encodeURIComponent(videoId)}`;

  try {
    if (debug) console.log(` Summary API  ${url}`);
    const res = await fetch(url);
    if (!res.ok) return null;

    const data = await res.json().catch(() => null);
    if (!data) return null;

    let summary = "";

    if (typeof data.summary === "string") summary = data.summary;
    else if (typeof data.text === "string") summary = data.text;
    else if (Array.isArray(data.bullets)) summary = data.bullets.join(" ");
    else if (Array.isArray(data.sentences)) summary = data.sentences.join(" ");

    if (!summary || summary.trim().length < 30) return null;

    if (debug) console.log(" Summary API OK");
    return summary.trim();
  } catch {
    return null;
  }
}

// ======================================================================
//  Scraper HTML YouTube + noembed
// ======================================================================

async function fetchNoembed(videoId) {
  try {
    const url = `https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`;
    const res = await fetch(url);
    if (!res.ok) return null;
    return await res.json();
  } catch {
    return null;
  }
}

function extractDesc(html) {
  if (!html) return null;

  // shortDescription nello script JSON
  const j = html.match(/"shortDescription":"(.*?)"/s);
  if (j && j[1]) {
    return j[1]
      .replace(/\\n/g, " ")
      .replace(/\\r/g, " ")
      .replace(/\\"/g, '"')
      .replace(/\\\\/g, "\\")
      .trim();
  }

  // meta description
  const m = html.match(/<meta\s+name="description"\s+content="([^"]*)"/i);
  if (m && m[1]) return m[1].trim();

  return null;
}

function extractTitle(html) {
  if (!html) return null;
  const m = html.match(/<title>(.*?)<\/title>/i);
  if (m && m[1]) {
    return m[1].replace(/\s+-\s+YouTube$/i, "").trim();
  }
  return null;
}

async function fetchHtml(videoId) {
  try {
    const url = `https://www.youtube.com/watch?v=${videoId}`;
    const res = await fetch(url);
    if (!res.ok) return null;
    return await res.text();
  } catch {
    return null;
  }
}

async function scrapeContext(videoId, debug = false) {
  const [noembed, html] = await Promise.all([
    fetchNoembed(videoId),
    fetchHtml(videoId),
  ]);

  const title =
    (noembed && noembed.title) ||
    (html && extractTitle(html)) ||
    null;

  const author = (noembed && noembed.author_name) || null;
  const description = html ? extractDesc(html) : null;
  const htmlSnippet = html ? html.slice(0, 8000) : null;

  if (debug) {
    console.log(" SCRAPER CONTEXT:", {
      title,
      author,
      descPreview: description ? description.slice(0, 100) : null,
    });
  }

  return { title, author, description, htmlSnippet };
}

// ======================================================================
//  Summary interno via AI (tipo "YouTube Summary" interno)
// ======================================================================

async function trySummaryInternal(videoId, debug = false) {
  const ctx = await scrapeContext(videoId, debug);
  const { title, description } = ctx;

  if (!title && !description) return null;

  const systemPrompt =
    "Riassumi in 10-15 frasi brevi e chiare il probabile contenuto di questo video YouTube, basandoti su titolo e descrizione. Non inventare cose assurde, ma sii verosimile.";

  const userPrompt = `
Titolo: ${title || "(non disponibile)"}

Descrizione:
${description || "(nessuna descrizione)"}
`.trim();

  try {
    if (debug) console.log(" Summary interno: chiamata modello...");
    const aiRaw = await callAIModel({
      model: process.env.AI_SUMMARY_MODEL || "gpt-4o-mini",
      temperature: 0.4,
      maxTokens: 1500,
      systemPrompt,
      userPrompt,
    });

    const txt = String(
      typeof aiRaw === "string" ? aiRaw : aiRaw?.content || aiRaw?.text || ""
    ).trim();

    if (!txt || txt.length < 50) return null;

    if (debug) console.log(" Summary interno OK (len:", txt.length, ")");
    return txt;
  } catch {
    return null;
  }
}

// ======================================================================
//  AI Transcript Rebuild (con contesto + summary)
// ======================================================================

async function rebuildTranscript(videoId, ctx, summary, debug = false) {
  const systemPrompt = `
Sei un assistente che ricostruisce transcript verosimili di video YouTube
per analisi strategiche. Usa tutti i dati disponibili (titolo, autore, descrizione,
summary testuale, snippet HTML) per creare un transcript continuo, naturale, plausibile,
in italiano se possibile. Non scrivere commenti, solo il testo del transcript.
`.trim();

  const parts = [];

  parts.push(`Video ID: ${videoId}`);
  if (ctx?.title) parts.push(`Titolo: ${ctx.title}`);
  if (ctx?.author) parts.push(`Autore/Canale: ${ctx.author}`);
  if (ctx?.description) parts.push(`Descrizione YouTube:\n${ctx.description}`);
  if (summary) parts.push(`Riassunto disponibile:\n${summary}`);
  if (ctx?.htmlSnippet) parts.push(`Snippet HTML (estratto dalla pagina YouTube):\n${ctx.htmlSnippet}`);

  parts.push("Ricostruisci il possibile transcript parlato del video, con frasi complete e scorrevoli.");

  const userPrompt = parts.join("\n\n");

  try {
    if (debug) console.log(" AI REBUILD: chiamata modello...");
    const aiRaw = await callAIModel({
      model: process.env.AI_TRANSCRIPT_REBUILD_MODEL || "gpt-4o-mini",
      temperature: 0.5,
      maxTokens: 6000,
      systemPrompt,
      userPrompt,
    });

    const txt = String(
      typeof aiRaw === "string" ? aiRaw : aiRaw?.content || aiRaw?.text || ""
    ).trim();

    if (!txt || txt.length < 50) {
      if (debug) console.log(" AI REBUILD ha prodotto testo corto/vuoto.");
      return null;
    }

    if (debug) console.log(" AI REBUILD OK (len:", txt.length, ")");
    return txt;
  } catch {
    return null;
  }
}

// ======================================================================
//  Fallback testuale generico (mai errori duri)
// ======================================================================

async function genericFallbackTranscript(videoId) {
  return `Transcript non disponibile per il video ${videoId}. L'AI non  riuscita a ricostruire il parlato. Incolla manualmente la trascrizione da YouTube dentro Zen YouTube Coach Pro per analisi pi accurate.`;
}

// ======================================================================
//  AI Cleanup finale
// ======================================================================

async function cleanupTranscript(text) {
  if (!text || text.length < 20) return null;

  const systemPrompt = `
Ripulisci questo transcript:
- sistema la punteggiatura,
- unisci frasi spezzate,
- non aggiungere concetti nuovi,
- non cambiare lingua.
Rispondi solo con il testo pulito.
`.trim();

  const userPrompt = text;

  try {
    const aiRaw = await callAIModel({
      model: process.env.AI_TRANSCRIPT_CLEAN_MODEL || "gpt-4o-mini",
      temperature: 0.1,
      maxTokens: 4000,
      systemPrompt,
      userPrompt,
    });

    const out = String(
      typeof aiRaw === "string" ? aiRaw : aiRaw?.content || aiRaw?.text || ""
    ).trim();

    if (!out || out.length < 20) return null;
    return out;
  } catch {
    return null;
  }
}

// ======================================================================
//  PIPELINE PRINCIPALE AUTOMATICA
// ======================================================================

async function resolvePipeline(videoId, options = {}) {
  const debug = !!options.debug;
  if (debug) console.log(` PIPELINE V6  videoId = ${videoId}`);

  // 1) TimedText
  const timed = await tryTimedText(videoId, debug);
  if (timed) {
    const cleaned = await cleanupTranscript(timed.plain);
    return { provider: timed.provider, text: cleaned || timed.plain };
  }

  // 2) Proxy
  const proxy = await tryProxy(videoId, debug);
  if (proxy) {
    const cleaned = await cleanupTranscript(proxy.plain);
    return { provider: proxy.provider, text: cleaned || proxy.plain };
  }

  // 3) Summary (manuale, API, interno)
  let summary = null;

  if (options.manualSummary && options.manualSummary.trim().length > 0) {
    summary = options.manualSummary.trim();
    if (debug) console.log(" Uso manualSummary fornito dall'utente.");
  } else {
    summary =
      (await trySummaryApi(videoId, debug)) ||
      (await trySummaryInternal(videoId, debug));
  }

  // 4) Scraper contesto + AI Rebuild
  const ctx = await scrapeContext(videoId, debug);
  const rebuilt = await rebuildTranscript(videoId, ctx, summary, debug);

  if (rebuilt) {
    const cleaned = await cleanupTranscript(rebuilt);
    return {
      provider: summary ? "ai-rebuild-with-summary" : "ai-rebuild",
      text: cleaned || rebuilt,
    };
  }

  // 5) Fallback generico (ma SEMPRE testo, mai errore duro)
  const fallback = await genericFallbackTranscript(videoId);
  return { provider: "fallback-generic", text: fallback };
}

// ======================================================================
//  ENTRYPOINT PUBBLICO
// ======================================================================
//
// getTranscript(videoIdOrUrl, {
//   manualTranscript?: string,
//   manualSummary?: string,
//   forceRefresh?: boolean,
//   debug?: boolean
// })
//
// ======================================================================

export async function getTranscript(videoIdOrUrl, options = {}) {
  const {
    manualTranscript,
    manualSummary,
    forceRefresh = false,
    debug = false,
  } = options;

  const videoId = normalizeVideoId(videoIdOrUrl);

  if (!videoId) {
    return {
      success: false,
      error: true,
      message: "videoId non valido.",
    };
  }

  // 1) manualTranscript  PRIORITARIO (quello che incolli tu da YouTube)
  if (manualTranscript && manualTranscript.trim().length > 20) {
    const text = manualTranscript.trim();
    const cleaned = await cleanupTranscript(text);
    const final = cleaned || text;

    const out = {
      success: true,
      error: false,
      provider: "manual",
      videoId,
      continuousText: final,
      aiText: cleaned || null,
      timestamp: new Date().toISOString(),
    };

    transcriptCache.set(videoId, out);
    return out;
  }

  // 2) Cache
  if (!forceRefresh && transcriptCache.has(videoId)) {
    return { ...transcriptCache.get(videoId), fromCache: true };
  }

  // 3) Pipeline automatica
  const result = await resolvePipeline(videoId, { manualSummary, debug });

  const out = {
    success: true,
    error: false,
    provider: result.provider,
    videoId,
    continuousText: result.text,
    aiText: null,
    timestamp: new Date().toISOString(),
  };

  transcriptCache.set(videoId, out);
  return out;
}

// Tools opzionali
export function clearTranscriptCache() {
  transcriptCache.clear();
}

export function getTranscriptCacheSize() {
  return transcriptCache.size;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\transcriptUtils.js
// ==================================================

// ======================================================================
//  transcriptUtils.js  Versione 2025 Ultra-Premium
// Utilities avanzate per la pulizia, normalizzazione e fusione segmenti
// Compatibile con transcriptService.js + compare-transcript + analyze
// ======================================================================

// ---------------------------------------------------------------
// 1 Riconoscimento timestamp tipo: 00:01 / 1:23 / 12:03:59
// ---------------------------------------------------------------
export function isTimestamp(str = "") {
  return /^\d{1,2}:\d{2}(:\d{2})?$/.test(str.trim());
}

// ---------------------------------------------------------------
// 2 Pulizia testo: rimuove rumore, tag, doppi spazi, timestamp mixati
// ---------------------------------------------------------------
export function cleanText(text = "") {
  return String(text)
    .replace(/<[^>]+>/g, " ")            // Tag HTML/XML
    .replace(/\[[^\]]+\]/g, " ")         // [music], [applause], ecc.
    .replace(/\(\d+:\d+\)/g, " ")         // Timestamp in parentesi
    .replace(/\d{1,2}:\d{2}(:\d{2})?/g, "") // Timestamp qualsiasi
    .replace(/\s+/g, " ")                // Spazi multipli
    .trim();
}

// ---------------------------------------------------------------
// 3 Normalizza segmenti YouTube (oggetto  testo pulito coerente)
// ---------------------------------------------------------------
export function normalizeSegments(segments = []) {
  if (!Array.isArray(segments)) return [];

  return segments
    .map((s) => {
      if (!s) return null;

      let text = "";

      // Caso 1: YouTube API restituisce: { text: "..." }
      if (typeof s === "object" && s.text) text = s.text;

      // Caso 2: stringa pura
      if (typeof s === "string") text = s;

      if (!text) return null;

      const cleaned = cleanText(text);
      if (!cleaned || cleaned.length < 1) return null;

      return cleaned;
    })
    .filter(Boolean);
}

// ---------------------------------------------------------------
// 4 Merge segmenti  testo continuo
// ---------------------------------------------------------------
export function mergeSegmentsToText(segments = []) {
  if (!Array.isArray(segments)) return "";

  const cleaned = normalizeSegments(segments);

  return cleaned
    .join(" ")
    .replace(/\s{2,}/g, " ")
    .trim();
}

// ---------------------------------------------------------------
// 5 Mini-SRT generator (non basato su tempi reali, solo sequenze)
// ---------------------------------------------------------------
export function segmentsToSRT(segments = []) {
  const cleaned = normalizeSegments(segments);
  if (!cleaned.length) return "";

  return cleaned
    .map((line, i) => {
      const start = `00:00:${String(i).padStart(2, "0")},000`;
      const end = `00:00:${String(i + 1).padStart(2, "0")},000`;

      return `${i + 1}\n${start} --> ${end}\n${line}\n`;
    })
    .join("\n");
}

// ---------------------------------------------------------------
// 6 Mini-VTT generator (stesso approccio finch non hai timestamp reali)
// ---------------------------------------------------------------
export function segmentsToVTT(segments = []) {
  const cleaned = normalizeSegments(segments);
  if (!cleaned.length) return "";

  const header = "WEBVTT\n\n";

  const body = cleaned
    .map((line, i) => {
      const start = `00:00:${String(i).padStart(2, "0")}.000`;
      const end = `00:00:${String(i + 1).padStart(2, "0")}.000`;
      return `${start} --> ${end}\n${line}\n`;
    })
    .join("\n");

  return header + body;
}

// ---------------------------------------------------------------
// 7 Funzione premium: deduplicazione + ricostruzione naturale
// ---------------------------------------------------------------
export function naturalParagraphsFromText(text = "", maxLen = 220) {
  const cleaned = cleanText(text);

  if (!cleaned) return [];

  const sentences = cleaned.split(/(?<=[.!?])\s+/);
  const paragraphs = [];

  let buffer = [];

  for (const sentence of sentences) {
    buffer.push(sentence);

    if (buffer.join(" ").length >= maxLen) {
      paragraphs.push(buffer.join(" "));
      buffer = [];
    }
  }

  if (buffer.length) paragraphs.push(buffer.join(" "));

  return paragraphs.map((p) => p.trim());
}

// ---------------------------------------------------------------
// 8 Funzione Premium: controllo qualit transcript
// ---------------------------------------------------------------
export function validateTranscriptQuality(text = "") {
  const length = text.length;
  const wordCount = text.split(/\s+/).filter(Boolean).length;

  return {
    isTooShort: wordCount < 20,
    isProbablyInvalid: wordCount < 5,
    length,
    wordCount,
    score: (() => {
      if (wordCount < 10) return 1;
      if (wordCount < 50) return 3;
      if (wordCount < 150) return 6;
      if (wordCount < 500) return 8;
      return 10;
    })()
  };
}

// ---------------------------------------------------------------
// 9 Utility Premium: safeTrim (evita crash di undefined/null)
// ---------------------------------------------------------------
export function safeTrim(value) {
  if (!value) return "";
  return String(value).trim();
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\trendScanService.js
// ==================================================

// services/trendScanService.js

import Groq from "groq-sdk";
import dotenv from "dotenv";
dotenv.config();

const client = new Groq({
  apiKey: process.env.GROQ_API_KEY
});

/**
 * Forza il modello a rispondere in JSON
 * Taglia eventuali testi extra prima/dopo
 */
function cleanJSON(raw) {
  try {
    const first = raw.indexOf("{");
    const last = raw.lastIndexOf("}");
    const jsonString = raw.substring(first, last + 1);
    return JSON.parse(jsonString);
  } catch (e) {
    console.error(" JSON_PARSE_ERROR:", e, "\nRAW:", raw);
    return { error: "JSON_PARSE_ERROR", raw };
  }
}

/**
 * Trend Scan PRO  Segmentazione 50/60/70
 */
export async function TrendScanPro() {
  const prompt = `
Sei un YouTube Trend Analyst esperto in pubblico over 50, over 60 e over 70.
Analizza SOLO la nicchia: salute, benessere, alimentazione, lunga vita.

Genera massimo 20 trend attivi dal 2024 a oggi.

Per ogni trend crea:
- topic
- audience_relevance: { over50, over60, over70 }
- score 1-100 (opportunity)
- volume (alto/medio/basso)
- competition (bassa/media/alta)
- longevity_days (durata prevista)
- best_day
- best_hour
- 2 subtopics
- 1 video idea ottimizzata per il canale Zen Salute e Benessere

RISPONDI SOLO IN JSON.
  `;

  const response = await client.chat.completions.create({
    model: "llama-3.1-70b-versatile",
    temperature: 0.3,
    max_tokens: 4096,
    messages: [
      { role: "system", content: "Sei un analista di trend YouTube professionale." },
      { role: "user", content: prompt }
    ]
  });

  const content = response.choices[0].message.content;
  return cleanJSON(content);
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\videoInfoService.js
// ==================================================

// ======================================================
//  videoInfoService.js  Zen YouTube Coach Pro
// ESTRAZIONE DATI VIDEO YOUTUBE (NO API KEY, NO COSTI)
// ======================================================

import dotenv from "dotenv";
dotenv.config();

/**
 * Funzione principale
 * @param {string} videoId
 * @returns {Promise<{ok:boolean, error?:string, data?:object}>}
 */
export async function getVideoInfo(videoId) {
  try {
    if (!videoId) {
      return { ok: false, error: "Missing videoId" };
    }

    const url = `https://www.youtube.com/watch?v=${videoId}`;
    const html = await fetch(url).then((r) => r.text());

    if (!html) {
      return { ok: false, error: "Unable to fetch YouTube page" };
    }

    // ------------------------------------------------------
    //  Estrai ytInitialPlayerResponse dal codice HTML
    // ------------------------------------------------------
    const playerResponse = extractInitialPlayerResponse(html);

    if (!playerResponse) {
      return {
        ok: false,
        error: "Unable to locate ytInitialPlayerResponse in HTML"
      };
    }

    // ------------------------------------------------------
    //  Estrarre dati principali
    // ------------------------------------------------------
    const videoDetails = playerResponse.videoDetails || {};
    const microformat = playerResponse.microformat?.playerMicroformatRenderer || {};

    const info = {
      videoId: videoDetails.videoId || videoId,
      title: videoDetails.title || null,
      description: videoDetails.shortDescription || null,
      author: videoDetails.author || null,
      channelId: videoDetails.channelId || null,
      thumbnails: videoDetails.thumbnail?.thumbnails || [],
      thumbnailHD: extractBestThumbnail(videoDetails),
      durationSec: parseInt(videoDetails.lengthSeconds || microformat.lengthSeconds || 0),
      tags: videoDetails.keywords || [],
      isLive: videoDetails.isLive || false,
      published: microformat.publishDate || null,
      uploadDate: microformat.uploadDate || null
    };

    return { ok: true, data: info };

  } catch (err) {
    console.error(" videoInfoService ERROR:", err);
    return {
      ok: false,
      error: err?.message || "Unknown error while fetching video info"
    };
  }
}

// ======================================================
//  Estrai ytInitialPlayerResponse dal codice sorgente
// ======================================================
function extractInitialPlayerResponse(html) {
  try {
    const marker = "ytInitialPlayerResponse =";
    const idx = html.indexOf(marker);

    if (idx === -1) return null;

    // taglia a partire dal marker
    const start = idx + marker.length;
    const sliced = html.slice(start);

    // cerca la chiusura dell'oggetto JSON
    const endIdx = sliced.indexOf(";</script>");
    if (endIdx === -1) return null;

    const jsonString = sliced.slice(0, endIdx).trim();

    return JSON.parse(jsonString);
  } catch (err) {
    console.error(" extractInitialPlayerResponse ERROR:", err);
    return null;
  }
}

// ======================================================
//  Trova la thumbnail pi alta disponibile
// ======================================================
function extractBestThumbnail(videoDetails = {}) {
  try {
    const thumbs = videoDetails?.thumbnail?.thumbnails;

    if (!thumbs || !Array.isArray(thumbs)) return null;

    // ordina per risoluzione
    const sorted = thumbs.sort((a, b) => (b.width * b.height) - (a.width * a.height));
    return sorted[0] || null;
  } catch {
    return null;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\youtubeMetadata.js
// ==================================================

// ======================================================================
//  youtubeMetadata.js  Metadata YouTube (OEmbed UFFICIALE)
// ======================================================================

export async function fetchYouTubeMetadata(videoIdOrUrl) {
  try {
    let videoUrl = videoIdOrUrl;

    // Normalizza URL
    if (!videoUrl.startsWith("http")) {
      videoUrl = `https://www.youtube.com/watch?v=${videoIdOrUrl}`;
    }

    // Endpoint OEmbed ufficiale YouTube
    const oembedUrl = `https://www.youtube.com/oembed?url=${encodeURIComponent(
      videoUrl
    )}&format=json`;

    const res = await fetch(oembedUrl, {
      headers: {
        "User-Agent":
          "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36",
        Accept: "application/json"
      }
    });

    if (!res.ok) {
      return {
        error: true,
        message: "YouTube OEmbed non disponibile"
      };
    }

    const data = await res.json();

    // estrai id video
    const match = videoUrl.match(/v=([^&]+)/);
    const videoId = match ? match[1] : null;

    return {
      success: true,
      videoId,
      title: data.title || "",
      author: data.author_name || "",
      thumbnail: data.thumbnail_url || "",
      description: "" // OEmbed NON restituisce descrizione
    };
  } catch (err) {
    return {
      error: true,
      message: err.message
    };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\youtubeService.js
// ==================================================

// src/services/youtubeService.js

import axios from "axios";

const YT_API_KEY = process.env.YOUTUBE_API_KEY;

/**
 * Ottiene gli ultimi video di un canale YouTube
 */
export async function fetchChannelVideos(channelId, maxResults = 10) {
  try {
    const url = `https://www.googleapis.com/youtube/v3/search?key=${YT_API_KEY}&channelId=${channelId}&part=snippet,id&order=date&maxResults=${maxResults}`;
    const response = await axios.get(url);

    return response.data.items.map((item) => ({
      videoId: item.id.videoId,
      title: item.snippet.title,
      description: item.snippet.description,
      thumbnail: item.snippet.thumbnails?.high?.url,
      publishedAt: item.snippet.publishedAt
    }));
  } catch (err) {
    console.error("fetchChannelVideos ERROR:", err.message);
    throw new Error("Failed to fetch channel videos.");
  }
}

/**
 * Ottiene dettagli completi di un singolo video
 */
export async function fetchVideoDetails(videoId) {
  try {
    const url = `https://www.googleapis.com/youtube/v3/videos?key=${YT_API_KEY}&id=${videoId}&part=snippet,statistics,contentDetails`;
    const response = await axios.get(url);

    const info = response.data.items[0];

    return {
      id: videoId,
      title: info.snippet.title,
      description: info.snippet.description,
      thumbnail: info.snippet.thumbnails?.high?.url,
      publishedAt: info.snippet.publishedAt,
      duration: info.contentDetails.duration,
      views: Number(info.statistics.viewCount || 0),
      likes: Number(info.statistics.likeCount || 0),
      comments: Number(info.statistics.commentCount || 0),
      channelId: info.snippet.channelId
    };
  } catch (err) {
    console.error("fetchVideoDetails ERROR:", err.message);
    throw new Error("Failed to fetch video details.");
  }
}

/**
 * Ottiene informazioni video + canale partendo da URL YouTube
 */
export async function getVideoInfo(videoUrl) {
  try {
    // Estrai ID del video da URL
    const match = videoUrl.match(/v=([a-zA-Z0-9_-]+)/);
    const videoId = match ? match[1] : null;

    if (!videoId) {
      throw new Error("Invalid YouTube URL: unable to extract video ID");
    }

    // 1. Ottieni dettagli video
    const video = await fetchVideoDetails(videoId);

    // 2. Ottieni dettagli canale
    let channel = null;

    if (video.channelId) {
      const url = `https://www.googleapis.com/youtube/v3/channels?key=${YT_API_KEY}&id=${video.channelId}&part=snippet,statistics`;
      const response = await axios.get(url);
      const info = response.data.items?.[0];

      if (info) {
        channel = {
          id: video.channelId,
          title: info.snippet.title,
          description: info.snippet.description,
          thumbnails: info.snippet.thumbnails,
          subscribers: Number(info.statistics.subscriberCount || 0),
          videos: Number(info.statistics.videoCount || 0),
          views: Number(info.statistics.viewCount || 0)
        };
      }
    }

    return {
      video,
      channel
    };
  } catch (err) {
    console.error("getVideoInfo ERROR:", err.message);
    throw new Error("Failed to extract video info.");
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\youtubeTitleService.js
// ==================================================

// ======================================================================
//  youtubeTitleService.js  Recupero titolo YouTube (senza API Key)
// Ultra Premium 2025
// ======================================================================

export async function getYouTubeTitle(videoIdOrUrl) {
  try {
    if (!videoIdOrUrl) return null;

    // Estrazione videoId (copiata dalla logica del transcriptService)
    let videoId = videoIdOrUrl;
    if (videoIdOrUrl.startsWith("http")) {
      try {
        const url = new URL(videoIdOrUrl);
        const v = url.searchParams.get("v");
        if (v) videoId = v;

        const m = url.pathname.match(/\/(shorts|embed)\/([^/?]+)/);
        if (m?.[2]) videoId = m[2];
      } catch {
        // fallback: usa stringa intera
      }
    }

    const res = await fetch(`https://www.youtube.com/watch?v=${videoId}`);
    if (!res.ok) return null;

    const html = await res.text();

    // Estraggo il <title> dal documento HTML
    const match = html.match(/<title>(.*?)<\/title>/i);
    if (!match || !match[1]) return null;

    return match[1]
      .replace("- YouTube", "")
      .trim();
  } catch (err) {
    console.warn(" getYouTubeTitle error:", err.message);
    return null;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\services\youtubeTools.js
// ==================================================

// ==========================================================================
//   youtubeTools.js  Zen YouTube Coach Pro
//  Transcript Engine Ultra-Premium stile YouTube Summary
//  Pipeline:
//   1) YouTube timedtext
//   2) HTML captionTracks (ytInitialPlayerResponse)
//   3) Whisper (audio  testo) via OpenAI
//   4) AI Summary (pseudo-trascrizione da titolo+descrizione)
// ==========================================================================

import axios from "axios";
import ytdl from "ytdl-core";
import FormData from "form-data";
import dotenv from "dotenv";

dotenv.config();

const OPENAI_API_KEY = process.env.OPENAI_API_KEY || null;
const transcriptCache = new Map();

// ==========================================================================
//   Estrai videoId da URL YouTube
// ==========================================================================
export function extractYouTubeId(url) {
  try {
    if (!url) return null;

    if (url.includes("youtu.be/")) {
      return url.split("youtu.be/")[1].split("?")[0];
    }

    if (url.includes("watch?v=")) {
      const params = new URL(url);
      return params.searchParams.get("v");
    }

    if (url.includes("/shorts/")) {
      return url.split("/shorts/")[1].split("?")[0];
    }

    return null;
  } catch (error) {
    console.error(" Errore estrazione videoId:", error);
    return null;
  }
}

// ==========================================================================
//   Livello 1  YouTube TimedText API
// ==========================================================================
async function fetchTimedText(videoId, lang = "it") {
  try {
    const url = `https://www.youtube.com/api/timedtext?lang=${lang}&v=${videoId}`;

    const { data } = await axios.get(url, {
      timeout: 8000,
      responseType: "text",
    });

    if (!data || data.length < 10) return null;

    let transcript = data
      .replace(/<text start="([\d.]+)" dur="([\d.]+)">/g, "")
      .replace(/<\/text>/g, "\n")
      .replace(/&amp;/g, "&")
      .replace(/&#39;/g, "'")
      .replace(/&quot;/g, '"')
      .replace(/<[^>]+>/g, "")
      .trim();

    if (transcript.length < 20) return null;

    console.log(" Transcript trovato via timedtext");
    return transcript;
  } catch (err) {
    console.log(" timedtext non disponibile:", err.message);
    return null;
  }
}

// ==========================================================================
//   Livello 2  HTML captionTracks da ytInitialPlayerResponse
// ==========================================================================
async function fetchFromHtmlCaptions(videoId, preferredLangs = ["it", "en"]) {
  try {
    const watchUrl = `https://www.youtube.com/watch?v=${videoId}`;

    const { data: html } = await axios.get(watchUrl, {
      timeout: 10000,
      responseType: "text",
      headers: {
        "User-Agent":
          "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36",
      },
    });

    const match = html.match(
      /ytInitialPlayerResponse\s*=\s*({.*?});<\/script>/s
    );
    if (!match || match.length < 2) {
      console.log(" ytInitialPlayerResponse non trovato nell'HTML");
      return null;
    }

    let playerResponseRaw = match[1];
    playerResponseRaw = playerResponseRaw.replace(/;$/, "");

    let playerResponse;
    try {
      playerResponse = JSON.parse(playerResponseRaw);
    } catch (err) {
      console.log(" Errore parse ytInitialPlayerResponse:", err.message);
      return null;
    }

    const captionTracks =
      playerResponse?.captions?.playerCaptionsTracklistRenderer?.captionTracks;

    if (!captionTracks || !Array.isArray(captionTracks) || captionTracks.length === 0) {
      console.log(" Nessun captionTrack trovato in ytInitialPlayerResponse");
      return null;
    }

    let track = null;
    for (const lang of preferredLangs) {
      track = captionTracks.find((t) => t.languageCode === lang);
      if (track) break;
    }
    if (!track) {
      track = captionTracks[0];
    }

    if (!track?.baseUrl) {
      console.log(" captionTrack senza baseUrl");
      return null;
    }

    const { data } = await axios.get(track.baseUrl, {
      timeout: 10000,
      responseType: "text",
    });

    let transcript = data
      .replace(/<text.*?>/g, "")
      .replace(/<\/text>/g, "\n")
      .replace(/<[^>]+>/g, "")
      .replace(/&amp;/g, "&")
      .replace(/&#39;/g, "'")
      .replace(/&quot;/g, '"')
      .trim();

    if (!transcript || transcript.length < 20) {
      console.log(" Transcript via HTML troppo corto o vuoto");
      return null;
    }

    console.log(" Transcript trovato via HTML/ytInitialPlayerResponse");
    return transcript;
  } catch (err) {
    console.log(" Errore fetchFromHtmlCaptions:", err.message);
    return null;
  }
}

// ==========================================================================
//   Helper  Metadati base dal HTML (titolo + descrizione)
// ==========================================================================
async function fetchVideoMetadata(videoId) {
  try {
    const watchUrl = `https://www.youtube.com/watch?v=${videoId}`;

    const { data: html } = await axios.get(watchUrl, {
      timeout: 10000,
      responseType: "text",
      headers: {
        "User-Agent":
          "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36",
      },
    });

    let title = "";
    const titleMatch = html.match(/<title>(.*?)<\/title>/i);
    if (titleMatch && titleMatch[1]) {
      title = titleMatch[1].replace(" - YouTube", "").trim();
    }

    let description = "";
    const descMatch = html.match(
      /"shortDescription":"(.*?)","isCrawlable"/s
    );
    if (descMatch && descMatch[1]) {
      description = descMatch[1]
        .replace(/\\n/g, " ")
        .replace(/\\"/g, '"')
        .replace(/\\\\/g, "\\")
        .trim();
    }

    return { title, description };
  } catch (err) {
    console.log(" Errore fetchVideoMetadata:", err.message);
    return { title: "", description: "" };
  }
}

// ==========================================================================
//   Livello 3  Whisper (audio  testo)
// ==========================================================================
async function fetchTranscriptWhisper(videoId, lang = "it") {
  if (!OPENAI_API_KEY) {
    console.log(" Nessuna OPENAI_API_KEY, Whisper disattivato");
    return null;
  }

  try {
    const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;
    console.log(` Whisper: scarico audio da ${videoUrl}`);

    const audioStream = ytdl(videoUrl, {
      quality: "lowestaudio",
      filter: "audioonly",
    });

    const chunks = [];
    await new Promise((resolve, reject) => {
      audioStream.on("data", (chunk) => chunks.push(chunk));
      audioStream.on("end", resolve);
      audioStream.on("error", reject);
    });

    const audioBuffer = Buffer.concat(chunks);

    const form = new FormData();
    form.append("file", audioBuffer, {
      filename: `${videoId}.webm`,
      contentType: "audio/webm",
    });
    form.append("model", "whisper-1");
    form.append("language", lang);

    const { data } = await axios.post(
      "https://api.openai.com/v1/audio/transcriptions",
      form,
      {
        headers: {
          Authorization: `Bearer ${OPENAI_API_KEY}`,
          ...form.getHeaders(),
        },
        timeout: 120000,
      }
    );

    if (!data?.text) {
      console.log(" Whisper non ha restituito testo");
      return null;
    }

    console.log(" Transcript ottenuto via Whisper");
    return data.text;
  } catch (err) {
    console.log(" Errore Whisper:", err.message);
    return null;
  }
}

// ==========================================================================
//   Livello 4  AI Summary (pseudo-trascrizione)
//   Nota: questo NON vede il video, usa titolo+descrizione per generare
//  un testo strutturato che si comporta *come* una trascrizione plausibile.
// ==========================================================================
async function fetchTranscriptAISummary(videoId) {
  if (!OPENAI_API_KEY) {
    console.log(" Nessuna OPENAI_API_KEY, AI Summary disattivato");
    return null;
  }

  try {
    const { title, description } = await fetchVideoMetadata(videoId);

    if (!title && !description) {
      console.log(" Nessun metadata per AI Summary");
      return null;
    }

    const prompt = `
Ti do titolo e descrizione di un video YouTube.

Titolo: ${title || "N/D"}
Descrizione: ${description || "N/D"}

Scrivi una pseudo-trascrizione PLAUSIBILE in italiano, come se stessi
trascrivendo il contenuto del video, parlato in seconda persona singolare,
stile educativo ma semplice.

Non inventare cose assurde, resta aderente al tema evidente da titolo+descrizione.
Non mettere timestamp o label di speaker. Solo testo continuo, ben strutturato in paragrafi brevi.
    `.trim();

    const payload = {
      model: "gpt-4o-mini",
      messages: [
        {
          role: "system",
          content:
            "Sei uno strumento che genera pseudo-trascrizioni plausibili per video YouTube, basandosi su titolo e descrizione.",
        },
        { role: "user", content: prompt },
      ],
      temperature: 0.4,
    };

    const { data } = await axios.post(
      "https://api.openai.com/v1/chat/completions",
      payload,
      {
        headers: {
          Authorization: `Bearer ${OPENAI_API_KEY}`,
          "Content-Type": "application/json",
        },
        timeout: 60000,
      }
    );

    const text = data?.choices?.[0]?.message?.content?.trim();
    if (!text) {
      console.log(" AI Summary non ha restituito contenuto");
      return null;
    }

    console.log(" Pseudo-trascrizione generata via AI Summary");
    return text;
  } catch (err) {
    console.log(" Errore AI Summary:", err.message);
    return null;
  }
}

// ==========================================================================
//   Clean transcript
// ==========================================================================
function cleanTranscript(text) {
  if (!text) return null;

  return text
    .replace(/\r/g, "")
    .replace(/\n{2,}/g, "\n")
    .replace(/\s{2,}/g, " ")
    .trim();
}

// ==========================================================================
//   Funzione principale: PIPELINE COMPLETA
// ==========================================================================
export async function fetchTranscript(videoId, options = {}) {
  try {
    if (!videoId) return null;

    if (transcriptCache.has(videoId)) {
      return transcriptCache.get(videoId);
    }

    const preferredLangs = options.preferredLangs || ["it", "en"];

    let transcript = null;

    // 1 TimedText
    transcript = await fetchTimedText(videoId, preferredLangs[0]);
    if (transcript) {
      transcript = cleanTranscript(transcript);
      transcriptCache.set(videoId, transcript);
      return transcript;
    }

    // 2 HTML captionTracks
    transcript = await fetchFromHtmlCaptions(videoId, preferredLangs);
    if (transcript) {
      transcript = cleanTranscript(transcript);
      transcriptCache.set(videoId, transcript);
      return transcript;
    }

    // 3 Whisper (audio  testo)
    transcript = await fetchTranscriptWhisper(videoId, preferredLangs[0]);
    if (transcript) {
      transcript = cleanTranscript(transcript);
      transcriptCache.set(videoId, transcript);
      return transcript;
    }

    // 4 AI Summary (pseudo-trascrizione)
    transcript = await fetchTranscriptAISummary(videoId);
    if (transcript) {
      transcript = cleanTranscript(transcript);
      transcriptCache.set(videoId, transcript);
      return transcript;
    }

    console.log(" Nessun livello pipeline  riuscito a ottenere il transcript");
    return null;
  } catch (error) {
    console.error(" Errore nella fetchTranscript:", error);
    return null;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\utils\cleanAIResponse.js
// ==================================================

// ===================================================================
//  cleanAIResponse.js  Rimuove ```json, markdown e converte in JSON valido
// ===================================================================

export function cleanAIResponse(raw) {
  try {
    if (!raw) return null;

    // Rimuove blocchi ```json o ```
    raw = raw.replace(/```json|```/g, "").trim();

    // Trova prima e ultima graffa
    const first = raw.indexOf("{");
    const last = raw.lastIndexOf("}");

    if (first === -1 || last === -1) {
      console.warn(" Nessun JSON valido trovato, restituisco testo grezzo.");
      return { raw };
    }

    const jsonString = raw.substring(first, last + 1);

    return JSON.parse(jsonString);

  } catch (error) {
    console.error(" Errore pulizia JSON:", error, "RAW:", raw);
    return { raw };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\utils\jsonHelpers.js
// ==================================================

// ============================================================
//  jsonHelpers.js  estrazione e parse sicuro JSON da risposta AI
// ============================================================

export function extractJsonObject(raw) {
  try {
    if (typeof raw !== "string") return null;
    const first = raw.indexOf("{");
    const last = raw.lastIndexOf("}");
    if (first === -1 || last === -1) return null;
    return raw.substring(first, last + 1);
  } catch {
    return null;
  }
}

export function safeParseJson(raw) {
  try {
    if (!raw) return null;

    if (typeof raw === "object") {
      return raw;
    }

    const objSlice = extractJsonObject(raw);
    if (objSlice) {
      return JSON.parse(objSlice);
    }

    return JSON.parse(raw);
  } catch (err) {
    console.error(" safeParseJson error:", err);
    return null;
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\utils\jsonUtils.js
// ==================================================

// src/utils/jsonUtils.js
//  Utility per pulire e validare JSON generato dall'AI

export function safeParseJSON(content) {
  try {
    // Cerca il primo { e l'ultimo }
    const first = content.indexOf("{");
    const last = content.lastIndexOf("}");

    if (first !== -1 && last !== -1) {
      content = content.substring(first, last + 1);
    }

    return JSON.parse(content);
  } catch (e) {
    console.error(" JSON PARSE ERROR:", e, "\nRAW:", content);
    return { error: "Invalid JSON from AI", raw: content };
  }
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\utils\sceneTools.js
// ==================================================

// ============================================================
//  sceneTools.js  Boost Mode, Hook Surgeon, Fliki Markers
// ============================================================

/**
 * Template domande per retention (ogni 3 scene circa)
 */
const RETENTION_QUESTIONS = [
  "Quale di queste idee ti rispecchia di pi?",
  "Ti sei mai trovato in una situazione simile?",
  "Quale di questi consigli senti pi vicino alla tua vita quotidiana?",
  "Cosa ti colpisce di pi di quello che hai ascoltato finora?"
];

/**
 * Restituisce una label umana per il segmento di et
 */
function getSegmentLabel(segment) {
  switch (segment) {
    case "over50":
      return "dopo i 50 anni";
    case "over70":
      return "dopo i 70 anni";
    case "over60":
    default:
      return "dopo i 60 anni";
  }
}

/**
 *  Hook Surgeon  riscrive la prima scena per massimizzare l'aggancio
 * Mantiene il ruolo HOOK, aggiunge brand + promessa chiara.
 */
export function applyHookSurgeon(scenes, { idea, segment }) {
  if (!Array.isArray(scenes) || scenes.length === 0) return scenes;

  const [first, ...rest] = scenes;
  const segmentLabel = getSegmentLabel(segment || "over60");

  const originalText = (first.text || "").trim();
  const topic = (idea || "migliorare la tua salute e il tuo benessere").toLowerCase();

  const newHookText = `
Benvenuto su Zen Salute e Benessere. Se hai superato l'et dei ${segmentLabel} e ti capita di fare fatica con il sonno o la stanchezza durante il giorno, questo video  per te. Insieme vedremo passo passo cosa puoi fare nella vita di tutti i giorni per ${topic}, con esempi semplici e concreti, senza termini medici complicati. ${originalText}
`.trim();

  return [
    {
      ...first,
      role: "HOOK",
      text: newHookText
    },
    ...rest
  ];
}

/**
 *  Domande di retention  aggiunge una domanda ogni N scene
 * (senza toccare CTA e senza aggiungere doppie domande)
 */
export function insertRetentionQuestions(scenes, interval = 3) {
  if (!Array.isArray(scenes) || scenes.length === 0) return scenes;

  let questionIndex = 0;

  return scenes.map((scene, idx) => {
    const output = { ...scene };
    const text = (output.text || "").trim();

    // salta CTA e scene che gi finiscono con ?
    if (
      (idx + 1) % interval !== 0 ||
      output.role === "CTA" ||
      text.endsWith("?")
    ) {
      return output;
    }

    const q = RETENTION_QUESTIONS[questionIndex % RETENTION_QUESTIONS.length];
    questionIndex += 1;

    output.text = `${text} ${q}`.trim();
    return output;
  });
}

/**
 *  Fliki AutoScene Mode  aggiunge [SCENE_CHANGE] a fine scena
 * (senza usare costanti non definite, tutto come stringa)
 */
export function addFlikiMarkers(scenes) {
  if (!Array.isArray(scenes) || scenes.length === 0) return scenes;

  const MARKER = " [SCENE_CHANGE]";

  return scenes.map((scene, idx) => {
    const output = { ...scene };
    const text = (output.text || "").trim();

    // Se il marker gi c', non lo duplico
    if (text.includes("[SCENE_CHANGE]")) {
      output.text = text;
      return output;
    }

    // Puoi decidere se saltare l'ultima scena; per ora lo mettiamo ovunque
    output.text = `${text}${MARKER}`;
    return output;
  });
}

/**
 *  Normalizza scena (id, role, text)
 */
function normalizeScene(scene, index) {
  const out = { ...scene };

  if (typeof out.id !== "number") {
    out.id = index + 1;
  }

  if (typeof out.role !== "string") {
    out.role = "SPIEGAZIONE";
  }

  if (typeof out.text !== "string") {
    out.text = String(out.text || "");
  }

  return out;
}

/**
 *  applyBoostModes  applica in sequenza:
 * Hook Surgeon  domande retention  Fliki markers
 */
export function applyBoostModes(scenes, options = {}) {
  const {
    idea,
    segment = "over60",
    enableHookSurgeon = true,
    enableRetentionQuestions = true,
    retentionInterval = 3,
    enableFlikiMarkers = true
  } = options;

  if (!Array.isArray(scenes) || scenes.length === 0) return [];

  // Normalizzo tutte le scene
  let working = scenes.map(normalizeScene);

  // 1) Hook Surgeon
  if (enableHookSurgeon) {
    working = applyHookSurgeon(working, { idea, segment });
  }

  // 2) Domande di retention
  if (enableRetentionQuestions) {
    working = insertRetentionQuestions(working, retentionInterval);
  }

  // 3) Marker per Fliki
  if (enableFlikiMarkers) {
    working = addFlikiMarkers(working);
  }

  return working;
}

// ==================================================
// FILE: C:\Users\christian.SYSTEMA\OneDrive\Immagini\SALUTE E BENESSERE\NUOVI VIDEO FLIKI\YOUTUBE COACH PRO DA ATTIVARE\APPLICAZIONE GITHUB\zen-youtube-coach-backend\src\utils\wordDuration.js
// ==================================================

// ============================================================
//  wordDuration.js  calcolo parole e durata stimata
// ============================================================

export function countWords(text = "") {
  if (typeof text !== "string") return 0;
  const cleaned = text.trim();
  if (!cleaned) return 0;
  return cleaned.split(/\s+/).length;
}

export function formatDuration(seconds) {
  const total = Math.max(0, Math.round(seconds));
  const m = Math.floor(total / 60);
  const s = total % 60;
  const ss = s.toString().padStart(2, "0");
  return `${m}:${ss}`;
}

export function estimateSceneDurations(scenes, wpm = 145) {
  if (!Array.isArray(scenes)) {
    return {
      scenesWithTime: [],
      totalWords: 0,
      totalDurationSec: 0,
      totalDurationFormatted: "0:00",
    };
  }

  const wordsPerSecond = wpm / 60;
  let totalWords = 0;
  let totalDurationSec = 0;

  const scenesWithTime = scenes.map((scene) => {
    const text = typeof scene.text === "string" ? scene.text : String(scene.text ?? "");
    const wordCount = countWords(text);
    const durationSec = wordCount / wordsPerSecond;

    totalWords += wordCount;
    totalDurationSec += durationSec;

    return {
      ...scene,
      wordCount,
      estimatedDurationSec: Math.round(durationSec),
      estimatedDurationFormatted: formatDuration(durationSec),
    };
  });

  return {
    scenesWithTime,
    totalWords,
    totalDurationSec: Math.round(totalDurationSec),
    totalDurationFormatted: formatDuration(totalDurationSec),
  };
}

