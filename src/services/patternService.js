import OpenAI from "openai";import { OPENAI_API_KEY } from "../config/openai.js";const client = new OpenAI({ apiKey: OPENAI_API_KEY });export async function runPatternAnalysis(videos) {  // Pulizia dati dei video  const cleaned = videos.map(v => ({    title: v.title,    description: v.description,    views: v.views,    likes: v.likes,    comments: v.comments,    channelSubs: v.channel?.subs || 0  }));  const prompt = `Sei un analista professionista YouTube specializzato in CTR, Retention e Trend.Analizza questi 5 video e produci SOLO JSON valido nel seguente formato:{  "patternSummary": "",  "idealVideoBlueprint": {    "idealLengthMinutes": 0,    "idealTitleStyle": "",    "idealDescriptionStructure": "",    "idealHookFirst10Seconds": "",    "idealCTAStyle": ""  },  "recurringElements": [],  "mistakesToAvoid": [],  "checklistForMyChannel": [],    "zenPattern": {    "summary": "",    "idealVideoBlueprint": {},    "recurringElements": [],    "mistakesToAvoid": [],    "checklist": []  },  "nextVideoIdea": {    "title": "",    "hook": "",    "intro": "",    "whyItWorks": ""  }}Ecco i 5 video da analizzare:${JSON.stringify(cleaned, null, 2)}  `;  const response = await client.responses.create({    model: "gpt-5.1-mini",    input: prompt  });  try {    const raw = response.output_text.trim();    const first = raw.indexOf("{");    const last = raw.lastIndexOf("}");    return JSON.parse(raw.substring(first, last + 1));  } catch (err) {    return { error: "Invalid JSON", raw: response.output_text };  }}