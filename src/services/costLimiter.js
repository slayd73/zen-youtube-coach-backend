import fs from "fs";import path from "path";const COST_FILE = path.resolve("cost-usage.json");// Carica lo statofunction loadState() {  if (!fs.existsSync(COST_FILE)) {    return { month: getCurrentMonth(), used: 0 };  }  return JSON.parse(fs.readFileSync(COST_FILE, "utf-8"));}function saveState(state) {  fs.writeFileSync(COST_FILE, JSON.stringify(state, null, 2));}function getCurrentMonth() {  return new Date().toISOString().slice(0, 7); // es: "2025-11"}export function initCostLimiter(limitEuro = 10) {  return {    limitEuro,    checkAndConsume(costEuro) {      const state = loadState();      const currentMonth = getCurrentMonth();      // Reset mensile      if (state.month !== currentMonth) {        state.month = currentMonth;        state.used = 0;      }      // Se superiamo il limite → blocco      if (state.used + costEuro > this.limitEuro) {        throw new Error(          `BUDGET SUPERATO: limite ${this.limitEuro}€, usati ${state.used.toFixed(            2          )}€. Richiesta bloccata.`        );      }      // Aggiorna consumo      state.used += costEuro;      saveState(state);      return state.used;    },    getUsage() {      return loadState();    },  };}