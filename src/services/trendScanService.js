// services/trendScanService.jsimport Groq from "groq-sdk";import dotenv from "dotenv";dotenv.config();const client = new Groq({  apiKey: process.env.GROQ_API_KEY});/** * Forza il modello a rispondere in JSON * Taglia eventuali testi extra prima/dopo */function cleanJSON(raw) {  try {    const first = raw.indexOf("{");    const last = raw.lastIndexOf("}");    const jsonString = raw.substring(first, last + 1);    return JSON.parse(jsonString);  } catch (e) {    console.error("❌ JSON_PARSE_ERROR:", e, "\nRAW:", raw);    return { error: "JSON_PARSE_ERROR", raw };  }}/** * Trend Scan PRO – Segmentazione 50/60/70 */export async function TrendScanPro() {  const prompt = `Sei un YouTube Trend Analyst esperto in pubblico over 50, over 60 e over 70.Analizza SOLO la nicchia: salute, benessere, alimentazione, lunga vita.Genera massimo 20 trend attivi dal 2024 a oggi.Per ogni trend crea:- topic- audience_relevance: { over50, over60, over70 }- score 1-100 (opportunity)- volume (alto/medio/basso)- competition (bassa/media/alta)- longevity_days (durata prevista)- best_day- best_hour- 2 subtopics- 1 video idea ottimizzata per il canale Zen Salute e BenessereRISPONDI SOLO IN JSON.  `;  const response = await client.chat.completions.create({    model: "llama-3.1-70b-versatile",    temperature: 0.3,    max_tokens: 4096,    messages: [      { role: "system", content: "Sei un analista di trend YouTube professionale." },      { role: "user", content: prompt }    ]  });  const content = response.choices[0].message.content;  return cleanJSON(content);}