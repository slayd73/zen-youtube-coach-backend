// ======================================================================// üéß transcriptService.js ‚Äî Zen YouTube Coach Pro (2025 - OPTION B)// AI Transcript Premium + YouTube Metadata (senza usare transcript reali)// ======================================================================import { callAIModel } from "./aiEngine.js";import { fetchYouTubeMetadata } from "./youtubeMetadata.js";import {  naturalParagraphsFromText,  mergeSegmentsToText} from "./transcriptUtils.js";const transcriptCache = new Map();// ======================================================================// üßº CLEAN TEXT// ======================================================================function cleanText(text) {  return String(text || "")    .replace(/\r?\n|\r/g, " ")    .replace(/\s{2,}/g, " ")    .trim();}// ======================================================================// ‚úçÔ∏è TRANSCRIPT MANUALE (incollato dall‚Äôutente)// ======================================================================export async function processManualTranscript(rawText) {  if (!rawText || !String(rawText).trim()) {    return {      success: false,      message: "Transcript manuale vuoto."    };  }  const cleaned = cleanText(rawText);  const paragraphs = naturalParagraphsFromText(cleaned, 250);  const polishPrompt = `Migliora la leggibilit√† del testo seguente:- Non cambiare i contenuti- Aggiungi solo punteggiatura- Nessuna lista- Nessun riassuntoTesto:"""${cleaned}"""  `.trim();  let aiPolished = await callAIModel(polishPrompt, "text", {    temperature: 0.25,    maxTokens: 4000  });  aiPolished = aiPolished ? cleanText(aiPolished) : cleaned;  return {    success: true,    provider: "manual",    videoId: null,    continuousText: cleaned,    aiText: aiPolished,    paragraphs,    segments: []  };}// ======================================================================// üî• GENERATORE DI TRANSCRIPT AI PREMIUM// ======================================================================async function generateAITranscript(title, description) {  const prompt = `Genera un transcript completo e naturale per un video YouTube basandoti su:TITOLO:${title}DESCRIZIONE:${description || "(non disponibile)"}Regole:- 6‚Äì10 paragrafi lunghi- Stile parlato, naturale- Nessuna frase tipo "non posso accedere"- Nessun riferimento all'AI- Nessun elenco puntato- Inizia direttamente con il contenuto- Tema coerente con titolo e descrizione- Durata stimata: 8‚Äì12 minutiTranscript:  `.trim();  const raw = await callAIModel(prompt, "text", {    temperature: 0.35,    maxTokens: 7000  });  return cleanText(raw || "");}// ======================================================================// üöÄ getTranscript (VERSIONE B ‚Äî SOLO METADATA + AI Premium)// ======================================================================export async function getTranscript(videoIdOrUrl) {  try {    if (!videoIdOrUrl) {      return { error: true, message: "videoIdOrUrl mancante" };    }    if (transcriptCache.has(videoIdOrUrl)) {      return transcriptCache.get(videoIdOrUrl);    }    // 1Ô∏è‚É£ Recupera METADATA (titolo + thumbnail + author)    const meta = await fetchYouTubeMetadata(videoIdOrUrl);    if (meta.error || !meta.title) {      return {        success: false,        message: "Impossibile recuperare i metadata YouTube",        provider: "metadata-failed"      };    }    // 2Ô∏è‚É£ Genera transcript AI    const aiText = await generateAITranscript(      meta.title,      meta.description || ""    );    const result = {      success: true,      provider: "ai-premium-summary",      videoId: meta.videoId,      title: meta.title,      description: meta.description || "",      thumbnail: meta.thumbnail || "",      aiText,      continuousText: aiText,      paragraphs: naturalParagraphsFromText(aiText, 250),      segments: []    };    transcriptCache.set(videoIdOrUrl, result);    return result;  } catch (err) {    return {      success: false,      message: err.message || "Errore transcriptService"    };  }}