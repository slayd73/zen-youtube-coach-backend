import express from "express";import { callAI } from "../services/aiService.js";import { getDefaultProfile, getProfileByHandle } from "../services/profileManager.js";const router = express.Router();router.post("/title", async (req, res) => {  try {    const { idea, handle } = req.body;    if (!idea) {      return res.status(400).json({ error: "Missing 'idea' field" });    }    const profile = handle ? getProfileByHandle(handle) : getDefaultProfile();    const prompt = `Sei un Title Engineer per il canale YouTube "${profile.channelName}".Pubblico: ${profile.targetAudience.join(", ")}.Crea SOLO JSON valido.{  "idea": "",  "titles": ["t1","t2","t3","t4","t5"],  "best": ""}Argomento:"${idea}"`;    const aiRaw = await callAI(prompt, {      model: "gpt-4o-mini",      temperature: 0.9,      max_tokens: 1200    });    const aiResponse = typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;    return res.json({      success: true,      result: {        profile,        idea: aiResponse.idea || idea,        titles: aiResponse.titles,        best: aiResponse.best || aiResponse.titles[0]      }    });  } catch (err) {    return res.status(500).json({ error: "Internal Server Error" });  }});export default router;