// ======================================================// üß± /outline-generator ‚Äî Generatore scaletta video// ======================================================import express from "express";import { callAIModel } from "../services/aiEngine.js";const router = express.Router();/** * Body: * { *   "topic": "tema del video", *   "audience": "over60", *   "forceProvider": "auto|groq|openai" * } */router.post("/", async (req, res) => {  try {    const {      topic,      audience = "over60",      forceProvider = "auto"    } = req.body || {};    if (!topic) {      return res.status(400).json({        ok: false,        error: "Missing 'topic'"      });    }    const prompt = `Genera una scaletta dettagliata per un video YouTube sul tema:"${topic}"Target: ${audience} (salute, benessere, longevit√†).Rispondi SOLO con JSON nel formato:{  "titoloProposto": "...",  "hookIniziale": "...",  "sezioni": [    {      "titolo": "Sezione 1",      "obiettivo": "Cosa deve capire/sentire lo spettatore",      "puntiChiave": ["punto 1", "punto 2"],      "durataStimataSec": 60    }  ],  "ctaFinale": "Testo CTA finale"}`.trim();    const aiResp = await callAIModel(prompt, "json", {      task: "outline",      temperature: 0.35,      maxTokens: 4000,      forceProvider    });    if (aiResp?.error) {      return res.status(502).json({        ok: false,        error: "AI outline generation failed",        details: aiResp      });    }    return res.json({      ok: true,      providerUsed: forceProvider,      data: aiResp    });  } catch (err) {    console.error("‚ùå /outline-generator ERROR:", err);    res.status(500).json({      ok: false,      error: "outline-generator route crashed",      details: err.message    });  }});export default router;