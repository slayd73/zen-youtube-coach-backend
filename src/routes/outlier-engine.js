// ============================================================// ðŸ”¥ OUTLIER ANALYZER â€” Zen YouTube Coach Pro (Ultra Premium)// Analisi predittiva dei video: hook, ritenzione, narrativa,// potenziale virale, punti deboli, fix immediati.// ============================================================import express from "express";import { callAIModel } from "../services/aiEngine.js";import { extractYouTubeId, fetchTranscript } from "../services/youtubeTools.js";const router = express.Router();// Debug rapido: verifica che la route sia montatarouter.get("/ping", (req, res) => {  return res.json({    ok: true,    route: "/outlier-engine/ping",    message: "Outlier Engine attivo",  });});// ---------------------------------------------// ðŸ§  Prompt: algoritmo Outlier Analyzer// ---------------------------------------------function buildPrompt(transcript, audience) {  return `Sei "Zen Outlier Engine", lâ€™AI piÃ¹ avanzata al mondo per la previsione delle performance video.Analizza questo transcript e produci:1. Valutazioni numeriche (0â€“100):   - Viral Potential   - Hook Power   - Retention Forecast   - Emotional Energy   - Novelty Factor2. Analisi qualitativa:   - Analisi primi 30 secondi   - Ritmo narrativo   - Mappa emozionale   - Forza dellâ€™idea   - Chiarezza della promessa3. Diagnosi profonda:   - 5 punti di forza   - 5 punti deboli   - 5 opportunitÃ  di crescita   - 5 fix immediati4. Previsioni:   - Performance previsionale a 24h, 48h, 7 giorniTarget: pubblico ${audience}.Rispondi SOLO in questo JSON:{  "score": {    "viralPotential": 0,    "hookPower": 0,    "retentionForecast": 0,    "emotionalEnergy": 0,    "noveltyFactor": 0  },  "analysis": {    "hook": "",    "structure": "",    "strengths": [],    "weaknesses": [],    "opportunities": [],    "immediateFixes": [],    "predictions": {      "24h": "",      "48h": "",      "7days": ""    }  }}TRANSCRIPT ANALIZZATO:${transcript}`;}// ---------------------------------------------// ðŸš€ Route principale// ---------------------------------------------router.post("/", async (req, res) => {  try {    const { url, audience } = req.body;    if (!url) return res.status(400).json({ error: "URL mancante." });    const videoId = extractYouTubeId(url);    if (!videoId) return res.status(400).json({ error: "URL YouTube non valido." });    // Recupera transcript    const transcript = await fetchTranscript(videoId);    if (!transcript) {      return res.status(500).json({ error: "Impossibile estrarre il transcript." });    }    // Prepara il prompt    const prompt = buildPrompt(transcript, audience || "over60");    // Chiama il modello AI    const aiResponse = await callAIModel(prompt, "json");    res.json({      success: true,      outlier: aiResponse    });  } catch (error) {    console.error("ðŸ”¥ Errore OUTLIER ENGINE:", error);    res.status(500).json({ error: "Errore interno del server." });  }});export default router;