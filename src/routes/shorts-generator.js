// ======================================================// üé¨ /shorts-generator ‚Äî Ideen e script per Shorts// ======================================================import express from "express";import { callAIModel } from "../services/aiEngine.js";const router = express.Router();/** * Body: * { *   "topic": "tema opzionale", *   "transcript": "testo lungo opzionale", *   "audience": "over60", *   "forceProvider": "auto" * } * Almeno topic O transcript devono essere presenti. */router.post("/", async (req, res) => {  try {    const {      topic = "",      transcript = "",      audience = "over60",      forceProvider = "auto"    } = req.body || {};    if (!topic && !transcript) {      return res.status(400).json({        ok: false,        error: "Provide at least 'topic' or 'transcript'"      });    }    const base = topic || transcript.slice(0, 2000);    const prompt = `Genera idee di YouTube Shorts sul tema seguente:"${base}"Target: ${audience}Rispondi SOLO con JSON nel formato:{  "shorts": [    {      "titolo": "Titolo breve",      "hookIniziale": "prima frase che blocca lo scroll",      "script": "testo completo (max 45-50 secondi)",      "testoSovraimpresso": ["max 3-4 parole"],      "callToAction": "..."    }  ]}`.trim();    const aiResp = await callAIModel(prompt, "json", {      task: "shorts",      temperature: 0.45,      maxTokens: 5000,      forceProvider    });    if (aiResp?.error) {      return res.status(502).json({        ok: false,        error: "AI shorts generation failed",        details: aiResp      });    }    return res.json({      ok: true,      providerUsed: forceProvider,      data: aiResp    });  } catch (err) {    console.error("‚ùå /shorts-generator ERROR:", err);    res.status(500).json({      ok: false,      error: "shorts-generator route crashed",      details: err.message    });  }});export default router;