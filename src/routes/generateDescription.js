// ============================================================// üìù generateDescription.js ‚Äî Descrizioni + Hashtag + Chapters// ============================================================import express from "express";import { callAI } from "../services/aiService.js";import {  getDefaultProfile,  getProfileByHandle} from "../services/profileManager.js"; // ‚úÖ FIX DEFINITIVOconst router = express.Router();/** * POST /generate/description * Body: { title, idea?, keywords?, handle? } */router.post("/description", async (req, res) => {  try {    const { title, idea, keywords = [], handle } = req.body;    if (!title) {      return res.status(400).json({ error: "Missing 'title' field" });    }    const profile = handle      ? getProfileByHandle(handle)      : getDefaultProfile();    const prompt = `Sei un YouTube SEO Writer per il canale "${profile.channelName}".Pubblico: ${profile.targetAudience.join(", ")}.Linguaggio: italiano.Tono: semplice, umano, amichevole, non medico.Genera SOLO JSON valido.üéØ OBIETTIVO:- Descrizione ottimizzata per Over 50/60/70- Invito a iscriversi al canale "${profile.channelName}"- Testo scorrevole e motivante- Inserire hashtag rilevanti- Inserire chapters utiliüìå FORMATO JSON:{  "title": "",  "description": "",  "hashtags": ["#esempio1", "#esempio2"],  "chapters": [    { "time": "00:00", "label": "Intro" },    { "time": "01:15", "label": "Problema principale" }  ]}Titolo:"${title}"Idea:"${idea || ""}"Keywords:${Array.isArray(keywords) && keywords.length > 0 ? keywords.join(", ") : "nessuna"}Rispondi SOLO con JSON.`;    const aiRaw = await callAI(prompt, {      model: "gpt-4o-mini",      temperature: 0.7,      max_tokens: 2000    });    const aiResponse =      typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;    if (!aiResponse || !aiResponse.description) {      throw new Error("Invalid AI response format from /generate/description");    }    return res.json({      success: true,      result: {        profile,        title: aiResponse.title || title,        description: aiResponse.description,        hashtags: aiResponse.hashtags || [],        chapters: aiResponse.chapters || []      }    });  } catch (err) {    console.error("‚ùå /generate/description error:", err);    return res.status(500).json({ error: "Internal Server Error" });  }});export default router;