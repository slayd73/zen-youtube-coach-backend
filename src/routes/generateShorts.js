// =======================================================// üé¨ generateShorts.js ‚Äî Shorts Generator (Premium)// =======================================================import express from "express";import { callAI } from "../services/aiService.js";import {  getDefaultProfile,  getProfileByHandle} from "../services/profileManager.js";   // ‚úÖ FIX DEFINITIVOconst router = express.Router();/** * POST /generate/shorts * Genera 1‚Äì5 shorts ottimizzati per pubblico Over50/60/70 * con hook ultra forti e CTA strategiche. */router.post("/shorts", async (req, res) => {  try {    const { idea, profileHandle, count = 3 } = req.body || {};    if (!idea) {      return res.status(400).json({ error: "Missing 'idea' field" });    }    // Carica profilo corretto    const profile =      profileHandle        ? await getProfileByHandle(profileHandle)        : await getDefaultProfile();    const profileDescription = profile?.description      || "Pubblico Over 50, Over 60 e Over 70, interessato a salute, energia, cibo sano, movimenti semplici.";    const prompt = `Sei "Zen Shorts Coach Pro", specializzato in pubblico Over 50/60/70.Crea SOLO JSON valido.OBIETTIVO:‚Äì Shorts virali (15‚Äì45 secondi)‚Äì Hook emotivi e shock‚Äì Linguaggio semplice, diretto‚Äì 1 CTA finale leggera, non aggressivaFORMAT JSON:{  "shorts": [    {      "id": 1,      "hook": "",      "body": "",      "cta": ""    }  ]}Profilo del canale:${profileDescription}Tema richiesto:"${idea}"Genera esattamente ${Math.min(Math.max(count, 1), 5)} shorts.`;    const aiRaw = await callAI(prompt, {      model: "gpt-4o-mini",      temperature: 0.85,      max_tokens: 2000    });    const aiResponse =      typeof aiRaw === "string" ? JSON.parse(aiRaw) : aiRaw;    return res.json({      success: true,      profile,      result: aiResponse    });  } catch (err) {    console.error("‚ùå /generate/shorts ERROR:", err);    return res.status(500).json({      error: "Internal Server Error",      details: err.message    });  }});export default router;