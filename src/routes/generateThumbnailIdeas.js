import express from "express";import { callAI } from "../services/aiService.js";import {  getDefaultProfile,  getProfileByHandle,} from "../services/profileManager.js";const router = express.Router();async function resolveProfile(profileHandle) {  try {    if (profileHandle) {      const p = await getProfileByHandle(profileHandle);      if (p) return p;    }  } catch {}  try {    const def = await getDefaultProfile();    if (def) return def;  } catch {}  return {    handle: "zen-default-over50-70",    label: "Over 50/60/70 â€“ Salute e Benessere",    description:      "Pubblico Over 50, Over 60 e Over 70, interessato a sonno, salute semplice, alimentazione pratica e movimento dolce.",  };}router.post("/thumbnailIdeas", async (req, res) => {  try {    const { idea, scriptText, profileHandle } = req.body || {};    if (!idea && !scriptText) {      return res        .status(400)        .json({ error: "Provide at least 'idea' or 'scriptText'" });    }    const profile = await resolveProfile(profileHandle);    const profileDescription = profile?.description;    const base = scriptText      ? String(scriptText).slice(0, 2000)      : `Tema: ${idea}`;    const prompt = `Genera 3 idee di thumbnail Over50/60/70 per YouTube.SOLO JSON:{ "thumbnails":[   {     "id":1,     "styleLabel":"",     "prompt":"",     "textOverlay":"",     "colors":[],     "focalPoint":"",     "notes":""   } ]}Idea:"${idea}"`;    const aiResponse = await callAI(prompt, {      model: "gpt-4o-mini",      temperature: 0.8,      max_tokens: 1500,    });    return res.json({      success: true,      result: aiResponse,    });  } catch (err) {    return res.status(500).json({ error: "Internal Server Error" });  }});export default router;