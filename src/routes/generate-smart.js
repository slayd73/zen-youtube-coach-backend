// ======================================================// ğŸš€ /generate-smart â€” Script Generator SMART// Integra Trend + Compare + Script generator// ======================================================import express from "express";import { callAIModel } from "../services/aiEngine.js";import { safeParseJSON } from "../utils/jsonUtils.js";const router = express.Router();router.post("/script", async (req, res) => {  try {    const { topic, trendData, dnaData, targetAge = "over50" } = req.body;    if (!topic || !trendData || !dnaData) {      return res.status(400).json({        error: "Missing 'topic', 'trendData' or 'dnaData' in request body."      });    }    const prompt = `ğŸ¯ Genera uno SCRIPT YouTube ottimizzato basato su:ğŸ”¥ TOPIC: ${topic}ğŸ“Š TREND DATA (dal modulo Trend DeepSearch):${JSON.stringify(trendData, null, 2)}ğŸ§¬ WINNING CONTENT DNA (dal modulo Compare Transcript):${JSON.stringify(dnaData, null, 2)}ğŸ¯ TARGET: ${targetAge}, pubblico reale (Italia)ğŸ¥ STILE: Zen Salute e Benessere (caldo, empatico, semplice, autorevole)ğŸ”¹ Output richiesto IN JSON, diviso in blocchi precisi:{  "hook": "",  "microStory": "",  "topicTransition": "",  "keySections": [    {"title": "", "content": "", "visualSuggestion": ""}  ],  "emotionalTrigger": "",  "cta": ""}Genera contenuti:âœ” Conversazionali, NON da chatbotâœ” Empatici per Over50/60/70âœ” Basati su paure reali, speranze concrete, soluzioni realisticheâœ” Pronti per Fliki/YouTube--- INIZIA ---`;    const response = await callAIModel(prompt, {      model: "gpt-4o-mini", // ottimizzato: qualitÃ  alta, costo basso      max_tokens: 3000,      temperature: 0.7    });    const result = safeParseJSON(response);    return res.json({      status: "success",      engine: "SMART",      targetAge,      data: result    });  } catch (err) {    console.error("âŒ Errore /generate-smart/script:", err);    res.status(500).json({ error: "Errore interno generazione script SMART." });  }});export default router;