// ============================================================// ðŸŽ¯ sceneTools.js â€” Boost Mode, Hook Surgeon, Fliki Markers// ============================================================/** * Template domande per retention (ogni 3 scene circa) */const RETENTION_QUESTIONS = [  "Quale di queste idee ti rispecchia di piÃ¹?",  "Ti sei mai trovato in una situazione simile?",  "Quale di questi consigli senti piÃ¹ vicino alla tua vita quotidiana?",  "Cosa ti colpisce di piÃ¹ di quello che hai ascoltato finora?"];/** * Restituisce una label umana per il segmento di etÃ  */function getSegmentLabel(segment) {  switch (segment) {    case "over50":      return "dopo i 50 anni";    case "over70":      return "dopo i 70 anni";    case "over60":    default:      return "dopo i 60 anni";  }}/** * ðŸ§  Hook Surgeon â€” riscrive la prima scena per massimizzare l'aggancio * Mantiene il ruolo HOOK, aggiunge brand + promessa chiara. */export function applyHookSurgeon(scenes, { idea, segment }) {  if (!Array.isArray(scenes) || scenes.length === 0) return scenes;  const [first, ...rest] = scenes;  const segmentLabel = getSegmentLabel(segment || "over60");  const originalText = (first.text || "").trim();  const topic = (idea || "migliorare la tua salute e il tuo benessere").toLowerCase();  const newHookText = `Benvenuto su Zen Salute e Benessere. Se hai superato l'etÃ  dei ${segmentLabel} e ti capita di fare fatica con il sonno o la stanchezza durante il giorno, questo video Ã¨ per te. Insieme vedremo passo passo cosa puoi fare nella vita di tutti i giorni per ${topic}, con esempi semplici e concreti, senza termini medici complicati. ${originalText}`.trim();  return [    {      ...first,      role: "HOOK",      text: newHookText    },    ...rest  ];}/** * ðŸ’¬ Domande di retention â€” aggiunge una domanda ogni N scene * (senza toccare CTA e senza aggiungere doppie domande) */export function insertRetentionQuestions(scenes, interval = 3) {  if (!Array.isArray(scenes) || scenes.length === 0) return scenes;  let questionIndex = 0;  return scenes.map((scene, idx) => {    const output = { ...scene };    const text = (output.text || "").trim();    // salta CTA e scene che giÃ  finiscono con ?    if (      (idx + 1) % interval !== 0 ||      output.role === "CTA" ||      text.endsWith("?")    ) {      return output;    }    const q = RETENTION_QUESTIONS[questionIndex % RETENTION_QUESTIONS.length];    questionIndex += 1;    output.text = `${text} ${q}`.trim();    return output;  });}/** * ðŸŽ¨ Fliki AutoScene Mode â€” aggiunge [SCENE_CHANGE] a fine scena * (senza usare costanti non definite, tutto come stringa) */export function addFlikiMarkers(scenes) {  if (!Array.isArray(scenes) || scenes.length === 0) return scenes;  const MARKER = " [SCENE_CHANGE]";  return scenes.map((scene, idx) => {    const output = { ...scene };    const text = (output.text || "").trim();    // Se il marker giÃ  c'Ã¨, non lo duplico    if (text.includes("[SCENE_CHANGE]")) {      output.text = text;      return output;    }    // Puoi decidere se saltare l'ultima scena; per ora lo mettiamo ovunque    output.text = `${text}${MARKER}`;    return output;  });}/** * ðŸ§© Normalizza scena (id, role, text) */function normalizeScene(scene, index) {  const out = { ...scene };  if (typeof out.id !== "number") {    out.id = index + 1;  }  if (typeof out.role !== "string") {    out.role = "SPIEGAZIONE";  }  if (typeof out.text !== "string") {    out.text = String(out.text || "");  }  return out;}/** * ðŸš€ applyBoostModes â€” applica in sequenza: * Hook Surgeon â†’ domande retention â†’ Fliki markers */export function applyBoostModes(scenes, options = {}) {  const {    idea,    segment = "over60",    enableHookSurgeon = true,    enableRetentionQuestions = true,    retentionInterval = 3,    enableFlikiMarkers = true  } = options;  if (!Array.isArray(scenes) || scenes.length === 0) return [];  // Normalizzo tutte le scene  let working = scenes.map(normalizeScene);  // 1) Hook Surgeon  if (enableHookSurgeon) {    working = applyHookSurgeon(working, { idea, segment });  }  // 2) Domande di retention  if (enableRetentionQuestions) {    working = insertRetentionQuestions(working, retentionInterval);  }  // 3) Marker per Fliki  if (enableFlikiMarkers) {    working = addFlikiMarkers(working);  }  return working;}